<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring Security OAuth2 - Authorization Server | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="授权服务器 Introspection Endpoint：校验 Access Token 的合法性">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security OAuth2 - Authorization Server">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/09/13/microservices-governance-security-oauth2-spring-security-oauth2-authorization-server/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="授权服务器 Introspection Endpoint：校验 Access Token 的合法性">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png">
<meta property="article:published_time" content="2022-09-12T16:06:25.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.596Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Architecture">
<meta property="article:tag" content="Microservices">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Security">
<meta property="article:tag" content="Microservices Governance">
<meta property="article:tag" content="Oauth2">
<meta property="article:tag" content="Spring Security">
<meta property="article:tag" content="Spring Security OAuth2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spring Security OAuth2 - Authorization Server",
  "url": "https://blog.zhongmingmao.top/2022/09/13/microservices-governance-security-oauth2-spring-security-oauth2-authorization-server/",
  "image": "https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png",
  "datePublished": "2022-09-12T16:06:25.000Z",
  "dateModified": "2023-04-03T10:04:59.596Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/09/13/microservices-governance-security-oauth2-spring-security-oauth2-authorization-server/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring Security OAuth2 - Authorization Server',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Spring Security OAuth2 - Authorization Server</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Spring Security OAuth2 - Authorization Server</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-09-12T16:06:25.000Z" title="Created 2022-09-13 00:06:25">2022-09-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservices-governance/">Microservices Governance</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservices-governance/security/">Security</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservices-governance/security/oauth2/">Oauth2</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>6mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h1 id="授权服务器"><a href="#授权服务器" class="headerlink" title="授权服务器"></a>授权服务器</h1><blockquote>
<p><strong>Introspection Endpoint</strong>：校验 Access Token 的合法性</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102010635416.png" alt="image-20221102010635416"></p>
<span id="more"></span>

<h1 id="Spring-Security-OAuth2-架构"><a href="#Spring-Security-OAuth2-架构" class="headerlink" title="Spring Security OAuth2 架构"></a>Spring Security OAuth2 架构</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://terasolunaorg.github.io/guideline/5.3.0.RELEASE/en/_images/OAuth_OAuth2Architecture.png"></p>
<h1 id="Authorization-flow"><a href="#Authorization-flow" class="headerlink" title="Authorization flow"></a>Authorization flow</h1><h2 id="Authorization-Code-Flow"><a href="#Authorization-Code-Flow" class="headerlink" title="Authorization Code Flow"></a>Authorization Code Flow</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102000540824.png" alt="image-20221102000540824"></p>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security.oauth<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line">  String name;</span><br><span class="line">  String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;UserInfo&gt; <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">  <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">    UserInfo.builder()</span><br><span class="line">    .name(user.getUsername())</span><br><span class="line">    .email(user.getUsername() + <span class="string">&quot;@gmail.com&quot;</span>)</span><br><span class="line">    .build());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Authorization-Server"><a href="#Authorization-Server" class="headerlink" title="Authorization Server"></a>Authorization Server</h3><blockquote>
<p>Authorization Server + Client App<br><strong>authorization_code</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title class_">AuthorizationServerConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    clients</span><br><span class="line">        .inMemory()</span><br><span class="line">        .withClient(<span class="string">&quot;wechat&quot;</span>)</span><br><span class="line">        .secret(<span class="string">&quot;654321&quot;</span>)</span><br><span class="line">        .redirectUris(<span class="string">&quot;http://localhost:9000/callback&quot;</span>)</span><br><span class="line">        .authorizedGrantTypes(<span class="string">&quot;authorization_code&quot;</span>) <span class="comment">// 授权码模式</span></span><br><span class="line">        .scopes(<span class="string">&quot;read_userinfo&quot;</span>, <span class="string">&quot;read_contacts&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Resource-Server"><a href="#Resource-Server" class="headerlink" title="Resource Server"></a>Resource Server</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableResourceServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceServer</span> <span class="keyword">extends</span> <span class="title class_">ResourceServerConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .requestMatchers()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/api/**&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Resource-owner"><a href="#Resource-owner" class="headerlink" title="Resource owner"></a>Resource owner</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">zhongmingmao</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<h3 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h3><blockquote>
<p>未授权</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;http://localhost:8000/api/user&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &quot;unauthorized&quot;,</span><br><span class="line">  &quot;error_description&quot;: &quot;Full authentication is required to access this resource&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>获取授权码，<strong>response_type&#x3D;code</strong><br>浏览器：<a target="_blank" rel="noopener" href="http://localhost:8000/oauth/authorize?client_id=wechat&redirect_uri=http://localhost:9000/callback&response_type=code&scope=read_userinfo">http://localhost:8000/oauth/authorize?client_id=wechat&amp;redirect_uri=http://localhost:9000/callback&amp;response_type=code&amp;scope=read_userinfo</a></p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221103001315526.png" alt="image-20221103001315526"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221103001416403.png" alt="image-20221103001416403"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221103001636098.png" alt="image-20221103001636098"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&#x27;zhongmingmao:123456&#x27;</span> | <span class="built_in">base64</span></span></span><br><span class="line">emhvbmdtaW5nbWFvOjEyMzQ1Ng==</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl --location --request POST <span class="string">&#x27;http://localhost:8000/oauth/authorize&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Authorization: Basic emhvbmdtaW5nbWFvOjEyMzQ1Ng==&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;user_oauth_approval=true&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;scope.read_userinfo=true&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;authorize=Authorize&#x27;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>兑换授权码</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&#x27;wechat:654321&#x27;</span> | <span class="built_in">base64</span></span></span><br><span class="line">d2VjaGF0OjY1NDMyMQ==</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request POST <span class="string">&#x27;http://localhost:8000/oauth/token&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;content-type: application/x-www-form-urlencoded&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Authorization: Basic d2VjaGF0OjY1NDMyMQ==&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;code=6qhVz7&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;grant_type=authorization_code&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;redirect_uri=http://localhost:9000/callback&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;scope=read_userinfo&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;: &quot;1aac6db3-c304-45c1-ab9d-9c7d63da842d&quot;,</span><br><span class="line">  &quot;token_type&quot;: &quot;bearer&quot;,</span><br><span class="line">  &quot;expires_in&quot;: 43199,</span><br><span class="line">  &quot;scope&quot;: &quot;read_userinfo&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>访问资源</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;http://localhost:8000/api/user&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;authorization: Bearer 1aac6db3-c304-45c1-ab9d-9c7d63da842d&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;zhongmingmao&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;zhongmingmao@gmail.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Implicit-Grant-Flow"><a href="#Implicit-Grant-Flow" class="headerlink" title="Implicit Grant Flow"></a>Implicit Grant Flow</h2><blockquote>
<p>相对于授权码模式，减少了<strong>授权码兑换</strong>的过程，直接获得 Access Token，<strong>非常不安全</strong>！</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102001550406.png" alt="image-20221102001550406"></p>
<blockquote>
<p>代码结构与授权码类似</p>
</blockquote>
<h3 id="Authorization-Server-1"><a href="#Authorization-Server-1" class="headerlink" title="Authorization Server"></a>Authorization Server</h3><blockquote>
<p><strong>implicit</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title class_">AuthorizationServerConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    clients</span><br><span class="line">        .inMemory()</span><br><span class="line">        .withClient(<span class="string">&quot;wechat&quot;</span>)</span><br><span class="line">        .secret(<span class="string">&quot;654321&quot;</span>)</span><br><span class="line">        .redirectUris(<span class="string">&quot;http://localhost:9000/callback&quot;</span>)</span><br><span class="line">        .authorizedGrantTypes(<span class="string">&quot;implicit&quot;</span>)</span><br><span class="line">        .accessTokenValiditySeconds(<span class="number">1</span> &lt;&lt; <span class="number">8</span>)</span><br><span class="line">        .scopes(<span class="string">&quot;read_userinfo&quot;</span>, <span class="string">&quot;read_contacts&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flow-1"><a href="#Flow-1" class="headerlink" title="Flow"></a>Flow</h3><blockquote>
<p>直接获取 Access Token：<strong>response_type&#x3D;token</strong><br>浏览器：<a target="_blank" rel="noopener" href="http://localhost:8000/oauth/authorize?client_id=wechat&redirect_uri=http://localhost:9000/callback&response_type=token&scope=read_userinfo">http://localhost:8000/oauth/authorize?client_id=wechat&amp;redirect_uri=http://localhost:9000/callback&amp;response_type=token&amp;scope=read_userinfo</a></p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221103011001348.png" alt="image-20221103011001348"></p>
<blockquote>
<p>访问资源</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;http://localhost:8000/api/user&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;authorization: Bearer a5cf3dc2-d3e6-4915-aee3-155e95d9764e&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;zhongmingmao&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;zhongmingmao@gmail.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Resource-Owner-Password-Credentials-Flow"><a href="#Resource-Owner-Password-Credentials-Flow" class="headerlink" title="Resource Owner Password Credentials Flow"></a>Resource Owner Password Credentials Flow</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102001311093.png"></p>
<h3 id="Authorization-Server-2"><a href="#Authorization-Server-2" class="headerlink" title="Authorization Server"></a>Authorization Server</h3><blockquote>
<p><strong>password</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAuthorizationServer</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServer</span> <span class="keyword">extends</span> <span class="title class_">AuthorizationServerConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 认证</span></span><br><span class="line">  AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    endpoints.authenticationManager(authenticationManager);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    clients</span><br><span class="line">        .inMemory()</span><br><span class="line">        .withClient(<span class="string">&quot;wechat&quot;</span>)</span><br><span class="line">        .secret(<span class="string">&quot;654321&quot;</span>)</span><br><span class="line">        .authorizedGrantTypes(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">        .scopes(<span class="string">&quot;read_userinfo&quot;</span>, <span class="string">&quot;read_contacts&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Flow-2"><a href="#Flow-2" class="headerlink" title="Flow"></a>Flow</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&#x27;wechat:654321&#x27;</span> | <span class="built_in">base64</span></span></span><br><span class="line">d2VjaGF0OjY1NDMyMQ==</span><br></pre></td></tr></table></figure>

<blockquote>
<p>客户应用直接使用<strong>用户账密</strong>去授权服务器申请 Access Token</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request POST <span class="string">&#x27;http://localhost:8000/oauth/token&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;accept: application/json&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;content-type: application/x-www-form-urlencoded&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Authorization: Basic d2VjaGF0OjY1NDMyMQ==&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;grant_type=password&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;username=zhongmingmao&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;password=123456&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;scope=read_userinfo&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;: &quot;e2849e93-125d-444a-862e-acc2c3a0bad9&quot;,</span><br><span class="line">  &quot;token_type&quot;: &quot;bearer&quot;,</span><br><span class="line">  &quot;expires_in&quot;: 43145,</span><br><span class="line">  &quot;scope&quot;: &quot;read_userinfo&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;http://localhost:8000/api/user&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;authorization: Bearer e2849e93-125d-444a-862e-acc2c3a0bad9&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;zhongmingmao&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;zhongmingmao@gmail.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Client-Credentials-Flow"><a href="#Client-Credentials-Flow" class="headerlink" title="Client Credentials Flow"></a>Client Credentials Flow</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102002252924.png"></p>
<h3 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;UserInfo&gt;&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">  List&lt;UserInfo&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">  users.add(UserInfo.builder().name(<span class="string">&quot;zhongmingmao&quot;</span>).email(<span class="string">&quot;zhongmingmao@gmail.com&quot;</span>).build());</span><br><span class="line">  users.add(UserInfo.builder().name(<span class="string">&quot;zhongmingwu&quot;</span>).email(<span class="string">&quot;zhongmingmao@outlook.com&quot;</span>).build());</span><br><span class="line">  <span class="keyword">return</span> ResponseEntity.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Authorization-Server-3"><a href="#Authorization-Server-3" class="headerlink" title="Authorization Server"></a>Authorization Server</h3><blockquote>
<p><strong>client_credentials</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">clients</span><br><span class="line">  .inMemory()</span><br><span class="line">  .withClient(<span class="string">&quot;wechat&quot;</span>)</span><br><span class="line">  .secret(<span class="string">&quot;654321&quot;</span>)</span><br><span class="line">  .authorizedGrantTypes(<span class="string">&quot;client_credentials&quot;</span>)</span><br><span class="line">  .scopes(<span class="string">&quot;read_userinfo&quot;</span>, <span class="string">&quot;read_contacts&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Flow-3"><a href="#Flow-3" class="headerlink" title="Flow"></a>Flow</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&#x27;wechat:654321&#x27;</span> | <span class="built_in">base64</span></span></span><br><span class="line">d2VjaGF0OjY1NDMyMQ==</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request POST <span class="string">&#x27;http://localhost:8000/oauth/token&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Authorization: Basic d2VjaGF0OjY1NDMyMQ==&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;grant_type=client_credentials&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-urlencode <span class="string">&#x27;scope=read_userinfo&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;: &quot;5954cfbc-5b1b-4699-9478-8233774c05c6&quot;,</span><br><span class="line">  &quot;token_type&quot;: &quot;bearer&quot;,</span><br><span class="line">  &quot;expires_in&quot;: 43199,</span><br><span class="line">  &quot;scope&quot;: &quot;read_userinfo&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;http://localhost:8000/api/users&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;authorization: Bearer 5954cfbc-5b1b-4699-9478-8233774c05c6&#x27;</span> | jq</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;name&quot;: &quot;zhongmingmao&quot;,</span><br><span class="line">    &quot;email&quot;: &quot;zhongmingmao@gmail.com&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;name&quot;: &quot;zhongmingwu&quot;,</span><br><span class="line">    &quot;email&quot;: &quot;zhongmingmao@outlook.com&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/image-20221102004642403.png"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://time.geekbang.org/course/intro/100007001">微服务架构实战 160 讲</a></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/09/13/microservices-governance-security-oauth2-spring-security-oauth2-authorization-server/">https://blog.zhongmingmao.top/2022/09/13/microservices-governance-security-oauth2-spring-security-oauth2-authorization-server/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/architecture/">Architecture</a><a class="post-meta__tags" href="/tags/microservices/">Microservices</a><a class="post-meta__tags" href="/tags/spring/">Spring</a><a class="post-meta__tags" href="/tags/security/">Security</a><a class="post-meta__tags" href="/tags/microservices-governance/">Microservices Governance</a><a class="post-meta__tags" href="/tags/oauth2/">Oauth2</a><a class="post-meta__tags" href="/tags/spring-security/">Spring Security</a><a class="post-meta__tags" href="/tags/spring-security-oauth2/">Spring Security OAuth2</a></div><div class="post-share"><div class="social-share" data-image="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/09/14/microservices-governance-security-oauth2-authorization-code-flow/" title="Oauth2 - Authorization Code Flow"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Oauth2 - Authorization Code Flow</div></div><div class="info-2"><div class="info-item-1">Authorization ServerMaven12345678910111213141516171819&lt;dependencies&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt;    &lt;artif...</div></div></div></a><a class="pagination-related" href="/2022/09/12/microservices-governance-security-oauth2-overview/" title="Oauth2 - Overview"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Oauth2 - Overview</div></div><div class="info-2"><div class="info-item-1">问题域 开放系统间授权     账号密码 不安全   万能钥匙 适用于公司内部   特殊令牌 核心挑战是令牌的生命周期管理   微服务安全 核心是 Token   OAuth2最简向导 正式定义 Token 是核心，可类比为仆从钥匙（给应用授予有限的访问权限，让应用代表用户去访问用户数据）   优劣主要优势 OAuth2 使用代理授权的方式解决密码共享的反模式问题   主要劣势 OAuth2 不是认证协议，而是一个代理授权框架   OAuth2 提供一个宽泛的协议框架，具体安全场景需要定制   主要角色 主要术语  Token 类型 常见误区 典型 Flow https://www.rfc-editor.org/rfc/rfc6749  Authorization Code Flow 最复杂 + 最安全 + 应用最广泛   Implicit Grant Flow 减少了授权码兑换的过程（通过 Script 解析 Access Token），适用于单页应用（无后端）   Resource Owner Password Credentials Flow 适用于公司内部应用等风险可控的场景   Client ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/09/21/microservices-governance-security-architecture/" title="Microservices - Security Architecture"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/security-architecture.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="info-item-2">Microservices - Security Architecture</div></div><div class="info-2"><div class="info-item-1">Option 1 Access Token 为透明令牌，API 网关需要去授权服务器集中校验并兑换成 JWT（自校验），然后再传递到后续的微服务缺点：授权服务器压力比较大     Option 2 全链路无状态，API 网关与授权服务器约定一致的 secret，API 网关可以直接解密 JWT（对称&#x2F;非对称）缺点：缺少集中校验 Token 的环节，无法通过授权服务器及时吊销，只能等 Token 自然过期   Option 3 生产环境最为常用：原理与 Option 1 类似，只是增加了 Redis 缓存   Reference 微服务架构实战 160 讲  </div></div></div></a><a class="pagination-related" href="/2022/09/20/microservices-governance-security-oauth2-github/" title="Oauth2 - Github"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/oauth2-01.svg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-20</div><div class="info-item-2">Oauth2 - Github</div></div><div class="info-2"><div class="info-item-1">Module   模块 描述    spring-security-oauth2-core OAuth2 授权框架 + OIDC 核心数据结构及接口   spring-security-oauth2-jose 支持 JOSE 协议组JWT: JSON Web TokenJWS: JSON Web SignatureJWE: JSON Web EncryptionJWK: JSON Web Key   spring-security-oauth2-client 支持 OAuth2 和 OIDC 的客户端     Register application callback: &#x2F;login&#x2F;oauth2&#x2F;code&#x2F;github   Config callback template: {baseUrl}&#x2F;login&#x2F;oauth2&#x2F;code&#x2F;{registrationId}  12345678910server:  port: 9000spring:  security:    oauth2:      client:        ...</div></div></div></a><a class="pagination-related" href="/2022/09/17/microservices-governance-security-oauth2-jwt/" title="Oauth2 - JWT"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2/oauth2-jwt.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-17</div><div class="info-item-2">Oauth2 - JWT</div></div><div class="info-2"><div class="info-item-1">Token Type   JWT 资源服务器自解释和自校验，无需再跟授权服务器交互  结构 验签   issue + audience issue：令牌签发人audience：目标接收人   CodeAuthorization ServerMaven12345678910111213141516171819&lt;dependencies&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;  &lt;/dependency&gt;  ...</div></div></div></a><a class="pagination-related" href="/2022/09/14/microservices-governance-security-oauth2-authorization-code-flow/" title="Oauth2 - Authorization Code Flow"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-14</div><div class="info-item-2">Oauth2 - Authorization Code Flow</div></div><div class="info-2"><div class="info-item-1">Authorization ServerMaven12345678910111213141516171819&lt;dependencies&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;  &lt;/dependency&gt;  &lt;dependency&gt;    &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt;    &lt;artif...</div></div></div></a><a class="pagination-related" href="/2022/09/12/microservices-governance-security-oauth2-overview/" title="Oauth2 - Overview"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/oauth2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-12</div><div class="info-item-2">Oauth2 - Overview</div></div><div class="info-2"><div class="info-item-1">问题域 开放系统间授权     账号密码 不安全   万能钥匙 适用于公司内部   特殊令牌 核心挑战是令牌的生命周期管理   微服务安全 核心是 Token   OAuth2最简向导 正式定义 Token 是核心，可类比为仆从钥匙（给应用授予有限的访问权限，让应用代表用户去访问用户数据）   优劣主要优势 OAuth2 使用代理授权的方式解决密码共享的反模式问题   主要劣势 OAuth2 不是认证协议，而是一个代理授权框架   OAuth2 提供一个宽泛的协议框架，具体安全场景需要定制   主要角色 主要术语  Token 类型 常见误区 典型 Flow https://www.rfc-editor.org/rfc/rfc6749  Authorization Code Flow 最复杂 + 最安全 + 应用最广泛   Implicit Grant Flow 减少了授权码兑换的过程（通过 Script 解析 Access Token），适用于单页应用（无后端）   Resource Owner Password Credentials Flow 适用于公司内部应用等风险可控的场景   Client ...</div></div></div></a><a class="pagination-related" href="/2022/09/25/microservices-governance-config-apollo-ha-monitoring/" title="Apollo - HA + Monitoring"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://microservices-1253868755.cos.ap-guangzhou.myqcloud.com/apollo/apollo-logao.awebp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-25</div><div class="info-item-2">Apollo - HA + Monitoring</div></div><div class="info-2"><div class="info-item-1">Architecture   Deployment HA   Scene Influence Downgrade Reason    某台 Config Service 下线 无影响  Config Service 无状态   所有 Config Service 下线 Client 无法获取最新配置 Client 重启可获取本地缓存配置    某台 Admin Service 下线 无影响  Admin Service 无状态   所有 Admin Service 下线 用户无法管理配置     某台 Portal 下线 无影响  Portal 无状态   所有 Portal 下线 用户无法管理配置     数据库宕机 用户无法管理配置 Config Service 开启缓存Client 不受影响    Monitoring CAT + Prometheus   Reference 微服务架构实战 160 讲  </div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">授权服务器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Security-OAuth2-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">Spring Security OAuth2 架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Authorization-flow"><span class="toc-number">3.</span> <span class="toc-text">Authorization flow</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Authorization-Code-Flow"><span class="toc-number">3.1.</span> <span class="toc-text">Authorization Code Flow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Maven"><span class="toc-number">3.1.1.</span> <span class="toc-text">Maven</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API"><span class="toc-number">3.1.2.</span> <span class="toc-text">API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authorization-Server"><span class="toc-number">3.1.3.</span> <span class="toc-text">Authorization Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource-Server"><span class="toc-number">3.1.4.</span> <span class="toc-text">Resource Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource-owner"><span class="toc-number">3.1.5.</span> <span class="toc-text">Resource owner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flow"><span class="toc-number">3.1.6.</span> <span class="toc-text">Flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implicit-Grant-Flow"><span class="toc-number">3.2.</span> <span class="toc-text">Implicit Grant Flow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Authorization-Server-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">Authorization Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flow-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">Flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resource-Owner-Password-Credentials-Flow"><span class="toc-number">3.3.</span> <span class="toc-text">Resource Owner Password Credentials Flow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Authorization-Server-2"><span class="toc-number">3.3.1.</span> <span class="toc-text">Authorization Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flow-2"><span class="toc-number">3.3.2.</span> <span class="toc-text">Flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-Credentials-Flow"><span class="toc-number">3.4.</span> <span class="toc-text">Client Credentials Flow</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-1"><span class="toc-number">3.4.1.</span> <span class="toc-text">API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Authorization-Server-3"><span class="toc-number">3.4.2.</span> <span class="toc-text">Authorization Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flow-3"><span class="toc-number">3.4.3.</span> <span class="toc-text">Flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">3.5.</span> <span class="toc-text">技术选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-server.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Server V1"/></a><div class="content"><a class="title" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1">Observability - Prometheus Server V1</a><time datetime="2025-01-23T16:06:25.000Z" title="Created 2025-01-24 00:06:25">2025-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>