<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Security - OPA Operation | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="ConfigurationExample1$ opa run -s -c config.yaml  12345678910111213$ opa run --server \--log-format&#x3D;json-pretty \--set&#x3D;decision_logs.console&#x3D;true \--set&#x3D;services.A.url&#x3D;http:&#x2F;&#x2F;my-bundles:8080&#x2F;api&#x2F;opa&#x2F;b">
<meta property="og:type" content="article">
<meta property="og:title" content="Security - OPA Operation">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/12/27/cloud-native-foundation-security-opa-ops/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="ConfigurationExample1$ opa run -s -c config.yaml  12345678910111213$ opa run --server \--log-format&#x3D;json-pretty \--set&#x3D;decision_logs.console&#x3D;true \--set&#x3D;services.A.url&#x3D;http:&#x2F;&#x2F;my-bundles:8080&#x2F;api&#x2F;opa&#x2F;b">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg">
<meta property="article:published_time" content="2022-12-26T16:06:25.000Z">
<meta property="article:modified_time" content="2023-10-17T15:29:56.659Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Cloud Native Foundation">
<meta property="article:tag" content="OPA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Security - OPA Operation",
  "url": "https://blog.zhongmingmao.top/2022/12/27/cloud-native-foundation-security-opa-ops/",
  "image": "https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg",
  "datePublished": "2022-12-26T16:06:25.000Z",
  "dateModified": "2023-10-17T15:29:56.659Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/12/27/cloud-native-foundation-security-opa-ops/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Security - OPA Operation',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Security - OPA Operation</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Security - OPA Operation</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-12-26T16:06:25.000Z" title="Created 2022-12-27 00:06:25">2022-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/">Cloud Native Foundation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/opa/">OPA</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>15mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-10-17 23:29:56&quot;}" hidden></div><h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ opa run -s -c config.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ opa run --server \</span><br><span class="line">--log-format=json-pretty \</span><br><span class="line">--set=decision_logs.console=true \</span><br><span class="line"></span><br><span class="line">--set=services.A.url=http://my-bundles:8080/api/opa/bundle/ \</span><br><span class="line">--set=bundles.A.service=A \</span><br><span class="line">--set=bundles.A.polling.long_polling_timeout_seconds=45 \</span><br><span class="line">--set=bundles.A.resource=A.tar.gz \</span><br><span class="line"></span><br><span class="line">--set=services.B.url=http://my-bundles:8080/api/opa/bundle/ \</span><br><span class="line">--set=bundles.B.service=B \</span><br><span class="line">--set=bundles.B.polling.long_polling_timeout_seconds=45 \</span><br><span class="line">--set=bundles.B.resource=B.tar.gz \</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<figure class="highlight yaml"><figcaption><span>config.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">acmecorp:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://example.com/control-plane-api/v1</span></span><br><span class="line">    <span class="attr">response_header_timeout_seconds:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">credentials:</span></span><br><span class="line">      <span class="attr">bearer:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">&quot;bGFza2RqZmxha3NkamZsa2Fqc2Rsa2ZqYWtsc2RqZmtramRmYWxkc2tm&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">region:</span> <span class="string">west</span></span><br><span class="line">  <span class="attr">environment:</span> <span class="string">production</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bundles:</span></span><br><span class="line">  <span class="attr">authz:</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">acmecorp</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">bundles/http/example/authz.tar.gz</span></span><br><span class="line">    <span class="attr">persist:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">polling:</span></span><br><span class="line">      <span class="attr">min_delay_seconds:</span> <span class="number">60</span></span><br><span class="line">      <span class="attr">max_delay_seconds:</span> <span class="number">120</span></span><br><span class="line">    <span class="attr">signing:</span></span><br><span class="line">      <span class="attr">keyid:</span> <span class="string">global_key</span></span><br><span class="line">      <span class="attr">scope:</span> <span class="string">write</span></span><br><span class="line"></span><br><span class="line"><span class="attr">decision_logs:</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">acmecorp</span></span><br><span class="line">  <span class="attr">reporting:</span></span><br><span class="line">    <span class="attr">min_delay_seconds:</span> <span class="number">300</span></span><br><span class="line">    <span class="attr">max_delay_seconds:</span> <span class="number">600</span></span><br><span class="line"></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">service:</span> <span class="string">acmecorp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default_decision:</span> <span class="string">/http/example/authz/allow</span></span><br><span class="line"></span><br><span class="line"><span class="attr">persistence_directory:</span> <span class="string">/var/opa</span></span><br><span class="line"></span><br><span class="line"><span class="attr">keys:</span></span><br><span class="line">  <span class="attr">global_key:</span></span><br><span class="line">    <span class="attr">algorithm:</span> <span class="string">RS256</span></span><br><span class="line">    <span class="attr">key:</span> <span class="string">&lt;PEM_encoded_public_key&gt;</span></span><br><span class="line">    <span class="attr">scope:</span> <span class="string">read</span></span><br><span class="line"></span><br><span class="line"><span class="attr">caching:</span></span><br><span class="line">  <span class="attr">inter_query_builtin_cache:</span></span><br><span class="line">    <span class="attr">max_size_bytes:</span> <span class="number">10000000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">distributed_tracing:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">grpc</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">localhost:4317</span></span><br><span class="line">  <span class="attr">service_name:</span> <span class="string">opa</span></span><br><span class="line">  <span class="attr">sample_percentage:</span> <span class="number">50</span></span><br><span class="line">  <span class="attr">encryption:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">encoding:</span></span><br><span class="line">    <span class="attr">gzip:</span></span><br><span class="line">        <span class="attr">min_length:</span> <span class="number">1024</span><span class="string">,</span></span><br><span class="line">        <span class="attr">compression_level:</span> <span class="number">9</span></span><br></pre></td></tr></table></figure>

<h2 id="Environment-Variable-Substitution"><a href="#Environment-Variable-Substitution" class="headerlink" title="Environment Variable Substitution"></a>Environment Variable Substitution</h2><blockquote>
<p>Only supported with the OPA runtime (<code>opa run</code>).<br>Environment variables referenced with the <code>$&#123;...&#125;</code> notation within the configuration will be replaced with the value of the environment variable.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">acmecorp:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">&quot;$&#123;BASE_URL&#125;&quot;</span></span><br><span class="line">    <span class="attr">credentials:</span></span><br><span class="line">      <span class="attr">bearer:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">&quot;$&#123;BEARER_TOKEN&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">discovery:</span></span><br><span class="line">  <span class="attr">resource:</span> <span class="string">/configuration/example/discovery</span></span><br><span class="line">  <span class="attr">decision:</span> <span class="string">example</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The environment variables <code>BASE_URL</code> and <code>BEARER_TOKEN</code> will be <em>substituted</em> in when the config file is loaded by the <em>OPA runtime</em>.<br>If the variable is <em>undefined</em> then an <em>empty string</em> (<code>&quot;&quot;</code>) is substituted. It will <strong>not</strong> raise an error.</p>
</blockquote>
<h2 id="CLI-Runtime-Overrides"><a href="#CLI-Runtime-Overrides" class="headerlink" title="CLI Runtime Overrides"></a>CLI Runtime Overrides</h2><blockquote>
<p>Only supported with the OPA runtime (<code>opa run</code>).</p>
</blockquote>
<ol>
<li>Using <code>opa run</code> there are CLI options to <em>explicitly</em> set config values. These will <em>override</em> any values set in the config file.</li>
<li>There are two options to use: <code>--set</code> and <code>--set-file</code><ul>
<li>Both options take in a <em>key&#x3D;value</em> format where the key is a <em>selector</em> for the yaml config structure</li>
</ul>
</li>
<li><em>Multiple values</em> can be specified with <em>comma</em> separators (<code>key1=value,key2=value2,..</code>). Or with additional <code>--set</code> parameters.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ opa run \</span><br><span class="line">  --set &quot;default_decision=/http/example/authz/allow&quot; \</span><br><span class="line">  --set &quot;services.acmecorp.url=https://test-env/control-plane-api/v1&quot; \</span><br><span class="line">  --set &quot;services.acmecorp.credentials.bearer.token=\$&#123;TOKEN&#125;&quot;</span><br><span class="line">  --set &quot;labels.app=myapp,labels.region=west&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>This is equivalent to a YAML config file that looks like</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">acmecorp:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://test-env/control-plane-api/v1</span></span><br><span class="line">    <span class="attr">credentials:</span></span><br><span class="line">      <span class="attr">bearer:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">$&#123;TOKEN&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">labels:</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">region:</span> <span class="string">west</span></span><br><span class="line"></span><br><span class="line"><span class="attr">default_decision:</span> <span class="string">/http/example/authz/allow</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <code>--set-file</code> option is <em>expecting</em> a file path for the value.<br>This allows <em>keeping secrets in files</em> and loading them into the config at run time. </p>
</blockquote>
<blockquote>
<p>With a file <code>/var/run/secrets/bearer_token.txt</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bGFza2RqZmxha3NkamZsa2Fqc2Rsa2ZqYWtsc2RqZmtramRmYWxkc2tm</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Then using the <code>--set-file</code> flag for OPA<br>It will <em>read the contents of the file</em> and set the config value with the token.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ opa run --set-file &quot;services.acmecorp.credentials.bearer.token=/var/run/secrets/bearer_token.txt&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Override-Limitations"><a href="#Override-Limitations" class="headerlink" title="Override Limitations"></a>Override Limitations</h3><h4 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h4><blockquote>
<p>If using <em>arrays&#x2F;lists</em> in the configuration the <code>--set</code> and <code>--set-file</code> overrides will not be able to <em>patch sub-objects of the list</em>.<br>They will <em>overwrite</em> the <em>entire index</em> with the <em>new object</em>.</p>
</blockquote>
<blockquote>
<p>For example, a <code>config.yaml</code> file with contents:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">acmecorp</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://test-env/control-plane-api/v1</span></span><br><span class="line">    <span class="attr">credentials:</span></span><br><span class="line">      <span class="attr">bearer:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Used with overrides:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ opa run \</span><br><span class="line">  --config-file config.yaml</span><br><span class="line">  --set-file &quot;services[0].credentials.bearer.token=/var/run/secrets/bearer_token.txt&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Will result in configuration like:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">credentials:</span></span><br><span class="line">      <span class="attr">bearer:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">bGFza2RqZmxha3NkamZsa2Fqc2Rsa2ZqYWtsc2RqZmtramRmYWxkc2tm</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Because the <em>entire</em> <code>0</code> index was <em>overwritten</em>.</p>
</blockquote>
<blockquote>
<p>It is highly recommended to use <em>objects&#x2F;maps</em> instead of <em>lists</em> for configuration for this reason.</p>
</blockquote>
<h3 id="Remote-Bundles-Override-Shorthand"><a href="#Remote-Bundles-Override-Shorthand" class="headerlink" title="Remote Bundles Override Shorthand"></a>Remote Bundles Override Shorthand</h3><blockquote>
<p>When running the server to quickly try <em>a remote public bundle</em>, you may find it convenient to provide the URL of the bundle directly, rather than via repeated <code>--set</code> flags</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ opa run -s https://example.com/bundles/bundle.tar.gz</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The above shorthand command is <em>identical</em> to:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ opa run -s --set &quot;services.cli1.url=https://example.com&quot; \</span><br><span class="line">           --set &quot;bundles.cli1.service=cli1&quot; \</span><br><span class="line">           --set &quot;bundles.cli1.resource=/bundles/bundle.tar.gz&quot; \</span><br><span class="line">           --set &quot;bundles.cli1.persist=true&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Empty-objects"><a href="#Empty-objects" class="headerlink" title="Empty objects"></a>Empty objects</h3><blockquote>
<p>If you need to set an empty object with the CLI overrides, for example with plugin configuration like:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">decision_logs:</span></span><br><span class="line">  <span class="attr">plugin:</span> <span class="string">my_plugin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line">  <span class="attr">my_plugin:</span></span><br><span class="line">    <span class="comment"># empty</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can do this by setting the value with <code>null</code>. For example:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ opa run --set &quot;decision_logs.plugin=my_plugin&quot; --set &quot;plugins.my_plugin=null&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Keys-with-Special-Characters"><a href="#Keys-with-Special-Characters" class="headerlink" title="Keys with Special Characters"></a>Keys with Special Characters</h3><blockquote>
<p>If you have a <em>key</em> which contains a special character (<code>=</code>, <code>[</code>, <code>,</code>, <code>.</code>), like <code>opa.example.com</code>,<br>and want to use the <code>--set</code> or <code>--set-file</code> options you will need to <em>escape</em> the character with a backslash (<code>\</code>).</p>
</blockquote>
<blockquote>
<p>For example a config section like:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">opa.example.com:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://opa.example.com</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Could be specified with something like:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--set services.opa\.example\.com.url=https://opa.example.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note that when using it in a <em>shell</em> you may need to put it in <em>quotes</em> or escape the <code>\</code> character too. For example:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--set services.&quot;opa\.example\.com&quot;.url=https://opa.example.com</span><br></pre></td></tr></table></figure>

<p><em>or</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--set services.opa\\.example\\.com.url=https://opa.example.com</span><br></pre></td></tr></table></figure>

<h2 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h2><blockquote>
<p>Services represent <em>endpoints</em> that implement one or more <em>control plane APIs</em> such as the <em>Bundle</em> or <em>Status</em> APIs.<br>OPA configuration files may contain <em>multiple services</em>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>services[_].name</code></td>
<td>string</td>
<td>Yes</td>
<td><em>Unique name</em> for the service. <em>Referred to by plugins</em>.</td>
</tr>
<tr>
<td><code>services[_].url</code></td>
<td>string</td>
<td>Yes</td>
<td><em>Base URL</em> to contact the service with.</td>
</tr>
<tr>
<td><code>services[_].response_header_timeout_seconds</code></td>
<td>int64</td>
<td>No (default: 10)</td>
<td>Amount of time to <em>wait for a server’s response headers</em> after <em>fully writing the request</em>.<br />This time <em>does not include the time to read the response body</em>.</td>
</tr>
<tr>
<td><code>services[_].headers</code></td>
<td>object</td>
<td>No</td>
<td>HTTP headers to include in requests to the service.</td>
</tr>
<tr>
<td><code>services[_].tls.ca_cert</code></td>
<td>string</td>
<td>No</td>
<td>The path to the <em>root CA certificate</em>.<br />If not provided, this defaults to TLS using the <em>host’s root CA set</em>.</td>
</tr>
<tr>
<td><code>services[_].tls.system_ca_required</code></td>
<td>bool</td>
<td>No (default: <code>false</code>)</td>
<td>Require <em>system certificate</em> appended with <em>root CA certificate</em>.</td>
</tr>
<tr>
<td><code>services[_].allow_insecure_tls</code></td>
<td>bool</td>
<td>No</td>
<td>Allow insecure TLS.</td>
</tr>
<tr>
<td><code>services[_].type</code></td>
<td>string</td>
<td>No (default: empty)</td>
<td>Optional parameter that allows to use an “OCI” service type.<br />This will allow bundle and discovery plugins to download bundles from an <em>OCI registry</em>.</td>
</tr>
</tbody></table>
<blockquote>
<p>Services can be defined as an <em>array</em> or <em>object</em>. When defined as an <em>object</em>, the <em>object keys</em> override the <code>services[_].name</code> fields. For example:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">s1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://s1/example/</span></span><br><span class="line">  <span class="attr">s2:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://s2/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Is equivalent to</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">s1</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://s1/example/</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">s2</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://s2/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Each service may optionally specify a <em>credential mechanism</em> by which OPA will <em>authenticate itself to the service</em>.</p>
</blockquote>
<h2 id="Credential"><a href="#Credential" class="headerlink" title="Credential"></a>Credential</h2><h3 id="Bearer-Token"><a href="#Bearer-Token" class="headerlink" title="Bearer Token"></a>Bearer Token</h3><ol>
<li>OPA will authenticate using the specified bearer token and schema</li>
<li>to enable bearer token authentication, either the <em>token</em> or the <em>path to the token</em> must be specified.<ul>
<li>If the latter is provided, on <em>each request</em> OPA will <em>re-read the token from the file</em> and use that token for authentication.</li>
</ul>
</li>
</ol>
<h3 id="Client-TLS-Certificate"><a href="#Client-TLS-Certificate" class="headerlink" title="Client TLS Certificate"></a>Client TLS Certificate</h3><ol>
<li>OPA will present the <em>specified TLS certificate</em> to authenticate.</li>
<li>The paths to the <em>client certificate</em> and the <em>private key</em> are required;<ul>
<li>the <em>passphrase</em> for the <em>private key</em> is only required if the private key is <em>encrypted</em>.</li>
</ul>
</li>
</ol>
<h3 id="OAuth2-Client-Credentials"><a href="#OAuth2-Client-Credentials" class="headerlink" title="OAuth2 Client Credentials"></a>OAuth2 Client Credentials</h3><ol>
<li>OPA will authenticate using a <em>bearer token</em> obtained through the <em>OAuth2 client credentials flow</em>.</li>
<li>Following <em>successful authentication</em> at the <em>token endpoint</em> the <em>returned token</em> will be <em>cached</em> for <em>subsequent requests</em> for the duration of its lifetime.</li>
<li>Note that as per the <em>OAuth2 standard</em>, only the <em>HTTPS</em> scheme is supported for the <em>token endpoint</em> URL.</li>
</ol>
<h3 id="OAuth2-Client-Credentials-JWT-authentication"><a href="#OAuth2-Client-Credentials-JWT-authentication" class="headerlink" title="OAuth2 Client Credentials JWT authentication"></a>OAuth2 Client Credentials JWT authentication</h3><ol>
<li>OPA will authenticate using a <em>bearer token</em> obtained through the <em>OAuth2 client credentials flow</em>.</li>
<li>Rather than providing a client secret along with the request for an <em>access token</em>, the <em>client asserts its identity in the form of a signed JWT</em>.</li>
<li>Following <em>successful authentication</em> at the <em>token endpoint</em> the <em>returned token</em> will be <em>cached</em> for <em>subsequent requests</em> for the duration of its lifetime.</li>
<li>Note that as per the <em>OAuth2 standard</em>, only the <em>HTTPS</em> scheme is supported for the <em>token endpoint</em> URL.</li>
</ol>
<h3 id="OAuth2-JWT-Bearer-Grant-Type"><a href="#OAuth2-JWT-Bearer-Grant-Type" class="headerlink" title="OAuth2 JWT Bearer Grant Type"></a>OAuth2 JWT Bearer Grant Type</h3><ol>
<li>OPA will authenticate using a <em>bearer token</em> obtained through the <em>OAuth2 JWT authorization grant flow</em>.</li>
<li>Rather than providing a client secret along with the request for an <em>access token</em>, the <em>client asserts its identity in the form of a signed JWT</em>.</li>
<li>Following <em>successful authentication</em> at the <em>token endpoint</em> the <em>returned token</em> will be <em>cached</em> for <em>subsequent requests</em> for the duration of its lifetime.</li>
<li>Note that as per the <em>OAuth2 standard</em>, only the <em>HTTPS</em> scheme is supported for the <em>token endpoint</em> URL.</li>
</ol>
<h2 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h2><table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>labels</code></td>
<td>object</td>
<td>Yes</td>
<td>Set of <em>key-value</em> pairs that uniquely identify the <em>OPA instance</em>.<br />Labels are included when OPA <em>uploads decision logs and status information</em>.</td>
</tr>
<tr>
<td><code>default_decision</code></td>
<td>string</td>
<td>No (default: <code>/system/main</code>)</td>
<td>Set path of <em>default policy decision</em> used to serve queries against OPA’s <em>base URL</em>.</td>
</tr>
<tr>
<td><code>default_authorization_decision</code></td>
<td>string</td>
<td>No (default: <code>/system/authz/allow</code>)</td>
<td>Set path of <em>default authorization decision</em> for OPA’s API.</td>
</tr>
<tr>
<td><code>persistence_directory</code></td>
<td>string</td>
<td>No (default <code>$PWD/.opa</code>)</td>
<td>Set directory to use for persistence with options like <code>bundles[_].persist</code>.</td>
</tr>
<tr>
<td><code>plugins</code></td>
<td>object</td>
<td>No (default: <code>&#123;&#125;</code>)</td>
<td>Location for <em>custom plugin</em> configuration.</td>
</tr>
<tr>
<td><code>nd_builtin_cache</code></td>
<td>boolean</td>
<td>No (default: <code>false</code>)</td>
<td>Enable the non-deterministic builtins caching system during policy evaluation, and include the contents of the cache in decision logs.<br />Note that decision logs that are larger than <code>upload_size_limit_bytes</code> will drop the <code>nd_builtin_cache</code> key from the log entry before uploading.</td>
</tr>
</tbody></table>
<h2 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h2><blockquote>
<p>Caching represents the configuration of the <em>inter-query cache</em> that <em>built-in functions</em> can utilize.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>caching.inter_query_builtin_cache.max_size_bytes</code></td>
<td>int64</td>
<td>No</td>
<td><em>Inter-query cache size limit in bytes</em>.<br />OPA will <em>drop old items</em> from the cache if this limit is exceeded.<br />By default, <em>no limit</em> is set.</td>
</tr>
</tbody></table>
<h2 id="Bundles"><a href="#Bundles" class="headerlink" title="Bundles"></a>Bundles</h2><ol>
<li>Bundles are defined with a <em>key</em> that is the <code>name</code> of the bundle.<ul>
<li>This <code>name</code> is used in the <em>status</em> API, <em>decision logs</em>, server provenance, etc.</li>
</ul>
</li>
<li>Each bundle can be configured to <em>verify</em> a bundle <em>signature</em> using the <code>keyid</code> and <code>scope</code> fields.<ul>
<li>The <code>keyid</code> is the <em>name</em> of one of the keys listed under the <em>keys</em> entry.</li>
</ul>
</li>
<li><em>Signature verification fails</em> if the <code>bundles[_].signing</code> field is configured on a bundle but no <code>.signatures.json</code> file is included in the actual bundle gzipped tarball.</li>
</ol>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>bundles[_].resource</code></td>
<td>string</td>
<td>No (default: <code>bundles/&lt;name&gt;</code>)</td>
<td>Resource path to use to <em>download</em> bundle from configured service.</td>
</tr>
<tr>
<td><code>bundles[_].service</code></td>
<td>string</td>
<td>Yes</td>
<td>Name of service to use to contact remote server.</td>
</tr>
<tr>
<td><code>bundles[_].polling.min_delay_seconds</code></td>
<td>int64</td>
<td>No (default: <code>60</code>)</td>
<td>Minimum amount of time to wait <em>between bundle downloads</em>.</td>
</tr>
<tr>
<td><code>bundles[_].polling.max_delay_seconds</code></td>
<td>int64</td>
<td>No (default: <code>120</code>)</td>
<td>Maximum amount of time to wait <em>between bundle downloads</em>.</td>
</tr>
<tr>
<td><code>bundles[_].trigger</code></td>
<td><code>string</code> (default: <code>periodic</code>)</td>
<td>No</td>
<td>Controls <em>how</em> bundle is downloaded from the remote server.<br />Allowed values are <code>periodic</code> and <code>manual</code>.</td>
</tr>
<tr>
<td><code>bundles[_].polling.long_polling_timeout_seconds</code></td>
<td>int64</td>
<td>No</td>
<td>Maximum amount of time the server should wait before issuing a <em>timeout</em> if there’s <em>no update available</em>.</td>
</tr>
<tr>
<td><code>bundles[_].persist</code></td>
<td>bool</td>
<td>No</td>
<td>Persist activated bundles to <em>disk</em>.</td>
</tr>
<tr>
<td><code>bundles[_].signing.keyid</code></td>
<td>string</td>
<td>No</td>
<td><em>Name</em> of the <em>key</em> to use for <em>bundle signature verification</em>.</td>
</tr>
<tr>
<td><code>bundles[_].signing.scope</code></td>
<td>string</td>
<td>No</td>
<td><em>Scope</em> to <em>use</em> for <em>bundle signature verification</em>.</td>
</tr>
<tr>
<td><code>bundles[_].signing.exclude_files</code></td>
<td>array</td>
<td>No</td>
<td>Files in the bundle to <em>exclude during verification</em>.</td>
</tr>
<tr>
<td><code>bundles[_].size_limit_bytes</code></td>
<td>int64</td>
<td>No (default: <code>1073741824</code>)</td>
<td>Size limit for <em>individual files</em> contained in the bundle.</td>
</tr>
</tbody></table>
<h2 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h2><table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>status.service</code></td>
<td>string</td>
<td>Yes</td>
<td>Name of service to use to contact remote server.</td>
</tr>
<tr>
<td><code>status.partition_name</code></td>
<td>string</td>
<td>No</td>
<td><em>Path segment</em> to include in <em>status updates</em>.</td>
</tr>
<tr>
<td><code>status.console</code></td>
<td>boolean</td>
<td>No (default: <code>false</code>)</td>
<td>Log the status updates <em>locally</em> to the console.<br />When enabled alongside a remote status update API the <code>service</code> must be configured, the default <code>service</code> selection will be <em>disabled</em>.</td>
</tr>
<tr>
<td><code>status.prometheus</code></td>
<td>boolean</td>
<td>No (default: <code>false</code>)</td>
<td>Export the status (<em>bundle</em> and <em>plugin</em>) metrics to prometheus.<br />When enabled alongside a remote status update API the <code>service</code> must be configured, the default <code>service</code> selection will be <em>disabled</em>.</td>
</tr>
<tr>
<td><code>status.plugin</code></td>
<td>string</td>
<td>No</td>
<td>Use the <em>named plugin</em> for <em>status updates</em>.<br />If this field exists, the other configuration fields are not required.</td>
</tr>
<tr>
<td><code>status.trigger</code></td>
<td><code>string</code> (default: <code>periodic</code>)</td>
<td>No</td>
<td>Controls <em>how</em> status updates are reported to the remote server.<br />Allowed values are <code>periodic</code> and <code>manual</code>.</td>
</tr>
</tbody></table>
<h2 id="Decision-Logs"><a href="#Decision-Logs" class="headerlink" title="Decision Logs"></a>Decision Logs</h2><table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>decision_logs.service</code></td>
<td>string</td>
<td>No</td>
<td>Name of the service to use to contact remote server.<br />If <em>no plugin is specified</em>, and <em>console logging is disabled</em>, this will default to the <em>first service name defined</em> in the Services configuration.</td>
</tr>
<tr>
<td><code>decision_logs.partition_name</code></td>
<td>string</td>
<td>No</td>
<td><del>Deprecated: Use <code>resource</code> instead. Path segment to include in status updates.</del></td>
</tr>
<tr>
<td><code>decision_logs.resource</code></td>
<td>string</td>
<td>No (default: <code>/logs</code>)</td>
<td><em>Full path</em> to use for sending decision logs to a remote server.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.buffer_size_limit_bytes</code></td>
<td>int64</td>
<td>No</td>
<td><em>Decision log buffer size limit in bytes</em>.<br />OPA will <em>drop old events</em> from the log if this limit is exceeded.<br />By default, <em>no limit</em> is set.<br />Only one of <code>buffer_size_limit_bytes</code>, <code>max_decisions_per_second</code> may be set.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.max_decisions_per_second</code></td>
<td>float64</td>
<td>No</td>
<td><em>Maximum number of decision log events to buffer per second</em>.<br />OPA will <em>drop events</em> if the rate limit is exceeded.<br />Only one of <code>buffer_size_limit_bytes</code>, <code>max_decisions_per_second</code> may be set.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.upload_size_limit_bytes</code></td>
<td>int64</td>
<td>No (default: <code>32768</code>)</td>
<td><em>Decision log upload size limit in bytes</em>.<br />OPA will <em>chunk uploads</em> to <em>cap message body to this limit</em>.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.min_delay_seconds</code></td>
<td>int64</td>
<td>No (default: <code>300</code>)</td>
<td>Minimum amount of time to wait <em>between uploads</em>.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.max_delay_seconds</code></td>
<td>int64</td>
<td>No (default: <code>600</code>)</td>
<td>Maximum amount of time to wait <em>between uploads</em>.</td>
</tr>
<tr>
<td><code>decision_logs.reporting.trigger</code></td>
<td>string</td>
<td>No (default: <code>periodic</code>)</td>
<td>Controls <em>how</em> decision logs are reported to the remote server.<br />Allowed values are <code>periodic</code> and <code>manual</code>.</td>
</tr>
<tr>
<td><code>decision_logs.mask_decision</code></td>
<td>string</td>
<td>No (default: <code>/system/log/mask</code>)</td>
<td>Set path of masking decision.</td>
</tr>
<tr>
<td><code>decision_logs.drop_decision</code></td>
<td>string</td>
<td>No (default: <code>/system/log/drop</code>)</td>
<td>Set path of drop decision.</td>
</tr>
<tr>
<td><code>decision_logs.plugin</code></td>
<td>string</td>
<td>No</td>
<td>Use the <em>named plugin</em> for decision logging.<br />If this field exists, the other configuration fields are not required.</td>
</tr>
<tr>
<td><code>decision_logs.console</code></td>
<td>boolean</td>
<td>No (default: <code>false</code>)</td>
<td>Log the decisions <em>locally</em> to the console.<br />When enabled alongside a remote decision logging API the <code>service</code> must be configured, the default <code>service</code> selection will be <em>disabled</em>.</td>
</tr>
</tbody></table>
<h2 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h2><blockquote>
<p>The <code>server</code> configuration sets the <em>gzip compression</em> settings for <code>/v0/data</code>, <code>/v1/data</code> and <code>/v1/compile</code> HTTP <code>POST</code> endpoints The gzip compression settings are used when the client sends <code>Accept-Encoding: gzip</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>server.encoding.gzip.min_length</code></td>
<td>int</td>
<td>No, (default: 1024)</td>
<td>Specifies the <em>minimum length of the response</em> to compress</td>
</tr>
<tr>
<td><code>server.encoding.gzip.compression_level</code></td>
<td>int</td>
<td>No, (default: 9)</td>
<td>Specifies the compression level.<br />Accepted values:<br />a value of either <em>0</em> (<em>no compression</em>), <em>1</em> (<em>best speed, lowest compression</em>) or <em>9</em> (<em>slowest, best compression</em>).</td>
</tr>
</tbody></table>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/12/27/cloud-native-foundation-security-opa-ops/">https://blog.zhongmingmao.top/2022/12/27/cloud-native-foundation-security-opa-ops/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/cloud-native-foundation/">Cloud Native Foundation</a><a class="post-meta__tags" href="/tags/opa/">OPA</a></div><div class="post-share"><div class="social-share" data-image="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/12/28/go-foundation-primitive/" title="Go - Primitive Type"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gotype.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Go - Primitive Type</div></div><div class="info-2"><div class="info-item-1">数值整型平台无关整型 在任何 CPU 架构和任何操作系统下面，长度都是固定不变的      有符号整型 vs 无符号整型    Go 采用补码作为整型的比特位编码方法：原码逐位取反后加 1   平台相关整型 长度会根据运行平台的改变而改变，在编写移植性要求的代码时，不要依赖下述类型的长度   123456a, b := int(5), uint(6)p := 0x12345678fmt.Println(unsafe.Sizeof(a)) // 8fmt.Println(unsafe.Sizeof(b)) // 8fmt.Println(unsafe.Sizeof(p)) // 8  溢出1234567var s int8 = 127s += 1fmt.Println(s) // -128var u uint8 = 1u -= 2fmt.Println(u) // 255  字面值1234567891011a := 53        // 十进制b := 0700      // 八进制，以 0 开头c1 := 0xaabbcc // 十六进制，以 0x 开头c2 := 0Xddeeff // 十六进制...</div></div></div></a><a class="pagination-related" href="/2022/12/26/cloud-native-foundation-security-opa-management/" title="Security - OPA Management"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-management-7474053.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Security - OPA Management</div></div><div class="info-2"><div class="info-item-1">Overview &amp; Architecture OPA exposes a set of APIs that enable unified, logically centralized policy management. Read this page if you are interested in how to build a control plane around OPA that enables policy distribution and collection of important telemetry data like decision logs.     OPA enables low-latency, highly-available policy enforcement by providing a lightweight engine for distributed architectures.By default, all of the policy and data that OPA uses to make decisions is kept in-memory...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/12/26/cloud-native-foundation-security-opa-management/" title="Security - OPA Management"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-management-7474053.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-26</div><div class="info-item-2">Security - OPA Management</div></div><div class="info-2"><div class="info-item-1">Overview &amp; Architecture OPA exposes a set of APIs that enable unified, logically centralized policy management. Read this page if you are interested in how to build a control plane around OPA that enables policy distribution and collection of important telemetry data like decision logs.     OPA enables low-latency, highly-available policy enforcement by providing a lightweight engine for distributed architectures.By default, all of the policy and data that OPA uses to make decisions is kept in-memory...</div></div></div></a><a class="pagination-related" href="/2022/12/25/cloud-native-foundation-security-opa-gatekeeper/" title="Security - OPA Gatekeeper"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-gatekeeper.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-25</div><div class="info-item-2">Security - OPA Gatekeeper</div></div><div class="info-2"><div class="info-item-1">Overview &amp; Architecture In Kubernetes, Admission Controllers enforce policies on objects during create, update, and delete operations.Admission control is fundamental to policy enforcement in Kubernetes.   For example, by deploying OPA as an admission controller you can   Require specific labels on all resources. Require container images come from the corporate image registry. Require all Pods specify resource requests and limits. Prevent conflicting Ingress objects from being created.     Admission ...</div></div></div></a><a class="pagination-related" href="/2022/12/24/cloud-native-foundation-security-opa-core/" title="Security - OPA Core"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-7255236.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-24</div><div class="info-item-2">Security - OPA Core</div></div><div class="info-2"><div class="info-item-1">Glance Use OPA for a unified toolset and framework for policy across the cloud native stack. Use OPA to decouple policy from the service’s code so you can release, analyze, and review policies without sacrificing availability or performance. Declarative Express policy in a high-level, declarative language that promotes safe, performant, fine-grained controls. Use a language purpose-built for policy in a world where JSON is pervasive. Iterate, traverse hierarchies, and apply 150+ built-ins like string man...</div></div></div></a><a class="pagination-related" href="/2023/05/11/cloud-native-foundation-k8s-helm-doc/" title="Kubernetes - Helm Doc"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/helm.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-11</div><div class="info-item-2">Kubernetes - Helm Doc</div></div><div class="info-2"><div class="info-item-1">基本概念 Chart 包含在 Kubernetes 集群内部运行的应用程序、工具和服务所需的所有资源定义   Repository 用于存放和共享 Chart   Release 运行在 Kubernetes 集群中的 Chart 实例 一个 Chart 可以在同一个集群中被安装多次，每次安装都会创建一个 Release      基本使用Search   Source Desc    hub 从 Artifact Hub 中搜索   repo 基于本地 repo 搜索，无需联网   hub123456$ h search hub wordpressURL                                                   CHART VERSION	APP VERSION        	DESCRIPTIONhttps://artifacthub.io/packages/helm/kube-wordp...    0.1.0        	1.1                	this is my wordpress packagehttps://artifact...</div></div></div></a><a class="pagination-related" href="/2023/02/02/cloud-native-foundation-k8s-security/" title="Kubernetes - Security"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/k8s-security.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-02</div><div class="info-item-2">Kubernetes - Security</div></div><div class="info-2"><div class="info-item-1">层次模型   开发 分发 部署 运行时 容器运行时Non-root 在 Dockerfile 中通过 USER 命令切换成非 root 用户   防止某些镜像窃取宿主的 root 权限并造成危害 在某些容器运行时，容器内部的 root 用户与宿主上的 root 用户是同一个用户 宿主上的重要文件被 mount 到容器内，并被容器修改配置   即使在容器内部也应该权限隔离  123FROM ubuntuRUN user add AUSER A  User namespace 依赖 User namespace，任何容器内部的用户都会映射为宿主上的非 root 用户 默认关闭，因为会引入配置复杂性 系统不知道宿主用户与容器用户的映射关系，在 mount 文件时无法设置适当的权限    Rootless container 容器运行时以非 root 身份启动 即使容器被攻破，在宿主层面获得的用户权限也是非 root 用户 Docker 和其它容器运行时本身的后台 Daemon 需要以 root 身份运行，其它的用户容器才能以 rootless 身份运行 某些运行时，如 Podman，没有 Daemon 进程，...</div></div></div></a><a class="pagination-related" href="/2023/02/01/cloud-native-foundation-k8s-federation/" title="Kubernetes - Federation"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/federation.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-01</div><div class="info-item-2">Kubernetes - Federation</div></div><div class="info-2"><div class="info-item-1">跨地域 使用单一集群，可以管控多个地域的机器，底层网络需要打通    Service 优先级：zone &gt; region &gt; other    集群联邦必要性 单一集群的管理规模有上限 数据库存储 etcd 作为 Kubernetes 集群的后端存储数据库，对空间大小（8G）的要求比较苛刻   内存占用 Kubernetes 的 API Server 作为 API 网关，会缓存该集群的所有对象 其它的 Kubernetes Controller 也需要对监听的对象构建客户端缓存   控制器复杂度 Kubernetes 的一个业务流程由多个对象和控制器联动完成 随着对象数量的增长，控制器的处理耗时也会增长     单一计算节点的资源有上限 可量化资源：CPU、Memory 等 不可量化资源：端口数量（限制 Service NodePort）、进程数量等   故障域控制 集群规模越大，控制面组件出现故障时的影响范围越大 方案：将大规模的数据中心切成多个规模相对较小的集群，每个集群控制在一定规模   应用 HA 多数据中心部署来保障跨地域高可用   混合云 私有云 + 公有云    职责 跨集群同...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Configuration"><span class="toc-number">1.</span> <span class="toc-text">Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example"><span class="toc-number">1.1.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment-Variable-Substitution"><span class="toc-number">1.2.</span> <span class="toc-text">Environment Variable Substitution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CLI-Runtime-Overrides"><span class="toc-number">1.3.</span> <span class="toc-text">CLI Runtime Overrides</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Override-Limitations"><span class="toc-number">1.3.1.</span> <span class="toc-text">Override Limitations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lists"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">Lists</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Bundles-Override-Shorthand"><span class="toc-number">1.3.2.</span> <span class="toc-text">Remote Bundles Override Shorthand</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Empty-objects"><span class="toc-number">1.3.3.</span> <span class="toc-text">Empty objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keys-with-Special-Characters"><span class="toc-number">1.3.4.</span> <span class="toc-text">Keys with Special Characters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Services"><span class="toc-number">1.4.</span> <span class="toc-text">Services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Credential"><span class="toc-number">1.5.</span> <span class="toc-text">Credential</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bearer-Token"><span class="toc-number">1.5.1.</span> <span class="toc-text">Bearer Token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-TLS-Certificate"><span class="toc-number">1.5.2.</span> <span class="toc-text">Client TLS Certificate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth2-Client-Credentials"><span class="toc-number">1.5.3.</span> <span class="toc-text">OAuth2 Client Credentials</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth2-Client-Credentials-JWT-authentication"><span class="toc-number">1.5.4.</span> <span class="toc-text">OAuth2 Client Credentials JWT authentication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OAuth2-JWT-Bearer-Grant-Type"><span class="toc-number">1.5.5.</span> <span class="toc-text">OAuth2 JWT Bearer Grant Type</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Miscellaneous"><span class="toc-number">1.6.</span> <span class="toc-text">Miscellaneous</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caching"><span class="toc-number">1.7.</span> <span class="toc-text">Caching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bundles"><span class="toc-number">1.8.</span> <span class="toc-text">Bundles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Status"><span class="toc-number">1.9.</span> <span class="toc-text">Status</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Decision-Logs"><span class="toc-number">1.10.</span> <span class="toc-text">Decision Logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server"><span class="toc-number">1.11.</span> <span class="toc-text">Server</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/Java-Foreign-Function-API.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Foreign Function API"/></a><div class="content"><a class="title" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API">New Java Feature - Foreign Function API</a><time datetime="2025-01-16T16:06:25.000Z" title="Created 2025-01-17 00:06:25">2025-01-17</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>