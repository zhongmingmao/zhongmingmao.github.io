<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Kubernetes - CNI | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="网络分类   Type Desc    CNI Pod 到 Pod 的网络，Node 到 Pod 的网络   kube-proxy 通过 Service 访问   Ingress 入站流量">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes - CNI">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/12/08/cloud-native-foundation-k8s-cni-v2/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="网络分类   Type Desc    CNI Pod 到 Pod 的网络，Node 到 Pod 的网络   kube-proxy 通过 Service 访问   Ingress 入站流量">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/cni-logo-card.png">
<meta property="article:published_time" content="2022-12-07T16:06:25.000Z">
<meta property="article:modified_time" content="2023-07-30T13:31:53.637Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Cloud Native Foundation">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/cni-logo-card.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/12/08/cloud-native-foundation-k8s-cni-v2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Kubernetes - CNI',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-30 21:31:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">458</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">125</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">65</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/cni-logo-card.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Kubernetes - CNI</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-12-07T16:06:25.000Z" title="Created 2022-12-08 00:06:25">2022-12-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/">Cloud Native Foundation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/kubernetes/">Kubernetes</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>44min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网络分类"><a href="#网络分类" class="headerlink" title="网络分类"></a>网络分类</h1><table>
<thead>
<tr>
<th>Type</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><code>CNI</code></td>
<td><code>Pod</code> 到 <code>Pod</code> 的网络，<code>Node</code> 到 <code>Pod</code> 的网络</td>
</tr>
<tr>
<td><code>kube-proxy</code></td>
<td>通过 <code>Service</code> 访问</td>
</tr>
<tr>
<td><code>Ingress</code></td>
<td><code>入站</code>流量</td>
</tr>
</tbody></table>
<span id="more"></span>

<h1 id="基础原则"><a href="#基础原则" class="headerlink" title="基础原则"></a>基础原则</h1><ol>
<li>所有 <code>Pod</code> 能够不通过 <code>NAT</code> 就能互相访问</li>
<li>所有 <code>Node</code> 能够不通过 <code>NAT</code> 就能互相访问</li>
<li>容器内看到的 IP 地址和外部组件看到的<code>容器 IP</code> 是一样的</li>
</ol>
<blockquote>
<p>补充说明</p>
</blockquote>
<ol>
<li>在 Kubernetes 集群，<code>IP 地址</code>是以 <code>Pod</code> 为单位进行分配的，每个 Pod 拥有一个独立的 IP 地址</li>
<li>一个 Pod 内部的<code>所有容器</code>共享一个<code>网络栈</code>，即宿主上的一个 <code>Network Namespace</code></li>
<li>Pod 内的<code>所有容器</code>能够通过 <code>localhost:port</code> 来连接对方</li>
<li>在 Kubernetes 中，提供一个<code>轻量</code>的<code>通用</code>容器网络接口 <code>CNI</code><ul>
<li><code>Container Network Interface</code>，用来设置和删除<code>容器的网络连通性</code></li>
</ul>
</li>
<li><code>Container Runtime</code> 通过 <code>CNI</code> 调用<code>网络插件</code>来完成<code>容器的网络设置</code></li>
</ol>
<h1 id="插件分类"><a href="#插件分类" class="headerlink" title="插件分类"></a>插件分类</h1><blockquote>
<p>下面的 Plugin 均由 <code>ContainerNetworking</code> 组维护</p>
</blockquote>
<blockquote>
<p><code>IPAM -&gt; Main -&gt; Meta</code></p>
</blockquote>
<blockquote>
<p><code>IPAM</code> - IP address allocation - 解决 <code>IP 分配</code>的问题</p>
</blockquote>
<table>
<thead>
<tr>
<th>Plugin</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><code>dhcp</code></td>
<td>Runs a daemon on the host to make DHCP requests on behalf of the container</td>
</tr>
<tr>
<td><code>host-local</code></td>
<td>Maintains a local database of allocated IPs</td>
</tr>
<tr>
<td><code>static</code></td>
<td>Allocate a single static IPv4&#x2F;IPv6 address to container</td>
</tr>
</tbody></table>
<blockquote>
<p><code>Main</code> - interface-creating - 解决<code>网络互通</code>的问题</p>
</blockquote>
<blockquote>
<ol>
<li><code>容器</code>和<code>主机</code>的互通</li>
<li><code>同一主机</code>的容器互通</li>
<li><code>跨主机</code>的容器互通 - <code>CNI</code> 在原先容器网络的基础上的新增能力</li>
</ol>
</blockquote>
<table>
<thead>
<tr>
<th>Plugin</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><code>bridge</code></td>
<td>Creates a bridge, adds the host and the container to it</td>
</tr>
<tr>
<td><code>ipvlan</code></td>
<td>Adds an ipvlan interface in the container</td>
</tr>
<tr>
<td><code>loopback</code></td>
<td>Set the state of loopback interface to up</td>
</tr>
<tr>
<td><code>macvlan</code></td>
<td>Creates a new MAC address, forwards all traffic to that to the container</td>
</tr>
<tr>
<td><code>ptp</code></td>
<td>Creates a veth pair</td>
</tr>
<tr>
<td><code>vlan</code></td>
<td>Allocates a vlan device</td>
</tr>
<tr>
<td><code>host-device</code></td>
<td>Move an already-existing device into a container</td>
</tr>
<tr>
<td><code>dummy</code></td>
<td>Creates a new Dummy device in the container</td>
</tr>
</tbody></table>
<blockquote>
<p>Meta - other plugins</p>
</blockquote>
<table>
<thead>
<tr>
<th>Plugin</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><code>tuning</code></td>
<td>Tweaks sysctl parameters of an existing interface</td>
</tr>
<tr>
<td><code>portmap</code></td>
<td>An iptables-based portmapping plugin. Maps ports from the host’s address space to the container</td>
</tr>
<tr>
<td><code>bandwidth</code></td>
<td>Allows bandwidth-limiting through use of traffic control tbf (ingress&#x2F;egress)</td>
</tr>
<tr>
<td><code>sbr</code></td>
<td>A plugin that configures source based routing for an interface (from which it is chained)</td>
</tr>
<tr>
<td><code>firewall</code></td>
<td>A firewall plugin which uses iptables or firewalld to add rules to allow traffic to&#x2F;from the container</td>
</tr>
</tbody></table>
<h1 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h1><blockquote>
<p><code>Container Runtime</code> 在<code>启动</code>时从 <code>CNI</code> 的配置目录读取 <code>JSON</code> 格式的配置文件（多个文件，按<code>字典序</code>选择第 1 个）</p>
</blockquote>
<blockquote>
<p><code>1 CNI  + N CSI</code></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/image-20230729103814030.png" alt="image-20230729103814030"></p>
<blockquote>
<p>关于容器网络管理，<code>Container Runtime</code> 一般需要配置两个参数：<code>--cni-bin-dir</code> 和 <code>--cni-conf-dir</code></p>
</blockquote>
<blockquote>
<p>特殊情况：使用 <code>kubelet</code> 内置的 <code>Dockershim</code> 作为 <code>Container Runtime</code> 时<br>由 <code>kubelet</code> 来查找 <code>CNI</code> 插件，运行插件为容器设置网络，因此这两个参数应该设置为 <code>kubelet</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Parameters</th>
</tr>
</thead>
<tbody><tr>
<td>配置文件</td>
<td><code>/etc/cni/net.d</code></td>
<td><code>--cni-conf-dir</code></td>
</tr>
<tr>
<td>可执行文件</td>
<td><code>/opt/cni/bin</code></td>
<td><code>--cni-bin-dir</code></td>
</tr>
</tbody></table>
<blockquote>
<p>配置文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ll /etc/cni/net.d</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root  680 Jul 26 17:15 10-calico.conflist</span><br><span class="line">-rw------- 1 root root 2733 Jul 26 17:18 calico-kubeconfig</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ipam</code> - calico-ipam<br><code>main</code> - calico<br><code>meta</code> - bandwidth + portmap</p>
</blockquote>
<figure class="highlight json"><figcaption><span>/etc/cni/net.d/10-calico.conflist</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;k8s-pod-network&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;cniVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;0.3.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;container_settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;allow_ip_forwarding&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;datastore_type&quot;</span><span class="punctuation">:</span><span class="string">&quot;kubernetes&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;ipam&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;assign_ipv4&quot;</span><span class="punctuation">:</span><span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;assign_ipv6&quot;</span><span class="punctuation">:</span><span class="string">&quot;false&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;calico-ipam&quot;</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;kubernetes&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;k8s_api_root&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://10.96.0.1:443&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;kubeconfig&quot;</span><span class="punctuation">:</span><span class="string">&quot;/etc/cni/net.d/calico-kubeconfig&quot;</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;log_file_max_age&quot;</span><span class="punctuation">:</span><span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;log_file_max_count&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;log_file_max_size&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;log_file_path&quot;</span><span class="punctuation">:</span><span class="string">&quot;/var/log/calico/cni/cni.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;log_level&quot;</span><span class="punctuation">:</span><span class="string">&quot;Info&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;mtu&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;nodename_file_optional&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;policy&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;k8s&quot;</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;calico&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;bandwidth&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;bandwidth&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;portMappings&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;snat&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;portmap&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译好的<code>可执行</code>文件 - Kubernetes <code>调用 CNI 插件</code>，本质上是运行<code>本地的可执行文件</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ll /opt/cni/bin</span><br><span class="line">total 245688</span><br><span class="line">-rwxr-xr-x 1 root root  3885252 Jul 23 12:02 bandwidth</span><br><span class="line">-rwxr-xr-x 1 root root  4241166 Jan 16  2023 bridge</span><br><span class="line">-rwsr-xr-x 1 root root 59619577 Jul 23 12:02 calico</span><br><span class="line">-rwsr-xr-x 1 root root 59619577 Jul 23 12:02 calico-ipam</span><br><span class="line">-rwxr-xr-x 1 root root  9895211 Jan 16  2023 dhcp</span><br><span class="line">-rwxr-xr-x 1 root root  3963159 Jan 16  2023 dummy</span><br><span class="line">-rwxr-xr-x 1 root root  4275642 Jan 16  2023 firewall</span><br><span class="line">-rwxr-xr-x 1 root root  2390464 Jul 23 12:02 flannel</span><br><span class="line">-rwxr-xr-x 1 root root  3865536 Jan 16  2023 host-device</span><br><span class="line">-rwxr-xr-x 1 root root  3413600 Jul 23 12:02 host-local</span><br><span class="line">-rwsr-xr-x 1 root root 59619577 Jul 23 12:02 install</span><br><span class="line">-rwxr-xr-x 1 root root  3968070 Jan 16  2023 ipvlan</span><br><span class="line">-rwxr-xr-x 1 root root  3426012 Jul 23 12:02 loopback</span><br><span class="line">-rwxr-xr-x 1 root root  3976826 Jan 16  2023 macvlan</span><br><span class="line">-rwxr-xr-x 1 root root  3811556 Jul 23 12:02 portmap</span><br><span class="line">-rwxr-xr-x 1 root root  4075754 Jan 16  2023 ptp</span><br><span class="line">-rwxr-xr-x 1 root root  3505660 Jan 16  2023 sbr</span><br><span class="line">-rwxr-xr-x 1 root root  2843609 Jan 16  2023 static</span><br><span class="line">-rwxr-xr-x 1 root root  3602160 Jul 23 12:02 tuning</span><br><span class="line">-rwxr-xr-x 1 root root  3966201 Jan 16  2023 vlan</span><br><span class="line">-rwxr-xr-x 1 root root  3581314 Jan 16  2023 vrf</span><br></pre></td></tr></table></figure>

<h1 id="设计考量"><a href="#设计考量" class="headerlink" title="设计考量"></a>设计考量</h1><ol>
<li>Container Runtime 必须在<code>调用任何 CNI 插件之前</code>为容器创建一个新的 <code>Network Namespace</code><ul>
<li><code>Network Namespace</code> 挂在 <code>SandBox</code></li>
<li>Container Runtime 执行 <code>RunPodSandBox</code> 后，才去调用 CNI 插件</li>
</ul>
</li>
<li>Container Runtime 必须要决定<code>容器</code>属于哪些<code>网络</code>，针对每个网络，哪些<code>插件</code>必须要执行</li>
<li>Container Runtime 必须加载<code>配置文件</code>，并确定<code>设置网络</code>时哪些<code>插件</code>必须被执行</li>
<li>网络配置采用 <code>JSON</code> 格式</li>
<li>Container Runtime 必须按<code>顺序执行</code>配置文件里相应的<code>插件</code></li>
<li>在完成<code>容器生命周期</code>后，Container Runtime 必须按照与执行添加容器<code>相反的顺序</code>执行<code>CNI 插件</code><ul>
<li>为了将容器与网络<code>断开连接</code></li>
</ul>
</li>
<li>Container Runtime 被<code>同一容器</code>调用时<code>不能并行</code>操作，但被<code>不同容器</code>调用时，<code>允许并行</code>操作</li>
<li>Container Runtime 针对<code>一个容器</code>必须按<code>顺序</code>执行 <code>ADD</code> 和 <code>DEL</code> 操作<ul>
<li>ADD 对应 Container Runtime 的 <code>SetUpPodNetwork</code>，CNI 的 <code>AddNetwork</code></li>
<li>ADD 后总是跟着相应的 DEL</li>
<li>DEL 可能跟着额外的 DEL，CNI 插件应该允许处理多个 DEL</li>
</ul>
</li>
<li><code>容器</code>必须由 <code>ContainerID</code> 来唯一标识<ul>
<li>需要<code>存储状态</code>的插件需要使用<code>网络名称</code>、<code>容器 ID</code>、<code>网络接口</code>组成的<code>主 Key</code> 来<code>索引</code></li>
</ul>
</li>
<li>Container Runtime 针对<code>同一网络</code>、<code>同一容器</code>、<code>同一网络接口</code>，不能连续调用<code>两次</code> ADD 命令<ul>
<li><code>1 ADD + N DEL</code></li>
</ul>
</li>
</ol>
<blockquote>
<p>Container Runtime 通过<code>环境变量</code>的方式，将参数传递给 calico 的二进制可执行文件</p>
</blockquote>
<h1 id="主机网络"><a href="#主机网络" class="headerlink" title="主机网络"></a>主机网络</h1><ol>
<li>Kubernetes 需要<code>标准的 CNI 插件</code>，最低版本为 0.2.0</li>
<li>网络插件除了支持设置和清理 <code>Pod</code> 的网络接口外，还需要支持 <code>iptables</code><ul>
<li>如果 <code>kube-proxy</code> 工作在 <code>iptables</code> 模式，网络插件需要确保<code>容器流量</code>能使用 <code>iptables</code> 转发</li>
<li>如果网络插件将容器连接到 <code>Linux 网桥</code>，需要将 <code>net.bridge.bridge-nf-call-iptables</code> 设置为 1<ul>
<li>Linux 网桥上的数据包将<code>遍历 iptables 规则</code></li>
</ul>
</li>
<li>如果网络插件不使用 Linux 网桥，应确保容器流量被正确设置了<code>路由</code></li>
</ul>
</li>
</ol>
<h1 id="数据链路"><a href="#数据链路" class="headerlink" title="数据链路"></a>数据链路</h1><ol>
<li>Container Runtime 调用 <code>CNI 插件</code>配置网络（<code>chain: ipam -&gt; main -&gt; meta</code>）</li>
<li>Container Runtime 将配置结果返回给 <code>kubelet</code></li>
<li><code>kubelet</code> 将相关信息上报给 <code>API Server</code>，此时通过 <code>get po -owide</code> 就能查看到对应的 <code>Pod IP</code> 信息</li>
</ol>
<h1 id="跨主机互通"><a href="#跨主机互通" class="headerlink" title="跨主机互通"></a>跨主机互通</h1><blockquote>
<p><code>跨主机互通</code>的 2 种方式</p>
</blockquote>
<ol>
<li><code>Tunnel 模式</code><ul>
<li>封包解包：<code>IPinIP</code>（IP + <code>IP</code>） &#x2F; <code>VXLAN</code>（IP + <code>UDP</code>）</li>
</ul>
</li>
<li><code>动态路由</code><ul>
<li>Node 之间<code>交换路由信息</code>，最终 Node A 会知道 Node B 的路由信息，相当于有一个<code>全景地图</code></li>
</ul>
</li>
</ol>
<h1 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h1><blockquote>
<p>Flannel &#x2F; Weave &#x2F; Calico &#x2F; Cilium，其中 <code>Calico</code> 和 <code>Cilium</code> 是<code>完整</code>的解决方案</p>
</blockquote>
<h2 id="Flannel"><a href="#Flannel" class="headerlink" title="Flannel"></a>Flannel</h2><blockquote>
<p>基于 <code>Tunnel</code> 实现，封包解包的<code>性能开销</code>大致为 <code>10%</code></p>
</blockquote>
<blockquote>
<p>Flannel 本身<code>没有完备的生态</code>（如对 <code>NetworkPolicy</code> 的支持）</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/image-20230729141652306.png" alt="image-20230729141652306"></p>
<ol>
<li>Flannel 由 CoreOS 开发，是 CNI 插件的早期入门产品，<code>简单易用</code></li>
<li>Flannel 使用 Kubernetes 集群<code>现有的 etcd 集群</code>来存储其<code>状态信息</code><ul>
<li>不需要提供专用的数据存储，只需要在每个 <code>Node</code> 上运行 <code>flanneld</code> 守护进程（<code>DaemonSet</code>）</li>
</ul>
</li>
<li>每个 <code>Node</code> 都被<code>分配一个子网</code>，为该 Node 上的 <code>Pod</code> 分配 IP 地址</li>
<li><code>同一 Node</code>内的 Pod 可以使用<code>网桥</code>进行通信<ul>
<li>而<code>不同 Node</code>上的 Pod 将通过 <code>flanneld</code> 将其流量封装在 <code>UDP</code> 包中并<code>路由</code>到目的地 - <code>VXLAN</code></li>
</ul>
</li>
<li>封装方式使用 <code>VXLAN</code><ul>
<li>优点 - <code>性能良好</code></li>
<li>缺点 - <code>流量难以跟踪</code></li>
</ul>
</li>
</ol>
<h2 id="Calico"><a href="#Calico" class="headerlink" title="Calico"></a>Calico</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p><code>性能</code>更佳 + <code>功能</code>更全（<code>网络策略</code>）</p>
</blockquote>
<ol>
<li>对于<code>同网段</code>通信，基于 <code>3 层</code>，Calico 使用 <code>BGP 路由协议</code>在 <code>Node</code> 之间<code>路由</code>数据包<ul>
<li><code>BGP</code> - 数据包在 Node 之间移动<code>不需要包装在额外的封装层</code></li>
</ul>
</li>
<li>对于<code>跨网段</code>通信，基于 <code>IPinIP</code> 使用虚拟网卡设备 <code>tunl0</code><ul>
<li>用一个 IP 数据包封装另一个 IP 数据包</li>
<li><code>外层 IP 数据包头</code>的<code>源地址</code>为<code>隧道入口设备</code>的 IP 地址，<code>目标地址</code>为<code>隧道出口设备</code>的 IP 地址</li>
</ul>
</li>
<li><code>网络策略</code> - Calico 最受欢迎的功能之一<ul>
<li>使用 <code>ACLs</code> 和 <code>kube-proxy</code> 来创建 <code>iptables</code> 过滤规则，从而实现<code>隔离容器网络</code>的目的</li>
</ul>
</li>
<li>Calico 可以与 <code>Istio</code> 集成<ul>
<li>在 <code>Service Mesh</code> 层和<code>网络基础结构</code>层上解释和实施集群中工作负载的策略</li>
<li>即：可以配置<code>功能强大的规则</code>来描述 <code>Pod</code> 应该如何<code>发送和接收流量</code>，提高<code>安全性</code>和加强对网络环境的<code>控制</code></li>
</ul>
</li>
<li>Calico 是<code>完全分布式</code>的<code>横向扩展</code>结构，可以快速和平稳地扩展部署规模</li>
</ol>
<blockquote>
<p>社区提供的是<code>通用</code>方案，Pod 网络<code>不强绑定</code>底层基础网络，在底层基础网络默认是没法为 Pod 网络路由</p>
</blockquote>
<blockquote>
<p>felix agent - 配置网络<br><code>BIRD</code> agent - <code>BGP</code> Daemon</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/image-20230729150050500.png" alt="image-20230729150050500"></p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><blockquote>
<p>CNI 二进制文件和配置文件是<code>由 initContainer 从容器拷贝到主机上</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ k get ds -A</span><br><span class="line">NAMESPACE       NAME              DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span><br><span class="line">calico-system   calico-node       1         1         1       1            1           kubernetes.io/os=linux   5d19h</span><br><span class="line">calico-system   csi-node-driver   1         1         1       1            1           kubernetes.io/os=linux   5d19h</span><br><span class="line">kube-system     kube-proxy        1         1         1       1            1           kubernetes.io/os=linux   5d19h</span><br><span class="line"></span><br><span class="line">$ k get po -n calico-system</span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-6f6579ddff-sq7hz   1/1     Running   1          5d19h</span><br><span class="line">calico-node-tsjrx                          1/1     Running   1          5d19h</span><br><span class="line">calico-typha-64bcb7cddc-mgdnz              1/1     Running   1          5d19h</span><br><span class="line">csi-node-driver-j62g7                      2/2     Running   2          5d19h</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DaemonSet - <code>k get ds -n calico-system calico-node -oyaml</code></p>
</blockquote>
<blockquote>
<p><code>CALICO_NETWORKING_BACKEND</code> - 当前运行在 <code>bird</code> 模式</p>
</blockquote>
<blockquote>
<p>The BIRD project aims to develop a fully functional <code>dynamic IP routing</code> daemon primarily targeted on (but not limited to) Linux, FreeBSD and other UNIX-like systems and distributed under the GNU General Public License.</p>
</blockquote>
<blockquote>
<p><code>BIRD</code> 是一个开源的 <code>BGP Deamon</code>，不同的 IDC 之间可以通过 BGP <code>交换路由信息</code></p>
</blockquote>
<figure class="highlight yaml"><figcaption><span>calico-node</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">deprecated.daemonset.template.generation:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2022-07-23T11:58:03Z&quot;</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">  <span class="attr">ownerReferences:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">operator.tigera.io/v1</span></span><br><span class="line">    <span class="attr">blockOwnerDeletion:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Installation</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="string">a7119daf-ab1a-4956-aff8-81e031c29f69</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;4748&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">c4123a23-c83b-4ace-89d3-9917de839e67</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">hash.operator.tigera.io/cni-config:</span> <span class="string">9f0a12e03c58671de56ed3876cb88f1c43cef5dc</span></span><br><span class="line">        <span class="attr">hash.operator.tigera.io/system:</span> <span class="string">bb4746872201725da2dea19756c475aa67d9c1e9</span></span><br><span class="line">        <span class="attr">hash.operator.tigera.io/tigera-ca-private:</span> <span class="string">dd84db09815307584549b186f41feb6a048625c9</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">calico-node</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATASTORE_TYPE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">kubernetes</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WAIT_FOR_DATASTORE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLUSTER_TYPE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">k8s,operator,bgp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_DISABLE_FILE_LOGGING</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_DEFAULTENDPOINTTOHOSTACTION</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">ACCEPT</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_HEALTHENABLED</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_HEALTHPORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;9099&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODENAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHAK8SNAMESPACE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">calico-system</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHAK8SSERVICENAME</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">calico-typha</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHACAFILE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/etc/pki/tls/certs/tigera-ca-bundle.crt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHACERTFILE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/node-certs/tls.crt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHAKEYFILE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/node-certs/tls.key</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FIPS_MODE_ENABLED</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_TYPHACN</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">typha-server</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_MANAGE_CNI</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_CIDR</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_VXLAN</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">CrossSubnet</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_BLOCK_SIZE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;26&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_NODE_SELECTOR</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">all()</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_DISABLE_BGP_EXPORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">bird</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">autodetect</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP_AUTODETECTION_METHOD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">first-found</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP6</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">none</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_IPV6SUPPORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_SERVICE_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">10.96</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_SERVICE_PORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/calico/node:v3.26.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">lifecycle:</span></span><br><span class="line">          <span class="attr">preStop:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-shutdown</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9099</span></span><br><span class="line">            <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">exec:</span></span><br><span class="line">            <span class="attr">command:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">-bird-ready</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">-felix-ready</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">          <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsGroup:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">seccompProfile:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">RuntimeDefault</span></span><br><span class="line">        <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">        <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/pki/tls/certs</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">tigera-ca-bundle</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/pki/tls/cert.pem</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">tigera-ca-bundle</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">ca-bundle.crt</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/lib/modules</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/node-certs</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">node-certs</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/calico</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/log/calico/cni</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">cni-log-dir</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">docker.io/calico/pod2daemon-flexvol:v3.26.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">flexvol-driver</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsGroup:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">seccompProfile:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">RuntimeDefault</span></span><br><span class="line">        <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">        <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/driver</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/cni/bin/install</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_CONF_NAME</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">10</span><span class="string">-calico.conflist</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SLEEP</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_NET_DIR</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_NETWORK_CONFIG</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">config</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-config</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_SERVICE_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">10.96</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_SERVICE_PORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/calico/cni:v3.26.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">runAsGroup:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">runAsNonRoot:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">seccompProfile:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">RuntimeDefault</span></span><br><span class="line">        <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">        <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/opt/cni/bin</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">      <span class="attr">securityContext:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">calico-node</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">calico-node</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CriticalAddonsOnly</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoExecute</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/lib/modules</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">tigera-ca-bundle</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">tigera-ca-bundle</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node-certs</span></span><br><span class="line">        <span class="attr">secret:</span></span><br><span class="line">          <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">node-certs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/run/calico</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/log/calico/cni</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cni-log-dir</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/usr/libexec/kubernetes/kubelet-plugins/volume/exec/nodeagent~uds</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">currentNumberScheduled:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">desiredNumberScheduled:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">numberAvailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">numberMisscheduled:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">numberReady:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">observedGeneration:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">updatedNumberScheduled:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>initContainers - 将 <code>Calico</code> 的文件（10-calico.conflist）拷贝到<code>主机</code>上的 CNI 目录（&#x2F;etc&#x2F;cni&#x2F;net.d）<br>然后 Container Runtime 就能读到 CNI 插件对应的文件</p>
</blockquote>
<blockquote>
<p>即 CRI 使用 CNI 的可执行文件和配置文件，那 CNI 的某个 initContainer 先将这些文件拷贝到主机上</p>
</blockquote>
<h3 id="VXLAN"><a href="#VXLAN" class="headerlink" title="VXLAN"></a>VXLAN</h3><blockquote>
<p>封包解包</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/image-20230729153724848.png" alt="image-20230729153724848"></p>
<blockquote>
<p>类似与 Flannel 的 <code>flannelId</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br><span class="line">...</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:62:da:29 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.191.153/24 brd 192.168.191.255 scope global dynamic ens160</span><br><span class="line">       valid_lft 1563sec preferred_lft 1563sec</span><br><span class="line">    inet6 fe80::20c:29ff:fe62:da29/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">...</span><br><span class="line">10: vxlan.calico: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ether 66:9e:7d:ae:1b:ec brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.185.0/32 scope global vxlan.calico</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::649e:7dff:feae:1bec/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="CRD"><a href="#CRD" class="headerlink" title="CRD"></a>CRD</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ k get crd</span><br><span class="line">NAME                                                  CREATED AT</span><br><span class="line">apiservers.operator.tigera.io                         2022-07-23T11:57:17Z</span><br><span class="line">bgpconfigurations.crd.projectcalico.org               2022-07-23T11:57:17Z</span><br><span class="line">bgpfilters.crd.projectcalico.org                      2022-07-23T11:57:17Z</span><br><span class="line">bgppeers.crd.projectcalico.org                        2022-07-23T11:57:17Z</span><br><span class="line">blockaffinities.crd.projectcalico.org                 2022-07-23T11:57:17Z</span><br><span class="line">caliconodestatuses.crd.projectcalico.org              2022-07-23T11:57:17Z</span><br><span class="line">clusterinformations.crd.projectcalico.org             2022-07-23T11:57:17Z</span><br><span class="line">felixconfigurations.crd.projectcalico.org             2022-07-23T11:57:17Z</span><br><span class="line">globalnetworkpolicies.crd.projectcalico.org           2022-07-23T11:57:17Z</span><br><span class="line">globalnetworksets.crd.projectcalico.org               2022-07-23T11:57:17Z</span><br><span class="line">hostendpoints.crd.projectcalico.org                   2022-07-23T11:57:17Z</span><br><span class="line">imagesets.operator.tigera.io                          2022-07-23T11:57:17Z</span><br><span class="line">installations.operator.tigera.io                      2022-07-23T11:57:17Z</span><br><span class="line">ipamblocks.crd.projectcalico.org                      2022-07-23T11:57:17Z</span><br><span class="line">ipamconfigs.crd.projectcalico.org                     2022-07-23T11:57:17Z</span><br><span class="line">ipamhandles.crd.projectcalico.org                     2022-07-23T11:57:17Z</span><br><span class="line">ippools.crd.projectcalico.org                         2022-07-23T11:57:17Z</span><br><span class="line">ipreservations.crd.projectcalico.org                  2022-07-23T11:57:17Z</span><br><span class="line">kubecontrollersconfigurations.crd.projectcalico.org   2022-07-23T11:57:17Z</span><br><span class="line">networkpolicies.crd.projectcalico.org                 2022-07-23T11:57:17Z</span><br><span class="line">networksets.crd.projectcalico.org                     2022-07-23T11:57:17Z</span><br><span class="line">tigerastatuses.operator.tigera.io                     2022-07-23T11:57:17Z</span><br></pre></td></tr></table></figure>

<h3 id="IPPool"><a href="#IPPool" class="headerlink" title="IPPool"></a>IPPool</h3><blockquote>
<p>定义一个集群的预定义 IP 段</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ k get ippools.projectcalico.org</span><br><span class="line">NAME                  CREATED AT</span><br><span class="line">default-ipv4-ippool   2022-07-23T12:04:44Z</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ipipMode: Never</code> - 没有开启 <code>IPinIP</code></p>
</blockquote>
<blockquote>
<ol>
<li><code>blockSize: 26</code> - 每个 <code>Node</code> 可以分配多大的 IP 段</li>
<li><code>2^(26-16) ≈ 1024</code> 个 <code>Node</code>，每个 Node 上可分配 <code>2^(32 - 26) ≈ 64</code> 个 <code>IP</code></li>
</ol>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">projectcalico.org/v3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IPPool</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2022-07-23T12:04:44Z&quot;</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">default-ipv4-ippool</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;1600&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">ea36eb56-7eed-473f-97c8-4d6c8f77c963</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">allowedUses:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Workload</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Tunnel</span></span><br><span class="line">  <span class="attr">blockSize:</span> <span class="number">26</span></span><br><span class="line">  <span class="attr">cidr:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span><span class="string">/16</span></span><br><span class="line">  <span class="attr">ipipMode:</span> <span class="string">Never</span></span><br><span class="line">  <span class="attr">natOutgoing:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">nodeSelector:</span> <span class="string">all()</span></span><br><span class="line">  <span class="attr">vxlanMode:</span> <span class="string">CrossSubnet</span></span><br></pre></td></tr></table></figure>

<h3 id="IPAMBlock"><a href="#IPAMBlock" class="headerlink" title="IPAMBlock"></a>IPAMBlock</h3><blockquote>
<p>定义每个 Node 预分配的 IP 段</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ k get ipamblocks.crd.projectcalico.org</span><br><span class="line">NAME               AGE</span><br><span class="line">192-168-185-0-26   3d5h</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">crd.projectcalico.org/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IPAMBlock</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">projectcalico.org/metadata:</span> <span class="string">&#x27;&#123;&quot;creationTimestamp&quot;:null&#125;&#x27;</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2022-07-23T12:04:44Z&quot;</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">25</span></span><br><span class="line">  <span class="attr">name:</span> <span class="number">192</span><span class="number">-168</span><span class="number">-185</span><span class="number">-0</span><span class="number">-26</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;6531&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">fcb98ac4-8ff2-49c3-9832-c0d3e7a656d3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">affinity:</span> <span class="string">host:mac-k8s</span></span><br><span class="line">  <span class="attr">allocations:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">4</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">5</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">6</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">7</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">attributes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">vxlan-tunnel-addr-mac-k8s</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">vxlanTunnelAddress</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.4bcae222a79b7ef46f048e435d5ab62d41e3a343d00a13da40e931a3e9df1aaa</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">csi-node-driver-j62g7</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-23 12:04:45.262852871</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.ecddecbd8bb0be0bbadc17c37b4ea684badc89bf88daae1920ffbbbd3363ec21</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">calico-apiserver</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">calico-apiserver-5bc5cf4559-9d6dq</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:08.73997821</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.7d6e14cf214eb0436a77a72f94030819255bdce7abb177549a078fa436d6e899</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">csi-node-driver-j62g7</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:09.429526008</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.14994dea79206eef6dca3caf2528e786aed6c882b1e03acdbac1d551c67f8909</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">coredns-7f6cbbb7b8-rr9dr</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:10.43794577</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.704b36894705f2aabb5d3802c2071e4ea14cc2963006bd3426f1b7ce6e8b0cde</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">calico-kube-controllers-6f6579ddff-sq7hz</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:11.43459441</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.a31bfee878b49c68c28b36ff9fe4a7e5510639337bdff0c830dc5d37f6b87377</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">coredns-7f6cbbb7b8-78bwt</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:13.461429435</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.6cdce974ca5b8f5c2abc51b7cc2880df73192d440d52a964906c5437ca7eabb0</span></span><br><span class="line">    <span class="attr">secondary:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">calico-apiserver</span></span><br><span class="line">      <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">      <span class="attr">pod:</span> <span class="string">calico-apiserver-5bc5cf4559-l7m8r</span></span><br><span class="line">      <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:18.491248056</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">  <span class="attr">cidr:</span> <span class="number">192.168</span><span class="number">.185</span><span class="number">.0</span><span class="string">/26</span></span><br><span class="line">  <span class="attr">deleted:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">sequenceNumber:</span> <span class="number">1690113884806720496</span></span><br><span class="line">  <span class="attr">sequenceNumberForAllocation:</span></span><br><span class="line">    <span class="attr">&quot;0&quot;:</span> <span class="number">1690113884806720472</span></span><br><span class="line">    <span class="attr">&quot;1&quot;:</span> <span class="number">1690113884806720473</span></span><br><span class="line">    <span class="attr">&quot;7&quot;:</span> <span class="number">1690113884806720479</span></span><br><span class="line">    <span class="attr">&quot;8&quot;:</span> <span class="number">1690113884806720481</span></span><br><span class="line">    <span class="attr">&quot;9&quot;:</span> <span class="number">1690113884806720482</span></span><br><span class="line">    <span class="attr">&quot;10&quot;:</span> <span class="number">1690113884806720483</span></span><br><span class="line">    <span class="attr">&quot;11&quot;:</span> <span class="number">1690113884806720484</span></span><br><span class="line">    <span class="attr">&quot;12&quot;:</span> <span class="number">1690113884806720485</span></span><br><span class="line">    <span class="attr">&quot;13&quot;:</span> <span class="number">1690113884806720486</span></span><br><span class="line">    <span class="attr">&quot;14&quot;:</span> <span class="number">1690113884806720487</span></span><br><span class="line">    <span class="attr">&quot;15&quot;:</span> <span class="number">1690113884806720488</span></span><br><span class="line">  <span class="attr">strictAffinity:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">unallocated:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">16</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">17</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">18</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">19</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">20</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">21</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">22</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">23</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">24</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">25</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">26</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">27</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">28</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">29</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">30</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">31</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">32</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">33</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">34</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">35</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">36</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">37</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">38</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">39</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">40</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">41</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">42</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">43</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">44</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">45</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">46</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">47</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">48</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">49</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">50</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">51</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">52</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">53</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">54</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">55</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">56</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">57</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">58</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">59</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">60</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">61</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">62</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">63</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">7</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">14</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">15</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">5</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">6</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h3 id="IPAMHandle"><a href="#IPAMHandle" class="headerlink" title="IPAMHandle"></a>IPAMHandle</h3><blockquote>
<p>记录 IP 分配的具体细节</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ k run --image=nginx nginx</span><br><span class="line">pod/nginx created</span><br><span class="line"></span><br><span class="line">$ k get ipamhandles.crd.projectcalico.org</span><br><span class="line">NAME                                                                               AGE</span><br><span class="line">k8s-pod-network.14994dea79206eef6dca3caf2528e786aed6c882b1e03acdbac1d551c67f8909   22m</span><br><span class="line">k8s-pod-network.6cdce974ca5b8f5c2abc51b7cc2880df73192d440d52a964906c5437ca7eabb0   22m</span><br><span class="line">k8s-pod-network.704b36894705f2aabb5d3802c2071e4ea14cc2963006bd3426f1b7ce6e8b0cde   22m</span><br><span class="line">k8s-pod-network.7d6e14cf214eb0436a77a72f94030819255bdce7abb177549a078fa436d6e899   22m</span><br><span class="line">k8s-pod-network.a31bfee878b49c68c28b36ff9fe4a7e5510639337bdff0c830dc5d37f6b87377   22m</span><br><span class="line">k8s-pod-network.cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34   2m10s</span><br><span class="line">k8s-pod-network.ecddecbd8bb0be0bbadc17c37b4ea684badc89bf88daae1920ffbbbd3363ec21   22m</span><br><span class="line">vxlan-tunnel-addr-mac-k8s                                                          3d5h</span><br><span class="line"></span><br><span class="line">$ k get po -owide</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   IP               NODE      NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx   1/1     Running   0          79s   192.168.185.16   mac-k8s   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">crd.projectcalico.org/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IPAMHandle</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">projectcalico.org/metadata:</span> <span class="string">&#x27;&#123;&quot;creationTimestamp&quot;:null&#125;&#x27;</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="string">&quot;2022-07-26T17:35:23Z&quot;</span></span><br><span class="line">  <span class="attr">generation:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-pod-network.cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;6651&quot;</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">2932b06f-5e97-4d01-a86f-4956a4bfcec7</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">block:</span></span><br><span class="line">    <span class="attr">192.168.185.0/26:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">deleted:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">handleID:</span> <span class="string">k8s-pod-network.cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>新增记录</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">items:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiVersion:</span> <span class="string">crd.projectcalico.org/v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">IPAMBlock</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">projectcalico.org/metadata:</span> <span class="string">&#x27;&#123;&quot;creationTimestamp&quot;:null&#125;&#x27;</span></span><br><span class="line">    <span class="attr">creationTimestamp:</span> <span class="string">&quot;2022-07-23T12:04:44Z&quot;</span></span><br><span class="line">    <span class="attr">generation:</span> <span class="number">27</span></span><br><span class="line">    <span class="attr">name:</span> <span class="number">192</span><span class="number">-168</span><span class="number">-185</span><span class="number">-0</span><span class="number">-26</span></span><br><span class="line">    <span class="attr">resourceVersion:</span> <span class="string">&quot;6653&quot;</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="string">fcb98ac4-8ff2-49c3-9832-c0d3e7a656d3</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">affinity:</span> <span class="string">host:mac-k8s</span></span><br><span class="line">    <span class="attr">allocations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">4</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">5</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">6</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">7</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="bullet">-</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">attributes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">vxlan-tunnel-addr-mac-k8s</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">vxlanTunnelAddress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.ecddecbd8bb0be0bbadc17c37b4ea684badc89bf88daae1920ffbbbd3363ec21</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">calico-apiserver</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">calico-apiserver-5bc5cf4559-9d6dq</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:08.73997821</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.7d6e14cf214eb0436a77a72f94030819255bdce7abb177549a078fa436d6e899</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">csi-node-driver-j62g7</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:09.429526008</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.14994dea79206eef6dca3caf2528e786aed6c882b1e03acdbac1d551c67f8909</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">coredns-7f6cbbb7b8-rr9dr</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:10.43794577</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.704b36894705f2aabb5d3802c2071e4ea14cc2963006bd3426f1b7ce6e8b0cde</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">calico-system</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">calico-kube-controllers-6f6579ddff-sq7hz</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:11.43459441</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.a31bfee878b49c68c28b36ff9fe4a7e5510639337bdff0c830dc5d37f6b87377</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">coredns-7f6cbbb7b8-78bwt</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:13.461429435</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.6cdce974ca5b8f5c2abc51b7cc2880df73192d440d52a964906c5437ca7eabb0</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">calico-apiserver</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">calico-apiserver-5bc5cf4559-l7m8r</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:15:18.491248056</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">handle_id:</span> <span class="string">k8s-pod-network.cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34</span></span><br><span class="line">      <span class="attr">secondary:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">        <span class="attr">node:</span> <span class="string">mac-k8s</span></span><br><span class="line">        <span class="attr">pod:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">timestamp:</span> <span class="number">2022-07-26 17:35:23.756365378</span> <span class="string">+0000</span> <span class="string">UTC</span></span><br><span class="line">    <span class="attr">cidr:</span> <span class="number">192.168</span><span class="number">.185</span><span class="number">.0</span><span class="string">/26</span></span><br><span class="line">    <span class="attr">deleted:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">sequenceNumber:</span> <span class="number">1690113884806720498</span></span><br><span class="line">    <span class="attr">sequenceNumberForAllocation:</span></span><br><span class="line">      <span class="attr">&quot;0&quot;:</span> <span class="number">1690113884806720472</span></span><br><span class="line">      <span class="attr">&quot;7&quot;:</span> <span class="number">1690113884806720479</span></span><br><span class="line">      <span class="attr">&quot;8&quot;:</span> <span class="number">1690113884806720481</span></span><br><span class="line">      <span class="attr">&quot;9&quot;:</span> <span class="number">1690113884806720482</span></span><br><span class="line">      <span class="attr">&quot;10&quot;:</span> <span class="number">1690113884806720483</span></span><br><span class="line">      <span class="attr">&quot;11&quot;:</span> <span class="number">1690113884806720484</span></span><br><span class="line">      <span class="attr">&quot;12&quot;:</span> <span class="number">1690113884806720485</span></span><br><span class="line">      <span class="attr">&quot;13&quot;:</span> <span class="number">1690113884806720486</span></span><br><span class="line">      <span class="attr">&quot;14&quot;:</span> <span class="number">1690113884806720487</span></span><br><span class="line">      <span class="attr">&quot;15&quot;:</span> <span class="number">1690113884806720488</span></span><br><span class="line">      <span class="attr">&quot;16&quot;:</span> <span class="number">1690113884806720496</span></span><br><span class="line">    <span class="attr">strictAffinity:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">unallocated:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">17</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">18</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">19</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">20</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">21</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">22</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">23</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">24</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">25</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">26</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">27</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">28</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">29</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">30</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">31</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">32</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">33</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">34</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">35</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">36</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">37</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">38</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">39</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">40</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">41</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">42</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">43</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">44</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">45</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">46</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">47</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">48</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">49</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">50</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">51</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">52</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">53</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">54</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">55</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">56</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">57</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">58</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">59</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">60</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">61</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">62</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">63</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">7</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">14</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">15</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">5</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">3</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">6</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">4</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">List</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">resourceVersion:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">selfLink:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h3><figure class="highlight yaml"><figcaption><span>centos.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">centos</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">centos</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">centos</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">centos</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">tail</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/dev/null</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">centos</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">centos</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ k apply -f centos.yaml</span><br><span class="line">deployment.apps/centos created</span><br><span class="line"></span><br><span class="line">$ k get po -owide</span><br><span class="line">NAME                      READY   STATUS    RESTARTS   AGE     IP               NODE      NOMINATED NODE   READINESS GATES</span><br><span class="line">centos-67dd9d8678-bxxdv   1/1     Running   0          91s     192.168.185.20   mac-k8s   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">nginx                     1/1     Running   0          2d14h   192.168.185.16   mac-k8s   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>容器内执行，数据包会到 Mac 地址 <code>EE:EE:EE:EE:EE:EE</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ k exec -it centos-67dd9d8678-bxxdv -- bash</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]# ping -c1 192.168.185.16</span><br><span class="line">PING 192.168.185.16 (192.168.185.16) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.185.16: icmp_seq=1 ttl=63 time=0.057 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.185.16 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.057/0.057/0.057/0.000 ms</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]#</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth0@if32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether a6:86:ba:01:06:53 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.185.20/32 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a486:baff:fe01:653/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]#</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]# ip r</span><br><span class="line">default via 169.254.1.1 dev eth0</span><br><span class="line">169.254.1.1 dev eth0 scope link</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]# arping 169.254.1.1</span><br><span class="line">ARPING 169.254.1.1 from 192.168.185.20 eth0</span><br><span class="line">Unicast reply from 169.254.1.1 [EE:EE:EE:EE:EE:EE]  0.556ms</span><br><span class="line">Unicast reply from 169.254.1.1 [EE:EE:EE:EE:EE:EE]  0.534ms</span><br><span class="line">^CSent 2 probes (1 broadcast(s))</span><br><span class="line">Received 2 response(s)</span><br><span class="line">[root@centos-67dd9d8678-bxxdv /]#</span><br></pre></td></tr></table></figure>

<blockquote>
<p>宿主上 veth 对应的 Mac 地址也为 <code>ee:ee:ee:ee:ee:ee</code></p>
</blockquote>
<blockquote>
<p>宿主上发现 <code>192.168.185.16</code> 对应的是本机上的 <code>calic440f455693</code> veth</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br><span class="line">...</span><br><span class="line">32: calica4914fdab0@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netns cni-4fd4e0b7-863d-e095-8460-124c23d7a176</span><br><span class="line">    inet6 fe80::ecee:eeff:feee:eeee/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">$ ip r</span><br><span class="line">default via 192.168.191.2 dev ens160 proto dhcp src 192.168.191.153 metric 100</span><br><span class="line">172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 linkdown</span><br><span class="line">blackhole 192.168.185.0/26 proto 80</span><br><span class="line">192.168.185.8 dev calia19a798b8fd scope link</span><br><span class="line">192.168.185.9 dev calice2f12042d3 scope link</span><br><span class="line">192.168.185.10 dev calic53d7952249 scope link</span><br><span class="line">192.168.185.11 dev calicb368f46996 scope link</span><br><span class="line">192.168.185.12 dev cali07e441e0d79 scope link</span><br><span class="line">192.168.185.13 dev cali9ecb9fbd866 scope link</span><br><span class="line">192.168.185.16 dev calic440f455693 scope link</span><br><span class="line">192.168.185.20 dev calica4914fdab0 scope link</span><br><span class="line">192.168.191.0/24 dev ens160 proto kernel scope link src 192.168.191.153</span><br><span class="line">192.168.191.2 dev ens160 proto dhcp scope link src 192.168.191.153 metric 100</span><br><span class="line"></span><br><span class="line">$ ip a</span><br><span class="line">...</span><br><span class="line">26: calic440f455693@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netns cni-02d7ba4f-f888-aa95-479c-b3c2eb0c05b8</span><br><span class="line">    inet6 fe80::ecee:eeff:feee:eeee/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>进入另一个 Pod 确认</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo crictl ps</span><br><span class="line">CONTAINER           IMAGE               CREATED             STATE               NAME                        ATTEMPT             POD ID              POD</span><br><span class="line">e422f11ca3b74       e6a0117ec169e       54 minutes ago      Running             centos                      0                   68a89759992ad       centos-67dd9d8678-bxxdv</span><br><span class="line">61a0ff5acdc68       d5dd9023bb474       54 minutes ago      Running             calico-node                 0                   869afd4133b4f       calico-node-2z92v</span><br><span class="line">7d6ad449ae76b       ff78c7a65ec2b       2 days ago          Running             nginx                       0                   cb07c78e24238       nginx</span><br><span class="line">....</span><br></pre></td></tr></table></figure>

<blockquote>
<p>sudo crictl inspect 7d6ad449ae76b</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7d6ad449ae76b3166d44ccb50db26fca776353225381820a16dbad3dbbe5861b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;attempt&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CONTAINER_RUNNING&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createdAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-07-26T17:36:12.783406623Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-07-26T17:36:12.846397022Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;finishedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exitCode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker.io/library/nginx:latest&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;imageRef&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker.io/library/nginx@sha256:67f9a4f10d147a6e04629340e6493c9703300ca23a2f7f3aa56fe615d75d31ca&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.container.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.pod.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.pod.namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.pod.uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25fae09f-aef9-4b5a-950f-80ea16cf5e1e&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.container.hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9624f5a5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.container.restartCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.container.terminationMessagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/termination-log&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.container.terminationMessagePolicy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;File&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;io.kubernetes.pod.terminationGracePeriod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mounts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;containerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hostPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/volumes/kubernetes.io~projected/kube-api-access-75rfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;propagation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PROPAGATION_PRIVATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;selinuxRelabel&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;containerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/hosts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hostPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/etc-hosts&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;propagation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PROPAGATION_PRIVATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;selinuxRelabel&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;containerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/termination-log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hostPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/containers/nginx/1616e6f2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;propagation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PROPAGATION_PRIVATE&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;selinuxRelabel&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;logPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/log/pods/default_nginx_25fae09f-aef9-4b5a-950f-80ea16cf5e1e/nginx/0.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cpuPeriod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cpuQuota&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cpuShares&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cpusetCpus&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cpusetMems&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hugepageLimits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;memoryLimitInBytes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;memorySwapLimitInBytes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;oomScoreAdj&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;unified&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;windows&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;sandboxID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pid&quot;</span><span class="punctuation">:</span> <span class="number">106728</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;removing&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshotKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7d6ad449ae76b3166d44ccb50db26fca776353225381820a16dbad3dbbe5861b&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;snapshotter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;overlayfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;runtimeType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;io.containerd.runc.v2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;runtimeOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;systemd_cgroup&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sha256:ff78c7a65ec2b1fb09f58b27b0dd022ac1f4e16b9bcfe1cbdc18c36f2e0e1842&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;envs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_PORT_443_TCP_PROTO&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_PORT_443_TCP_PORT&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_PORT_443_TCP_ADDR&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.96.0.1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_SERVICE_HOST&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.96.0.1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_SERVICE_PORT&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_SERVICE_PORT_HTTPS&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;443&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_PORT&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp://10.96.0.1:443&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;KUBERNETES_PORT_443_TCP&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tcp://10.96.0.1:443&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;mounts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;container_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;host_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/volumes/kubernetes.io~projected/kube-api-access-75rfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;readonly&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;container_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/hosts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;host_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/etc-hosts&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;container_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/termination-log&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;host_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/containers/nginx/1616e6f2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.container.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.pod.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.pod.namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.pod.uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25fae09f-aef9-4b5a-950f-80ea16cf5e1e&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.container.hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9624f5a5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.container.restartCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.container.terminationMessagePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/termination-log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.container.terminationMessagePolicy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;File&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.pod.terminationGracePeriod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;log_path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx/0.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;cpu_period&quot;</span><span class="punctuation">:</span> <span class="number">100000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;cpu_shares&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;oom_score_adj&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;hugepage_limits&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;page_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2MB&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;page_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32MB&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;page_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;64KB&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;page_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1GB&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;security_context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;namespace_options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pid&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;run_as_user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;masked_paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;/proc/acpi&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/kcore&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/keys&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/latency_stats&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/timer_list&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/timer_stats&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/sched_debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/scsi&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;readonly_paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;/proc/asound&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/bus&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/fs&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/irq&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/sys&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;seccomp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;profile_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;runtimeSpec&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;ociVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.2-dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;process&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gid&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;additionalGids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">0</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;/docker-entrypoint.sh&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;-g&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;daemon off;&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;HOSTNAME=nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;NGINX_VERSION=1.25.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;NJS_VERSION=0.7.12&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;PKG_RELEASE=1~bookworm&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_PORT_443_TCP_PROTO=tcp&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_PORT_443_TCP_PORT=443&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_SERVICE_HOST=10.96.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_SERVICE_PORT=443&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_SERVICE_PORT_HTTPS=443&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_PORT=tcp://10.96.0.1:443&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bounding&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;CAP_CHOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FSETID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FOWNER&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_MKNOD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_RAW&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETGID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETFCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETPCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_BIND_SERVICE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SYS_CHROOT&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_KILL&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_AUDIT_WRITE&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;effective&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;CAP_CHOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FSETID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FOWNER&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_MKNOD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_RAW&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETGID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETFCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETPCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_BIND_SERVICE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SYS_CHROOT&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_KILL&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_AUDIT_WRITE&quot;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;permitted&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;CAP_CHOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_DAC_OVERRIDE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FSETID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_FOWNER&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_MKNOD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_RAW&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETGID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETFCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SETPCAP&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_NET_BIND_SERVICE&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_SYS_CHROOT&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_KILL&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;CAP_AUDIT_WRITE&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;apparmorProfile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cri-containerd.apparmor.d&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;oomScoreAdj&quot;</span><span class="punctuation">:</span> <span class="number">1000</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;root&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rootfs&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;mounts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/proc&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;proc&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;proc&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;noexec&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;nodev&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tmpfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tmpfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;strictatime&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;mode=755&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;size=65536k&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/pts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devpts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;devpts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;noexec&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;newinstance&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;ptmxmode=0666&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;mode=0620&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;gid=5&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/mqueue&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mqueue&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mqueue&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;noexec&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;nodev&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/sys&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sysfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sysfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;noexec&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;nodev&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;ro&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/sys/fs/cgroup&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cgroup&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cgroup&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;nosuid&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;noexec&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;nodev&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;relatime&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;ro&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/hosts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/etc-hosts&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rw&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/termination-log&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/containers/nginx/1616e6f2&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rw&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/hostname&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/containerd/io.containerd.grpc.v1.cri/sandboxes/cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34/hostname&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rw&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/etc/resolv.conf&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/containerd/io.containerd.grpc.v1.cri/sandboxes/cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34/resolv.conf&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rw&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/dev/shm&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/run/containerd/io.containerd.grpc.v1.cri/sandboxes/cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34/shm&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rw&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/run/secrets/kubernetes.io/serviceaccount&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bind&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/var/lib/kubelet/pods/25fae09f-aef9-4b5a-950f-80ea16cf5e1e/volumes/kubernetes.io~projected/kube-api-access-75rfs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="string">&quot;rbind&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;rprivate&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="string">&quot;ro&quot;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.container-name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.container-type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;container&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.image-name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker.io/library/nginx:latest&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.sandbox-id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cb07c78e242382171ac035d9b888454f71bb393e788f7feaa7ee13d4ead5cb34&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.sandbox-name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.sandbox-namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;io.kubernetes.cri.sandbox-uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25fae09f-aef9-4b5a-950f-80ea16cf5e1e&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;linux&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;devices&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;allow&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;access&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rwm&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;cpu&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;shares&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;period&quot;</span><span class="punctuation">:</span> <span class="number">100000</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cgroupsPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kubepods-besteffort-pod25fae09f_aef9_4b5a_950f_80ea16cf5e1e.slice:cri-containerd:7d6ad449ae76b3166d44ccb50db26fca776353225381820a16dbad3dbbe5861b&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;namespaces&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pid&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ipc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/proc/105758/ns/ipc&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uts&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/proc/105758/ns/uts&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mount&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;network&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/proc/105758/ns/net&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;maskedPaths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;/proc/acpi&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/kcore&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/keys&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/latency_stats&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/timer_list&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/timer_stats&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/sched_debug&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/scsi&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;readonlyPaths&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="string">&quot;/proc/asound&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/bus&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/fs&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/irq&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/sys&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nsenter -t 106728 -n ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth0@if26: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 4a:86:d5:a8:f4:f5 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 192.168.185.16/32 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::4886:d5ff:fea8:f4f5/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">$ sudo nsenter -t 106728 -n ip r</span><br><span class="line">default via 169.254.1.1 dev eth0</span><br><span class="line">169.254.1.1 dev eth0 scope link</span><br><span class="line"></span><br><span class="line">$ sudo nsenter -t 106728 -n arp</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">169.254.1.1              ether   ee:ee:ee:ee:ee:ee   C                     eth0</span><br><span class="line"></span><br><span class="line">$ ip link</span><br><span class="line">...</span><br><span class="line">26: calic440f455693@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netns cni-02d7ba4f-f888-aa95-479c-b3c2eb0c05b8</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="跨主机路由"><a href="#跨主机路由" class="headerlink" title="跨主机路由"></a>跨主机路由</h3><blockquote>
<p>IDC -&gt; Node</p>
</blockquote>
<ol>
<li>每个 <code>Node</code> 会运行一个 <code>bird</code> Deamon</li>
<li>不同的 Node 上的 bird 会保持一个<code>长连接</code>，然后<code>交换路由信息</code>（将 Node 模拟成一个<code>路由器</code>）</li>
</ol>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><blockquote>
<p>生产：<code>Calico</code> &#x2F; <code>Cilium</code></p>
</blockquote>
<table>
<thead>
<tr>
<th></th>
<th>网络策略</th>
<th>IPV6</th>
<th>网络层级</th>
<th>部署方式</th>
<th>命令行</th>
</tr>
</thead>
<tbody><tr>
<td>Flannel</td>
<td>N</td>
<td>N</td>
<td>L2 - <code>VXLAN</code></td>
<td><code>DaemonSet</code></td>
<td></td>
</tr>
<tr>
<td>Weave</td>
<td>Y</td>
<td>Y</td>
<td>L2 - VXLAN</td>
<td>DaemonSet</td>
<td></td>
</tr>
<tr>
<td><code>Calico</code></td>
<td><code>Y</code></td>
<td>Y</td>
<td>L3 - <code>IPinIP / VXLAN / BGP</code></td>
<td><code>DaemonSet</code></td>
<td>calicoctl</td>
</tr>
<tr>
<td><code>Cilium</code></td>
<td>Y</td>
<td>Y</td>
<td>L3&#x2F;L4 + L7(filtering)</td>
<td>DaemonSet</td>
<td>cilium</td>
</tr>
</tbody></table>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/12/08/cloud-native-foundation-k8s-cni-v2/">https://blog.zhongmingmao.top/2022/12/08/cloud-native-foundation-k8s-cni-v2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/cloud-native-foundation/">Cloud Native Foundation</a><a class="post-meta__tags" href="/tags/kubernetes/">Kubernetes</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/09/cloud-native-foundation-k8s-csi/" title="Kubernetes - CSI"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/k8s-csi.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Kubernetes - CSI</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/07/cloud-native-foundation-k8s-cri/" title="Kubernetes - CRI"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/kubernetes-trends_k8s_container_runtime_popularity.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Kubernetes - CRI</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/12/15/cloud-native-foundation-k8s-devops/" title="Kubernetes - DevOps"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/devops.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-15</div><div class="title">Kubernetes - DevOps</div></div></a></div><div><a href="/2022/12/14/cloud-native-foundation-k8s-production-ops/" title="Kubernetes - Production Ops"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/k8s-ops.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Kubernetes - Production Ops</div></div></a></div><div><a href="/2022/12/13/cloud-native-foundation-k8s-manage-production-clusters/" title="Kubernetes - Manage Production Clusters"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/2bc58949d451b7e5f8f8759c44d962d01b2ed48d-1108x1108.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-13</div><div class="title">Kubernetes - Manage Production Clusters</div></div></a></div><div><a href="/2022/12/12/cloud-native-foundation-k8s-service-discovery/" title="Kubernetes - Service Discovery"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/kubernetes-service-discovery.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-12</div><div class="title">Kubernetes - Service Discovery</div></div></a></div><div><a href="/2022/12/10/cloud-native-foundation-k8s-pod-life-cycle/" title="Kubernetes - Pod Life Cycle"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/pod-life-cycle.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-10</div><div class="title">Kubernetes - Pod Life Cycle</div></div></a></div><div><a href="/2022/12/09/cloud-native-foundation-k8s-csi/" title="Kubernetes - CSI"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/k8s-csi.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-09</div><div class="title">Kubernetes - CSI</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">458</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">125</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">65</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">网络分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%8E%9F%E5%88%99"><span class="toc-number">2.</span> <span class="toc-text">基础原则</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%88%86%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">插件分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">运行机制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%80%83%E9%87%8F"><span class="toc-number">5.</span> <span class="toc-text">设计考量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">6.</span> <span class="toc-text">主机网络</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF"><span class="toc-number">7.</span> <span class="toc-text">数据链路</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E4%B8%BB%E6%9C%BA%E4%BA%92%E9%80%9A"><span class="toc-number">8.</span> <span class="toc-text">跨主机互通</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Plugin"><span class="toc-number">9.</span> <span class="toc-text">Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flannel"><span class="toc-number">9.1.</span> <span class="toc-text">Flannel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Calico"><span class="toc-number">9.2.</span> <span class="toc-text">Calico</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">9.2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">9.2.2.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VXLAN"><span class="toc-number">9.2.3.</span> <span class="toc-text">VXLAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRD"><span class="toc-number">9.2.4.</span> <span class="toc-text">CRD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPPool"><span class="toc-number">9.2.5.</span> <span class="toc-text">IPPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPAMBlock"><span class="toc-number">9.2.6.</span> <span class="toc-text">IPAMBlock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPAMHandle"><span class="toc-number">9.2.7.</span> <span class="toc-text">IPAMHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">9.2.8.</span> <span class="toc-text">网络连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1"><span class="toc-number">9.2.9.</span> <span class="toc-text">跨主机路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">9.3.</span> <span class="toc-text">对比</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/31/go-foundation-map/" title="Go - Map"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomap.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go - Map"/></a><div class="content"><a class="title" href="/2022/12/31/go-foundation-map/" title="Go - Map">Go - Map</a><time datetime="2022-12-30T16:06:25.000Z" title="Created 2022-12-31 00:06:25">2022-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/30/go-foundation-array-slice/" title="Go - Array + Slice"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gophslice.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go - Array + Slice"/></a><div class="content"><a class="title" href="/2022/12/30/go-foundation-array-slice/" title="Go - Array + Slice">Go - Array + Slice</a><time datetime="2022-12-29T16:06:25.000Z" title="Created 2022-12-30 00:06:25">2022-12-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/29/go-foundation-constant/" title="Go - Constant"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-constant.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go - Constant"/></a><div class="content"><a class="title" href="/2022/12/29/go-foundation-constant/" title="Go - Constant">Go - Constant</a><time datetime="2022-12-28T16:06:25.000Z" title="Created 2022-12-29 00:06:25">2022-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/28/go-foundation-primitive/" title="Go - Primitive Type"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gotype.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go - Primitive Type"/></a><div class="content"><a class="title" href="/2022/12/28/go-foundation-primitive/" title="Go - Primitive Type">Go - Primitive Type</a><time datetime="2022-12-27T16:06:25.000Z" title="Created 2022-12-28 00:06:25">2022-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/27/cloud-native-foundation-security-opa-ops/" title="Security - OPA Operation"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/opa/opa-ops.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Security - OPA Operation"/></a><div class="content"><a class="title" href="/2022/12/27/cloud-native-foundation-security-opa-ops/" title="Security - OPA Operation">Security - OPA Operation</a><time datetime="2022-12-26T16:06:25.000Z" title="Created 2022-12-27 00:06:25">2022-12-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2023 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>