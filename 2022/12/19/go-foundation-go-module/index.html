<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Go - Go Module | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="添加依赖 github.com&#x2F;google&#x2F;uuid  main.go1234567891011package mainimport (    &quot;github.com&#x2F;google&#x2F;uuid&quot;    &quot;github.com&#x2F;sirupsen&#x2F;logrus&quot;)func main() &amp;#123;    logrus.Println(&amp;qu">
<meta property="og:type" content="article">
<meta property="og:title" content="Go - Go Module">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/12/19/go-foundation-go-module/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="添加依赖 github.com&#x2F;google&#x2F;uuid  main.go1234567891011package mainimport (    &quot;github.com&#x2F;google&#x2F;uuid&quot;    &quot;github.com&#x2F;sirupsen&#x2F;logrus&quot;)func main() &amp;#123;    logrus.Println(&amp;qu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomodule.png">
<meta property="article:published_time" content="2022-12-18T16:06:25.000Z">
<meta property="article:modified_time" content="2023-10-10T12:12:04.989Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomodule.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go - Go Module",
  "url": "https://blog.zhongmingmao.top/2022/12/19/go-foundation-go-module/",
  "image": "https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomodule.png",
  "datePublished": "2022-12-18T16:06:25.000Z",
  "dateModified": "2023-10-10T12:12:04.989Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/12/19/go-foundation-go-module/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go - Go Module',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomodule.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Go - Go Module</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Go - Go Module</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-12-18T16:06:25.000Z" title="Created 2022-12-19 00:06:25">2022-12-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/go/">Go</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>11mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-10-10 20:12:04&quot;}" hidden></div><h1 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h1><blockquote>
<p>github.com&#x2F;google&#x2F;uuid</p>
</blockquote>
<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logrus.Println(<span class="string">&quot;hello, gomodule mode&quot;</span>)</span><br><span class="line">    logrus.Println(uuid.NewString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<blockquote>
<p><code>go.mod</code> 里的 <code>require</code> 字段中，没有任何 Module 提供了包 github.com&#x2F;google&#x2F;uuid</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go build</span><br><span class="line">main.go:4:2: no required module provides package github.com/google/uuid; to add it:</span><br><span class="line">    go get github.com/google/uuid</span><br></pre></td></tr></table></figure>

<blockquote>
<p>手动 <code>go get</code>，下载依赖到<code>本地 Module 缓存</code>，并更新 <code>go.mod</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ go env GOMODCACHE</span><br><span class="line">/Users/zhongmingmao/workspace/go/pkg/mod</span><br><span class="line"></span><br><span class="line">$ go get github.com/google/uuid</span><br><span class="line">go: downloading github.com/google/uuid v1.3.1</span><br><span class="line">go: added github.com/google/uuid v1.3.1</span><br><span class="line"></span><br><span class="line">$ du -sh /Users/zhongmingmao/workspace/go/pkg/mod/github.com/google/uuid@v1.3.1</span><br><span class="line">140K    /Users/zhongmingmao/workspace/go/pkg/mod/github.com/google/uuid@v1.3.1</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require github.com/sirupsen/logrus v1.9.3</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1 // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行 <code>go mod tidy</code> ，可以<code>自动分析</code>源码中的<code>依赖变化</code>，识别并下载<code>新增依赖</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ go mod tidy</span><br><span class="line">go: finding module for package github.com/google/uuid</span><br><span class="line">go: found github.com/google/uuid in github.com/google/uuid v1.3.1</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.9.3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br></pre></td></tr></table></figure>

<blockquote>
<p>构建并执行</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go build</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] a8ae99d7-d2f2-4f37-96f5-352cf205a336</span><br></pre></td></tr></table></figure>

<h1 id="更改版本"><a href="#更改版本" class="headerlink" title="更改版本"></a>更改版本</h1><blockquote>
<p>语义版本导入</p>
</blockquote>
<h2 id="v1-Y-Z"><a href="#v1-Y-Z" class="headerlink" title="v1.Y.Z"></a>v1.Y.Z</h2><blockquote>
<p>当依赖的主版本号为 <code>0</code> 或者 <code>1</code> 时，对应的 <code>import path</code> 不需要增加主版本号</p>
</blockquote>
<blockquote>
<p>列出 <code>Go Module</code> 的版本列表</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ go list</span><br><span class="line">github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">$ go list -m -versions github.com/sirupsen/logrus</span><br><span class="line">github.com/sirupsen/logrus v0.1.0 v0.1.1 v0.2.0 v0.3.0 v0.4.0 v0.4.1 v0.5.0 v0.5.1 v0.6.0 v0.6.1 v0.6.2 v0.6.3 v0.6.4 v0.6.5 v0.6.6 v0.7.0 v0.7.1 v0.7.2 v0.7.3 v0.8.0 v0.8.1 v0.8.2 v0.8.3 v0.8.4 v0.8.5 v0.8.6 v0.8.7 v0.9.0 v0.10.0 v0.11.0 v0.11.1 v0.11.2 v0.11.3 v0.11.4 v0.11.5 v1.0.0 v1.0.1 v1.0.3 v1.0.4 v1.0.5 v1.0.6 v1.1.0 v1.1.1 v1.2.0 v1.3.0 v1.4.0 v1.4.1 v1.4.2 v1.5.0 v1.6.0 v1.7.0 v1.7.1 v1.8.0 v1.8.1 v1.8.2 v1.8.3 v1.9.0 v1.9.1 v1.9.2 v1.9.3</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 <code>go get </code> 降级为某个<code>兼容版本</code> v1.8.0</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/sirupsen/logrus@v1.8.0</span><br><span class="line">go: downloading github.com/sirupsen/logrus v1.8.0</span><br><span class="line">go: downloading github.com/magefile/mage v1.10.0</span><br><span class="line">go: downloading github.com/stretchr/testify v1.2.2</span><br><span class="line">go: added github.com/magefile/mage v1.10.0</span><br><span class="line">go: downgraded github.com/sirupsen/logrus v1.9.3 =&gt; v1.8.0</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.8.0</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/magefile/mage v1.10.0 // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">$ cat go.sum | grep logrus</span><br><span class="line">github.com/sirupsen/logrus v1.8.0 h1:nfhvjKcUMhBMVqbKHJlk5RPrrfYr/NMo3692g0dwfWU=</span><br><span class="line">github.com/sirupsen/logrus v1.8.0/go.mod h1:4GuYW9TZmE769R5STWrRakJc4UqQ3+QQ95fyz7ENv1A=</span><br><span class="line">github.com/sirupsen/logrus v1.9.3 h1:dueUQJ1C2q9oE3F7wvmSGAaVtTmUizReu6fjN8uqzbQ=</span><br><span class="line">github.com/sirupsen/logrus v1.9.3/go.mod h1:naHLuLoDiP4jHNo9R0sCBMtWGeIprob74mVsIT4qYEQ=</span><br><span class="line"></span><br><span class="line">$ go build</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] f7825699-04ca-42a7-8d34-acb0c96c47d5</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 <code>go mod edit</code> 来继续降级为另一个<code>兼容版本</code> v1.7.0</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ go mod edit -require=github.com/sirupsen/logrus@v1.7.0</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.7.0</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/magefile/mage v1.10.0 // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">$ go mod tidy</span><br><span class="line">go: downloading github.com/sirupsen/logrus v1.7.0</span><br><span class="line"></span><br><span class="line">$ cat go.sum | grep logrus</span><br><span class="line">github.com/sirupsen/logrus v1.7.0 h1:ShrD1U9pZB12TX0cVy0DtePoCH97K8EtX+mg7ZARUtM=</span><br><span class="line">github.com/sirupsen/logrus v1.7.0/go.mod h1:yWOB1SBYBC5VeMP7gHvWumXLIWorT60ONWic61uBYv0=</span><br><span class="line"></span><br><span class="line">$ go build</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] dcf1b908-7a9a-471e-b532-f886bd0f379e</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过 <code>go get </code> 升级为某个<code>兼容版本</code> v1.7.1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/sirupsen/logrus@v1.7.1</span><br><span class="line">go: downloading github.com/sirupsen/logrus v1.7.1</span><br><span class="line">go: added github.com/magefile/mage v1.10.0</span><br><span class="line">go: upgraded github.com/sirupsen/logrus v1.7.0 =&gt; v1.7.1</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.7.1</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/magefile/mage v1.10.0 // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">$ cat go.sum | grep logrus</span><br><span class="line">github.com/sirupsen/logrus v1.7.0 h1:ShrD1U9pZB12TX0cVy0DtePoCH97K8EtX+mg7ZARUtM=</span><br><span class="line">github.com/sirupsen/logrus v1.7.0/go.mod h1:yWOB1SBYBC5VeMP7gHvWumXLIWorT60ONWic61uBYv0=</span><br><span class="line">github.com/sirupsen/logrus v1.7.1 h1:rsizeFmZP+GYwyb4V6t6qpG7ZNWzA2bvgW/yC2xHCcg=</span><br><span class="line">github.com/sirupsen/logrus v1.7.1/go.mod h1:4GuYW9TZmE769R5STWrRakJc4UqQ3+QQ95fyz7ENv1A=</span><br><span class="line"></span><br><span class="line">$ go build</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] 413d0dbb-5f8f-4ce5-89fc-8adcdd7dbf28</span><br></pre></td></tr></table></figure>

<h2 id="vX-Y-Z"><a href="#vX-Y-Z" class="headerlink" title="vX.Y.Z"></a>vX.Y.Z</h2><blockquote>
<p>如果要为 Go 项目添加<code>主版本大于 1</code> 的依赖，<code>import path</code> 需要加上<code>主版本号</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    _ <span class="string">&quot;github.com/go-redis/redis/v7&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logrus.Println(<span class="string">&quot;hello, gomodule mode&quot;</span>)</span><br><span class="line">    logrus.Println(uuid.NewString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>选择 go-redis <code>最新</code>的 v7 版本 v7.4.1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ go mod init github.com/zhongmingmao/gomodule</span><br><span class="line">go: creating new go.mod: module github.com/zhongmingmao/gomodule</span><br><span class="line">go: to add module requirements and sums:</span><br><span class="line">    go mod tidy</span><br><span class="line">    </span><br><span class="line">$ go mod tidy</span><br><span class="line">go: finding module for package github.com/sirupsen/logrus</span><br><span class="line">go: finding module for package github.com/go-redis/redis/v7</span><br><span class="line">go: finding module for package github.com/google/uuid</span><br><span class="line">go: downloading github.com/go-redis/redis v6.15.9+incompatible</span><br><span class="line">go: downloading github.com/go-redis/redis/v7 v7.4.1</span><br><span class="line">go: found github.com/go-redis/redis/v7 in github.com/go-redis/redis/v7 v7.4.1</span><br><span class="line">go: found github.com/google/uuid in github.com/google/uuid v1.3.1</span><br><span class="line">go: found github.com/sirupsen/logrus in github.com/sirupsen/logrus v1.9.3</span><br><span class="line">go: downloading github.com/onsi/ginkgo v1.10.1</span><br><span class="line">go: downloading github.com/onsi/gomega v1.7.0</span><br><span class="line">go: downloading github.com/hpcloud/tail v1.0.0</span><br><span class="line">go: downloading gopkg.in/yaml.v2 v2.2.4</span><br><span class="line">go: downloading golang.org/x/net v0.0.0-20190923162816-aa69164e4478</span><br><span class="line">go: downloading gopkg.in/fsnotify.v1 v1.4.7</span><br><span class="line">go: downloading golang.org/x/text v0.3.2</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/go-redis/redis/v7 v7.4.1</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.9.3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br></pre></td></tr></table></figure>

<blockquote>
<p>升级到一个<code>不兼容</code>的版本 v8，需要修改 <code>import path</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    _ <span class="string">&quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logrus.Println(<span class="string">&quot;hello, gomodule mode&quot;</span>)</span><br><span class="line">    logrus.Println(uuid.NewString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ go mod tidy</span><br><span class="line">go: finding module for package github.com/go-redis/redis/v8</span><br><span class="line">go: found github.com/go-redis/redis/v8 in github.com/go-redis/redis/v8 v8.11.5</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/go-redis/redis/v8 v8.11.5</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.9.3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/cespare/xxhash/v2 v2.1.2 // indirect</span><br><span class="line">    github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">$ cat go.sum| grep redis</span><br><span class="line">github.com/go-redis/redis/v8 v8.11.5 h1:AcZZR7igkdvfVmQTPnu9WE37LRrO/YrBH5zWyjDC0oI=</span><br><span class="line">github.com/go-redis/redis/v8 v8.11.5/go.mod h1:gREzHqY1hg6oD9ngVRbLStwAWKhA0FEgq8Jd4h5lpwo=</span><br></pre></td></tr></table></figure>

<h1 id="移除依赖"><a href="#移除依赖" class="headerlink" title="移除依赖"></a>移除依赖</h1><blockquote>
<p>注释代码</p>
</blockquote>
<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="comment">// _ &quot;github.com/go-redis/redis/v8&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/sirupsen/logrus&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    logrus.Println(<span class="string">&quot;hello, gomodule mode&quot;</span>)</span><br><span class="line">    logrus.Println(uuid.NewString())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>依然依赖 redis - <code>go build 不会自动清空多余的依赖项</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ go build</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] 35566587-7b11-4715-ab00-94ebf29ec43c</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/go-redis/redis/v8 v8.11.5</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.9.3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/cespare/xxhash/v2 v2.1.2 // indirect</span><br><span class="line">    github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f // indirect</span><br><span class="line">    golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">$ go list -m all | grep redis</span><br><span class="line">github.com/go-redis/redis/v8 v8.11.5</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>go mod tidy</code> - 自动分析源码依赖，将<code>不再使用</code>的依赖从 <code>go.mod</code> 和 <code>go.sum</code> 中<code>移除</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ go mod tidy</span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line">module github.com/zhongmingmao/gomodule</span><br><span class="line"></span><br><span class="line">go 1.21.2</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/google/uuid v1.3.1</span><br><span class="line">    github.com/sirupsen/logrus v1.9.3</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">require golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8 // indirect</span><br></pre></td></tr></table></figure>

<h1 id="借用-vendor"><a href="#借用-vendor" class="headerlink" title="借用 vendor"></a>借用 vendor</h1><ol>
<li>vendor 机制是 Go Module 构建机制的一个<code>补充</code><ul>
<li>适用场景：不方便访问外部网络，且对构建性能敏感的环境</li>
</ul>
</li>
<li>GOPATH vs Go Module<ul>
<li>在 <code>GOPATH</code> 构建模式下，<code>vendor</code> 需要<code>手动管理</code></li>
<li>在 <code>Go Module</code> 构建模式下，可以通过命令<code>快速</code>建立和更新 vendor，<code>维护成本很低</code></li>
</ul>
</li>
</ol>
<blockquote>
<p>建立 vendor - 建立了一份<code>项目依赖包</code>的<code>副本</code>，通过 <code>vendor/modules.txt</code> 记录信息</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ tree .</span><br><span class="line">.</span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">└── main.go</span><br><span class="line"></span><br><span class="line">$ go mod vendor</span><br><span class="line"></span><br><span class="line">$ tree -LF 3 .</span><br><span class="line">./</span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── main.go</span><br><span class="line">└── vendor/</span><br><span class="line">    ├── github.com/</span><br><span class="line">    │   ├── google/</span><br><span class="line">    │   └── sirupsen/</span><br><span class="line">    ├── golang.org/</span><br><span class="line">    │   └── x/</span><br><span class="line">    └── modules.txt</span><br><span class="line">    </span><br><span class="line">$ du -sh vendor</span><br><span class="line">7.9M    vendor</span><br><span class="line"></span><br><span class="line">$ cat vendor/modules.txt</span><br><span class="line"># github.com/google/uuid v1.3.1</span><br><span class="line">## explicit</span><br><span class="line">github.com/google/uuid</span><br><span class="line"># github.com/sirupsen/logrus v1.9.3</span><br><span class="line">## explicit; go 1.13</span><br><span class="line">github.com/sirupsen/logrus</span><br><span class="line"># golang.org/x/sys v0.0.0-20220715151400-c0bba94af5f8</span><br><span class="line">## explicit; go 1.17</span><br><span class="line">golang.org/x/sys/internal/unsafeheader</span><br><span class="line">golang.org/x/sys/unix</span><br><span class="line">golang.org/x/sys/windows</span><br></pre></td></tr></table></figure>

<blockquote>
<p>基于 <code>vendor</code> 构建（默认是基于 <code>Module 本地缓存</code>构建）<br><code>Go 1.14</code> ，如果 Go 项目的顶层目录中存在 <code>vendor 目录</code>，优先基于 <code>vendor</code> 构建，除非指定 <code>-mod</code> 参数</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ go version</span><br><span class="line">go version go1.21.2 darwin/arm64</span><br><span class="line"></span><br><span class="line">$ go build -mod=vendor</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] 6f36a59f-d696-45e4-a194-f10a6b5a9bee</span><br><span class="line"></span><br><span class="line">$ rm -rf ./vendor/golang.org</span><br><span class="line"></span><br><span class="line">$ go build</span><br><span class="line">vendor/github.com/sirupsen/logrus/terminal_check_bsd.go:6:8: cannot find module providing package golang.org/x/sys/unix: import lookup disabled by -mod=vendor</span><br><span class="line">    (Go version in go.mod is at least 1.14 and vendor directory exists.)</span><br><span class="line">    </span><br><span class="line">$ go build -mod=mod</span><br><span class="line"></span><br><span class="line">$ ./gomodule</span><br><span class="line">INFO[0000] hello, gomodule mode</span><br><span class="line">INFO[0000] 6174371d-9560-4f1e-9add-7dd3a21ed5e3</span><br></pre></td></tr></table></figure>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/12/19/go-foundation-go-module/">https://blog.zhongmingmao.top/2022/12/19/go-foundation-go-module/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/go/">Go</a></div><div class="post-share"><div class="social-share" data-image="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/gomodule.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/12/20/go-foundation-main-init/" title="Go - Main + Init"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/goinit.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Go - Main + Init</div></div><div class="info-2"><div class="info-item-1">main.main main 包中的 main 函数 - 所有可执行程序的用户层执行逻辑的入口函数  123456package main// 无参数 + 无返回值func main() &#123;  // 用户层执行逻辑&#125;     可执行程序的 main 包必须定义 main 函数，否则会编译报错function main is undeclared in the main package  main.go1package main  123$ go build main.go# command-line-argumentsruntime.main_main·f: function main is undeclared in the main package   在启动了多个 goroutine 的 Go 应用中，main.main 将在 Go 应用的主 goroutine 中执行 main.main 函数返回意味着整个 Go 程序结束 除了 main 包外，其它包也可以拥有自己的 main 函数 但依据 Go 的可见性规则，非 main 包中的 main 函数仅限于包内使用    123...</div></div></div></a><a class="pagination-related" href="/2022/12/18/go-foundation-build-mode/" title="Go - Build Mode"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-package-management.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Go - Build Mode</div></div><div class="info-2"><div class="info-item-1">构建过程 确定包版本 + 编译包 + 链接目标文件（编译后得到的）    构建模式   Mode Desc    GOPATH 不关注依赖版本   Vendor - 1.5 Reproducible Build   Go Module - 1.11 Dependency Management   GOPATH Go 首次开源时，内置了 GOPATH 的构建模式 Go 编译器可以在本地 GOPATH 下搜索 Go 程序依赖的第三方包 如果存在，则使用这个本地包进行编译；如果不存在，则会报编译错误    main.go1234567package mainimport &quot;github.com/sirupsen/logrus&quot;func main() &#123;    logrus.Println(&quot;hello, gopath mode&quot;)&#125;   无法找到依赖包而构建失败  1234567891011121314151617$ go versiongo version go1.10.8 linux/amd64$ echo $GOROOT/home/zhongm...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/05/10/cloud-native-foundation-go-engineering-cli/" title="Go Engineering - CLI"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-framework.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-10</div><div class="info-item-2">Go Engineering - CLI</div></div><div class="info-2"><div class="info-item-1">应用框架 命令行参数解析 - Pflag 配置文件解析 - Viper 应用的命令行框架 - Cobra 命令需要具备 help 功能 命令需要能够解析命令行参数和配置文件 命令需要能够初始化业务代码，并最终启动业务进程      Pflag 命令行参数解析工具 - Kubernetes &#x2F; Istio &#x2F; Helm &#x2F; Docker &#x2F; Etcd &#x2F; …  Flag 一个命令行参数会被解析成一个 Flag 类型的变量  1234567891011121314// A Flag represents the state of a flag.type Flag struct &#123;    Name                string              // name as it appears on command line    Shorthand           string              // one-letter abbreviated flag    Usage               string   ...</div></div></div></a><a class="pagination-related" href="/2023/05/09/cloud-native-foundation-go-engineering-log/" title="Go Engineering - Log"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-log.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-09</div><div class="info-item-2">Go Engineering - Log</div></div><div class="info-2"><div class="info-item-1">功能设计基础功能 支持基本的日志信息 - 时间戳、文件名、行号、日志级别、日志信息 支持不同的日志级别 - Debug &#x2F; Info &#x2F; Warn &#x2F; Error &#x2F; Panic &#x2F; Fatal logrus 支持 Trace 日志级别，Trace 不是必须的 Trace 和 Panic 是可选的级别   支持自定义配置 - 不同的环境采用不同的配置 开发环境的日志级别为 Debug，而生产环境的日志级别为 Info 通过配置，可以在不重新编译代码的情况下，改变记录日志的行为   支持输出到标准输出和文件     至少实现 6 个日志级别    日志调用时的属性   输出级别 glog.Info(“This is info message”)   开关级别 启动程序时，期望哪些输出级别的日志会被打印 glog -v=L - 只有输出级别 ≥L 的日志才会被打印     高级功能 支持多种日志格式 - TEXT &#x2F; JSON &#x2F; … 开发环境采用 TEXT 格式，生产环境采用 JSON 格式   按日志级别分类输出 - Error 级别...</div></div></div></a><a class="pagination-related" href="/2023/05/08/cloud-native-foundation-go-engineering-err-code/" title="Go Engineering - Error Code"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-error-handling.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-08</div><div class="info-item-2">Go Engineering - Error Code</div></div><div class="info-2"><div class="info-item-1">预期功能 有业务 Code 码标识 - HTTP Code 码有限 安全 - 对内对外展示不同的错误信息    设计方式 无论请求成功与否，都返回 200，在 HTTP Body 中包含错误信息 HTTP Code 通常代表 HTTP Transport 层的状态信息 缺点：性能不佳（需解析 Body） + 对客户端不友好   返回 4xx or 5xx，并在 Body 中返回简单的错误信息 返回 4xx or 5xx，并在 Body 中返回详细的错误信息 - 推荐  设计思路 区别于 http status code，业务码需要有一定的规则，可以通过业务码判断出是哪类错误 请求出错时，可以通过 http status code，直接感知到请求出错 需要在请求出错时，返回详细的信息：Code + Message + Reference（Optional） 返回的错误信息，需要是可以直接展示给用户的安全信息，不能包含敏感信息 但同时也要有内部更详细的错误信息，方便 Debug   返回的数据格式应该是固定的，规范的 错误信息要保持简洁，并提供有用的信息  Biz Code 纯数字表示，不同部位代表不同的服...</div></div></div></a><a class="pagination-related" href="/2023/05/07/cloud-native-foundation-go-engineering-doc/" title="Go Engineering - Doc"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-doc.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-07</div><div class="info-item-2">Go Engineering - Doc</div></div><div class="info-2"><div class="info-item-1">Swagger Swagger 是一套围绕 OpenAPI 规范构建的开源工具     Component Desc    Swagger Editor 基于浏览器的编辑器，可以编写 OpenAPI 规范，并实时预览   Swagger UI 将 OpenAPI 规范呈现为交互式 API 文档   Swagger Codegen 根据 OpenAPI 规范，生成服务器存根和客户端代码库，涵盖 40 多种语言     OpenAPI OpenAPI 是一个 API 规范，其前身为 Swagger 规范 通过定义一种用来描述 API 格式或者 API 定义的 DSL，来规范 RESTful API 的开发过程 OpenAPI 3.0 ≈ Swagger 2.0   API 基本信息 对 API 的描述，介绍 API 可以实现的功能 每个 API 上可用的 Path 和 Method 每个 API 的输入和返回参数 验证方法 联系信息、许可证、使用条款和其它信息   OpenAPI 是一个 API 规范，而 Swagger 是实现该 API 规范的工具  go-swagger特性 功能强大、高性能、可以根据代...</div></div></div></a><a class="pagination-related" href="/2023/05/06/cloud-native-foundation-go-engineering-lint/" title="Go Engineering - Lint"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-lint.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-06</div><div class="info-item-2">Go Engineering - Lint</div></div><div class="info-2"><div class="info-item-1">golangci-lint 使用最多    优点   Advantage Desc    速度快 基于 gometalinter 开发，但比 gometalinter 快 5 倍原因：并行检查 + 复用 go build 缓存 + 缓存分析结果   可配置 支持 YAML 格式的配置文件   IDE 集成 Goland &#x2F; VS Code   linter 聚合器 不需要单独安装   最少误报数 调整了所集成 linter 的默认配置，大幅度减少误报   良好的输出 颜色、行号等   迭代快 不断有新的 linter 被集成到 golangci-lint 中   选项 配置 同时出现 - 命令行选项 &#x2F; 配置文件   bool&#x2F;string&#x2F;int - 命令行选项 slice - 合并  命令行选项 golangci-lint run -h     Flag Desc    –print-issued-lines Print lines of code with issue (default true)   –print-linter-name Print lin...</div></div></div></a><a class="pagination-related" href="/2023/05/05/cloud-native-foundation-go-engineering-makefile/" title="Go Engineering - Makefile"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-makefile.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-05</div><div class="info-item-2">Go Engineering - Makefile</div></div><div class="info-2"><div class="info-item-1">基础语法 https://github.com/seisman/how-to-write-makefile   规则语法 伪目标 变量赋值 特殊变量 自动化变量  功能设计Target   Target Desc    gen Generate all necessary files, such as error code files.   format Gofmt (reformat) package sources (exclude vendor dir if existed).   lint Check syntax and styling of go sources.   test Run unit test.   cover Run unit test and get test coverage.   build Build source code for host platform.   build.multiarch Build source code for multiple platforms. See option PLATFORMS.   image Build docker im...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E7%89%88%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">更改版本</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#v1-Y-Z"><span class="toc-number">2.1.</span> <span class="toc-text">v1.Y.Z</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vX-Y-Z"><span class="toc-number">2.2.</span> <span class="toc-text">vX.Y.Z</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E4%BE%9D%E8%B5%96"><span class="toc-number">3.</span> <span class="toc-text">移除依赖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%80%9F%E7%94%A8-vendor"><span class="toc-number">4.</span> <span class="toc-text">借用 vendor</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-server.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Server V1"/></a><div class="content"><a class="title" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1">Observability - Prometheus Server V1</a><time datetime="2025-01-23T16:06:25.000Z" title="Created 2025-01-24 00:06:25">2025-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>