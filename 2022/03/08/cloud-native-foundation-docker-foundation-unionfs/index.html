<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker Foundation - Union FS | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Union FS Docker 的创新在文件系统：通过镜像解决容器分发的问题   将不同目录挂载到同一个虚拟文件系统下的文件系统 支持为每一个成员目录（类似于 Git Branch）设定权限：readonly、readwrite、whiteout-able 文件系统分层，对 readonly 权限的 Branch 可以逻辑上进行修改（增量、不影响 readonly 部分） 用途 将多个 Disk">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Foundation - Union FS">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Union FS Docker 的创新在文件系统：通过镜像解决容器分发的问题   将不同目录挂载到同一个虚拟文件系统下的文件系统 支持为每一个成员目录（类似于 Git Branch）设定权限：readonly、readwrite、whiteout-able 文件系统分层，对 readonly 权限的 Branch 可以逻辑上进行修改（增量、不影响 readonly 部分） 用途 将多个 Disk">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png">
<meta property="article:published_time" content="2022-03-07T16:06:25.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.567Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Container">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker Foundation - Union FS",
  "url": "https://blog.zhongmingmao.top/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/",
  "image": "https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png",
  "datePublished": "2022-03-07T16:06:25.000Z",
  "dateModified": "2023-04-03T10:04:59.567Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker Foundation - Union FS',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Docker Foundation - Union FS</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Docker Foundation - Union FS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-03-07T16:06:25.000Z" title="Created 2022-03-08 00:06:25">2022-03-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/">Cloud Native Foundation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/container/">Container</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/container/docker/">Docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>4mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h1 id="Union-FS"><a href="#Union-FS" class="headerlink" title="Union FS"></a>Union FS</h1><blockquote>
<p>Docker 的创新在<strong>文件系统</strong>：通过<strong>镜像</strong>解决<strong>容器分发</strong>的问题</p>
</blockquote>
<ol>
<li>将<strong>不同目录</strong>挂载到<strong>同一个虚拟文件系统</strong>下的文件系统</li>
<li>支持为每一个<strong>成员目录</strong>（类似于 <strong>Git Branch</strong>）设定权限：<code>readonly</code>、<code>readwrite</code>、<code>whiteout-able</code></li>
<li>文件系统分层，对 <code>readonly</code> 权限的 Branch 可以<strong>逻辑上</strong>进行修改（<strong>增量</strong>、不影响 <code>readonly</code> 部分）</li>
<li>用途<ul>
<li>将多个 Disk 挂在同一个目录下</li>
<li>将一个 <code>readonly</code> 的 Branch 和一个 <code>writeable</code> 的 Branch 联合在一起</li>
</ul>
</li>
</ol>
<span id="more"></span>

<h1 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h1><blockquote>
<p>层可以<strong>复用</strong>，增量分发</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308221506755.png" alt="image-20220308221506755"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># docker image inspect --format &#x27;&#123;&#123;.RootFS&#125;&#125;&#x27; centos:latest</span><br><span class="line">&#123;layers [sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59] &#125;</span><br></pre></td></tr></table></figure>

<h1 id="镜像文件系统"><a href="#镜像文件系统" class="headerlink" title="镜像文件系统"></a>镜像文件系统</h1><ol>
<li>bootfs<ul>
<li>Bootloader <strong>引导加载 kernel</strong></li>
<li>当 kernel 被加载到内存后，<strong>umount bootfs</strong></li>
</ul>
</li>
<li>rootfs<ul>
<li>rootfs：<code>/dev</code>、<code>/proc</code> 等<strong>标准目录和文件</strong></li>
</ul>
</li>
<li>不同的 Linux 发行版，<strong>bootfs 基本一致，而 rootfs 会有差异</strong>，<strong>容器关心的只是 kernel</strong></li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308224259859.png" alt="image-20220308224259859"></p>
<h1 id="容器运行态"><a href="#容器运行态" class="headerlink" title="容器运行态"></a>容器运行态</h1><blockquote>
<p>容器是 Linux 上的一个进程，<strong>没有 bootfs（复用宿主机的 kernel），只有 rootfs</strong><br>容器需要借助 <strong>mnt namespace</strong> 进行隔离，可见的是镜像的 <strong>rootfs</strong></p>
</blockquote>
<ol>
<li>Linux<ul>
<li>在启动时，先将 <strong>rootfs</strong> 设置为 <strong>readonly</strong>，在进行一系列检查后，将其切换成 <strong>readwrite</strong> 供用户使用</li>
</ul>
</li>
<li>Docker 启动<ul>
<li>初始化时，同样将 <strong>rootfs</strong> 以 <strong>readonly</strong> 的方式加载并检查</li>
<li>然后利用 <strong>Union FS</strong> 的方式将一个 <strong>readwrite</strong> 文件系统挂载在 <strong>readonly</strong> 的 <strong>rootfs</strong> 之上</li>
<li>再次将<strong>下层的 FS</strong> 设为 <strong>readonly</strong>，并向上叠加 – <strong>迭代</strong></li>
<li>这样构成了 <strong>container</strong> 的运行态：<strong>N 个 readonly FS 层 + 1 个 writeable FS 层</strong></li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308225758225.png" alt="image-20220308225758225"></p>
<h1 id="写操作"><a href="#写操作" class="headerlink" title="写操作"></a>写操作</h1><blockquote>
<p>镜像是共享的，容器对<strong>可写层</strong>的操作依赖于<strong>存储驱动</strong>提供的<strong>写时复制</strong>和<strong>用时分配</strong>机制 – 提高存储和内存资源的<strong>利用率</strong></p>
</blockquote>
<ol>
<li><strong>写时复制</strong><ul>
<li>当需要修改镜像的文件时，从镜像的文件系统<strong>复制</strong>一份到容器的可写层进行修改，镜像里的文件不会改变<ul>
<li>同一个镜像可以对应多个容器，<strong>对应的镜像文件只会有一份</strong>，内容不同的是各自容器的可写层</li>
<li>不同容器对文件的修改是<strong>互不影响</strong>的</li>
</ul>
</li>
</ul>
</li>
<li><strong>用时分配</strong>：当一个文件<strong>被创建</strong>出来后，才会<strong>分配</strong>空间</li>
</ol>
<h1 id="容器存储驱动"><a href="#容器存储驱动" class="headerlink" title="容器存储驱动"></a>容器存储驱动</h1><blockquote>
<p>主流：OverlayFS</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308231845539.png" alt="image-20220308231845539"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308232731280.png" alt="image-20220308232731280"></p>
<h1 id="OverlayFS"><a href="#OverlayFS" class="headerlink" title="OverlayFS"></a>OverlayFS</h1><ol>
<li>OverlayFS 是一种 <strong>Union FS</strong>，属于<strong>文件级</strong>的存储驱动（<code>BtrFS</code> 和 <code>ZFS</code> 都是<strong>块级别</strong>的存储驱动）</li>
<li>Overlay 只有两层：<strong>Lower</strong> 层代表<strong>镜像层</strong>，<strong>Upper</strong> 层代表<strong>容器可写层</strong></li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220308233522162.png" alt="image-20220308233522162"></p>
<blockquote>
<p>work 是临时工作目录，以 merged 为准</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># mkdir upper lower merged work</span><br><span class="line"># echo &quot;from lower&quot; &gt; lower/in_lower.txt</span><br><span class="line"># echo &quot;from upper&quot; &gt; upper/in_upper.txt</span><br><span class="line"># echo &quot;from lower&quot; &gt; lower/in_both.txt</span><br><span class="line"># echo &quot;from upper&quot; &gt; upper/in_both.txt</span><br><span class="line"># tree</span><br><span class="line">.</span><br><span class="line">├── lower</span><br><span class="line">│   ├── in_both.txt</span><br><span class="line">│   └── in_lower.txt</span><br><span class="line">├── merged</span><br><span class="line">├── upper</span><br><span class="line">│   ├── in_both.txt</span><br><span class="line">│   └── in_upper.txt</span><br><span class="line">└── work</span><br><span class="line"></span><br><span class="line"># mount -t overlay overlay -o lowerdir=`pwd`/lower,upperdir=`pwd`/upper,workdir=`pwd`/work `pwd`/merged</span><br><span class="line"># tree</span><br><span class="line">.</span><br><span class="line">├── lower</span><br><span class="line">│   ├── in_both.txt</span><br><span class="line">│   └── in_lower.txt</span><br><span class="line">├── merged</span><br><span class="line">│   ├── in_both.txt</span><br><span class="line">│   ├── in_lower.txt</span><br><span class="line">│   └── in_upper.txt</span><br><span class="line">├── upper</span><br><span class="line">│   ├── in_both.txt</span><br><span class="line">│   └── in_upper.txt</span><br><span class="line">└── work</span><br><span class="line">    └── work</span><br><span class="line">    </span><br><span class="line"># cat merged/in_lower.txt </span><br><span class="line">from lower</span><br><span class="line"></span><br><span class="line"># cat merged/in_upper.txt </span><br><span class="line">from upper</span><br><span class="line"></span><br><span class="line"># cat merged/in_both.txt </span><br><span class="line">from upper</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># docker inspect --format &#x27;&#123;&#123;.GraphDriver.Name&#125;&#125;&#x27; 4201f70592fb</span><br><span class="line">overlay2</span><br><span class="line"></span><br><span class="line"># docker inspect --format &#x27;&#123;&#123;.GraphDriver.Data&#125;&#125;&#x27; 4201f70592fb</span><br><span class="line">map[</span><br><span class="line">  LowerDir:/var/lib/docker/overlay2/107d1c12b28e3fabb3e3786958511781538314871aa811d3c67167369ab34868-init/diff:/var/lib/docker/overlay2/f16880bc8754bf4782daa4849d0e2f41c56ec5c5e8bf8718efce67ca38a853de/diff </span><br><span class="line">  MergedDir:/var/lib/docker/overlay2/107d1c12b28e3fabb3e3786958511781538314871aa811d3c67167369ab34868/merged </span><br><span class="line">  UpperDir:/var/lib/docker/overlay2/107d1c12b28e3fabb3e3786958511781538314871aa811d3c67167369ab34868/diff </span><br><span class="line">  WorkDir:/var/lib/docker/overlay2/107d1c12b28e3fabb3e3786958511781538314871aa811d3c67167369ab34868/work</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># ls /var/lib/docker/overlay2/107d1c12b28e3fabb3e3786958511781538314871aa811d3c67167369ab34868/merged </span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>

<h1 id="OCI"><a href="#OCI" class="headerlink" title="OCI"></a>OCI</h1><blockquote>
<p>Open Container Initiative – Google 主导</p>
</blockquote>
<table>
<thead>
<tr>
<th>Specification</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Image</strong> Specification</td>
<td>定义应用如何打包</td>
</tr>
<tr>
<td><strong>Distribution</strong> Specification</td>
<td>定义如何分发容器镜像</td>
</tr>
<tr>
<td><strong>Runtime</strong> Specification</td>
<td>定义如何<strong>解压</strong>应用包并<strong>运行</strong></td>
</tr>
</tbody></table>
<h1 id="Docker-引擎架构"><a href="#Docker-引擎架构" class="headerlink" title="Docker 引擎架构"></a>Docker 引擎架构</h1><blockquote>
<p>containerd 是一个单纯的 daemon，fork 出来的子进程的父进程是一个 <strong>shim</strong>（shim 的父进程是 systemd），这样 containerd 重启时不会影响其他进程</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220309000951365.png" alt="image-20220309000951365"></p>
<blockquote>
<p>6469 就是 shim</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># docker inspect --format &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; 4201f70592fb</span><br><span class="line">6491</span><br><span class="line"></span><br><span class="line"># ps -ef | grep 6491                                              </span><br><span class="line">root        6491    6469  0 15:58 pts/0    00:00:00 bash</span><br><span class="line"></span><br><span class="line"># ps -ef | grep 6469    </span><br><span class="line">root        6469       1  0 15:58 ?        00:00:00 /usr/bin/containerd-shim-runc-v2 ...</span><br><span class="line">root        6491    6469  0 15:58 pts/0    00:00:00 bash</span><br></pre></td></tr></table></figure>

<blockquote>
<p>容器内的 1 号进程，是 <strong>EntryPoint</strong> 进程，并非宿主机上的 systemd</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 4201f70592fb ps -ef</span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">root           1       0  0 15:58 pts/0    00:00:00 bash</span><br><span class="line">root          15       0  0 16:23 pts/1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/">https://blog.zhongmingmao.top/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/docker/">Docker</a><a class="post-meta__tags" href="/tags/container/">Container</a></div><div class="post-share"><div class="social-share" data-image="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/03/14/cloud-native-foundation-go-engineering-iam/" title="Go Engineering - IAM"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-18.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Go Engineering - IAM</div></div><div class="info-2"><div class="info-item-1">概述 IAM：Identity and Access Management 用途：在特定条件下，用户能够对哪些资源做哪些操作  工作流程 3 种平台资源：User、Secret、Policy     系统架构   核心功能 创建平台资源 用户通过 iam-webconsole 或者 iamctl 请求 iam-apiserver，完成 User、Secret、Policy 的 CRUD iam-apiserver 将这些资源持久化到 MySQL 中   请求 API 完成资源授权 用户通过 iam-authz-server 的 &#x2F;v1&#x2F;authz 接口进行资源授权 请求 &#x2F;v1&#x2F;authz 接口需要通过密钥认证，认证通过后会查询授权策略，从而决定资源是否被允许   为了提高 &#x2F;v1&#x2F;authz 接口的性能，iam-authz-server 将密钥和策略缓存在内存中 iam-authz-server 通过 gRPC 调用 iam-apiserver，将密钥和策略缓存到内存中 为了保证数据的一致性，借助 Redis Channel 当 iam-ap...</div></div></div></a><a class="pagination-related" href="/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/" title="Docker Foundation - Namespace + Cgroup"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-22.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Docker Foundation - Namespace + Cgroup</div></div><div class="info-2"><div class="info-item-1">概要 基于 Linux Kernel 的 Cgroup、Namespace、Union FS 等技术，对进程进行封装隔离，属于 OS  层面的虚拟化技术 由于被隔离的进程独立于宿主机和其它被隔离的进程，因此称为容器   演变历史 最早基于 LXC – a linux container runtime 0.7：去除 LXC，转而使用自研的 Libcontainer 1.11：使用 runC 和 containerd    Docker 在容器的基础上，进行了进一步的封装，极大地简化了容器的创建和维护    Docker vs VM Docker Engine 是一个 Daemon 进程，启动一个容器的时候，相当于执行了一次进程的 Fork 操作       Container VM    启动时间 秒级 分钟级   硬盘使用 MB 级别 GB 级别   性能 接近原生 弱于   单机支持量 上千 几十   容器标准 OCI – Open Container Initiative K8S 的主要贡献：标准化 后期 Docker 公司不得不让步，兼容 OCI 标准   核心规范：Image  + Runti...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/10/16/cloud-native-foundation-docker/" title="Cloud Native Foundation - Docker"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/Docker-build.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-16</div><div class="info-item-2">Cloud Native Foundation - Docker</div></div><div class="info-2"><div class="info-item-1">历史 基于 Linux 的 Namespace 、Cgroup和 Union FS，对进程进行封装隔离，属于 OS 层的虚拟化技术 Docker 最初的实现是基于 LXC 从 0.7 以后开始移除 LXC，而使用自研的 Libcontainer 从 1.11 开始，使用 runC 和 Containerd   Docker 在容器的基础上，进行进一步的封装，极大地简化容器的创建和维护    Docker vs VM    特性 Docker VM    启动 秒级 分钟级   磁盘 MB GB   性能 接近原生 弱于   数量 单机上千个容器 几十个   容器标准 OCI - Open Container Initiative     Key Value    Image Specification 如何打包   Runtime Specification 如何解压应用包并运行   Distribution Specification 如何分发镜像   主要特性 隔离性（Namespace）、可配额（CGroup）、便携性（Union FS）、安全性  Namespace Linux Namespac...</div></div></div></a><a class="pagination-related" href="/2022/10/01/kubernetes-container-interconnection/" title="Kubernetes - Container Interconnection"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-04.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-01</div><div class="info-item-2">Kubernetes - Container Interconnection</div></div><div class="info-2"><div class="info-item-1">拷贝数据123456$ docker run -d --rm redis450662153d83e6e1b30af57443ccfe68d798d5c7f4f8e50d2d287fdde2c1645c$ docker psCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS      NAMES450662153d83   redis     &quot;docker-entrypoint.s…&quot;   7 seconds ago   Up 6 seconds   6379/tcp   cranky_wilbur   拷贝宿主机文件到容器  1234567891011$ md5sum a.txtd41d8cd98f00b204e9800998ecf8427e  a.txt$ docker cp a.txt 450:/tmp$ docker exec -it 450 sh# ls /tmpa.txt# md5sum /tmp/a.txtd41d8cd98f00b204e98009...</div></div></div></a><a class="pagination-related" href="/2022/09/26/kubernetes-docker-hub/" title="Kubernetes - Docker Hub"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-hub.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-26</div><div class="info-item-2">Kubernetes - Docker Hub</div></div><div class="info-2"><div class="info-item-1">Registry Registry -&gt; Repository     Docker Hub 默认 Registry   ImageOfficial Dockerhttps://hub.docker.com/u/library   Verified Bitnami &#x2F; Rancher &#x2F; Ubuntu   Unofficial半官方 开通 Verified publisher，需要付费   民间 个人镜像  Naming user&#x2F;app:tagtag &#x3D; version + osslim &#x2F; fat     OS Example    Alpine &#x2F; CentOS alpine3.15   Ubuntu 18.04 bionic   Ubuntu 20.04 focal   Debian 9 stretch   Debian 10 buster   Debian 11 bullseye   FlowOnline1234567$ docker login -u zhongmingmaoPassword:WARNING! Your pas...</div></div></div></a><a class="pagination-related" href="/2022/09/19/kubernetes-dockerfile/" title="Kubernetes - Dockerfile"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-02.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-19</div><div class="info-item-2">Kubernetes - Dockerfile</div></div><div class="info-2"><div class="info-item-1">Image 镜像由多层 Layer 组成，Layer 是一组只读不可修改的文件，Layer 可以在镜像间共享Image &#x3D; Layer + Union FS     1234567891011121314$ docker inspect nginx:alpine...        &quot;RootFS&quot;: &#123;            &quot;Type&quot;: &quot;layers&quot;,            &quot;Layers&quot;: [                &quot;sha256:e5e13b0c77cbb769548077189c3da2f0a764ceca06af49d8d558e759f5c232bd&quot;,                &quot;sha256:07099189e7ec257e501d9625507b55e0ea32c330e38c90d8533b3fa2a7a97069&quot;,                &quot;sha256:fcf860bf48b4e20f24f44ba02...</div></div></div></a><a class="pagination-related" href="/2022/09/18/kubernetes-containerization/" title="Kubernetes - Containerization"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-01.png.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-18</div><div class="info-item-2">Kubernetes - Containerization</div></div><div class="info-2"><div class="info-item-1">镜像 只读：依赖的文件系统、依赖库、环境变量、启动参数等    核心解决的问题：应用分发    应用容器化 应用不再直接与 OS 打交道，而是封装成镜像，再交给容器环境去运行   常用命令镜像   命令 作用    docker pull 从远端仓库拉取镜像   docker images 列出当前本地已有的镜像   docker rmi 删除不再使用的镜像   容器12$ docker run -h srv --rm alpine hostnamesrv  1234567891011121314151617181920$ docker run -d nginx:alpine6376e2649ef2d4a6073b977fcc4408f7a3f21b6f32775b42be85711b989dd6ce$ docker run -d --name redis_srv redis2a79d491ecb3108b07df7d369dfe8abc6ac314efc2054951ef7b77e0deba0584$ docker run -it --name ubuntu ubuntu sh# cat /etc/o...</div></div></div></a><a class="pagination-related" href="/2022/09/16/kubernetes-docker-nature/" title="Kubernetes - Docker Nature"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-geek.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-16</div><div class="info-item-2">Kubernetes - Docker Nature</div></div><div class="info-2"><div class="info-item-1">本质 容器，是一个特殊的隔离环境，能够让进程只看到这个环境内的有限信息，不能对外界环境施加影响隔离的原因：系统安全隔离的实现：namespace + cgroup + chroot(rootfs)    Container vs VM 容器并不是直接运行在 Docker 上，Docker 只是辅助建立隔离环境，让容器基于 Linux 运行    VM 虚拟化出来的是硬件，需要在上面再安装一个 Guest OS 才能运行应用程序，会消耗大量的系统资源   容器则直接利用了下层的计算机硬件和操作系统，非常轻量级，但多个容器共用 OS Kernel，隔离程度不如 VM      实现方式 优势 劣势    VM 虚拟化硬件 隔离程度非常高 资源消耗大，启动慢   Container 直接利用下层的硬件和操作系统 资源利用率高运行速度快 隔离程度较低   </div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Union-FS"><span class="toc-number">1.</span> <span class="toc-text">Union FS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F"><span class="toc-number">2.</span> <span class="toc-text">Docker 镜像</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.</span> <span class="toc-text">镜像文件系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%80%81"><span class="toc-number">4.</span> <span class="toc-text">容器运行态</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">写操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%AD%98%E5%82%A8%E9%A9%B1%E5%8A%A8"><span class="toc-number">6.</span> <span class="toc-text">容器存储驱动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OverlayFS"><span class="toc-number">7.</span> <span class="toc-text">OverlayFS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OCI"><span class="toc-number">8.</span> <span class="toc-text">OCI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-%E5%BC%95%E6%93%8E%E6%9E%B6%E6%9E%84"><span class="toc-number">9.</span> <span class="toc-text">Docker 引擎架构</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/Java-Foreign-Function-API.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Foreign Function API"/></a><div class="content"><a class="title" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API">New Java Feature - Foreign Function API</a><time datetime="2025-01-16T16:06:25.000Z" title="Created 2025-01-17 00:06:25">2025-01-17</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>