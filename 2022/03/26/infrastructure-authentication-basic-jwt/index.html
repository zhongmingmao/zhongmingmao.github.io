<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Infrastructure - Authentication - Basic + JWT | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="HTTP Authentication Some common authentication schemes include: Basic Bearer   The server responds to a client with a 401 (Unauthorized) response status and provides information on how to authorize wi">
<meta property="og:type" content="article">
<meta property="og:title" content="Infrastructure - Authentication - Basic + JWT">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/03/26/infrastructure-authentication-basic-jwt/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="HTTP Authentication Some common authentication schemes include: Basic Bearer   The server responds to a client with a 401 (Unauthorized) response status and provides information on how to authorize wi">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png">
<meta property="article:published_time" content="2022-03-25T17:06:25.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.577Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Infrastructure">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="JWT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Infrastructure - Authentication - Basic + JWT",
  "url": "https://blog.zhongmingmao.top/2022/03/26/infrastructure-authentication-basic-jwt/",
  "image": "https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png",
  "datePublished": "2022-03-25T17:06:25.000Z",
  "dateModified": "2023-04-03T10:04:59.577Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/03/26/infrastructure-authentication-basic-jwt/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Infrastructure - Authentication - Basic + JWT',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Infrastructure - Authentication - Basic + JWT</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Infrastructure - Authentication - Basic + JWT</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-03-25T17:06:25.000Z" title="Created 2022-03-26 01:06:25">2022-03-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/infrastructure/">Infrastructure</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/infrastructure/authentication/">Authentication</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>12mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h1 id="HTTP-Authentication"><a href="#HTTP-Authentication" class="headerlink" title="HTTP Authentication"></a>HTTP Authentication</h1><blockquote>
<p>Some common authentication schemes include: <strong>Basic</strong> <strong>Bearer</strong></p>
</blockquote>
<ol>
<li>The server responds to a client with a 401 (Unauthorized) response status and provides information on how to authorize with a WWW-Authenticate response header containing at least one challenge.</li>
<li>A client that wants to authenticate itself with the server can then do so by including an Authorization request header with the credentials.</li>
<li>Usually a client will present a password prompt to the user and will then issue the request including the correct Authorization header.</li>
</ol>
<span id="more"></span>

<h1 id="Basic-Authentication"><a href="#Basic-Authentication" class="headerlink" title="Basic Authentication"></a>Basic Authentication</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://infrastructure-1253868755.cos.ap-guangzhou.myqcloud.com/authentication/http-auth-sequence-diagram-8278251.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.csrf().disable().authorizeRequests().anyRequest().authenticated().and().httpBasic();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureGlobal</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth.inMemoryAuthentication().withUser(<span class="string">&quot;admin&quot;</span>).password(<span class="string">&quot;&#123;noop&#125;password&quot;</span>).roles(<span class="string">&quot;ADMIN&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -s -i <span class="string">&#x27;http://localhost:8080/hello/&#x27;</span></span>                                               </span><br><span class="line">HTTP/1.1 401 </span><br><span class="line">Set-Cookie: JSESSIONID=0A7BE231088CA8155B1218C70397CF2D; Path=/; HttpOnly</span><br><span class="line">WWW-Authenticate: Basic realm=&quot;Realm&quot;</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-XSS-Protection: 1; mode=block</span><br><span class="line">Cache-Control: no-cache, no-store, max-age=0, must-revalidate</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Expires: 0</span><br><span class="line">X-Frame-Options: DENY</span><br><span class="line">Content-Length: 0</span><br><span class="line">Date: Sat, 26 Mar 2022 07:19:15 GMT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> -n <span class="string">&#x27;admin:password&#x27;</span> | <span class="built_in">base64</span></span>                                                      </span><br><span class="line">YWRtaW46cGFzc3dvcmQ=</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -s -i -H <span class="string">&#x27;Authorization: Basic YWRtaW46cGFzc3dvcmQ=&#x27;</span> <span class="string">&#x27;http://localhost:8080/hello/&#x27;</span></span></span><br><span class="line">HTTP/1.1 200 </span><br><span class="line">Set-Cookie: JSESSIONID=B4A6CB1CE7C73B858C3244ABA6F9FEF9; Path=/; HttpOnly</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-XSS-Protection: 1; mode=block</span><br><span class="line">Cache-Control: no-cache, no-store, max-age=0, must-revalidate</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Expires: 0</span><br><span class="line">X-Frame-Options: DENY</span><br><span class="line">Content-Type: text/plain;charset=UTF-8</span><br><span class="line">Content-Length: 12</span><br><span class="line">Date: Sat, 26 Mar 2022 07:19:51 GMT</span><br><span class="line"></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<h1 id="JWT-Authentication"><a href="#JWT-Authentication" class="headerlink" title="JWT Authentication"></a>JWT Authentication</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ol>
<li>JSON Web Token (JWT) is an <strong>open standard</strong> (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>) that defines a <strong>compact</strong> and <strong>self-contained</strong> way for <strong>securely transmitting information</strong> between parties as a <strong>JSON object</strong>.</li>
<li>This information can be <strong>verified</strong> and <strong>trusted</strong> because it is <strong>digitally signed</strong>.</li>
<li>JWTs can be signed using a <strong>secret</strong> (with the <strong>HMAC</strong> algorithm) or a <strong>public&#x2F;private key pair</strong> using <strong>RSA</strong> or <strong>ECDSA</strong>.</li>
</ol>
<h2 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h2><ol>
<li>Once the user is logged in, each subsequent request will include the JWT, allowing the user to access routes, services, and resources that are permitted with that token.</li>
<li><strong>Single Sign On</strong> is a feature that widely uses JWT nowadays, because of its <strong>small overhead</strong> and its ability to be easily used <strong>across different domains</strong>.</li>
</ol>
<h2 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h2><blockquote>
<p>The output is <strong>three Base64-URL strings separated by dots</strong> that can be easily passed in HTML and HTTP environments, while being more compact when compared to XML-based standards such as SAML.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure>

<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><ol>
<li>The header <em>typically</em> consists of two parts: the type of the token, which is JWT, and the <strong>signing algorithm</strong> being used, such as <strong>HMAC SHA256</strong> or <strong>RSA</strong>.</li>
<li>Then, this JSON is <strong>Base64Url</strong> encoded to form the first part of the JWT.</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><ol>
<li>Claims are statements about an <strong>entity</strong> (typically, the <strong>user</strong>) and <strong>additional data</strong>.</li>
<li>There are three types of claims: <em>registered</em>, <em>public</em>, and <em>private</em> claims.<ul>
<li><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1">Registered claims</a><ul>
<li>These are a set of <strong>predefined</strong> claims which are not mandatory but <strong>recommended</strong>, to provide a set of useful, interoperable claims.</li>
<li>example: <strong>iss</strong> (issuer), <strong>exp</strong> (expiration time), <strong>sub</strong> (Subject)</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.2">Public claims</a><ul>
<li>These can be defined <strong>at will</strong> by those using JWTs.</li>
<li>But to <strong>avoid collisions</strong> they should be defined in the <a target="_blank" rel="noopener" href="https://www.iana.org/assignments/jwt/jwt.xhtml">IANA JSON Web Token Registry</a> or be defined as a URI that contains a <strong>collision resistant namespace</strong>.</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7519#section-4.3">Private claims</a><ul>
<li>These are the custom claims created to <strong>share information between parties</strong> that agree on using them and are neither <em>registered</em> or <em>public</em> claims.</li>
</ul>
</li>
</ul>
</li>
<li>The payload is then <strong>Base64Url</strong> encoded to form the second part of the JSON Web Token.</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Do note that for signed tokens this information, though protected against tampering, <strong>is readable by anyone</strong>. Do not put secret information in the payload or header elements of a JWT unless it is encrypted.</p>
</blockquote>
<h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><ol>
<li>To create the signature part you have to take the <strong>encoded header</strong>, <strong>the encoded payload</strong>, a <strong>secret</strong>, the algorithm specified in the header, and sign that.</li>
<li><strong>The signature is used to verify the message wasn’t changed along the way</strong>, and, in the case of tokens signed with a <strong>private key</strong>, it can also <strong>verify that the sender of the JWT</strong> is who it says it is.</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure>

<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><ol>
<li>In authentication, when the user successfully logs in using their credentials, <strong>a JSON Web Token will be returned</strong>.</li>
<li>Whenever the user wants to access a protected route or resource, the user agent should send the JWT, typically in the <strong>Authorization</strong> header using the <strong>Bearer</strong> schema.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Stateless"><a href="#Stateless" class="headerlink" title="Stateless"></a>Stateless</h2><ol>
<li>This can be, in certain cases, a stateless authorization mechanism.</li>
<li>The server’s protected routes will check for a valid JWT in the <code>Authorization</code> header, and if it’s present, the user will be allowed to access protected resources. </li>
<li>If the JWT contains the <strong>necessary data</strong>, the need to <strong>query the database</strong> for certain operations may be <strong>reduced</strong>, though this may not always be the case.<ul>
<li>Note that if you send JWT tokens through HTTP headers, you should try to <strong>prevent them from getting too big</strong>.</li>
<li>If you are trying to <strong>embed too much information in a JWT token</strong>, like by including all the user’s permissions, you may need an alternative solution.</li>
</ul>
</li>
</ol>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><blockquote>
<p>If the token is sent in the <code>Authorization</code> header, <strong>Cross-Origin Resource Sharing</strong> (CORS) won’t be an issue as it <strong>doesn’t use cookies</strong>.</p>
</blockquote>
<ol>
<li>The application or client requests authorization to the authorization server. </li>
<li>When the authorization is granted, the authorization server returns an access token to the application.</li>
<li>The application uses the access token to access a protected resource (like an API).</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://infrastructure-1253868755.cos.ap-guangzhou.myqcloud.com/authentication/client-credentials-grant.png" alt="client-credentials-grant"></p>
<blockquote>
<p>Do note that with signed tokens, all the information contained within the token is exposed to users or other parties, even though they are unable to change it. <strong>This means you should not put secret information within the token</strong>.</p>
</blockquote>
<h2 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h2><ol>
<li>Customers sign in by submitting their <strong>credentials</strong> to the provider.</li>
<li>Upon successful authentication, it generates <strong>JWT containing user details and privileges</strong> for accessing the services and sets the JWT <strong>expired date</strong> in payload.</li>
<li><strong>The server signs and encrypts the JWT if necessary</strong> and sends it to the client as a response with credentials to the initial request.</li>
<li>Based on the expiration set by the server, the customer&#x2F;client stores the JWT for a restricted or infinite amount of time.</li>
<li>The client sends this JWT token in the header for all subsequent requests.</li>
<li><strong>The client authenticates the user with this token</strong>. So we don’t need the client to send the user name and password to the server during each authentication process, but only once the server sends the client a JWT.</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://infrastructure-1253868755.cos.ap-guangzhou.myqcloud.com/authentication/jwt-workflow.jpeg" alt="jwt-workflow"></p>
<h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtRequest</span> &#123;</span><br><span class="line">  String username;</span><br><span class="line">  String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtResponse</span> &#123;</span><br><span class="line">  String token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;jwt.secret&#125;&quot;)</span></span><br><span class="line">  String secret;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">generate</span><span class="params">(UserDetails details)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">        <span class="comment">// Identifier (or, name) of the user this token represents.</span></span><br><span class="line">        .setSubject(details.getUsername())</span><br><span class="line">        <span class="comment">// Date/time when the token was issued.</span></span><br><span class="line">        .setIssuedAt(Date.from(Instant.now()))</span><br><span class="line">        <span class="comment">// Date/time at which point the token is no longer valid.</span></span><br><span class="line">        .setExpiration(Date.from(Instant.now().plus(Duration.ofDays(<span class="number">1</span>))))</span><br><span class="line">        .signWith(SignatureAlgorithm.HS512, secret)</span><br><span class="line">        .compact();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Boolean <span class="title function_">validate</span><span class="params">(String token, UserDetails userDetails)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !isTokenExpired(token) &amp;&amp; Objects.equals(username(token), userDetails.getUsername());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">username</span><span class="params">(String token)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resolveClaims(token, Claims::getSubject);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Date <span class="title function_">issuedAt</span><span class="params">(String token)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resolveClaims(token, Claims::getIssuedAt);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Date <span class="title function_">expiration</span><span class="params">(String token)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resolveClaims(token, Claims::getExpiration);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> &lt;T&gt; T <span class="title function_">resolveClaims</span><span class="params">(String token, Function&lt;Claims, T&gt; claimsResolver)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> claimsResolver.apply(</span><br><span class="line">        Jwts.parser().setSigningKey(secret).parseClaimsJws(token).getBody());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Boolean <span class="title function_">isTokenExpired</span><span class="params">(String token)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> expiration(token).before(Date.from(Instant.now()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnauthorizedEntryPoint</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(</span></span><br><span class="line"><span class="params">      HttpServletRequest request,</span></span><br><span class="line"><span class="params">      HttpServletResponse response,</span></span><br><span class="line"><span class="params">      AuthenticationException authException)</span></span><br><span class="line">      <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    response.sendError(HttpServletResponse.SC_UNAUTHORIZED, <span class="string">&quot;Unauthorized&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtRequestFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">  UserDetailsService userDetailsService;</span><br><span class="line">  JwtTokenHelper tokenHelper;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(</span></span><br><span class="line"><span class="params">      HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">      <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JWT Token is in the form &quot;Bearer token&quot;. Remove Bearer word and get only the Token</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(authorization) &amp;&amp; authorization.startsWith(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">      token = authorization.substring(<span class="number">7</span>);</span><br><span class="line">      username = tokenHelper.username(token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Once we get the token validate it.</span></span><br><span class="line">    <span class="keyword">if</span> (username != <span class="literal">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> userDetailsService.loadUserByUsername(username);</span><br><span class="line">      <span class="comment">// if token is valid configure Spring Security to manually set authentication</span></span><br><span class="line">      <span class="keyword">if</span> (tokenHelper.validate(token, userDetails)) &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authenticationToken</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(</span><br><span class="line">                userDetails, <span class="literal">null</span>, userDetails.getAuthorities());</span><br><span class="line">        authenticationToken.setDetails(<span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));</span><br><span class="line">        <span class="comment">// After setting the Authentication in the context, we specify</span></span><br><span class="line">        <span class="comment">// that the current user is authenticated. So it passes the Spring Security Configurations</span></span><br><span class="line">        <span class="comment">// successfully.</span></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">  UnauthorizedEntryPoint unauthorizedEntryPoint;</span><br><span class="line">  UserDetailsService detailsService;</span><br><span class="line">  JwtRequestFilter jwtRequestFilter;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureGlobal</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// configure AuthenticationManager so that it knows from where to load</span></span><br><span class="line">    <span class="comment">// user for matching credentials</span></span><br><span class="line">    <span class="comment">// Use BCryptPasswordEncoder</span></span><br><span class="line">    auth.userDetailsService(detailsService).passwordEncoder(passwordEncoder());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    httpSecurity</span><br><span class="line">        <span class="comment">// We don&#x27;t need CSRF for this example</span></span><br><span class="line">        .csrf()</span><br><span class="line">        .disable()</span><br><span class="line">        <span class="comment">// do not authenticate this particular request</span></span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/authenticate&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .antMatchers(HttpMethod.OPTIONS, <span class="string">&quot;/**&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        <span class="comment">// all other requests need to be authenticated</span></span><br><span class="line">        .anyRequest()</span><br><span class="line">        .authenticated()</span><br><span class="line">        .and()</span><br><span class="line">        .exceptionHandling()</span><br><span class="line">        .authenticationEntryPoint(unauthorizedEntryPoint)</span><br><span class="line">        .and()</span><br><span class="line">        <span class="comment">// make sure we use stateless session; session won&#x27;t be used to</span></span><br><span class="line">        <span class="comment">// store user&#x27;s state.</span></span><br><span class="line">        .sessionManagement()</span><br><span class="line">        .sessionCreationPolicy(SessionCreationPolicy.STATELESS);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add a filter to validate the tokens with every request</span></span><br><span class="line">    httpSecurity.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    <span class="comment">// bcrypt is a password-hashing function.</span></span><br><span class="line">    <span class="comment">// https://bcrypt-generator.com/</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;zhongmingmao&quot;</span>.equals(username)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(</span><br><span class="line">          <span class="string">&quot;zhongmingmao&quot;</span>,</span><br><span class="line">          <span class="string">&quot;$2a$12$VvnKaknki2o1saULFLmuduvzVAUMuFZ0LUOrchKnK0jHfLZof3/za&quot;</span>,</span><br><span class="line">          Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;User not found with username: &quot;</span> + username);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@FieldDefaults(level = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationController</span> &#123;</span><br><span class="line"></span><br><span class="line">  AuthenticationManager authenticationManager;</span><br><span class="line">  JwtTokenHelper tokenHelper;</span><br><span class="line">  UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(&quot;/authenticate&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> ResponseEntity&lt;JwtResponse&gt; <span class="title function_">generateAuthenticationToken</span><span class="params">(<span class="meta">@RequestBody</span> JwtRequest request)</span></span><br><span class="line">      <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    authenticationManager.authenticate(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(request.getUsername(), request.getPassword()));</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">JwtResponse</span>(</span><br><span class="line">            tokenHelper.generate(userDetailsService.loadUserByUsername(request.getUsername()))));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -s --location --request POST <span class="string">&#x27;localhost:8080/authenticate&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Content-Type: application/json&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--data-raw <span class="string">&#x27;&#123;</span></span></span><br><span class="line">    &quot;username&quot;:&quot;zhongmingmao&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;zhongmingmao&quot;</span><br><span class="line">&#125;&#x27; | jq</span><br><span class="line">&#123;</span><br><span class="line">  &quot;token&quot;: &quot;eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ6aG9uZ21pbmdtYW8iLCJpYXQiOjE2NDgzMTMwNDksImV4cCI6MTY0ODM5OTQ0OX0.9_Uq0p63SLkfE1FycNGxE0ttfufhiewDShdW38uXiOYaAggHu8mJfGTM5BrED1a5HiSnx_GN1n17xK4Tz5dQwg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl --location --request GET <span class="string">&#x27;localhost:8080/hello&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">--header <span class="string">&#x27;Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ6aG9uZ21pbmdtYW8iLCJpYXQiOjE2NDgzMTMwNDksImV4cCI6MTY0ODM5OTQ0OX0.9_Uq0p63SLkfE1FycNGxE0ttfufhiewDShdW38uXiOYaAggHu8mJfGTM5BrED1a5HiSnx_GN1n17xK4Tz5dQwg&#x27;</span></span></span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">curl -s --location --request GET <span class="string">&#x27;localhost:8080/hello&#x27;</span> | jq</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;timestamp&quot;: &quot;2022-03-25T16:46:29.363+0000&quot;,</span><br><span class="line">  &quot;status&quot;: 401,</span><br><span class="line">  &quot;error&quot;: &quot;Unauthorized&quot;,</span><br><span class="line">  &quot;message&quot;: &quot;Unauthorized&quot;,</span><br><span class="line">  &quot;path&quot;: &quot;/hello&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/03/26/infrastructure-authentication-basic-jwt/">https://blog.zhongmingmao.top/2022/03/26/infrastructure-authentication-basic-jwt/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/infrastructure/">Infrastructure</a><a class="post-meta__tags" href="/tags/authentication/">Authentication</a><a class="post-meta__tags" href="/tags/jwt/">JWT</a></div><div class="post-share"><div class="social-share" data-image="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/03/26/infrastructure-authentication-ldap/" title="Infrastructure - Authentication - LDAP"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Infrastructure - Authentication - LDAP</div></div><div class="info-2"><div class="info-item-1">What is LDAP    目录服务 目录 ≈ 树状结构的数据库 目录服务 ≈ 以树状结构的目录数据库为基础，外加各种访问协议的信息查询服务 目录数据库 vs 关系型数据库：读取性能极高，写入性能非常差（不支持事务），不适合频繁修改数据 用途：具有层次性且不需要频繁修改的数据，例如企业员工信息、企业设备信息等  LDAP DAP &#x3D; Directory Access Protocol X.500 是一套目录服务的标准（协议族） 通过 X.500 可以将局部的目录服务连接起来，构建基于 Internet 的分布在全球的目录服务系统   DAP 是 X.500 的核心组成之一，但非常复杂，因此诞生了 LDAP LDAP 是基于 X.500 的 DAP 发展而来，目前是第 3 版   LDAP 特点 基于 TCP&#x2F;IP 以树状结构存储数据 读取速度快，写入速度慢 服务端用于存放数据，客户端用于操作数据 跨平台，维护简单 支持 SSL&#x2F;TLS 加密 协议是开放的    样例   </div></div></div></a><a class="pagination-related" href="/2022/03/26/infrastructure-authentication-scheme/" title="Infrastructure - Authentication - Scheme"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-10.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Infrastructure - Authentication - Scheme</div></div><div class="info-2"><div class="info-item-1">ConceptSecrets and Keys Authentication is the art of unlocking things with a secret. At the heart of every authentication is a shared secret!   The secret has two copies. One copy is with the system and the other copy is with you. Your copy is what is called the private key. The server only has a highly encrypted version of the secret; it doesn’t know what the decrypted value would look like. That’s why if you forget your password, you’d need to reset it.     Public and Private Keys Your copy which is th...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/03/26/infrastructure-authentication-ldap/" title="Infrastructure - Authentication - LDAP"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="info-item-2">Infrastructure - Authentication - LDAP</div></div><div class="info-2"><div class="info-item-1">What is LDAP    目录服务 目录 ≈ 树状结构的数据库 目录服务 ≈ 以树状结构的目录数据库为基础，外加各种访问协议的信息查询服务 目录数据库 vs 关系型数据库：读取性能极高，写入性能非常差（不支持事务），不适合频繁修改数据 用途：具有层次性且不需要频繁修改的数据，例如企业员工信息、企业设备信息等  LDAP DAP &#x3D; Directory Access Protocol X.500 是一套目录服务的标准（协议族） 通过 X.500 可以将局部的目录服务连接起来，构建基于 Internet 的分布在全球的目录服务系统   DAP 是 X.500 的核心组成之一，但非常复杂，因此诞生了 LDAP LDAP 是基于 X.500 的 DAP 发展而来，目前是第 3 版   LDAP 特点 基于 TCP&#x2F;IP 以树状结构存储数据 读取速度快，写入速度慢 服务端用于存放数据，客户端用于操作数据 跨平台，维护简单 支持 SSL&#x2F;TLS 加密 协议是开放的    样例   </div></div></div></a><a class="pagination-related" href="/2022/03/26/infrastructure-authentication-scheme/" title="Infrastructure - Authentication - Scheme"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-10.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-26</div><div class="info-item-2">Infrastructure - Authentication - Scheme</div></div><div class="info-2"><div class="info-item-1">ConceptSecrets and Keys Authentication is the art of unlocking things with a secret. At the heart of every authentication is a shared secret!   The secret has two copies. One copy is with the system and the other copy is with you. Your copy is what is called the private key. The server only has a highly encrypted version of the secret; it doesn’t know what the decrypted value would look like. That’s why if you forget your password, you’d need to reset it.     Public and Private Keys Your copy which is th...</div></div></div></a><a class="pagination-related" href="/2023/02/15/cloud-native-serverless-faas-workflow/" title="FaaS - Workflow"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://serverless-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/faas-workflow.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-15</div><div class="info-item-2">FaaS - Workflow</div></div><div class="info-2"><div class="info-item-1"> </div></div></div></a><a class="pagination-related" href="/2023/02/14/cloud-native-serverless-faas-web-ide/" title="FaaS - WebIDE"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://serverless-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/webide.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-14</div><div class="info-item-2">FaaS - WebIDE</div></div><div class="info-2"><div class="info-item-1">架构   组成 蓝色部分 WebIDE 客户端的核心 Run VS Code on any machine anywhere and access it in the browser   绿色部分 将 WebIDE 与 FaaS 结合的核心   橘色部分 Serverless 形态下的必备支撑服务    过程 用户在 VS Code 的前端页面向后端发出函数在线编辑的请求 服务端，即 FaaS 的 Controller 在接收到请求并验证权限后，再转给 VS Code Server 容器实例   VS Code Server 容器实例会获取用户代码，然后再加载 FaaS 的资源调度系统 根据目前 Container Pool 中的资源现状，动态扩缩容 WebIDE Pod 资源   VS Code Server 根据用户请求，会调用 Serverless Extension BE 基于此时语言的环境，执行操作，并将执行结果返回给 Client 端    注意 可以将 Serverless Extension 插件提前集成在 VS Code Server 的镜像中 FaaS Runtime 依据原来函数计...</div></div></div></a><a class="pagination-related" href="/2023/02/13/cloud-native-serverless-faas-function-invoke/" title="FaaS - Function Invoke"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://serverless-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/faas-function-invoke.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-13</div><div class="info-item-2">FaaS - Function Invoke</div></div><div class="info-2"><div class="info-item-1">函数拆分 成本 云函数的收费：调用次数、公网流量、占用资源时间（最贵）   复用 组件化   性能 对于非串行的功能，拆分成多个函数可以提高并发性      调用方式 同步、异步、编排（具有调度和管理的语义）   同步 需要注意调用延迟和超时带来的费用成本  直接调用 使用云厂商提供的 SDK，调用指定的函数，实现直接调用  12345678import fc2client = fc2.Client(               endpoint=&#x27;&lt;Your Endpoint&gt;&#x27;,               accessKeyID=&#x27;&lt;Your AccessKeyID&gt;&#x27;,               accessKeySecret=&#x27;&lt;Your AccessKeySecret&gt;&#x27;)// 同步调用client.invoke_function(&#x27;service_name&#x27;, &#x27;function_name&#x27;)  网关调用 通过 API 网关调用函数，借助 API 网关来...</div></div></div></a><a class="pagination-related" href="/2023/02/12/cloud-native-serverless-faas-runtime/" title="FaaS - Runtime"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://serverless-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/faas-runtime.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-12</div><div class="info-item-2">FaaS - Runtime</div></div><div class="info-2"><div class="info-item-1">概述 一般的编程语言都有自身的运行时，运行时的主要职责是可以让代码和机器交互，进而实现业务逻辑 函数计算运行时 能够让函数在机器或者容器中执行起来，实现业务逻辑的执行环境 通常由特定语言构建的框架构成   函数计算运行时依赖于语言运行时 函数计算运行时的本质：让函数在容器中执行起来的代码框架      在函数实例初始化时，函数计算运行时一般会由一个初始化进程加载起来 然后函数计算运行时就可以准备接收请求 当请求到达后，业务代码会被对应的语言运行时中加载进来处理请求   Runtime 是一个特定语言环境下的服务框架环境   该服务将以一个进程的形态运行在用户容器中，并与用户代码相关联 该服务启动后，会一直等待请求的到来，一旦请求到达后，Runtime 会关联业务代码去执行（并发）  原理语言类型编译型语言 C&#x2F;C++&#x2F;Go，在编译时将所有用到的静态依赖、源码一起打包，编译完后可以直接运行 Java，经过编译产生的字节码需要 JVM 再次将其转换为机器码，同时具有编译型和解释型的特性 通常需要将所有依赖包打包成一个 jar 包或者 war 包，符合编译型语言的风格   在开发函数时，需...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP-Authentication"><span class="toc-number">1.</span> <span class="toc-text">HTTP Authentication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Basic-Authentication"><span class="toc-number">2.</span> <span class="toc-text">Basic Authentication</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT-Authentication"><span class="toc-number">3.</span> <span class="toc-text">JWT Authentication</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-number">3.1.</span> <span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authorization"><span class="toc-number">3.2.</span> <span class="toc-text">Authorization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Structure"><span class="toc-number">3.3.</span> <span class="toc-text">Structure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Header"><span class="toc-number">3.3.1.</span> <span class="toc-text">Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Payload"><span class="toc-number">3.3.2.</span> <span class="toc-text">Payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Signature"><span class="toc-number">3.3.3.</span> <span class="toc-text">Signature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage"><span class="toc-number">3.4.</span> <span class="toc-text">Usage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stateless"><span class="toc-number">3.5.</span> <span class="toc-text">Stateless</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS"><span class="toc-number">3.6.</span> <span class="toc-text">CORS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Workflow"><span class="toc-number">3.7.</span> <span class="toc-text">Workflow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Security"><span class="toc-number">3.8.</span> <span class="toc-text">Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Model"><span class="toc-number">3.8.1.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Config"><span class="toc-number">3.8.2.</span> <span class="toc-text">Config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-number">3.8.3.</span> <span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controller"><span class="toc-number">3.8.4.</span> <span class="toc-text">Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Validation"><span class="toc-number">3.8.5.</span> <span class="toc-text">Validation</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-server.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Server V1"/></a><div class="content"><a class="title" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1">Observability - Prometheus Server V1</a><time datetime="2025-01-23T16:06:25.000Z" title="Created 2025-01-24 00:06:25">2025-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>