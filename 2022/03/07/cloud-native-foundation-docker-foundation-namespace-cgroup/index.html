<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Docker Foundation - Namespace + Cgroup | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="概要 基于 Linux Kernel 的 Cgroup、Namespace、Union FS 等技术，对进程进行封装隔离，属于 OS  层面的虚拟化技术 由于被隔离的进程独立于宿主机和其它被隔离的进程，因此称为容器   演变历史 最早基于 LXC – a linux container runtime 0.7：去除 LXC，转而使用自研的 Libcontainer 1.11：使用 runC 和 c">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Foundation - Namespace + Cgroup">
<meta property="og:url" content="https://blog.zhongmingmao.top/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="概要 基于 Linux Kernel 的 Cgroup、Namespace、Union FS 等技术，对进程进行封装隔离，属于 OS  层面的虚拟化技术 由于被隔离的进程独立于宿主机和其它被隔离的进程，因此称为容器   演变历史 最早基于 LXC – a linux container runtime 0.7：去除 LXC，转而使用自研的 Libcontainer 1.11：使用 runC 和 c">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png">
<meta property="article:published_time" content="2022-03-06T16:06:25.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.567Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Container">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Docker Foundation - Namespace + Cgroup",
  "url": "https://blog.zhongmingmao.top/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/",
  "image": "https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png",
  "datePublished": "2022-03-06T16:06:25.000Z",
  "dateModified": "2023-04-03T10:04:59.567Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker Foundation - Namespace + Cgroup',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Docker Foundation - Namespace + Cgroup</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Docker Foundation - Namespace + Cgroup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2022-03-06T16:06:25.000Z" title="Created 2022-03-07 00:06:25">2022-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/">Cloud Native Foundation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/container/">Container</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/container/docker/">Docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>14mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><ol>
<li>基于 Linux Kernel 的 <strong>Cgroup</strong>、<strong>Namespace</strong>、<strong>Union FS</strong> 等技术，对<strong>进程</strong>进行<strong>封装隔离</strong>，属于 <strong>OS</strong>  层面的<strong>虚拟化技术</strong><ul>
<li>由于被隔离的进程独立于宿主机和其它被隔离的进程，因此称为<strong>容器</strong></li>
</ul>
</li>
<li>演变历史<ul>
<li>最早基于 <strong>LXC</strong> – a linux container <strong>runtime</strong></li>
<li>0.7：去除 LXC，转而使用自研的 <code>Libcontainer</code></li>
<li>1.11：使用 <strong><code>runC</code></strong> 和 <strong><code>containerd </code></strong></li>
</ul>
</li>
<li><strong>Docker</strong> 在容器的基础上，进行了进一步的封装，<strong>极大地简化了容器的创建和维护</strong></li>
</ol>
<span id="more"></span>

<h1 id="Docker-vs-VM"><a href="#Docker-vs-VM" class="headerlink" title="Docker vs VM"></a>Docker vs VM</h1><blockquote>
<p>Docker Engine 是一个 <strong>Daemon</strong> 进程，启动一个容器的时候，相当于执行了一次进程的 <strong>Fork</strong> 操作</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220213140203038.png" alt="image-20220213140203038"></p>
<table>
<thead>
<tr>
<th></th>
<th>Container</th>
<th>VM</th>
</tr>
</thead>
<tbody><tr>
<td>启动时间</td>
<td>秒级</td>
<td>分钟级</td>
</tr>
<tr>
<td>硬盘使用</td>
<td>MB 级别</td>
<td>GB 级别</td>
</tr>
<tr>
<td>性能</td>
<td>接近原生</td>
<td>弱于</td>
</tr>
<tr>
<td>单机支持量</td>
<td>上千</td>
<td>几十</td>
</tr>
</tbody></table>
<h1 id="容器标准"><a href="#容器标准" class="headerlink" title="容器标准"></a>容器标准</h1><ol>
<li><strong>OCI</strong> – Open Container Initiative<ul>
<li>K8S 的主要贡献：<strong>标准化</strong></li>
<li>后期 Docker 公司不得不让步，兼容 OCI 标准</li>
</ul>
</li>
<li>核心规范：<strong>Image  + Runtime</strong><ul>
<li><strong>Image</strong> Specification<ul>
<li>Docker 公司的主要贡献：基于 <strong>Union FS</strong>，创造了 <strong>Image</strong>，解决了<strong>容器分发</strong>的问题</li>
<li>如何通过构建系统打包、生成镜像清单（Manifest）、文件系统序列化文件、镜像配置</li>
</ul>
</li>
<li><strong>Runtime</strong> Specification<ul>
<li><strong>Cgroup（由 Google 开源） + Namespace</strong></li>
<li>文件系统如何解压到硬盘、Runtime 运行</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h1><blockquote>
<p>隔离性</p>
</blockquote>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ol>
<li>Linux Namespace 是一种 Linux Kernel 提供的<strong>资源隔离</strong>方案</li>
<li>Kernel 为进程分配不同的 Namespace，<strong>不同的 Namespace 下的进程互不干扰</strong></li>
<li>Linux 进程在运行时都会归属于某个 Namespace</li>
</ol>
<figure class="highlight c"><figcaption><span>Struct: Linux Process</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> &#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/* namespaces */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">nsproxy</span> *<span class="title">nsproxy</span>;</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><figcaption><span>Struct: Namespace</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nsproxy</span> &#123;</span></span><br><span class="line">    <span class="type">atomic_t</span> count;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">uts_namespace</span> *<span class="title">uts_ns</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ipc_namespace</span> *<span class="title">ipc_ns</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mnt_namespace</span> *<span class="title">mnt_ns</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pid_namespace</span> *<span class="title">pid_ns_for_children</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">net</span> *<span class="title">net_ns</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ol>
<li><strong>clone</strong><ul>
<li><code>int clone(int (*fn)(void *), void *child_stack, int flags, void *arg)</code></li>
<li>1 号进程一般是 <code>systemd</code>，会有<strong>默认</strong>的 Namespace</li>
<li><strong>创建新进程</strong>时，可以通过  <code>flags</code>  指定需要新建的 Namespace<ul>
<li>CLONE_NEWCGROUP</li>
<li>CLONE_NEWIPC</li>
<li>CLONE_NEWNET</li>
<li>CLONE_NEWNS</li>
<li>CLONE_NEWPID</li>
<li>CLONE_NEWUSER</li>
<li>CLONE_NEWUTS</li>
</ul>
</li>
</ul>
</li>
<li><strong>setns</strong><ul>
<li><code>int setns(int fd, int nstype)</code></li>
<li>让调用进程<strong>加入已经存在的 Namespace 中</strong></li>
</ul>
</li>
<li><strong>unshare</strong><ul>
<li><code>int unshare(int flags)</code></li>
<li>让调用进程<strong>移动到新的 Namespace 中</strong></li>
<li><em>Run a program with some namespaces <strong>unshared from the parent</strong>.</em></li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ls -l /proc/1/ns</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 cgroup -&gt; &#x27;cgroup:[4026531835]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 ipc -&gt; &#x27;ipc:[4026531839]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Feb 28 23:36 mnt -&gt; &#x27;mnt:[4026531840]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 net -&gt; &#x27;net:[4026531992]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Feb 28 15:40 pid -&gt; &#x27;pid:[4026531836]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 pid_for_children -&gt; &#x27;pid:[4026531836]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 time -&gt; &#x27;time:[4026531834]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 time_for_children -&gt; &#x27;time:[4026531834]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 user -&gt; &#x27;user:[4026531837]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 15:31 uts -&gt; &#x27;uts:[4026531838]&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><blockquote>
<p><strong>systemd Namespace</strong> 一般就是<strong>主机 Namespace</strong></p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220213165420070.png" alt="image-20220213165420070"></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Resource</th>
<th>Kernel</th>
</tr>
</thead>
<tbody><tr>
<td>PID</td>
<td>进程</td>
<td>2.6.14</td>
</tr>
<tr>
<td>Network</td>
<td>网络设备、网络协议栈、网络端口</td>
<td>2.6.29</td>
</tr>
<tr>
<td>IPC</td>
<td>System V IPC 和 POSIX 消息队列</td>
<td>2.6.19</td>
</tr>
<tr>
<td>Mount</td>
<td>挂载点</td>
<td>2.4.19</td>
</tr>
<tr>
<td>UTS</td>
<td><strong>主机名、域名</strong></td>
<td>2.6.19</td>
</tr>
<tr>
<td>USR</td>
<td>用户、用户组</td>
<td>3.8</td>
</tr>
</tbody></table>
<ol>
<li><strong>pid namespace</strong><ul>
<li><strong>不同用户的进程</strong>是通过 pid namespace 进行隔离，不同 namespace 中可以有<strong>相同</strong>的 pid</li>
<li>每个 namespace 中的 pid 可以相互隔离</li>
</ul>
</li>
<li><strong>net namespace</strong><ul>
<li>网络隔离通过 net namespace 实现<ul>
<li>每个 net namespace 有独立的 <strong>network devices、ip addresses、ip routing tables、&#x2F;proc&#x2F;net</strong>等</li>
</ul>
</li>
<li>Docker 默认采用 <strong>veth</strong>（<strong>Virtual</strong> Ethernet devices） 的方式<ul>
<li>将 container 中的<strong>虚拟网卡</strong>同 host 上的一个 <strong>docker bridge:docker0</strong> 连接在一起</li>
</ul>
</li>
</ul>
</li>
<li><strong>ipc namespace</strong><ul>
<li>container 中的进程交互采用的还是 Linux 进程交互的方法：信号量、消息队列、共享内存等</li>
<li>container 的进程间交互实际上还是 <strong>host 上具有相同 pid namespace</strong> 中的进程间交互<ul>
<li>在 ipc 资源申请时加入 <strong>pid</strong> namespace 的信息</li>
<li>每个 ipc 资源有一个唯一的32位ID</li>
</ul>
</li>
</ul>
</li>
<li><strong>mnt namespace</strong><ul>
<li>允许不同 namespace 的进程看到不同的<strong>文件结构</strong></li>
</ul>
</li>
<li><strong>uts namespace</strong><ul>
<li>UTS – <strong>UNIX Time-sharing System</strong></li>
<li>允许每个 container 拥有独立的 <strong>hostname</strong> 和 <strong>domain name</strong><ul>
<li>使其在网络上被视为一个<strong>独立的节点</strong>而非 host 上的一个进程</li>
</ul>
</li>
</ul>
</li>
<li><strong>user namespace</strong><ul>
<li>每个 container 可以有不同的 user 和 group id</li>
<li>在 container 内部用 <strong>container 内部的用户</strong>执行程序而非 host 上的用户</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ip a show docker0                         </span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:58:a4:13:33 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:58ff:fea4:1333/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<blockquote>
<p>container 中的 eth0@if13 与宿主机上的 docker0 连接在一起</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># docker run -it --rm busybox ip a show eth0</span><br><span class="line">12: eth0@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><blockquote>
<p>container id: afde0a1ff737, pid@host: 1771</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># docker run -it --rm centos bash</span><br><span class="line">[root@8a213344c62b /]#</span><br><span class="line"></span><br><span class="line"># docker inspect --format &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; 8a213344c62b            </span><br><span class="line">1771</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># lsns            </span><br><span class="line">        NS TYPE   NPROCS   PID USER             COMMAND</span><br><span class="line">4026531834 time      227     1 root             /sbin/init</span><br><span class="line">4026531835 cgroup    227     1 root             /sbin/init</span><br><span class="line">4026531836 pid       226     1 root             /sbin/init</span><br><span class="line">4026531837 user      227     1 root             /sbin/init</span><br><span class="line">4026531838 uts       223     1 root             /sbin/init</span><br><span class="line">4026531839 ipc       226     1 root             /sbin/init</span><br><span class="line">4026531840 mnt       219     1 root             /sbin/init</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># ls -l /proc/1771/ns </span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 cgroup -&gt; &#x27;cgroup:[4026531835]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 ipc -&gt; &#x27;ipc:[4026532646]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 mnt -&gt; &#x27;mnt:[4026532644]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:04 net -&gt; &#x27;net:[4026532649]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 pid -&gt; &#x27;pid:[4026532647]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:07 pid_for_children -&gt; &#x27;pid:[4026532647]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 time -&gt; &#x27;time:[4026531834]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:07 time_for_children -&gt; &#x27;time:[4026531834]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 user -&gt; &#x27;user:[4026531837]&#x27;</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar  1 16:06 uts -&gt; &#x27;uts:[4026532645]&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>nsenter</code> 是常用<strong>调试</strong>命令，适用场景：container 本身没有太多可用命令</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># nsenter -t 1771 -n ip a show eth0</span><br><span class="line">4: eth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"># docker exec 8a213344c62b ip a show eth0  </span><br><span class="line">4: eth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<h1 id="Cgroup"><a href="#Cgroup" class="headerlink" title="Cgroup"></a>Cgroup</h1><blockquote>
<p>可配额</p>
</blockquote>
<h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><ol>
<li>Cgroup（Control Group）：Linux 下对一个或者一组进程进行<strong>资源控制</strong>的机制<ul>
<li>资源分类：CPU 使用时间、内存、磁盘 IO 等</li>
</ul>
</li>
<li>不同资源的具体管理工作由相应的 <strong>Cgroup 子系统</strong>来实现</li>
<li>针对不同类型的资源限制，只需要将<strong>限制策略</strong>在不同的<strong>子系统</strong>上进行<strong>关联</strong>即可</li>
<li>Cgroup 在不同的系统资源管理子系统中以<strong>层级树</strong>的方式来组织管理<ul>
<li>每个 Cgroup 可以包含其他子 Cgroup，<strong>子 Cgroup 受到 父 Cgroup 设置的资源限制</strong></li>
</ul>
</li>
</ol>
<h2 id="Cgroup-Driver"><a href="#Cgroup-Driver" class="headerlink" title="Cgroup Driver"></a>Cgroup Driver</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220215231448648.png" alt="image-20220215231448648"></p>
<ol>
<li>Cgroup 本身需要一个 <code>driver</code> 去实现（通过控制<strong>文件</strong>去实现功能），<strong>systemd 在启动时会加载该文件系统</strong></li>
<li><strong>systemd</strong><ul>
<li>当操作系统使用 systemd 作为 init system 时，初始化进程会生成一个<strong>根 cgroup 目录</strong>并作为 cgroup 管理器</li>
<li>systemd 与 cgroup 紧密结合，并且为每个 systemd unit 分配 cgroup</li>
</ul>
</li>
<li><strong>Docker</strong><ul>
<li>Docker 默认使用 <strong>cgroupfs</strong> 作为 cgroup driver</li>
</ul>
</li>
<li>问题<ul>
<li>在 <strong>systemd</strong> 作为 init system 的系统中，默认<strong>并存两套 cgroup driver</strong>，管理<strong>混乱</strong></li>
<li>因此，kubelet 会默认 <code>--cgroup-driver=systemd</code></li>
</ul>
</li>
</ol>
<h2 id="子系统"><a href="#子系统" class="headerlink" title="子系统"></a>子系统</h2><blockquote>
<p>资源分类：可压缩资源（cpu等）、不可压缩资源（memory等）</p>
</blockquote>
<table>
<thead>
<tr>
<th>子系统</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>blkio</td>
<td>设置限制每个块设备的输入输出控制</td>
</tr>
<tr>
<td><strong>cpu</strong></td>
<td>控制一个进程可以使用多少 CPU</td>
</tr>
<tr>
<td>cpuacct</td>
<td>产生 cgroup 任务的 CPU 资源报告</td>
</tr>
<tr>
<td><strong>cpuset</strong></td>
<td><strong>绑核</strong>：如果是多核 CPU，为 cgroup 任务分配<strong>单独</strong>的 CPU 和内存</td>
</tr>
<tr>
<td>devices</td>
<td>允许或者拒绝 cgroup 任务对设备的访问</td>
</tr>
<tr>
<td>freezer</td>
<td>暂停和恢复 cgroup 任务</td>
</tr>
<tr>
<td><strong>memory</strong></td>
<td>设置每个 cgroup 的内存限制以及产生内存资源报告</td>
</tr>
<tr>
<td>net_cls</td>
<td>标记每个网络包以供 cgroup 方便使用</td>
</tr>
<tr>
<td>ns</td>
<td>命名空间</td>
</tr>
<tr>
<td>pid</td>
<td>进程标识</td>
</tr>
</tbody></table>
<h3 id="cpu"><a href="#cpu" class="headerlink" title="cpu"></a>cpu</h3><table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cpu.shares</td>
<td>可出让的能获得 CPU 使用时间的<strong>相对值</strong></td>
</tr>
<tr>
<td>cpu.cfs_period_us</td>
<td>配置时间周期长度，单位为<strong>微秒</strong></td>
</tr>
<tr>
<td>cpu.cfs_quota_us</td>
<td>配置当前 cgroup 在 cfs_period_us 时间内最多能使用的 CPU 时间数，单位是<strong>微秒</strong></td>
</tr>
<tr>
<td>cpu.stat</td>
<td>cgroup 内的进程使用 CPU 的时间统计</td>
</tr>
<tr>
<td></td>
<td>nr_periods：经过 cpu.cfs_period_us 的时间周期数量</td>
</tr>
<tr>
<td></td>
<td>nr_throttled：在经过的周期内，进程因为在指定的时间周期内用光了配额时间而受到限制的次数</td>
</tr>
<tr>
<td></td>
<td>throttled_time：cgroup 中的进程被限制使用 CPU 的总用时，单位<strong>纳秒</strong></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># pwd</span><br><span class="line">/sys/fs/cgroup</span><br><span class="line"></span><br><span class="line"># ll</span><br><span class="line">total 0</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 blkio</span><br><span class="line">lrwxrwxrwx  1 root root 11 Mar  1 15:56 cpu -&gt; cpu,cpuacct</span><br><span class="line">lrwxrwxrwx  1 root root 11 Mar  1 15:56 cpuacct -&gt; cpu,cpuacct</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 cpu,cpuacct</span><br><span class="line">dr-xr-xr-x  3 root root  0 Mar  1 15:56 cpuset</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 devices</span><br><span class="line">dr-xr-xr-x  4 root root  0 Mar  1 15:56 freezer</span><br><span class="line">dr-xr-xr-x  3 root root  0 Mar  1 15:56 hugetlb</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 memory</span><br><span class="line">lrwxrwxrwx  1 root root 16 Mar  1 15:56 net_cls -&gt; net_cls,net_prio</span><br><span class="line">dr-xr-xr-x  3 root root  0 Mar  1 15:56 net_cls,net_prio</span><br><span class="line">lrwxrwxrwx  1 root root 16 Mar  1 15:56 net_prio -&gt; net_cls,net_prio</span><br><span class="line">dr-xr-xr-x  3 root root  0 Mar  1 15:56 perf_event</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 pids</span><br><span class="line">dr-xr-xr-x  2 root root  0 Mar  1 15:56 rdma</span><br><span class="line">dr-xr-xr-x 12 root root  0 Mar  1 15:56 systemd</span><br><span class="line">dr-xr-xr-x 11 root root  0 Mar  1 15:56 unified</span><br><span class="line"></span><br><span class="line"># ls cpu</span><br><span class="line">cgroup.clone_children  cpuacct.usage             cpuacct.usage_percpu_user  cpu.cfs_quota_us     dev-mqueue.mount   sys-fs-fuse-connections.mount  system.slice</span><br><span class="line">cgroup.procs           cpuacct.usage_all         cpuacct.usage_sys          cpu.shares           docker             sys-kernel-config.mount        tasks</span><br><span class="line">cgroup.sane_behavior   cpuacct.usage_percpu      cpuacct.usage_user         cpu.stat             notify_on_release  sys-kernel-debug.mount         user.slice</span><br><span class="line">cpuacct.stat           cpuacct.usage_percpu_sys  cpu.cfs_period_us          dev-hugepages.mount  release_agent      sys-kernel-tracing.mount</span><br></pre></td></tr></table></figure>

<h4 id="shares"><a href="#shares" class="headerlink" title="shares"></a>shares</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cat cpu/cpu.shares </span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line"># cat cpu/docker/cpu.shares </span><br><span class="line">1024</span><br><span class="line"></span><br><span class="line"># cat cpu/system.slice/cpu.shares </span><br><span class="line">1024</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220307221824803.png" alt="image-20220307221824803"></p>
<h4 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h4><blockquote>
<p>cfs_period_us 和 cfs_quota_us 控制进程使用 CPU 的绝对值<br>cfs_period_us 的视角是<strong>单个 CPU</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># cat cpu/cpu.cfs_period_us      </span><br><span class="line">100000</span><br><span class="line"></span><br><span class="line"># cat cpu/cpu.cfs_quota_us </span><br><span class="line">-1</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/image-20220307222351051.png" alt="image-20220307222351051"></p>
<h4 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cd cpu &amp;&amp; mkdir cpudemo &amp;&amp; ls cpudemo</span><br><span class="line">cgroup.clone_children  cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  cpu.shares      cpu.uclamp.min</span><br><span class="line">cgroup.procs           cpuacct.usage_all     cpuacct.usage_percpu_user  cpu.cfs_period_us   cpu.stat        notify_on_release</span><br><span class="line">cpuacct.stat           cpuacct.usage_percpu  cpuacct.usage_sys          cpu.cfs_quota_us    cpu.uclamp.max  tasks</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>busy_loop.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">                <span class="keyword">for</span> &#123;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;()</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># lscpu | grep &#x27;CPU(s):&#x27;</span><br><span class="line">CPU(s):                          2</span><br><span class="line">NUMA node0 CPU(s):               0,1</span><br><span class="line"></span><br><span class="line"># top</span><br><span class="line">...</span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                                       </span><br><span class="line">  66313 root      20   0  702368    964    680 R 199.0   0.0   0:19.53 busy_loop </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># echo 66313 &gt; /sys/fs/cgroup/cpu/cpudemo/cgroup.procs</span><br><span class="line"></span><br><span class="line"># cat /sys/fs/cgroup/cpu/cpudemo/cpu.cfs_period_us</span><br><span class="line">100000</span><br><span class="line"></span><br><span class="line"># cat /sys/fs/cgroup/cpu/cpudemo/cpu.cfs_quota_us </span><br><span class="line">-1</span><br><span class="line"></span><br><span class="line"># echo 100000 &gt;  /sys/fs/cgroup/cpu/cpudemo/cpu.cfs_quota_us</span><br><span class="line"></span><br><span class="line"># top</span><br><span class="line">...</span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                                       </span><br><span class="line">  66313 root      20   0  702368    964    680 R 100.0   0.0  11:26.79 busy_loop </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># echo 10000 &gt;  /sys/fs/cgroup/cpu/cpudemo/cpu.cfs_quota_us </span><br><span class="line"></span><br><span class="line"># top</span><br><span class="line">...</span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                                       </span><br><span class="line">  66313 root      20   0  702368    964    680 R   9.9   0.0  13:05.55 busy_loop</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cat /sys/fs/cgroup/cpu/cpudemo/cpu.stat</span><br><span class="line">nr_periods 6432</span><br><span class="line">nr_throttled 6431</span><br><span class="line">throttled_time 1088304303102</span><br></pre></td></tr></table></figure>

<h3 id="cpuacct"><a href="#cpuacct" class="headerlink" title="cpuacct"></a>cpuacct</h3><blockquote>
<p>容器技术是一系列技术的组合，<strong>Linux 本身是没有容器的概念的</strong>，因此容器内部执行 top 命令，看到的是宿主机的内容</p>
</blockquote>
<table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>cpuacct.usage</td>
<td>包含该 cgroup 及其子 cgroup 下进程使用 CPU 的时间，单位纳秒</td>
</tr>
<tr>
<td>cpuacct.stat</td>
<td>包含该 cgroup 及其子 cgroup 下进程使用 CPU 的时间，以及用户态和内核态的时间</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># ls /sys/fs/cgroup/cpu/cpudemo/cpuacct.*</span><br><span class="line">/sys/fs/cgroup/cpu/cpudemo/cpuacct.stat       /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_percpu       /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_sys</span><br><span class="line">/sys/fs/cgroup/cpu/cpudemo/cpuacct.usage      /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_percpu_sys   /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_user</span><br><span class="line">/sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_all  /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage_percpu_user</span><br><span class="line"></span><br><span class="line"># cat /sys/fs/cgroup/cpu/cpudemo/cpuacct.stat                                    </span><br><span class="line">user 68598</span><br><span class="line">system 228</span><br><span class="line"></span><br><span class="line"># cat /sys/fs/cgroup/cpu/cpudemo/cpuacct.usage                                       </span><br><span class="line">645376450311</span><br></pre></td></tr></table></figure>

<h3 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h3><table>
<thead>
<tr>
<th>配置项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>memory.usage_in_bytes</td>
<td>cgroup 下进程使用的内存，包含 cgroup 及其子 cgroup 下的进程使用的内存</td>
</tr>
<tr>
<td>memory.max_usage_in_bytes</td>
<td>cgroup 下进程使用内存的最大值，包含子 cgroup 的内存使用量</td>
</tr>
<tr>
<td>memory.limit_in_bytes</td>
<td>设置 cgroup 下进程最多能使用的内存， -1 &#x3D; 不限制</td>
</tr>
<tr>
<td>memory.soft_limit_in_bytes</td>
<td>这个限制并不会阻止进程使用超过限额的内存，只是在系统内存足够时，会优先回收超过限额的内存</td>
</tr>
<tr>
<td>memory.oom_control</td>
<td>设置是否在 cgroup 中使用 OOM Killer，默认为使用</td>
</tr>
</tbody></table>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/">https://blog.zhongmingmao.top/2022/03/07/cloud-native-foundation-docker-foundation-namespace-cgroup/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/container/">Container</a><a class="post-meta__tags" href="/tags/docker/">Docker</a></div><div class="post-share"><div class="social-share" data-image="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2022/03/08/cloud-native-foundation-docker-foundation-unionfs/" title="Docker Foundation - Union FS"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Docker Foundation - Union FS</div></div><div class="info-2"><div class="info-item-1">Union FS Docker 的创新在文件系统：通过镜像解决容器分发的问题   将不同目录挂载到同一个虚拟文件系统下的文件系统 支持为每一个成员目录（类似于 Git Branch）设定权限：readonly、readwrite、whiteout-able 文件系统分层，对 readonly 权限的 Branch 可以逻辑上进行修改（增量、不影响 readonly 部分） 用途 将多个 Disk 挂在同一个目录下 将一个 readonly 的 Branch 和一个 writeable 的 Branch 联合在一起      Docker 镜像 层可以复用，增量分发   12# docker image inspect --format &#x27;&#123;&#123;.RootFS&#125;&#125;&#x27; centos:latest&#123;layers [sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59] &#125;  镜像文件系统 bootfs Bootloader 引导加载 kerne...</div></div></div></a><a class="pagination-related" href="/2022/02/22/jvm-bytecode-manipulation-asm-introduction/" title="ASM - Introduction"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-17.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">ASM - Introduction</div></div><div class="info-2"><div class="info-item-1">Glance ASM is an all purpose Java bytecode manipulation and analysis framework. It can be used to modify existing classes or to dynamically generate classes, directly in binary form.   ASM provides some common bytecode transformations and analysis algorithms from which custom complex transformations and code analysis tools can be built. ASM offers similar functionality as other Java bytecode frameworks, but is focused on performance. Because it was designed and implemented to be as small and as fast as p...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/10/16/cloud-native-foundation-docker/" title="Cloud Native Foundation - Docker"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/docker/Docker-build.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-16</div><div class="info-item-2">Cloud Native Foundation - Docker</div></div><div class="info-2"><div class="info-item-1">历史 基于 Linux 的 Namespace 、Cgroup和 Union FS，对进程进行封装隔离，属于 OS 层的虚拟化技术 Docker 最初的实现是基于 LXC 从 0.7 以后开始移除 LXC，而使用自研的 Libcontainer 从 1.11 开始，使用 runC 和 Containerd   Docker 在容器的基础上，进行进一步的封装，极大地简化容器的创建和维护    Docker vs VM    特性 Docker VM    启动 秒级 分钟级   磁盘 MB GB   性能 接近原生 弱于   数量 单机上千个容器 几十个   容器标准 OCI - Open Container Initiative     Key Value    Image Specification 如何打包   Runtime Specification 如何解压应用包并运行   Distribution Specification 如何分发镜像   主要特性 隔离性（Namespace）、可配额（CGroup）、便携性（Union FS）、安全性  Namespace Linux Namespac...</div></div></div></a><a class="pagination-related" href="/2022/10/01/kubernetes-container-interconnection/" title="Kubernetes - Container Interconnection"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-04.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-01</div><div class="info-item-2">Kubernetes - Container Interconnection</div></div><div class="info-2"><div class="info-item-1">拷贝数据123456$ docker run -d --rm redis450662153d83e6e1b30af57443ccfe68d798d5c7f4f8e50d2d287fdde2c1645c$ docker psCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS      NAMES450662153d83   redis     &quot;docker-entrypoint.s…&quot;   7 seconds ago   Up 6 seconds   6379/tcp   cranky_wilbur   拷贝宿主机文件到容器  1234567891011$ md5sum a.txtd41d8cd98f00b204e9800998ecf8427e  a.txt$ docker cp a.txt 450:/tmp$ docker exec -it 450 sh# ls /tmpa.txt# md5sum /tmp/a.txtd41d8cd98f00b204e98009...</div></div></div></a><a class="pagination-related" href="/2022/09/26/kubernetes-docker-hub/" title="Kubernetes - Docker Hub"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-hub.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-26</div><div class="info-item-2">Kubernetes - Docker Hub</div></div><div class="info-2"><div class="info-item-1">Registry Registry -&gt; Repository     Docker Hub 默认 Registry   ImageOfficial Dockerhttps://hub.docker.com/u/library   Verified Bitnami &#x2F; Rancher &#x2F; Ubuntu   Unofficial半官方 开通 Verified publisher，需要付费   民间 个人镜像  Naming user&#x2F;app:tagtag &#x3D; version + osslim &#x2F; fat     OS Example    Alpine &#x2F; CentOS alpine3.15   Ubuntu 18.04 bionic   Ubuntu 20.04 focal   Debian 9 stretch   Debian 10 buster   Debian 11 bullseye   FlowOnline1234567$ docker login -u zhongmingmaoPassword:WARNING! Your pas...</div></div></div></a><a class="pagination-related" href="/2022/09/19/kubernetes-dockerfile/" title="Kubernetes - Dockerfile"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-02.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-19</div><div class="info-item-2">Kubernetes - Dockerfile</div></div><div class="info-2"><div class="info-item-1">Image 镜像由多层 Layer 组成，Layer 是一组只读不可修改的文件，Layer 可以在镜像间共享Image &#x3D; Layer + Union FS     1234567891011121314$ docker inspect nginx:alpine...        &quot;RootFS&quot;: &#123;            &quot;Type&quot;: &quot;layers&quot;,            &quot;Layers&quot;: [                &quot;sha256:e5e13b0c77cbb769548077189c3da2f0a764ceca06af49d8d558e759f5c232bd&quot;,                &quot;sha256:07099189e7ec257e501d9625507b55e0ea32c330e38c90d8533b3fa2a7a97069&quot;,                &quot;sha256:fcf860bf48b4e20f24f44ba02...</div></div></div></a><a class="pagination-related" href="/2022/09/18/kubernetes-containerization/" title="Kubernetes - Containerization"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-01.png.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-18</div><div class="info-item-2">Kubernetes - Containerization</div></div><div class="info-2"><div class="info-item-1">镜像 只读：依赖的文件系统、依赖库、环境变量、启动参数等    核心解决的问题：应用分发    应用容器化 应用不再直接与 OS 打交道，而是封装成镜像，再交给容器环境去运行   常用命令镜像   命令 作用    docker pull 从远端仓库拉取镜像   docker images 列出当前本地已有的镜像   docker rmi 删除不再使用的镜像   容器12$ docker run -h srv --rm alpine hostnamesrv  1234567891011121314151617181920$ docker run -d nginx:alpine6376e2649ef2d4a6073b977fcc4408f7a3f21b6f32775b42be85711b989dd6ce$ docker run -d --name redis_srv redis2a79d491ecb3108b07df7d369dfe8abc6ac314efc2054951ef7b77e0deba0584$ docker run -it --name ubuntu ubuntu sh# cat /etc/o...</div></div></div></a><a class="pagination-related" href="/2022/09/16/kubernetes-docker-nature/" title="Kubernetes - Docker Nature"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://kubernetes-1253868755.cos.ap-guangzhou.myqcloud.com/docker/docker-geek.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-16</div><div class="info-item-2">Kubernetes - Docker Nature</div></div><div class="info-2"><div class="info-item-1">本质 容器，是一个特殊的隔离环境，能够让进程只看到这个环境内的有限信息，不能对外界环境施加影响隔离的原因：系统安全隔离的实现：namespace + cgroup + chroot(rootfs)    Container vs VM 容器并不是直接运行在 Docker 上，Docker 只是辅助建立隔离环境，让容器基于 Linux 运行    VM 虚拟化出来的是硬件，需要在上面再安装一个 Guest OS 才能运行应用程序，会消耗大量的系统资源   容器则直接利用了下层的计算机硬件和操作系统，非常轻量级，但多个容器共用 OS Kernel，隔离程度不如 VM      实现方式 优势 劣势    VM 虚拟化硬件 隔离程度非常高 资源消耗大，启动慢   Container 直接利用下层的硬件和操作系统 资源利用率高运行速度快 隔离程度较低   </div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%A6%81"><span class="toc-number">1.</span> <span class="toc-text">概要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-vs-VM"><span class="toc-number">2.</span> <span class="toc-text">Docker vs VM</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%A0%87%E5%87%86"><span class="toc-number">3.</span> <span class="toc-text">容器标准</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Namespace"><span class="toc-number">4.</span> <span class="toc-text">Namespace</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF"><span class="toc-number">4.2.</span> <span class="toc-text">场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.</span> <span class="toc-text">操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cgroup"><span class="toc-number">5.</span> <span class="toc-text">Cgroup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="toc-number">5.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cgroup-Driver"><span class="toc-number">5.2.</span> <span class="toc-text">Cgroup Driver</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.3.</span> <span class="toc-text">子系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu"><span class="toc-number">5.3.1.</span> <span class="toc-text">cpu</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#shares"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">shares</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">5.3.1.2.</span> <span class="toc-text">流量控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B"><span class="toc-number">5.3.1.3.</span> <span class="toc-text">样例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpuacct"><span class="toc-number">5.3.2.</span> <span class="toc-text">cpuacct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#memory"><span class="toc-number">5.3.3.</span> <span class="toc-text">memory</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>