<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Focus on Infrastructure">
<meta property="og:type" content="website">
<meta property="og:title" content="ByteCoding">
<meta property="og:url" content="https://blog.zhongmingmao.top/page/36/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Focus on Infrastructure">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png">
<meta property="article:author" content="zhongmingmao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/page/36/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ByteCoding',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-10-23 14:10:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">178</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">72</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2022/10/16/13/53/early-morning-7525151_1280.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">ByteCoding</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/10/kafka-consumer-manage-tcp-connection/" title="Kafka -- Java消费者管理TCP连接"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-1.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- Java消费者管理TCP连接"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/10/kafka-consumer-manage-tcp-connection/" title="Kafka -- Java消费者管理TCP连接">Kafka -- Java消费者管理TCP连接</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-10T02:03:46.000Z" title="Created 2019-09-10 10:03:46">2019-09-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">创建TCP连接
消费者端的主要程序入口是KafkaConsumer，但构建KafkaConsumer实例不会创建任何TCP连接
构建KafkaProducer实例时，会在后台默默地启动一个Sender线程，Sender线程负责Socket连接的创建
在Java构造函数中启动线程，会造成this指针逃逸，是一个隐患


消费者的TCP连接是在调用**KafkaConsumer.poll**方法时被创建的，poll方法内部有3个时机可以创建TCP连接



发起FindCoordinator请求时
消费者组有个组件叫作协调者（Coordinator）
驻留在Broker端的内存中，负责消费者组的组成员管理和各个消费者的位移提交管理


当消费者程序首次启动调用poll方法时，需要向Kafka集群（集群中的任意Broker）发送FindCoordinator请求
社区优化：消费者程序会向集群中当前负载最小的那台Broker发送请求
单向负载评估（非最优解）：消费者连接的所有Broker中，谁的待发送请求最少，谁的负载就越小



连接Coordinator时
Broker处理完FindCoordinator请求后， ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/09/java-performance-jit/" title="Java性能 -- JIT"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-11.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- JIT"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/09/java-performance-jit/" title="Java性能 -- JIT">Java性能 -- JIT</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-09T03:57:01.000Z" title="Created 2019-09-09 11:57:01">2019-09-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">编译
前端编译：即常见的**.java文件被编译成.class文件**的过程
运行时编译：机器无法直接运行Java生成的字节码，在运行时，JIT或者解释器会将字节码转换为机器码
类文件在运行时被进一步编译，可以变成高度优化的机器代码


C&#x2F;C++编译器的所有优化都是在编译期完成的，运行期的性能监控仅作为基础的优化措施是无法进行的
JIT编译器是JVM中运行时编译最重要的部分之一



编译 &#x2F; 加载 &#x2F; 执行

类编译
javac：将.java文件编译成.class文件
javap：反编译.class文件，重点关注常量池和方法表集合
常量池主要记录的是类文件中出现的字面量和符号引用
字面量：字符串常量、基本类型的常量
符号引用：类和接口的全限定名、类引用、方法引用、成员变量引用


方法表集合
方法的字节码、方法访问权限、方法名索引、描述符索引、JVM执行指令、属性集合等







类加载
当一个类被创建实例或者被其他对象引用时，JVM如果没有加载过该类，会通过类加载器将**.class文件加载到内存**中
不同的实现类由不同的类加载器加载
JDK中的本地方法类一般由根加载 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/08/kafka-multi-thread-consumer/" title="Kafka -- 多线程消费者"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-10.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 多线程消费者"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/08/kafka-multi-thread-consumer/" title="Kafka -- 多线程消费者">Kafka -- 多线程消费者</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-08T01:55:31.000Z" title="Created 2019-09-08 09:55:31">2019-09-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">Kafka Java Consumer设计原理
Kafka Java Consumer从Kafka 0.10.1.0开始，KafkaConsumer变成了双线程设计，即用户主线程和心跳线程
用户主线程：启动Consumer应用程序main方法的那个线程
心跳线程：只负责定期给对应的Broker机器发送心跳请求，以标识消费者应用的存活性


引入心跳线程的另一个目的
将心跳频率和主线程调用KafkaConsumer.poll方法的频率分开，解耦真实的消息处理逻辑和消费组成员存活性管理


虽然有了心跳线程，但实际的消息获取逻辑依然是在用户主线程中完成
因此在消费消息的这个层面，依然可以安全地认为KafkaConsumer是单线程的设计


老版本Consumer是多线程的架构
每个Consumer实例在内部为所有订阅的主题分区创建对应的消息获取线程，即Fetcher线程


老版本Consumer同时也是阻塞式的，Consumer实例启动后，内部会创建很多阻塞式的消息获取迭代器
但在很多场景下，Consumer端有非阻塞需求，如在流处理应用中执行过滤、分组等操作就不能是阻塞式的
基于这个原因，社区为新版本Con ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/07/java-performance-jvm-memory-model/" title="Java性能 -- JVM内存模型"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- JVM内存模型"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/07/java-performance-jvm-memory-model/" title="Java性能 -- JVM内存模型">Java性能 -- JVM内存模型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-07T11:51:47.000Z" title="Created 2019-09-07 19:51:47">2019-09-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">JVM内存模型



堆
堆是JVM内存中最大的一块内存空间，被所有线程共享，几乎所有对象和数组都被分配到堆内存中
堆被划分为新生代和老年代，新生代又被划分为Eden区和Survivor区（From Survivor + To Survivor）
永久代
在Java 6中，永久代在非堆内存中
在Java 7中，永久代的静态变量和运行时常量池被合并到堆中
在Java 8中，永久代被元空间取代





程序计数器
程序计数器是一块很小的内存空间，主要用来记录各个线程执行的字节码的地址
Java是多线程语言，当执行的线程数量超过CPU数量时，线程之间会根据时间片轮询争夺CPU资源
当一个线程的时间片用完了，或者其他原因导致该线程的CPU资源被提前抢夺
那么退出的线程需要单独的程序计数器来记录下一条运行的指令



方法区
方法区 !&#x3D; 永久代
HotSpot VM使用了永久代来实现方法区，但在其他VM（Oracle JRockit、IBM J9）不存在永久代一说
方法区只是JVM规范的一部分，在HotSpot VM中，使用了永久代来实现JVM规范的方法区
方法区主要用来存放已被虚拟机加载的类相关信息
类 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/06/kafka-commit-failed-exception/" title="Kafka -- CommitFailedException"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-17.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- CommitFailedException"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/06/kafka-commit-failed-exception/" title="Kafka -- CommitFailedException">Kafka -- CommitFailedException</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-06T09:57:04.000Z" title="Created 2019-09-06 17:57:04">2019-09-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">CommitFailedException
CommitFailedException是Consumer客户端在提交位移时出现的不可恢复的严重异常
如果异常是可恢复的瞬时错误，提交位移的API方法是支持自动错误重试的，如commitSync方法



解释
Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, which typically implies that the poll loop is spending too much time message processing. You can address this either by increasing the max.poll.interval.ms o ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/05/java-performance-consistency/" title="Java性能 -- 并发一致性"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 并发一致性"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/05/java-performance-consistency/" title="Java性能 -- 并发一致性">Java性能 -- 并发一致性</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-05T07:37:43.000Z" title="Created 2019-09-05 15:37:43">2019-09-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">背景在并发编程中，Java是通过共享内存来实现共享变量操作的，所以在多线程编程中会涉及到数据一致性的问题
1234567public class Example &#123;    int x = 0;    public void count() &#123;        x++;                    // 1        System.out.println(x)   // 2    &#125;&#125;




有两个线程分别执行count方法，x是共享变量
可能出现3种结果：**&lt;1,1&gt;**，&lt;2,1&gt;，&lt;1,2&gt;

Java内存模型



Java采用共享内存模型来实现多线程之间的信息交换和数据同步
程序运行时，局部变量将会存放在虚拟机栈中，而共享变量将会被保存在堆内存中
由于局部变量随线程的创建而创建，线程的销毁而销毁，Java栈数据并非线程共享，所以不需要关心数据的一致性
共享变量存储在堆内存或方法区中，堆内存和方法区的数据是线程共享的
堆内存中的共享变量在被不同线程操作时，会被加载到线程的工作内存中，即_CPU中的高速缓存_
CP ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/04/java-performance-command-line-tool/" title="Java性能 -- 命令行工具"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 命令行工具"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/04/java-performance-command-line-tool/" title="Java性能 -- 命令行工具">Java性能 -- 命令行工具</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-04T11:48:26.000Z" title="Created 2019-09-04 19:48:26">2019-09-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-/+ buffers/cache:       8880       7068Swap:            0          0          0




Mem是从操作系统的角度来看的
总共有15948M物理内存，其中15261M被使用了，还有687可用，15948 = 15261 + 687
有若干线程共享了304M物理内存，已经被弃用（值总为0）
buffer &#x2F; cached ：为了提高IO性能，由OS管理
A buffer is something that has yet to be “written” to disk.
A cache is something that has been “read” from the disk and stored ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/03/kafka-commit-offset/" title="Kafka -- 提交位移"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 提交位移"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/03/kafka-commit-offset/" title="Kafka -- 提交位移">Kafka -- 提交位移</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-03T07:42:05.000Z" title="Created 2019-09-03 15:42:05">2019-09-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">消费位移
Consumer的消费位移，记录了Consumer要消费的下一条消息的位移
假设一个分区中有10条消息，位移分别为0到9
某个Consumer消费了5条消息，实际消费了位移0到4的5条消息，此时Consumer的位移为5，指向下一条消息的位移


Consumer需要向Kafka汇报自己的位移数据，这个汇报过程就是提交位移
Consumer能够同时消费多个分区的数据，所以位移的提交实际上是在分区粒度上进行的
Consumer需要为分配给它的每个分区提交各自的位移数据


提交位移主要是为了表征Consumer的消费进度
当Consumer发生故障重启后，能够从Kafka中读取之前提交的位移值，然后从相应的位移处继续消费


位移提交的语义
如果提交了位移X，那么Kafka会认为位移值小于X的消息都已经被成功消费了





灵活
位移提交非常灵活，可以提交任何位移值，但要承担相应的后果
假设Consumer消费了位移为0~9的10条消息
如果提交的位移为20，位移位于10~19的消息可能会丢失
如果提交的位移为5，位移位于5~9的消息可能会被重复消费


位移提交的语义保障由应用程序保证，Kafka ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/02/java-performance-coroutine/" title="Java性能 -- 协程"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-11.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 协程"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/02/java-performance-coroutine/" title="Java性能 -- 协程">Java性能 -- 协程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-02T01:15:07.000Z" title="Created 2019-09-02 09:15:07">2019-09-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">线程实现模型
轻量级进程和内核线程一对一相互映射实现的1:1线程模型
用户线程和内核线程实现的N:1线程模型
用户线程和轻量级进程混合实现的N:M线程模型



1:1线程模型
内核线程（Kernel-Level Thread）是由操作系统内核支持的线程，内核通过调度器对线程进行调度，负责完成线程的切换
在Linux中，往往通过fork函数创建一个子进程来代表一个内核中的线程
一个进程调用fork函数后，系统会先给新的子进程分配资源，然后复制主进程，只有少数值与主进程不一样


采用fork的方式，会产生大量的冗余数据，占用大量内存空间，也会消耗大量CPU时间来初始化内存空间和复制数据
如果是一模一样的数据，可以共享主进程的数据，于是轻量级进程（Light Weight Process，LWP）出现了
LWP使用clone系统调用创建线程
clone函数将部分父进程的资源的数据结构进行复制，复制内容可选，且没有被复制的资源可以通过指针共享给子进程
LWP运行单元更小，运行速度更快，LWP和内核线程一一映射，每个LWP都是由一个内核线程支持



N:1线程模型
1:1线程模型的缺陷
在线程创建、切换上都存在用 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/01/kafka-avoid-rebalance/" title="Kafka -- 避免重平衡"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 避免重平衡"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/01/kafka-avoid-rebalance/" title="Kafka -- 避免重平衡">Kafka -- 避免重平衡</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-01T06:18:18.000Z" title="Created 2019-09-01 14:18:18">2019-09-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">概念
Rebalance是让Consumer Group下所有的Consumer实例就如何消费订阅主题的所有分区达成共识的过程
在Rebalance过程中，所有Consumer实例共同参与，在协调者组件的帮助下，完成订阅主题分区的分配
整个Rebalance过程中，所有Consumer实例都不能消费任何消息，因此对Consumer的TPS影响很大



协调者
协调者，即Coordinator，负责为Consumer Group执行Rebalance以及提供位移管理和组成员管理等
Consumer端应用程序在提交位移时，其实是向Coordinator所在的Broker提交位移
Consumer应用启动时，也是向Coordinator所在的Broker发送各种请求
然后由Coordinator负责执行消费组的注册、成员管理记录等元数据管理操作


所有Broker在启动时，都会创建和开启相应的Coordinator组件，所有Broker都有各自的Coordinator组件
内部位移主题__consumer_offsets记录了为Consumer Group服务的Coordinator在哪一台Broker上
为某 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/35/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/#content-inner">35</a><span class="page-number current">36</span><a class="page-number" href="/page/37/#content-inner">37</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/#content-inner">56</a><a class="extend next" rel="next" href="/page/37/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">178</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">72</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/15/rag-optimization-evaluation/" title="RAG - Optimization + Evaluation"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evaluation.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - Optimization + Evaluation"/></a><div class="content"><a class="title" href="/2024/08/15/rag-optimization-evaluation/" title="RAG - Optimization + Evaluation">RAG - Optimization + Evaluation</a><time datetime="2024-08-14T16:06:25.000Z" title="Created 2024-08-15 00:06:25">2024-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/14/rag-llm-prompt-engineering/" title="RAG - LLM + Prompt Engineering"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/llm-prompting.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - LLM + Prompt Engineering"/></a><div class="content"><a class="title" href="/2024/08/14/rag-llm-prompt-engineering/" title="RAG - LLM + Prompt Engineering">RAG - LLM + Prompt Engineering</a><time datetime="2024-08-13T16:06:25.000Z" title="Created 2024-08-14 00:06:25">2024-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/13/rag-hybrid-retrieval-rerank/" title="RAG - Hybrid retrieval + Rerank"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-rerank-9097303.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - Hybrid retrieval + Rerank"/></a><div class="content"><a class="title" href="/2024/08/13/rag-hybrid-retrieval-rerank/" title="RAG - Hybrid retrieval + Rerank">RAG - Hybrid retrieval + Rerank</a><time datetime="2024-08-12T16:06:25.000Z" title="Created 2024-08-13 00:06:25">2024-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/12/rag-vector-stores/" title="RAG - Vector Stores"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - Vector Stores"/></a><div class="content"><a class="title" href="/2024/08/12/rag-vector-stores/" title="RAG - Vector Stores">RAG - Vector Stores</a><time datetime="2024-08-11T16:06:25.000Z" title="Created 2024-08-12 00:06:25">2024-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/11/rag-kg-rag/" title="RAG - KG-RAG"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/kg_rag.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - KG-RAG"/></a><div class="content"><a class="title" href="/2024/08/11/rag-kg-rag/" title="RAG - KG-RAG">RAG - KG-RAG</a><time datetime="2024-08-10T16:06:25.000Z" title="Created 2024-08-11 00:06:25">2024-08-11</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/"><span class="card-category-list-name">AI</span><span class="card-category-list-count">31</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/llm/"><span class="card-category-list-name">LLM</span><span class="card-category-list-count">16</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/rag/"><span class="card-category-list-name">RAG</span><span class="card-category-list-count">15</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/career/"><span class="card-category-list-name">Career</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/"><span class="card-category-list-name">Cloud Computing</span><span class="card-category-list-count">10</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/iaas/"><span class="card-category-list-name">IaaS</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/paas/"><span class="card-category-list-name">PaaS</span><span class="card-category-list-count">5</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-native/"><span class="card-category-list-name">Cloud Native</span><span class="card-category-list-count">146</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/cloud-computing/" style="font-size: 1.23em; color: rgb(12, 108, 173)">Cloud Computing</a><a href="/tags/iaas/" style="font-size: 1.19em; color: rgb(3, 143, 173)">IaaS</a><a href="/tags/paas/" style="font-size: 1.19em; color: rgb(119, 2, 182)">PaaS</a><a href="/tags/cloud-native/" style="font-size: 1.45em; color: rgb(194, 119, 48)">Cloud Native</a><a href="/tags/kubernetes/" style="font-size: 1.43em; color: rgb(169, 172, 26)">Kubernetes</a><a href="/tags/devops/" style="font-size: 1.18em; color: rgb(147, 45, 63)">DevOps</a><a href="/tags/container/" style="font-size: 1.27em; color: rgb(43, 198, 103)">Container</a><a href="/tags/docker/" style="font-size: 1.29em; color: rgb(146, 73, 72)">Docker</a><a href="/tags/infrastructure/" style="font-size: 1.3em; color: rgb(68, 195, 136)">Infrastructure</a><a href="/tags/architecture/" style="font-size: 1.31em; color: rgb(67, 119, 179)">Architecture</a><a href="/tags/iac/" style="font-size: 1.15em; color: rgb(62, 189, 18)">IaC</a><a href="/tags/terraform/" style="font-size: 1.15em; color: rgb(187, 112, 114)">Terraform</a><a href="/tags/crossplane/" style="font-size: 1.15em; color: rgb(53, 59, 62)">Crossplane</a><a href="/tags/pulumi/" style="font-size: 1.15em; color: rgb(185, 1, 31)">Pulumi</a><a href="/tags/argo-cd/" style="font-size: 1.15em; color: rgb(19, 121, 146)">Argo CD</a><a href="/tags/vpc/" style="font-size: 1.15em; color: rgb(49, 138, 81)">VPC</a><a href="/tags/helm/" style="font-size: 1.15em; color: rgb(91, 144, 34)">Helm</a><a href="/tags/runc/" style="font-size: 1.15em; color: rgb(34, 20, 180)">runc</a><a href="/tags/kustomize/" style="font-size: 1.15em; color: rgb(112, 188, 187)">Kustomize</a><a href="/tags/oci/" style="font-size: 1.15em; color: rgb(52, 37, 61)">OCI</a><a href="/tags/buildkit/" style="font-size: 1.15em; color: rgb(124, 27, 59)">BuildKit</a><a href="/tags/crane/" style="font-size: 1.15em; color: rgb(26, 141, 176)">crane</a><a href="/tags/oci-image/" style="font-size: 1.15em; color: rgb(141, 83, 82)">OCI Image</a><a href="/tags/oci-runtime/" style="font-size: 1.15em; color: rgb(3, 28, 77)">OCI Runtime</a><a href="/tags/linux-namespace/" style="font-size: 1.15em; color: rgb(78, 78, 49)">Linux Namespace</a><a href="/tags/linux-cgroup/" style="font-size: 1.15em; color: rgb(178, 26, 163)">Linux CGroup</a><a href="/tags/k8s-manifest/" style="font-size: 1.15em; color: rgb(21, 85, 24)">K8S Manifest</a><a href="/tags/go-core/" style="font-size: 1.17em; color: rgb(165, 153, 79)">Go Core</a><a href="/tags/go/" style="font-size: 1.42em; color: rgb(85, 152, 72)">Go</a><a href="/tags/go-engineering/" style="font-size: 1.33em; color: rgb(149, 55, 18)">Go Engineering</a><a href="/tags/cloud-native-foundation/" style="font-size: 1.32em; color: rgb(161, 97, 194)">Cloud Native Foundation</a><a href="/tags/swagger/" style="font-size: 1.15em; color: rgb(175, 115, 121)">Swagger</a><a href="/tags/rpc/" style="font-size: 1.16em; color: rgb(188, 97, 193)">RPC</a><a href="/tags/grpc/" style="font-size: 1.16em; color: rgb(32, 58, 87)">gRPC</a><a href="/tags/ci/" style="font-size: 1.15em; color: rgb(14, 156, 161)">CI</a><a href="/tags/makefile/" style="font-size: 1.15em; color: rgb(79, 127, 59)">Makefile</a><a href="/tags/network/" style="font-size: 1.16em; color: rgb(105, 37, 89)">Network</a><a href="/tags/linux/" style="font-size: 1.28em; color: rgb(129, 65, 190)">Linux</a><a href="/tags/dockerfile/" style="font-size: 1.17em; color: rgb(80, 67, 16)">Dockerfile</a><a href="/tags/service-mesh/" style="font-size: 1.18em; color: rgb(22, 145, 63)">Service Mesh</a><a href="/tags/etcd/" style="font-size: 1.15em; color: rgb(113, 193, 181)">etcd</a><a href="/tags/raft/" style="font-size: 1.15em; color: rgb(73, 72, 133)">raft</a><a href="/tags/istio/" style="font-size: 1.17em; color: rgb(36, 16, 174)">Istio</a><a href="/tags/microservices/" style="font-size: 1.28em; color: rgb(101, 72, 137)">Microservices</a><a href="/tags/spring-cloud/" style="font-size: 1.21em; color: rgb(169, 53, 177)">Spring Cloud</a><a href="/tags/spring/" style="font-size: 1.24em; color: rgb(147, 59, 22)">Spring</a><a href="/tags/java/" style="font-size: 1.44em; color: rgb(15, 142, 174)">Java</a><a href="/tags/service-governance/" style="font-size: 1.17em; color: rgb(140, 2, 59)">Service Governance</a><a href="/tags/opa/" style="font-size: 1.21em; color: rgb(150, 117, 86)">OPA</a><a href="/tags/alibaba/" style="font-size: 1.22em; color: rgb(120, 57, 54)">Alibaba</a><a href="/tags/security/" style="font-size: 1.27em; color: rgb(136, 74, 40)">Security</a><a href="/tags/compliance/" style="font-size: 1.17em; color: rgb(185, 192, 33)">Compliance</a><a href="/tags/serverless/" style="font-size: 1.22em; color: rgb(58, 17, 107)">Serverless</a><a href="/tags/faas/" style="font-size: 1.22em; color: rgb(189, 120, 106)">FaaS</a><a href="/tags/api-gateway/" style="font-size: 1.15em; color: rgb(192, 123, 186)">API Gateway</a><a href="/tags/apisix/" style="font-size: 1.15em; color: rgb(188, 2, 153)">APISIX</a><a href="/tags/computer-basics/" style="font-size: 1.35em; color: rgb(131, 15, 167)">Computer Basics</a><a href="/tags/computer-organization/" style="font-size: 1.35em; color: rgb(154, 195, 1)">Computer Organization</a><a href="/tags/knowledge-map/" style="font-size: 1.15em; color: rgb(94, 166, 117)">Knowledge Map</a><a href="/tags/tool/" style="font-size: 1.23em; color: rgb(191, 131, 139)">Tool</a><a href="/tags/git/" style="font-size: 1.23em; color: rgb(69, 181, 81)">Git</a><a href="/tags/concurrency/" style="font-size: 1.15em; color: rgb(125, 91, 17)">Concurrency</a><a href="/tags/cloud/" style="font-size: 1.36em; color: rgb(116, 188, 45)">Cloud</a><a href="/tags/native/" style="font-size: 1.36em; color: rgb(152, 165, 144)">Native</a><a href="/tags/authentication/" style="font-size: 1.17em; color: rgb(148, 103, 12)">Authentication</a><a href="/tags/jwt/" style="font-size: 1.15em; color: rgb(82, 197, 42)">JWT</a><a href="/tags/oauth-2-0/" style="font-size: 1.21em; color: rgb(90, 47, 29)">OAuth 2.0</a><a href="/tags/ldap/" style="font-size: 1.15em; color: rgb(190, 164, 115)">LDAP</a><a href="/tags/storage/" style="font-size: 1.4em; color: rgb(140, 164, 133)">Storage</a><a href="/tags/mysql/" style="font-size: 1.41em; color: rgb(113, 74, 73)">MySQL</a><a href="/tags/innodb/" style="font-size: 1.2em; color: rgb(20, 103, 4)">InnoDB</a><a href="/tags/java-concurrent/" style="font-size: 1.38em; color: rgb(151, 178, 90)">Java Concurrent</a><a href="/tags/actor/" style="font-size: 1.15em; color: rgb(42, 120, 142)">Actor</a><a href="/tags/akka/" style="font-size: 1.15em; color: rgb(196, 117, 154)">Akka</a><a href="/tags/csp/" style="font-size: 1.15em; color: rgb(40, 165, 66)">CSP</a><a href="/tags/coroutine/" style="font-size: 1.16em; color: rgb(112, 182, 40)">Coroutine</a><a href="/tags/disruptor/" style="font-size: 1.15em; color: rgb(14, 161, 75)">Disruptor</a><a href="/tags/netty/" style="font-size: 1.15em; color: rgb(5, 116, 164)">Netty</a><a href="/tags/stm/" style="font-size: 1.15em; color: rgb(0, 157, 139)">STM</a><a href="/tags/mvcc/" style="font-size: 1.15em; color: rgb(191, 185, 97)">MVCC</a><a href="/tags/java-core/" style="font-size: 1.21em; color: rgb(52, 86, 146)">Java Core</a><a href="/tags/java-performance/" style="font-size: 1.33em; color: rgb(108, 15, 106)">Java Performance</a><a href="/tags/cas/" style="font-size: 1.15em; color: rgb(114, 109, 148)">CAS</a><a href="/tags/design-pattern/" style="font-size: 1.18em; color: rgb(139, 188, 140)">Design Pattern</a><a href="/tags/consistency/" style="font-size: 1.15em; color: rgb(180, 51, 168)">Consistency</a><a href="/tags/jvm/" style="font-size: 1.37em; color: rgb(68, 126, 160)">JVM</a><a href="/tags/gc/" style="font-size: 1.16em; color: rgb(44, 61, 112)">GC</a><a href="/tags/hashtable/" style="font-size: 1.15em; color: rgb(82, 172, 143)">HashTable</a><a href="/tags/concurrenthashmap/" style="font-size: 1.15em; color: rgb(174, 15, 44)">ConcurrentHashMap</a><a href="/tags/concurrentskiplistmap/" style="font-size: 1.15em; color: rgb(181, 60, 112)">ConcurrentSkipListMap</a><a href="/tags/hashmap/" style="font-size: 1.15em; color: rgb(94, 168, 22)">HashMap</a><a href="/tags/io/" style="font-size: 1.15em; color: rgb(68, 68, 7)">IO</a><a href="/tags/nio/" style="font-size: 1.16em; color: rgb(82, 109, 26)">NIO</a><a href="/tags/aio/" style="font-size: 1.16em; color: rgb(85, 36, 174)">AIO</a><a href="/tags/epoll/" style="font-size: 1.16em; color: rgb(161, 178, 153)">Epoll</a><a href="/tags/jit/" style="font-size: 1.15em; color: rgb(37, 136, 98)">JIT</a><a href="/tags/bio/" style="font-size: 1.15em; color: rgb(42, 190, 69)">BIO</a><a href="/tags/tomcat/" style="font-size: 1.15em; color: rgb(56, 179, 107)">Tomcat</a><a href="/tags/select/" style="font-size: 1.15em; color: rgb(50, 44, 91)">Select</a><a href="/tags/poll/" style="font-size: 1.15em; color: rgb(27, 90, 61)">Poll</a><a href="/tags/zero-copy/" style="font-size: 1.15em; color: rgb(182, 121, 72)">Zero Copy</a><a href="/tags/mmap/" style="font-size: 1.15em; color: rgb(187, 125, 18)">mmap</a><a href="/tags/reactor/" style="font-size: 1.15em; color: rgb(136, 94, 55)">Reactor</a><a href="/tags/synchronized/" style="font-size: 1.16em; color: rgb(174, 44, 78)">synchronized</a><a href="/tags/lock/" style="font-size: 1.15em; color: rgb(5, 167, 3)">Lock</a><a href="/tags/reentrantreadwritelock/" style="font-size: 1.15em; color: rgb(160, 66, 165)">ReentrantReadWriteLock</a><a href="/tags/stampedlock/" style="font-size: 1.15em; color: rgb(177, 16, 126)">StampedLock</a><a href="/tags/serialization/" style="font-size: 1.15em; color: rgb(37, 148, 103)">Serialization</a><a href="/tags/protobuf/" style="font-size: 1.15em; color: rgb(186, 59, 6)">ProtoBuf</a><a href="/tags/java-stream/" style="font-size: 1.15em; color: rgb(150, 48, 180)">Java Stream</a><a href="/tags/mark-word/" style="font-size: 1.15em; color: rgb(155, 107, 42)">Mark Word</a><a href="/tags/monitor/" style="font-size: 1.15em; color: rgb(133, 165, 110)">Monitor</a><a href="/tags/context-switch/" style="font-size: 1.15em; color: rgb(78, 128, 116)">Context Switch</a><a href="/tags/thread-pool/" style="font-size: 1.15em; color: rgb(103, 164, 106)">Thread Pool</a><a href="/tags/lambda/" style="font-size: 1.15em; color: rgb(197, 158, 197)">Lambda</a><a href="/tags/bytecode-manipulation/" style="font-size: 1.17em; color: rgb(90, 11, 100)">Bytecode Manipulation</a><a href="/tags/asm/" style="font-size: 1.15em; color: rgb(88, 116, 176)">ASM</a><a href="/tags/jol/" style="font-size: 1.17em; color: rgb(96, 121, 74)">JOL</a><a href="/tags/middleware/" style="font-size: 1.39em; color: rgb(16, 72, 58)">Middleware</a><a href="/tags/mq/" style="font-size: 1.39em; color: rgb(179, 24, 120)">MQ</a><a href="/tags/kafka/" style="font-size: 1.39em; color: rgb(55, 6, 55)">Kafka</a><a href="/tags/stream/" style="font-size: 1.39em; color: rgb(82, 126, 107)">Stream</a><a href="/tags/rebalance/" style="font-size: 1.17em; color: rgb(8, 191, 189)">Rebalance</a><a href="/tags/avro/" style="font-size: 1.18em; color: rgb(48, 106, 85)">Avro</a><a href="/tags/compression/" style="font-size: 1.15em; color: rgb(79, 42, 102)">Compression</a><a href="/tags/consumer-group/" style="font-size: 1.15em; color: rgb(154, 92, 87)">Consumer Group</a><a href="/tags/tcp/" style="font-size: 1.16em; color: rgb(200, 172, 22)">TCP</a><a href="/tags/idempotence/" style="font-size: 1.15em; color: rgb(79, 79, 28)">Idempotence</a><a href="/tags/producer/" style="font-size: 1.15em; color: rgb(27, 47, 84)">Producer</a><a href="/tags/load-balance/" style="font-size: 1.15em; color: rgb(158, 157, 13)">Load Balance</a><a href="/tags/distributed-architecture/" style="font-size: 1.15em; color: rgb(38, 106, 18)">Distributed Architecture</a><a href="/tags/distributed-design-pattern/" style="font-size: 1.17em; color: rgb(153, 16, 183)">Distributed Design Pattern</a><a href="/tags/career/" style="font-size: 1.15em; color: rgb(137, 63, 91)">Career</a><a href="/tags/linux-performance/" style="font-size: 1.17em; color: rgb(170, 15, 145)">Linux Performance</a><a href="/tags/linux-practice/" style="font-size: 1.25em; color: rgb(178, 158, 128)">Linux Practice</a><a href="/tags/ext4/" style="font-size: 1.15em; color: rgb(186, 6, 113)">ext4</a><a href="/tags/file-system/" style="font-size: 1.15em; color: rgb(136, 173, 30)">File System</a><a href="/tags/ai/" style="font-size: 1.34em; color: rgb(93, 60, 23)">AI</a><a href="/tags/llm/" style="font-size: 1.34em; color: rgb(157, 56, 142)">LLM</a><a href="/tags/chatgpt/" style="font-size: 1.15em; color: rgb(145, 34, 194)">ChatGPT</a><a href="/tags/nlp/" style="font-size: 1.26em; color: rgb(102, 64, 86)">NLP</a><a href="/tags/transformer/" style="font-size: 1.16em; color: rgb(19, 40, 90)">Transformer</a><a href="/tags/python/" style="font-size: 1.15em; color: rgb(101, 12, 180)">Python</a><a href="/tags/fastapi/" style="font-size: 1.15em; color: rgb(158, 50, 105)">FastAPI</a><a href="/tags/uvicorn/" style="font-size: 1.15em; color: rgb(73, 171, 42)">Uvicorn</a><a href="/tags/machine-learning/" style="font-size: 1.17em; color: rgb(86, 70, 170)">Machine Learning</a><a href="/tags/svm/" style="font-size: 1.15em; color: rgb(85, 41, 37)">SVM</a><a href="/tags/rnn/" style="font-size: 1.15em; color: rgb(16, 69, 42)">RNN</a><a href="/tags/seq2seq/" style="font-size: 1.16em; color: rgb(48, 108, 75)">Seq2Seq</a><a href="/tags/attention/" style="font-size: 1.15em; color: rgb(0, 69, 143)">Attention</a><a href="/tags/word2vec/" style="font-size: 1.15em; color: rgb(42, 11, 147)">Word2Vec</a><a href="/tags/langchain/" style="font-size: 1.19em; color: rgb(184, 161, 108)">LangChain</a><a href="/tags/ai-agent/" style="font-size: 1.18em; color: rgb(68, 46, 34)">AI Agent</a><a href="/tags/rag/" style="font-size: 1.3em; color: rgb(182, 164, 165)">RAG</a><a href="/tags/faiss/" style="font-size: 1.15em; color: rgb(68, 111, 184)">Faiss</a><a href="/tags/lora/" style="font-size: 1.15em; color: rgb(31, 93, 139)">LoRA</a><a href="/tags/peft/" style="font-size: 1.15em; color: rgb(60, 152, 93)">PEFT</a><a href="/tags/math/" style="font-size: 1.16em; color: rgb(174, 80, 111)">Math</a><a href="/tags/microservices-governance/" style="font-size: 1.22em; color: rgb(126, 140, 147)">Microservices Governance</a><a href="/tags/config/" style="font-size: 1.17em; color: rgb(187, 132, 97)">Config</a><a href="/tags/configuration-center/" style="font-size: 1.17em; color: rgb(106, 34, 154)">Configuration Center</a><a href="/tags/apollo/" style="font-size: 1.17em; color: rgb(28, 147, 131)">Apollo</a><a href="/tags/oauth2/" style="font-size: 1.2em; color: rgb(33, 12, 49)">Oauth2</a><a href="/tags/spring-security/" style="font-size: 1.19em; color: rgb(109, 60, 104)">Spring Security</a><a href="/tags/spring-security-oauth2/" style="font-size: 1.19em; color: rgb(178, 32, 174)">Spring Security OAuth2</a><a href="/tags/performance-tuning/" style="font-size: 1.15em; color: rgb(193, 170, 40)">Performance Tuning</a><a href="/tags/chatops/" style="font-size: 1.15em; color: rgb(36, 124, 101)">ChatOps</a><a href="/tags/chatbot/" style="font-size: 1.15em; color: rgb(133, 121, 46)">Chatbot</a><a href="/tags/rerank/" style="font-size: 1.15em; color: rgb(136, 149, 114)">Rerank</a><a href="/tags/prompting/" style="font-size: 1.15em; color: rgb(177, 84, 164)">Prompting</a><a href="/tags/kg-rag/" style="font-size: 1.15em; color: rgb(38, 97, 40)">KG-RAG</a><a href="/tags/vector/" style="font-size: 1.15em; color: rgb(55, 32, 194)">Vector</a><a href="/tags/vim/" style="font-size: 1.2em; color: rgb(44, 161, 88)">Vim</a><a href="/tags/web/" style="font-size: 1.21em; color: rgb(113, 101, 103)">Web</a><a href="/tags/javascript/" style="font-size: 1.19em; color: rgb(126, 117, 123)">JavaScript</a><a href="/tags/zookeeper/" style="font-size: 1.16em; color: rgb(56, 141, 152)">Zookeeper</a><a href="/tags/zab/" style="font-size: 1.15em; color: rgb(82, 33, 110)">ZAB</a><a href="/tags/distributed-lock/" style="font-size: 1.15em; color: rgb(116, 3, 109)">Distributed Lock</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">May 2023</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">February 2023</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">January 2023</span><span class="card-archive-list-count">31</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">December 2022</span><span class="card-archive-list-count">31</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">554</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2015-06-30T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">1054.2k</div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-10-23T06:10:24.110Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2024 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["Stay hungry, stay foolish."])
  } else {
    document.getElementById("subtitle").innerHTML = 'Stay hungry, stay foolish.'
  }
}
typedJSFn.run(subtitleType)</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>