<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Focus on Infrastructure">
<meta property="og:type" content="website">
<meta property="og:title" content="ByteCoding">
<meta property="og:url" content="https://blog.zhongmingmao.top/page/39/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Focus on Infrastructure">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png">
<meta property="article:author" content="zhongmingmao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/page/39/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ByteCoding',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-11-15 16:02:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">580</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">180</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">74</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://cdn.pixabay.com/photo/2022/10/16/13/53/early-morning-7525151_1280.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">ByteCoding</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/06/kafka-commit-failed-exception/" title="Kafka -- CommitFailedException"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- CommitFailedException"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/06/kafka-commit-failed-exception/" title="Kafka -- CommitFailedException">Kafka -- CommitFailedException</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-06T09:57:04.000Z" title="Created 2019-09-06 17:57:04">2019-09-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">CommitFailedException
CommitFailedException是Consumer客户端在提交位移时出现的不可恢复的严重异常
如果异常是可恢复的瞬时错误，提交位移的API方法是支持自动错误重试的，如commitSync方法



解释
Commit cannot be completed since the group has already rebalanced and assigned the partitions to another member. This means that the time between subsequent calls to poll() was longer than the configured max.poll.interval.ms, which typically implies that the poll loop is spending too much time message processing. You can address this either by increasing the max.poll.interval.ms o ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/05/java-performance-consistency/" title="Java性能 -- 并发一致性"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 并发一致性"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/05/java-performance-consistency/" title="Java性能 -- 并发一致性">Java性能 -- 并发一致性</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-05T07:37:43.000Z" title="Created 2019-09-05 15:37:43">2019-09-05</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">背景在并发编程中，Java是通过共享内存来实现共享变量操作的，所以在多线程编程中会涉及到数据一致性的问题
1234567public class Example &#123;    int x = 0;    public void count() &#123;        x++;                    // 1        System.out.println(x)   // 2    &#125;&#125;




有两个线程分别执行count方法，x是共享变量
可能出现3种结果：**&lt;1,1&gt;**，&lt;2,1&gt;，&lt;1,2&gt;

Java内存模型



Java采用共享内存模型来实现多线程之间的信息交换和数据同步
程序运行时，局部变量将会存放在虚拟机栈中，而共享变量将会被保存在堆内存中
由于局部变量随线程的创建而创建，线程的销毁而销毁，Java栈数据并非线程共享，所以不需要关心数据的一致性
共享变量存储在堆内存或方法区中，堆内存和方法区的数据是线程共享的
堆内存中的共享变量在被不同线程操作时，会被加载到线程的工作内存中，即_CPU中的高速缓存_
CP ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/04/java-performance-command-line-tool/" title="Java性能 -- 命令行工具"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-9.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 命令行工具"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/04/java-performance-command-line-tool/" title="Java性能 -- 命令行工具">Java性能 -- 命令行工具</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-04T11:48:26.000Z" title="Created 2019-09-04 19:48:26">2019-09-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-/+ buffers/cache:       8880       7068Swap:            0          0          0




Mem是从操作系统的角度来看的
总共有15948M物理内存，其中15261M被使用了，还有687可用，15948 = 15261 + 687
有若干线程共享了304M物理内存，已经被弃用（值总为0）
buffer &#x2F; cached ：为了提高IO性能，由OS管理
A buffer is something that has yet to be “written” to disk.
A cache is something that has been “read” from the disk and stored ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/03/kafka-commit-offset/" title="Kafka -- 提交位移"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-5.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 提交位移"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/03/kafka-commit-offset/" title="Kafka -- 提交位移">Kafka -- 提交位移</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-03T07:42:05.000Z" title="Created 2019-09-03 15:42:05">2019-09-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">消费位移
Consumer的消费位移，记录了Consumer要消费的下一条消息的位移
假设一个分区中有10条消息，位移分别为0到9
某个Consumer消费了5条消息，实际消费了位移0到4的5条消息，此时Consumer的位移为5，指向下一条消息的位移


Consumer需要向Kafka汇报自己的位移数据，这个汇报过程就是提交位移
Consumer能够同时消费多个分区的数据，所以位移的提交实际上是在分区粒度上进行的
Consumer需要为分配给它的每个分区提交各自的位移数据


提交位移主要是为了表征Consumer的消费进度
当Consumer发生故障重启后，能够从Kafka中读取之前提交的位移值，然后从相应的位移处继续消费


位移提交的语义
如果提交了位移X，那么Kafka会认为位移值小于X的消息都已经被成功消费了





灵活
位移提交非常灵活，可以提交任何位移值，但要承担相应的后果
假设Consumer消费了位移为0~9的10条消息
如果提交的位移为20，位移位于10~19的消息可能会丢失
如果提交的位移为5，位移位于5~9的消息可能会被重复消费


位移提交的语义保障由应用程序保证，Kafka ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/09/02/java-performance-coroutine/" title="Java性能 -- 协程"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 协程"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/02/java-performance-coroutine/" title="Java性能 -- 协程">Java性能 -- 协程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-02T01:15:07.000Z" title="Created 2019-09-02 09:15:07">2019-09-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">线程实现模型
轻量级进程和内核线程一对一相互映射实现的1:1线程模型
用户线程和内核线程实现的N:1线程模型
用户线程和轻量级进程混合实现的N:M线程模型



1:1线程模型
内核线程（Kernel-Level Thread）是由操作系统内核支持的线程，内核通过调度器对线程进行调度，负责完成线程的切换
在Linux中，往往通过fork函数创建一个子进程来代表一个内核中的线程
一个进程调用fork函数后，系统会先给新的子进程分配资源，然后复制主进程，只有少数值与主进程不一样


采用fork的方式，会产生大量的冗余数据，占用大量内存空间，也会消耗大量CPU时间来初始化内存空间和复制数据
如果是一模一样的数据，可以共享主进程的数据，于是轻量级进程（Light Weight Process，LWP）出现了
LWP使用clone系统调用创建线程
clone函数将部分父进程的资源的数据结构进行复制，复制内容可选，且没有被复制的资源可以通过指针共享给子进程
LWP运行单元更小，运行速度更快，LWP和内核线程一一映射，每个LWP都是由一个内核线程支持



N:1线程模型
1:1线程模型的缺陷
在线程创建、切换上都存在用 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/09/01/kafka-avoid-rebalance/" title="Kafka -- 避免重平衡"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-24.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 避免重平衡"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/09/01/kafka-avoid-rebalance/" title="Kafka -- 避免重平衡">Kafka -- 避免重平衡</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-09-01T06:18:18.000Z" title="Created 2019-09-01 14:18:18">2019-09-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">概念
Rebalance是让Consumer Group下所有的Consumer实例就如何消费订阅主题的所有分区达成共识的过程
在Rebalance过程中，所有Consumer实例共同参与，在协调者组件的帮助下，完成订阅主题分区的分配
整个Rebalance过程中，所有Consumer实例都不能消费任何消息，因此对Consumer的TPS影响很大



协调者
协调者，即Coordinator，负责为Consumer Group执行Rebalance以及提供位移管理和组成员管理等
Consumer端应用程序在提交位移时，其实是向Coordinator所在的Broker提交位移
Consumer应用启动时，也是向Coordinator所在的Broker发送各种请求
然后由Coordinator负责执行消费组的注册、成员管理记录等元数据管理操作


所有Broker在启动时，都会创建和开启相应的Coordinator组件，所有Broker都有各自的Coordinator组件
内部位移主题__consumer_offsets记录了为Consumer Group服务的Coordinator在哪一台Broker上
为某 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/08/31/java-performance-threadpool-size/" title="Java性能 -- 线程池大小"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-5.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 线程池大小"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/08/31/java-performance-threadpool-size/" title="Java性能 -- 线程池大小">Java性能 -- 线程池大小</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-08-31T02:57:40.000Z" title="Created 2019-08-31 10:57:40">2019-08-31</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">线程池原理
在Hotspot JVM的线程模型中，Java线程被一对一映射为内核线程
Java使用线程执行程序时，需要创建一个内核线程，当该Java线程被终止时，这个内核线程也会被回收
Java线程的创建和销毁将会消耗一定的计算机资源，从而增加系统的性能开销
大量创建线程也会给系统带来性能问题，线程会抢占内存和CPU资源，可能会发生内存溢出、CPU超负载等问题


线程池：即可以提高线程复用，也可以固定最大线程数，防止无限制地创建线程
当程序提交一个任务需要一个线程时，会去线程池查找是否有空闲的线程
如果有，则直接使用线程池中的线程工作，如果没有，则判断当前已创建的线程数是否超过最大线程数
如果未超过，则创建新线程，如果已经超过，则进行排队等待或者直接抛出异常





线程池框架Executor
Java最开始提供了ThreadPool来实现线程池，为了更好地实现用户级的线程调度，Java提供了一套Executor框架
Executor框架包括了ScheduledThreadPoolExecutor和ThreadPoolExecutor两个核心线程池，核心原理一样
ScheduledThreadPoolEx ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/08/30/java-performance-concurrent-container/" title="Java性能 -- 并发容器"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-20.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 并发容器"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/08/30/java-performance-concurrent-container/" title="Java性能 -- 并发容器">Java性能 -- 并发容器</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-08-30T01:26:40.000Z" title="Created 2019-08-30 09:26:40">2019-08-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">并发场景下的Map容器
某电商系统需要统计销量TOP 10的商品，通常用哈希表来存储商品和销量的键值对，然后使用排序获取销量TOP 10的商品
并发场景下不能使用HashMap
JDK 1.7，在并发场景下使用HashMap会出现死循环，导致CPU使用率居高不下，而扩容是导致死循环的主要原因
JDK 1.8，虽然修复了HashMap扩容导致的死循环问题，但在高并发场景下，依然会有数据丢失和不准确的情况


为了保证Map容器的线程安全，Java实现了HashTable、ConcurrentHashMap、ConcurrentSkipListMap
HashTable、ConcurrentHashMap是基于HashMap实现的，适用于小数据量存取的场景
ConcurrentSkipListMap是基于TreeMap的设计原理实现的
ConcurrentSkipListMap是基于跳表实现的，而TreeMap是基于红黑树实现的
ConcurrentSkipListMap最大的特点是存取平均时间复杂度为O(log(n))，适用于大数据量存取的场景







HashTable &#x2F; Concurren ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2019/08/26/kafka-offset-topic/" title="Kafka -- 位移主题"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka -- 位移主题"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/08/26/kafka-offset-topic/" title="Kafka -- 位移主题">Kafka -- 位移主题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-08-26T09:41:58.000Z" title="Created 2019-08-26 17:41:58">2019-08-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/middleware/">Middleware</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/">MQ</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/middleware/mq/kafka/">Kafka</a></span></div><div class="content">ZooKeeper
老版本Consumer的位移管理依托于Apache ZooKeeper，自动或手动地将位移数据提交到ZK中保存
当Consumer重启后，能自动从ZK中读取位移数据，从而在上次消费截止的地方继续消费
这种设计使得Kafka Broker不需要保存位移数据，减少了Broker端需要持有的状态空间，有利于实现高伸缩性
但ZK并不适用于高频的写操作



位移主题
将Consumer的位移数据作为普通的Kafka消息，提交到__consumer_offsets（保存Consumer的位移信息）
提交过程需要实现高持久性，并需要支持高频的写操作


位移主题是普通的Kafka主题，同时也是一个内部主题，交由Kafka管理即可
位移主题的消息格式由Kafka定义，用户不能修改
因此不能随意向位移主题写消息，一旦写入的消息不能满足格式，那Kafka内部无法成功解析，会造成Broker崩溃
Kafka Consumer有API来提交位移（即向位移主题写消息）



消息格式
常用格式：Key-Value
Key为消息键值，Value为消息体，在Kafka中都是字节数组
Key
&lt;Group ID, ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2019/08/25/java-performance-thread-cs/" title="Java性能 -- 线程上下文切换"><img class="post-bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-12.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java性能 -- 线程上下文切换"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/08/25/java-performance-thread-cs/" title="Java性能 -- 线程上下文切换">Java性能 -- 线程上下文切换</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2019-08-25T02:28:46.000Z" title="Created 2019-08-25 10:28:46">2019-08-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/java/">Java</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/java/performance/">Performance</a></span></div><div class="content">线程数量
在并发程序中，并不是启动更多的线程就能让程序最大限度地并发执行
线程数量设置太小，会导致程序不能充分地利用系统资源
线程数量设置太大，可能带来资源的过度竞争，导致上下文切换，带来的额外的系统开销



上下文切换
在单处理器时期，操作系统就能处理多线程并发任务，处理器给每个线程分配CPU时间片，线程在CPU时间片内执行任务
CPU时间片是CPU分配给每个线程执行的时间段，一般为几十毫秒


时间片决定了一个线程可以连续占用处理器运行的时长
当一个线程的时间片用完，或者因自身原因被迫暂停运行，此时另一个线程会被操作系统选中来占用处理器
上下文切换（Context Switch）：一个线程被暂停剥夺使用权，另一个线程被选中开始或者继续运行的过程
切出：一个线程被剥夺处理器的使用权而被暂停运行
切入：一个线程被选中占用处理器开始运行或者继续运行
切出切入的过程中，操作系统需要保存和恢复相应的进度信息，这个进度信息就是_上下文_




上下文的内容
寄存器的存储内容：CPU寄存器负责存储已经、正在和将要执行的任务
程序计数器存储的指令内容：程序计数器负责存储CPU正在执行的指令位置、即将执行的下一条指令的 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/38/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/#content-inner">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/#content-inner">40</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/#content-inner">58</a><a class="extend next" rel="next" href="/page/40/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">580</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">180</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">74</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/10/bigdata-distributed-system/" title="Big Data - Distributed System"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241115122617632.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Big Data - Distributed System"/></a><div class="content"><a class="title" href="/2024/09/10/bigdata-distributed-system/" title="Big Data - Distributed System">Big Data - Distributed System</a><time datetime="2024-09-09T16:06:25.000Z" title="Created 2024-09-10 00:06:25">2024-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/qdrant.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - Qdrant"/></a><div class="content"><a class="title" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant">RAG - Qdrant</a><time datetime="2024-09-08T16:06:25.000Z" title="Created 2024-09-09 00:06:25">2024-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/08/python-debug-profile/" title="Python - Debug + Profile"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://python-1253868755.cos.ap-guangzhou.myqcloud.com/python-debugging.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - Debug + Profile"/></a><div class="content"><a class="title" href="/2024/09/08/python-debug-profile/" title="Python - Debug + Profile">Python - Debug + Profile</a><time datetime="2024-09-07T16:06:25.000Z" title="Created 2024-09-08 00:06:25">2024-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/07/python-with/" title="Python - With"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://python-1253868755.cos.ap-guangzhou.myqcloud.com/python-with.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - With"/></a><div class="content"><a class="title" href="/2024/09/07/python-with/" title="Python - With">Python - With</a><time datetime="2024-09-06T16:06:25.000Z" title="Created 2024-09-07 00:06:25">2024-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/06/python-gc/" title="Python - GC"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://python-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241101191222475.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - GC"/></a><div class="content"><a class="title" href="/2024/09/06/python-gc/" title="Python - GC">Python - GC</a><time datetime="2024-09-05T16:06:25.000Z" title="Created 2024-09-06 00:06:25">2024-09-06</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/"><span class="card-category-list-name">AI</span><span class="card-category-list-count">34</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/llm/"><span class="card-category-list-name">LLM</span><span class="card-category-list-count">16</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ai/rag/"><span class="card-category-list-name">RAG</span><span class="card-category-list-count">18</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/big-data/"><span class="card-category-list-name">Big Data</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/career/"><span class="card-category-list-name">Career</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/"><span class="card-category-list-name">Cloud Computing</span><span class="card-category-list-count">10</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/iaas/"><span class="card-category-list-name">IaaS</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/cloud-computing/paas/"><span class="card-category-list-name">PaaS</span><span class="card-category-list-count">5</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/big-data/" style="font-size: 1.15em; color: rgb(47, 184, 198)">Big Data</a><a href="/tags/cloud-computing/" style="font-size: 1.22em; color: rgb(182, 129, 21)">Cloud Computing</a><a href="/tags/iaas/" style="font-size: 1.19em; color: rgb(120, 34, 19)">IaaS</a><a href="/tags/paas/" style="font-size: 1.19em; color: rgb(0, 146, 84)">PaaS</a><a href="/tags/cloud-native/" style="font-size: 1.45em; color: rgb(7, 145, 8)">Cloud Native</a><a href="/tags/kubernetes/" style="font-size: 1.43em; color: rgb(77, 41, 44)">Kubernetes</a><a href="/tags/devops/" style="font-size: 1.18em; color: rgb(58, 0, 155)">DevOps</a><a href="/tags/container/" style="font-size: 1.26em; color: rgb(172, 136, 0)">Container</a><a href="/tags/docker/" style="font-size: 1.28em; color: rgb(83, 153, 133)">Docker</a><a href="/tags/go-core/" style="font-size: 1.17em; color: rgb(89, 196, 47)">Go Core</a><a href="/tags/go/" style="font-size: 1.42em; color: rgb(75, 20, 2)">Go</a><a href="/tags/go-engineering/" style="font-size: 1.34em; color: rgb(145, 47, 36)">Go Engineering</a><a href="/tags/swagger/" style="font-size: 1.15em; color: rgb(48, 63, 157)">Swagger</a><a href="/tags/rpc/" style="font-size: 1.16em; color: rgb(157, 6, 176)">RPC</a><a href="/tags/grpc/" style="font-size: 1.16em; color: rgb(96, 175, 123)">gRPC</a><a href="/tags/ci/" style="font-size: 1.15em; color: rgb(99, 118, 144)">CI</a><a href="/tags/makefile/" style="font-size: 1.15em; color: rgb(168, 128, 114)">Makefile</a><a href="/tags/network/" style="font-size: 1.16em; color: rgb(26, 118, 82)">Network</a><a href="/tags/cloud-native-foundation/" style="font-size: 1.33em; color: rgb(102, 168, 36)">Cloud Native Foundation</a><a href="/tags/linux/" style="font-size: 1.27em; color: rgb(72, 61, 127)">Linux</a><a href="/tags/dockerfile/" style="font-size: 1.17em; color: rgb(133, 50, 105)">Dockerfile</a><a href="/tags/service-mesh/" style="font-size: 1.18em; color: rgb(110, 70, 102)">Service Mesh</a><a href="/tags/microservices/" style="font-size: 1.27em; color: rgb(92, 177, 73)">Microservices</a><a href="/tags/spring-cloud/" style="font-size: 1.21em; color: rgb(41, 36, 14)">Spring Cloud</a><a href="/tags/spring/" style="font-size: 1.23em; color: rgb(55, 63, 139)">Spring</a><a href="/tags/java/" style="font-size: 1.44em; color: rgb(187, 9, 64)">Java</a><a href="/tags/service-governance/" style="font-size: 1.17em; color: rgb(30, 150, 47)">Service Governance</a><a href="/tags/opa/" style="font-size: 1.21em; color: rgb(38, 130, 114)">OPA</a><a href="/tags/alibaba/" style="font-size: 1.22em; color: rgb(56, 128, 92)">Alibaba</a><a href="/tags/security/" style="font-size: 1.26em; color: rgb(176, 59, 190)">Security</a><a href="/tags/compliance/" style="font-size: 1.17em; color: rgb(71, 103, 120)">Compliance</a><a href="/tags/infrastructure/" style="font-size: 1.31em; color: rgb(159, 91, 200)">Infrastructure</a><a href="/tags/architecture/" style="font-size: 1.32em; color: rgb(5, 121, 149)">Architecture</a><a href="/tags/serverless/" style="font-size: 1.22em; color: rgb(185, 155, 192)">Serverless</a><a href="/tags/faas/" style="font-size: 1.22em; color: rgb(85, 55, 88)">FaaS</a><a href="/tags/computer-basics/" style="font-size: 1.36em; color: rgb(13, 133, 188)">Computer Basics</a><a href="/tags/computer-organization/" style="font-size: 1.36em; color: rgb(164, 145, 8)">Computer Organization</a><a href="/tags/knowledge-map/" style="font-size: 1.15em; color: rgb(198, 66, 161)">Knowledge Map</a><a href="/tags/tool/" style="font-size: 1.22em; color: rgb(190, 155, 52)">Tool</a><a href="/tags/git/" style="font-size: 1.22em; color: rgb(138, 173, 189)">Git</a><a href="/tags/concurrency/" style="font-size: 1.15em; color: rgb(126, 39, 69)">Concurrency</a><a href="/tags/cloud/" style="font-size: 1.37em; color: rgb(120, 43, 140)">Cloud</a><a href="/tags/native/" style="font-size: 1.37em; color: rgb(103, 87, 6)">Native</a><a href="/tags/authentication/" style="font-size: 1.17em; color: rgb(29, 193, 27)">Authentication</a><a href="/tags/ldap/" style="font-size: 1.15em; color: rgb(91, 17, 138)">LDAP</a><a href="/tags/oauth-2-0/" style="font-size: 1.21em; color: rgb(22, 119, 59)">OAuth 2.0</a><a href="/tags/storage/" style="font-size: 1.4em; color: rgb(155, 174, 4)">Storage</a><a href="/tags/mysql/" style="font-size: 1.41em; color: rgb(92, 198, 179)">MySQL</a><a href="/tags/innodb/" style="font-size: 1.2em; color: rgb(82, 82, 182)">InnoDB</a><a href="/tags/java-concurrent/" style="font-size: 1.38em; color: rgb(150, 185, 70)">Java Concurrent</a><a href="/tags/actor/" style="font-size: 1.15em; color: rgb(166, 86, 32)">Actor</a><a href="/tags/akka/" style="font-size: 1.15em; color: rgb(52, 63, 132)">Akka</a><a href="/tags/coroutine/" style="font-size: 1.16em; color: rgb(116, 60, 142)">Coroutine</a><a href="/tags/csp/" style="font-size: 1.15em; color: rgb(105, 68, 139)">CSP</a><a href="/tags/disruptor/" style="font-size: 1.15em; color: rgb(174, 184, 41)">Disruptor</a><a href="/tags/netty/" style="font-size: 1.15em; color: rgb(183, 127, 142)">Netty</a><a href="/tags/stm/" style="font-size: 1.15em; color: rgb(134, 166, 119)">STM</a><a href="/tags/mvcc/" style="font-size: 1.15em; color: rgb(43, 33, 36)">MVCC</a><a href="/tags/java-core/" style="font-size: 1.21em; color: rgb(83, 146, 112)">Java Core</a><a href="/tags/java-performance/" style="font-size: 1.34em; color: rgb(150, 41, 96)">Java Performance</a><a href="/tags/cas/" style="font-size: 1.15em; color: rgb(121, 179, 48)">CAS</a><a href="/tags/design-pattern/" style="font-size: 1.18em; color: rgb(38, 109, 39)">Design Pattern</a><a href="/tags/consistency/" style="font-size: 1.15em; color: rgb(108, 192, 118)">Consistency</a><a href="/tags/hashtable/" style="font-size: 1.15em; color: rgb(25, 8, 28)">HashTable</a><a href="/tags/concurrenthashmap/" style="font-size: 1.15em; color: rgb(58, 103, 197)">ConcurrentHashMap</a><a href="/tags/concurrentskiplistmap/" style="font-size: 1.15em; color: rgb(134, 18, 190)">ConcurrentSkipListMap</a><a href="/tags/jvm/" style="font-size: 1.38em; color: rgb(32, 173, 133)">JVM</a><a href="/tags/gc/" style="font-size: 1.16em; color: rgb(168, 69, 158)">GC</a><a href="/tags/io/" style="font-size: 1.15em; color: rgb(161, 157, 18)">IO</a><a href="/tags/nio/" style="font-size: 1.16em; color: rgb(127, 92, 36)">NIO</a><a href="/tags/aio/" style="font-size: 1.16em; color: rgb(189, 76, 26)">AIO</a><a href="/tags/epoll/" style="font-size: 1.16em; color: rgb(22, 3, 112)">Epoll</a><a href="/tags/jit/" style="font-size: 1.15em; color: rgb(93, 73, 81)">JIT</a><a href="/tags/hashmap/" style="font-size: 1.15em; color: rgb(76, 132, 107)">HashMap</a><a href="/tags/synchronized/" style="font-size: 1.16em; color: rgb(128, 68, 54)">synchronized</a><a href="/tags/lock/" style="font-size: 1.15em; color: rgb(130, 168, 85)">Lock</a><a href="/tags/reentrantreadwritelock/" style="font-size: 1.15em; color: rgb(66, 120, 102)">ReentrantReadWriteLock</a><a href="/tags/stampedlock/" style="font-size: 1.15em; color: rgb(183, 11, 34)">StampedLock</a><a href="/tags/serialization/" style="font-size: 1.15em; color: rgb(89, 138, 44)">Serialization</a><a href="/tags/protobuf/" style="font-size: 1.15em; color: rgb(77, 58, 46)">ProtoBuf</a><a href="/tags/java-stream/" style="font-size: 1.15em; color: rgb(161, 161, 146)">Java Stream</a><a href="/tags/mark-word/" style="font-size: 1.15em; color: rgb(92, 198, 29)">Mark Word</a><a href="/tags/monitor/" style="font-size: 1.15em; color: rgb(22, 119, 159)">Monitor</a><a href="/tags/context-switch/" style="font-size: 1.15em; color: rgb(84, 167, 161)">Context Switch</a><a href="/tags/thread-pool/" style="font-size: 1.15em; color: rgb(70, 9, 3)">Thread Pool</a><a href="/tags/lambda/" style="font-size: 1.15em; color: rgb(172, 40, 79)">Lambda</a><a href="/tags/bytecode-manipulation/" style="font-size: 1.17em; color: rgb(0, 141, 28)">Bytecode Manipulation</a><a href="/tags/asm/" style="font-size: 1.15em; color: rgb(175, 60, 77)">ASM</a><a href="/tags/jol/" style="font-size: 1.17em; color: rgb(100, 186, 97)">JOL</a><a href="/tags/middleware/" style="font-size: 1.39em; color: rgb(38, 118, 48)">Middleware</a><a href="/tags/mq/" style="font-size: 1.39em; color: rgb(97, 78, 148)">MQ</a><a href="/tags/kafka/" style="font-size: 1.39em; color: rgb(144, 189, 190)">Kafka</a><a href="/tags/stream/" style="font-size: 1.39em; color: rgb(52, 25, 134)">Stream</a><a href="/tags/avro/" style="font-size: 1.18em; color: rgb(48, 45, 167)">Avro</a><a href="/tags/rebalance/" style="font-size: 1.17em; color: rgb(104, 8, 91)">Rebalance</a><a href="/tags/compression/" style="font-size: 1.15em; color: rgb(118, 62, 169)">Compression</a><a href="/tags/consumer-group/" style="font-size: 1.15em; color: rgb(83, 8, 142)">Consumer Group</a><a href="/tags/tcp/" style="font-size: 1.16em; color: rgb(70, 78, 58)">TCP</a><a href="/tags/idempotence/" style="font-size: 1.15em; color: rgb(16, 29, 17)">Idempotence</a><a href="/tags/producer/" style="font-size: 1.15em; color: rgb(182, 176, 143)">Producer</a><a href="/tags/load-balance/" style="font-size: 1.15em; color: rgb(159, 156, 178)">Load Balance</a><a href="/tags/distributed-architecture/" style="font-size: 1.15em; color: rgb(90, 172, 169)">Distributed Architecture</a><a href="/tags/distributed-design-pattern/" style="font-size: 1.17em; color: rgb(166, 125, 77)">Distributed Design Pattern</a><a href="/tags/career/" style="font-size: 1.15em; color: rgb(112, 12, 177)">Career</a><a href="/tags/linux-performance/" style="font-size: 1.17em; color: rgb(75, 59, 86)">Linux Performance</a><a href="/tags/linux-practice/" style="font-size: 1.24em; color: rgb(171, 152, 113)">Linux Practice</a><a href="/tags/ext4/" style="font-size: 1.15em; color: rgb(152, 184, 10)">ext4</a><a href="/tags/file-system/" style="font-size: 1.15em; color: rgb(115, 192, 154)">File System</a><a href="/tags/ai/" style="font-size: 1.35em; color: rgb(30, 127, 109)">AI</a><a href="/tags/llm/" style="font-size: 1.35em; color: rgb(148, 122, 61)">LLM</a><a href="/tags/nlp/" style="font-size: 1.25em; color: rgb(63, 16, 158)">NLP</a><a href="/tags/python/" style="font-size: 1.3em; color: rgb(38, 77, 20)">Python</a><a href="/tags/fastapi/" style="font-size: 1.15em; color: rgb(189, 156, 86)">FastAPI</a><a href="/tags/uvicorn/" style="font-size: 1.15em; color: rgb(155, 75, 171)">Uvicorn</a><a href="/tags/chatgpt/" style="font-size: 1.15em; color: rgb(105, 34, 51)">ChatGPT</a><a href="/tags/machine-learning/" style="font-size: 1.17em; color: rgb(46, 168, 139)">Machine Learning</a><a href="/tags/rnn/" style="font-size: 1.15em; color: rgb(164, 191, 65)">RNN</a><a href="/tags/seq2seq/" style="font-size: 1.16em; color: rgb(177, 20, 161)">Seq2Seq</a><a href="/tags/langchain/" style="font-size: 1.19em; color: rgb(106, 196, 56)">LangChain</a><a href="/tags/ai-agent/" style="font-size: 1.18em; color: rgb(139, 21, 45)">AI Agent</a><a href="/tags/rag/" style="font-size: 1.29em; color: rgb(149, 31, 180)">RAG</a><a href="/tags/word2vec/" style="font-size: 1.15em; color: rgb(138, 15, 120)">Word2Vec</a><a href="/tags/lora/" style="font-size: 1.15em; color: rgb(46, 108, 0)">LoRA</a><a href="/tags/peft/" style="font-size: 1.15em; color: rgb(45, 32, 111)">PEFT</a><a href="/tags/faiss/" style="font-size: 1.15em; color: rgb(137, 129, 48)">Faiss</a><a href="/tags/math/" style="font-size: 1.16em; color: rgb(139, 75, 174)">Math</a><a href="/tags/microservices-governance/" style="font-size: 1.22em; color: rgb(140, 64, 192)">Microservices Governance</a><a href="/tags/config/" style="font-size: 1.17em; color: rgb(191, 91, 199)">Config</a><a href="/tags/configuration-center/" style="font-size: 1.17em; color: rgb(6, 101, 159)">Configuration Center</a><a href="/tags/apollo/" style="font-size: 1.17em; color: rgb(58, 157, 9)">Apollo</a><a href="/tags/oauth2/" style="font-size: 1.2em; color: rgb(67, 14, 156)">Oauth2</a><a href="/tags/spring-security/" style="font-size: 1.19em; color: rgb(183, 123, 95)">Spring Security</a><a href="/tags/spring-security-oauth2/" style="font-size: 1.19em; color: rgb(88, 50, 162)">Spring Security OAuth2</a><a href="/tags/chatops/" style="font-size: 1.15em; color: rgb(170, 174, 7)">ChatOps</a><a href="/tags/chatbot/" style="font-size: 1.15em; color: rgb(124, 75, 154)">Chatbot</a><a href="/tags/rerank/" style="font-size: 1.15em; color: rgb(176, 66, 159)">Rerank</a><a href="/tags/kg-rag/" style="font-size: 1.15em; color: rgb(93, 64, 172)">KG-RAG</a><a href="/tags/graphrag/" style="font-size: 1.15em; color: rgb(155, 92, 4)">GraphRAG</a><a href="/tags/prompting/" style="font-size: 1.15em; color: rgb(15, 1, 180)">Prompting</a><a href="/tags/vim/" style="font-size: 1.2em; color: rgb(15, 52, 195)">Vim</a><a href="/tags/vector/" style="font-size: 1.16em; color: rgb(72, 80, 8)">Vector</a><a href="/tags/web/" style="font-size: 1.21em; color: rgb(51, 100, 183)">Web</a><a href="/tags/javascript/" style="font-size: 1.19em; color: rgb(200, 21, 25)">JavaScript</a><a href="/tags/zookeeper/" style="font-size: 1.16em; color: rgb(171, 9, 19)">Zookeeper</a><a href="/tags/distributed-lock/" style="font-size: 1.15em; color: rgb(60, 43, 180)">Distributed Lock</a><a href="/tags/istio/" style="font-size: 1.17em; color: rgb(17, 193, 169)">Istio</a><a href="/tags/jwt/" style="font-size: 1.15em; color: rgb(44, 156, 62)">JWT</a><a href="/tags/bio/" style="font-size: 1.15em; color: rgb(74, 2, 14)">BIO</a><a href="/tags/tomcat/" style="font-size: 1.15em; color: rgb(149, 59, 132)">Tomcat</a><a href="/tags/select/" style="font-size: 1.15em; color: rgb(5, 42, 110)">Select</a><a href="/tags/poll/" style="font-size: 1.15em; color: rgb(40, 51, 155)">Poll</a><a href="/tags/zero-copy/" style="font-size: 1.15em; color: rgb(52, 166, 111)">Zero Copy</a><a href="/tags/mmap/" style="font-size: 1.15em; color: rgb(54, 186, 129)">mmap</a><a href="/tags/reactor/" style="font-size: 1.15em; color: rgb(161, 126, 183)">Reactor</a><a href="/tags/transformer/" style="font-size: 1.16em; color: rgb(45, 180, 147)">Transformer</a><a href="/tags/svm/" style="font-size: 1.15em; color: rgb(81, 122, 101)">SVM</a><a href="/tags/attention/" style="font-size: 1.15em; color: rgb(193, 156, 34)">Attention</a><a href="/tags/zab/" style="font-size: 1.15em; color: rgb(180, 136, 61)">ZAB</a><a href="/tags/etcd/" style="font-size: 1.15em; color: rgb(84, 127, 105)">etcd</a><a href="/tags/raft/" style="font-size: 1.15em; color: rgb(161, 52, 119)">raft</a><a href="/tags/iac/" style="font-size: 1.15em; color: rgb(37, 4, 187)">IaC</a><a href="/tags/terraform/" style="font-size: 1.15em; color: rgb(125, 36, 120)">Terraform</a><a href="/tags/crossplane/" style="font-size: 1.15em; color: rgb(155, 109, 25)">Crossplane</a><a href="/tags/pulumi/" style="font-size: 1.15em; color: rgb(15, 140, 78)">Pulumi</a><a href="/tags/argo-cd/" style="font-size: 1.15em; color: rgb(62, 122, 38)">Argo CD</a><a href="/tags/vpc/" style="font-size: 1.15em; color: rgb(107, 136, 63)">VPC</a><a href="/tags/helm/" style="font-size: 1.15em; color: rgb(162, 160, 93)">Helm</a><a href="/tags/runc/" style="font-size: 1.15em; color: rgb(129, 192, 26)">runc</a><a href="/tags/kustomize/" style="font-size: 1.15em; color: rgb(128, 30, 175)">Kustomize</a><a href="/tags/oci/" style="font-size: 1.15em; color: rgb(107, 146, 29)">OCI</a><a href="/tags/buildkit/" style="font-size: 1.15em; color: rgb(90, 123, 50)">BuildKit</a><a href="/tags/crane/" style="font-size: 1.15em; color: rgb(96, 101, 140)">crane</a><a href="/tags/oci-image/" style="font-size: 1.15em; color: rgb(34, 78, 136)">OCI Image</a><a href="/tags/oci-runtime/" style="font-size: 1.15em; color: rgb(150, 6, 108)">OCI Runtime</a><a href="/tags/linux-namespace/" style="font-size: 1.15em; color: rgb(175, 169, 114)">Linux Namespace</a><a href="/tags/linux-cgroup/" style="font-size: 1.15em; color: rgb(115, 124, 75)">Linux CGroup</a><a href="/tags/k8s-manifest/" style="font-size: 1.15em; color: rgb(118, 157, 106)">K8S Manifest</a><a href="/tags/performance-tuning/" style="font-size: 1.15em; color: rgb(168, 30, 3)">Performance Tuning</a><a href="/tags/api-gateway/" style="font-size: 1.15em; color: rgb(25, 71, 195)">API Gateway</a><a href="/tags/apisix/" style="font-size: 1.15em; color: rgb(130, 85, 26)">APISIX</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">September 2024</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><span class="card-archive-list-count">31</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">May 2023</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">February 2023</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">January 2023</span><span class="card-archive-list-count">31</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">580</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2015-06-30T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">1107.9k</div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-11-15T08:02:39.579Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2024 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["Stay hungry, stay foolish."])
  } else {
    document.getElementById("subtitle").innerHTML = 'Stay hungry, stay foolish.'
  }
}
typedJSFn.run(subtitleType)</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>