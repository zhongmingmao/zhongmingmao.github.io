<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>RAG - Vector Stores | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Embedding Vector Store概述 在 AI 时代，文字、图像、语音、视频等多模态数据的复杂性显著增加 多模态数据具有非结构化和多维特征 向量表示能够有效表示语义和捕捉潜在的语义关系 促使向量数据库成为存储、检索和分析高维向量的关键工具     Qdrant &#x2F; Milvus   优势  SQL vs NoSQL   传统数据库通常分为关系型（SQL）数据库和非关系型（No">
<meta property="og:type" content="article">
<meta property="og:title" content="RAG - Vector Stores">
<meta property="og:url" content="https://blog.zhongmingmao.top/2024/08/12/rag-vector-stores/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Embedding Vector Store概述 在 AI 时代，文字、图像、语音、视频等多模态数据的复杂性显著增加 多模态数据具有非结构化和多维特征 向量表示能够有效表示语义和捕捉潜在的语义关系 促使向量数据库成为存储、检索和分析高维向量的关键工具     Qdrant &#x2F; Milvus   优势  SQL vs NoSQL   传统数据库通常分为关系型（SQL）数据库和非关系型（No">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp">
<meta property="article:published_time" content="2024-08-11T16:06:25.000Z">
<meta property="article:modified_time" content="2024-10-17T13:53:42.010Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="RAG">
<meta property="article:tag" content="Vector">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RAG - Vector Stores",
  "url": "https://blog.zhongmingmao.top/2024/08/12/rag-vector-stores/",
  "image": "https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp",
  "datePublished": "2024-08-11T16:06:25.000Z",
  "dateModified": "2024-10-17T13:53:42.010Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2024/08/12/rag-vector-stores/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RAG - Vector Stores',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">RAG - Vector Stores</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">RAG - Vector Stores</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-08-11T16:06:25.000Z" title="Created 2024-08-12 00:06:25">2024-08-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ai/">AI</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ai/rag/">RAG</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>7mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2024-10-17 21:53:42&quot;}" hidden></div><h1 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016102402609.png" alt="image-20241016102402609"></p>
<h1 id="Vector-Store"><a href="#Vector-Store" class="headerlink" title="Vector Store"></a>Vector Store</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ol>
<li>在 AI 时代，<strong>文字</strong>、<strong>图像</strong>、<strong>语音</strong>、<strong>视频</strong>等<strong>多模态</strong>数据的<strong>复杂性</strong>显著增加</li>
<li>多模态数据具有<strong>非结构化</strong>和<strong>多维</strong>特征<ul>
<li><strong>向量</strong>表示能够有效表示语义和<strong>捕捉潜在的语义关系</strong></li>
<li>促使<strong>向量数据库</strong>成为存储、检索和分析<strong>高维向量</strong>的关键工具</li>
</ul>
</li>
</ol>
<blockquote>
<p>Qdrant &#x2F; Milvus</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016105046214.png" alt="image-20241016105046214"></p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016105836730.png" alt="image-20241016105836730"></p>
<blockquote>
<p>SQL vs NoSQL</p>
</blockquote>
<ol>
<li>传统数据库通常分为关系型（<strong>SQL</strong>）数据库和非关系型（<strong>NoSQL</strong>）数据库</li>
<li>存储<strong>复杂</strong>、<strong>非结构化</strong>或<strong>半结构化</strong>信息的需求，主要依赖于 <strong>NoSQL</strong> 的能力</li>
</ol>
<table>
<thead>
<tr>
<th>Store</th>
<th>Desc</th>
<th>Note</th>
</tr>
</thead>
<tbody><tr>
<td>Key-Value</td>
<td>用于简单的数据存储，通过 Key 来快速访问数据</td>
<td>精准定位信息</td>
</tr>
<tr>
<td>Document</td>
<td>用于存储<strong>文档结构</strong>的数据，如 <strong>JSON</strong> 格式</td>
<td>复杂的<strong>结构化</strong>信息</td>
</tr>
<tr>
<td>Graph</td>
<td>用于表示和存储复杂的<strong>关系</strong>数据，常用于<strong>社交网络</strong>、<strong>推荐</strong>等场景</td>
<td>复杂的<strong>关系</strong>数据</td>
</tr>
<tr>
<td>Vector</td>
<td>用于存储和检索基于<strong>向量</strong>表示的数据，用于 <strong>AI 模型</strong>的高维度和复杂的<strong>嵌入向量</strong></td>
<td><strong>语义</strong>最相关的数据</td>
</tr>
</tbody></table>
<ol>
<li>向量数据库的核心在于能够基于向量之间的<strong>相似性</strong>，能够<strong>快速</strong>、<strong>精确</strong>地<strong>定位</strong>和<strong>检索</strong>数据</li>
<li>向量数据库不仅为<strong>嵌入向量</strong>提供了优化的<strong>存储</strong>和<strong>查询</strong>性能<ul>
<li>同时也继承了<strong>传统数据库</strong>的诸多优势 - <strong>性能</strong>、<strong>可扩展性</strong>、<strong>灵活性</strong> - 充分利用<strong>大规模数据</strong></li>
</ul>
</li>
<li>传统的基于<strong>标量</strong>的数据库<ul>
<li>无法应对<strong>数据复杂性</strong>和<strong>规模化处理</strong>的挑战，难以有效<strong>提取洞察</strong>并实现<strong>实时分析</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>主要优势</p>
</blockquote>
<ol>
<li>数据管理<ul>
<li>向量数据库提供易于使用的<strong>数据存储</strong>功能 - 插入 + 删除 + 更新</li>
<li><strong>Faiss</strong> 是独立的<strong>向量索引工具</strong>，需要<strong>额外的工作</strong>才能与<strong>存储解决方案</strong>集成</li>
</ul>
</li>
<li>元数据存储和筛选<ul>
<li>向量数据库能够存储与<strong>每个向量</strong>条目<strong>关联</strong>的元数据</li>
<li>基于元数据，可以进行<strong>更细粒度</strong>的查询，从而提升查询的<strong>精确度</strong>和<strong>灵活性</strong></li>
</ul>
</li>
<li>可扩展性<ul>
<li>向量数据库支持<strong>分布式</strong>和<strong>并行</strong>处理</li>
<li>并通过<strong>无服务器架构</strong>优化大规模场景下<strong>成本</strong></li>
</ul>
</li>
<li>实时更新<ul>
<li>向量数据库支持<strong>实时数据更新</strong></li>
<li>允许<strong>动态修改</strong>数据以确保检索结果的<strong>时效性</strong>和<strong>准确性</strong></li>
</ul>
</li>
<li>备份与恢复<ul>
<li>向量数据库具备<strong>完善</strong>的备份机制，确保数据的<strong>安全性</strong>和<strong>持久性</strong></li>
</ul>
</li>
<li>生态系统集成<ul>
<li>向量数据库能够与<strong>数据处理</strong>生态系统中的其它组件轻松集成 - <strong>Spark</strong></li>
<li>还能无缝集成 AI 相关工具 - LangChain &#x2F; LlamaIndex &#x2F; Cohere</li>
</ul>
</li>
<li>数据安全与访问控制<ul>
<li>向量数据库提供内置的<strong>数据安全功能</strong>和<strong>访问控制机制</strong>，以保护<strong>敏感</strong>信息</li>
<li>通过<strong>命名空间</strong>实现<strong>多租户</strong>管理，允许对<strong>索引</strong>进行完全<strong>分区</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>应用场景</p>
</blockquote>
<ol>
<li>向量数据库广泛应用于 LLM RAG 系统、推荐系统等多种 AI 产品中</li>
<li>向量数据库是一类专门为<strong>生产</strong>场景下的<strong>嵌入向量</strong>管理而构建的数据库<ul>
<li>与传统基于<strong>标量</strong>的数据库以及独立的<strong>向量索引工具</strong>相比</li>
<li>向量数据库在<strong>性能</strong>、<strong>可扩展性</strong>、<strong>安全性</strong>和<strong>生态系统集成</strong>等方面展现了显著的优势</li>
</ul>
</li>
</ol>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ol>
<li>向量数据库是一种专门用于存储和检索<strong>多维向量</strong>的数据库类型<ul>
<li>与传统的基于<strong>行列结构</strong>的数据库不同，向量数据库主要处理<strong>高维空间</strong>中的<strong>数据点</strong></li>
<li>传统数据库通常处理<strong>字符串</strong>、<strong>数字</strong>等<strong>标量</strong>，并通过<strong>精确匹配</strong>来查询数据</li>
<li>向量数据库的操作逻辑是基于<strong>相似性搜索</strong><ul>
<li>在查询时，应用特定的<strong>相似性度量</strong>（余弦相似度、欧几里得距离等）来查找与<strong>查询向量</strong>最<strong>相似</strong>的向量</li>
</ul>
</li>
</ul>
</li>
<li>向量数据库的核心在于其高效的<strong>索引</strong>和<strong>搜索</strong>机制<ul>
<li>为了优化<strong>查询性能</strong>，采用<strong>哈希</strong>（LSH）、<strong>量化</strong>（PQ）和<strong>基于图形</strong>（HNSW）的多种算法</li>
<li>构建层次化可导航小世界（<strong>HNSW</strong>）、产品量化（<strong>PQ</strong>）和位置敏感哈希（<strong>LSH</strong>）等<strong>索引结构</strong>，提升<strong>查询性能</strong></li>
<li>搜索过程并非追求<strong>绝对精确</strong><ul>
<li>通过近似最近邻算法（<strong>ANN</strong>）在<strong>速度</strong>和<strong>准确性</strong>之间进行<strong>权衡</strong></li>
<li><strong>ANN</strong> 算法允许一定程度的<strong>误差</strong> - 显著<strong>提升搜索速度</strong> + 找到与查询<strong>相似度较高</strong>的向量</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>向量数据库的<strong>索引结构</strong>相当于一种<strong>预处理</strong>步骤</p>
</blockquote>
<table>
<thead>
<tr>
<th>Index structure</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>HNSW</td>
<td>通过在<strong>多层</strong>结构中将<strong>相似向量</strong>连接在一起，快速<strong>缩小搜索范围</strong></td>
</tr>
<tr>
<td>PQ</td>
<td>通过<strong>压缩</strong>高维向量，<strong>减少内存占用</strong>并<strong>加速检索</strong></td>
</tr>
<tr>
<td>LSH</td>
<td>通过<strong>哈希函数</strong>将<strong>相似向量</strong>聚集在一起，便于<strong>快速定位</strong></td>
</tr>
</tbody></table>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016170031508.png" alt="image-20241016170031508"></p>
<ol>
<li>数据处理 + 向量化<ul>
<li>原始数据首先被处理并转化为<strong>嵌入向量</strong></li>
<li>通过<strong>嵌入模型</strong>实现，利用<strong>深度学习</strong>算法提取数据的<strong>语义特征</strong>，生成适合后续处理的<strong>高维向量</strong>表示</li>
</ul>
</li>
<li>向量存储<ul>
<li>将转化后的<strong>嵌入向量</strong>存储到<strong>向量数据库</strong>中</li>
<li>数据<strong>高效检索</strong> + 以优化的方式管理和维护<strong>存储资源</strong>（适应不同<strong>规模</strong>和<strong>复杂度</strong>的应用需求）</li>
</ul>
</li>
<li>向量索引<ul>
<li>存储的<strong>嵌入向量</strong>经过<strong>索引处理</strong>，便于在后续<strong>查询</strong>中<strong>快速定位</strong>相关数据</li>
<li>索引过程通过构建<strong>特定结构</strong>，使得数据库能够在<strong>大规模数据集</strong>上实现<strong>高效的查询响应</strong></li>
</ul>
</li>
<li>向量搜索<ul>
<li>在收到<strong>查询向量</strong>后，向量数据库通过已建立的<strong>索引结构</strong>执行<strong>相似性搜索</strong> - 与查询向量<strong>最接近</strong>的<strong>数据点</strong></li>
<li>平衡<strong>搜索速度</strong>和<strong>准确性</strong> - 在<strong>大数据</strong>环境下提供<strong>快速</strong>且<strong>相关</strong>的查询结果</li>
<li>相似度度量<ul>
<li><strong>余弦相似度</strong> - 用于<strong>文件处理</strong>和<strong>信息检索</strong> - 关注向量之间的<strong>角度</strong>，捕捉<strong>语义相似性</strong></li>
<li><strong>欧几里得距离</strong> - 测量向量之间的<strong>实际距离</strong> - 适用于<strong>密集特征集</strong>的<strong>聚类</strong>和<strong>分类</strong></li>
<li><strong>曼哈顿距离</strong> - 计算笛卡尔坐标中<strong>绝对差值之和</strong>，适用于<strong>稀疏</strong>数据的处理</li>
<li><strong>点积</strong></li>
</ul>
</li>
</ul>
</li>
<li>数据检索<ul>
<li>向量数据库从匹配的向量中检索出<strong>对应</strong>的<strong>原始数据</strong>，并按需处理</li>
<li>确保最终结果能够准确反映用户的<strong>查询意图</strong>，并提供有意义的输出</li>
</ul>
</li>
</ol>
<h2 id="RAG"><a href="#RAG" class="headerlink" title="RAG"></a>RAG</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016175937752.png" alt="image-20241016175937752"></p>
<ol>
<li>在 RAG 系统中，向量数据库的主要功能在于<strong>索引过程</strong>中，建立高效的<strong>向量索引结构</strong></li>
<li>在<strong>查询</strong>阶段，系统将输入的提示转化为<strong>向量</strong>表示形式<ul>
<li>从向量数据库中检索出与之<strong>最相关</strong>的<strong>向量</strong>及其对应的<strong>分块</strong>数据</li>
</ul>
</li>
<li>通过索引和检索，检索到的向量为 LLM 提供了必要的<strong>上下文</strong>信息<ul>
<li>LLM 能够依据当前的语义上下文生成更加<strong>精确</strong>和相关的响应</li>
</ul>
</li>
</ol>
<h2 id="选型"><a href="#选型" class="headerlink" title="选型"></a>选型</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016181814194.png" alt="image-20241016181814194"></p>
<table>
<thead>
<tr>
<th>场景</th>
<th>选型</th>
</tr>
</thead>
<tbody><tr>
<td>快速开发 + 轻量化部署</td>
<td>Chroma &#x2F; <strong>Qdrant</strong></td>
</tr>
<tr>
<td>高性能 + 可扩展性</td>
<td><strong>Milvus</strong> &#x2F; Zilliz</td>
</tr>
<tr>
<td>极致性能 + 无需持久化 + 无需数据管理</td>
<td>FAISS</td>
</tr>
<tr>
<td>多模态数据</td>
<td>Weaviate &#x2F; LanceDB</td>
</tr>
<tr>
<td>集成现有数据库</td>
<td>PGVector &#x2F; Elasticsearch &#x2F; Redis</td>
</tr>
<tr>
<td>全托管</td>
<td>Pinecone</td>
</tr>
</tbody></table>
<h1 id="Chroma"><a href="#Chroma" class="headerlink" title="Chroma"></a>Chroma</h1><ol>
<li>Chroma 是一种<strong>简单</strong>且易于<strong>持久化</strong>的向量数据库，以<strong>轻量级</strong>、<strong>开箱即用</strong>的特性著称</li>
<li>Chroma 支持<strong>内存</strong>中操作和<strong>磁盘持久化</strong>，能够高效地<strong>管理</strong>和<strong>查询</strong>向量数据，非常适合<strong>快速集成和开发</strong></li>
</ol>
<h2 id="Client-Collection"><a href="#Client-Collection" class="headerlink" title="Client + Collection"></a>Client + Collection</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建ChromaDB本地存储实例和collection</span></span><br><span class="line">client = chromadb.PersistentClient(chroma_db_path)</span><br><span class="line">collection = client.get_or_create_collection(name=<span class="string">&quot;documents&quot;</span>)</span><br><span class="line">embedding_model = load_embedding_model()</span><br></pre></td></tr></table></figure>

<h2 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">indexing_process</span>(<span class="params">folder_path, embedding_model, collection</span>):</span><br><span class="line">    all_chunks = []</span><br><span class="line">    all_ids = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder_path):</span><br><span class="line">        file_path = os.path.join(folder_path, filename)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(file_path):</span><br><span class="line">            document_text = load_document(file_path)</span><br><span class="line">            <span class="keyword">if</span> document_text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;filename&#125;</span> 的总字符数: <span class="subst">&#123;<span class="built_in">len</span>(document_text)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                text_splitter = RecursiveCharacterTextSplitter(chunk_size=<span class="number">512</span>, chunk_overlap=<span class="number">128</span>)</span><br><span class="line">                chunks = text_splitter.split_text(document_text)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;filename&#125;</span> 分割的文本Chunk数量: <span class="subst">&#123;<span class="built_in">len</span>(chunks)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                all_chunks.extend(chunks)</span><br><span class="line">                <span class="comment"># 生成每个文本块对应的唯一ID</span></span><br><span class="line">                all_ids.extend([<span class="built_in">str</span>(uuid.uuid4()) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chunks))])</span><br><span class="line"></span><br><span class="line">    embeddings = [embedding_model.encode(chunk, normalize_embeddings=<span class="literal">True</span>).tolist() <span class="keyword">for</span> chunk <span class="keyword">in</span> all_chunks]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将文本块的ID、嵌入向量和原始文本块内容添加到ChromaDB的collection中</span></span><br><span class="line">    collection.add(ids=all_ids, embeddings=embeddings, documents=all_chunks)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;嵌入生成完成，向量数据库存储完成.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;索引过程完成.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;********************************************************&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Retrieval"><a href="#Retrieval" class="headerlink" title="Retrieval"></a>Retrieval</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">retrieval_process</span>(<span class="params">query, collection, embedding_model=<span class="literal">None</span>, top_k=<span class="number">6</span></span>):</span><br><span class="line">    query_embedding = embedding_model.encode(query, normalize_embeddings=<span class="literal">True</span>).tolist()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用向量数据库检索与query最相似的top_k个文本块</span></span><br><span class="line">    results = collection.query(query_embeddings=[query_embedding], n_results=top_k)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;查询语句: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;最相似的前<span class="subst">&#123;top_k&#125;</span>个文本块:&quot;</span>)</span><br><span class="line"></span><br><span class="line">    retrieved_chunks = []</span><br><span class="line">    <span class="comment"># 打印检索到的文本块ID、相似度和文本块信息</span></span><br><span class="line">    <span class="keyword">for</span> doc_id, doc, score <span class="keyword">in</span> <span class="built_in">zip</span>(results[<span class="string">&#x27;ids&#x27;</span>][<span class="number">0</span>], results[<span class="string">&#x27;documents&#x27;</span>][<span class="number">0</span>], results[<span class="string">&#x27;distances&#x27;</span>][<span class="number">0</span>]):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文本块ID: <span class="subst">&#123;doc_id&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;相似度: <span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文本块信息:\n<span class="subst">&#123;doc&#125;</span>\n&quot;</span>)</span><br><span class="line">        retrieved_chunks.append(doc)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;检索过程完成.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;********************************************************&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> retrieved_chunks</span><br></pre></td></tr></table></figure>

<h2 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241016223236449.png" alt="image-20241016223236449"></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2024/08/12/rag-vector-stores/">https://blog.zhongmingmao.top/2024/08/12/rag-vector-stores/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ai/">AI</a><a class="post-meta__tags" href="/tags/llm/">LLM</a><a class="post-meta__tags" href="/tags/rag/">RAG</a><a class="post-meta__tags" href="/tags/vector/">Vector</a></div><div class="post-share"><div class="social-share" data-image="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/08/13/rag-hybrid-retrieval-rerank/" title="RAG - Hybrid retrieval + Rerank"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-rerank-9097303.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">RAG - Hybrid retrieval + Rerank</div></div><div class="info-2"><div class="info-item-1">向量检索 当前主流的 RAG 检索方式主要采用向量检索，通过语义相似度来匹配 Chunk 向量检索并非万能，在某些场景下无法替代传统关键词检索的优势 当需要精准搜索的时候，向量检索的准确性就往往不如关键词检索 当用户输入的问题非常简短，语义匹配的效果可能不尽理想   关键词检索的适用场景 精确匹配 少量字符的匹配 - 不适合用向量检索 低频词汇的匹配       混合检索 结合关键词检索和语义匹配的优势   在 RAG 检索场景中，首要目标是确保最相关的结果能够出现在候选列表中 向量检索和关键词检索各具优势，混合检索通过结合多种检索技术，弥补各自不足，提供一种更加全面的搜索方案 重排序技术在检索系统中扮演着至关重要的角色 即使检索算法已经能够捕捉到所有相关的结果，重排序过程依然不可或缺 确保最符合用户意图和查询语义的结果优先展示，提升用户的搜索体验和结果的准确性     在多个数据集和多个检索任务中，混合检索和重排序的组合均取得了最佳表现     融合检索 &#x2F; 多路召回    https://python.langchain.com/v0.2/api_reference/community/r...</div></div></div></a><a class="pagination-related" href="/2024/08/11/rag-kg-rag/" title="RAG - KG-RAG"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/kg_rag.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">RAG - KG-RAG</div></div><div class="info-2"><div class="info-item-1">Knowledge Graph 知识图谱也称为语义网络，表示现实世界实体的网络，并说明它们之间的关系 信息通常存储在图形数据库中，并以图形结构直观呈现 知识图谱由三部分组成 - 节点 + 边 + 标签     Why 降噪 + 提召 + 提准   传统 RAG 中的 Chunking 方式会召回一些噪音的 Chunk 引入 KG，可以通过实体层级特征来增强相关性   传统 RAG 中的 Chunk 之间是彼此孤立的，缺乏关联，在跨文档回答任务上表现不太好 引入 KG，增强 Chunk 之间的关联，并提升召回的相关性   假设已有 KG 数据存在，可以将 KG 作为一路召回信息源，补充上下文信息 Chunk 之间形成的 KG，可以提供 Graph 视角的 Embedding，来补充召回特征   构建一个高质量、灵活更新、计算简单的大规模图谱的代价很高 - RAG 会很慢   https://hub.baai.ac.cn/view/30017 https://hub.baai.ac.cn/view/33147 https://hub.baai.ac.cn/view/33390 https://hub.baa...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/qdrant.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-09</div><div class="info-item-2">RAG - Qdrant</div></div><div class="info-2"><div class="info-item-1">Features   Getting StartedIntroduction Vector databases are a relatively new way for interacting with abstract data representations derived from opaque machine learning models such as deep learning architectures. These representations are often called vectors or embeddings and they are a compressed version of the data used to train a machine learning model to accomplish a task like sentiment analysis, speech recognition, object detection, and many others.  What is Qdrant? Qdrant “is a vector similarity s...</div></div></div></a><a class="pagination-related" href="/2024/08/17/rag-graphrag/" title="RAG - GraphRAG"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/graphrag-9781829.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-17</div><div class="info-item-2">RAG - GraphRAG</div></div><div class="info-2"><div class="info-item-1">向量检索 信息片段之间的连接能力有限   RAG 在跨越多个信息片段以获取综合见解时表现不足 当要回答一个复杂问题时，必须要通过共享属性在不同信息之间建立联系 RAG 无法有效捕捉这些关系 限制了 RAG 在处理需要多跳推理或整合多源数据的复杂查询时的能力       归纳总结能力不足   在处理大型数据集或长文档时，RAG 难以有效地归纳和总结复杂的语义概念 RAG 在需要全面理解和总结复杂语义信息的场景中表现不佳  GraphRAG 利用 LLM 生成的知识图谱来改进 RAG 的检索部分   GraphRAG 利用结构化的实体和关系信息，使得检索过程更加精准和全面 GraphRAG 在处理多跳问题和复杂文档分析时表现出色 GraphRAG 在处理复杂信息处理任务时，显著提升问答性能，提供比 RAG 更为准确和全面的答案 GraphRAG 通过知识图谱有效地连接不同的信息片段 不仅能够提供准确答案，还能展示答案之间的内在联系，提供更丰富和有价值的结果     GraphRAG 先利用知识图谱，关联查询的实体和关系从与知识图谱实体直接相关的文档中检索片段，提供一个更全面、指标化、高信息密度的总结   主...</div></div></div></a><a class="pagination-related" href="/2024/08/16/rag-evolution/" title="RAG - Evolution"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-16</div><div class="info-item-2">RAG - Evolution</div></div><div class="info-2"><div class="info-item-1">演进    Naive RAG -&gt; Advanced RAG -&gt; Modular RAG 三个范式之间具有继承与发展的关系 Advanced RAG 是 Modular RAG 的一种特例形式 Naive RAG 是 Advanced RAG 的基础特例   RAG 技术不断演进，以适应更复杂的任务和场景需求  Naive RAG Naive RAG 是最基础的形式，依赖核心的索引和检索策略来增强生成模型的输出 Naive RAG 适用于一些基础任务和产品 MVP 阶段  Advanced RAG 通过增加检索前、检索中以及检索后的优化策略，提高检索的准确性和生成的关联性 - 适用于复杂任务    Advanced RAG 通过优化检索前、检索中、检索后的各个环节 在索引质量、检索效果以及生成内容的上下文相关性方面都取得显著提升  检索前 通过索引、分块、查询优化和内容向量化等技术手段，提高检索内容的精确性和生成内容的相关性  滑动窗口 overlap   经典的 Chunking 技术，通过在相邻的 Chunk 之间创建重叠区域，确保关键信息不会因简单的 Chunking 而丢失 在 ...</div></div></div></a><a class="pagination-related" href="/2024/08/15/rag-optimization-evaluation/" title="RAG - Optimization + Evaluation"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evaluation.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-15</div><div class="info-item-2">RAG - Optimization + Evaluation</div></div><div class="info-2"><div class="info-item-1">RAG   检索优化数据清洗和预处理 在 RAG 索引流程中，文档解析之后，文档切块之前，进行数据清洗和预处理 减少脏数据和噪音，提升文本的整体质量和信息密度   手段：清除冗余信息、统一格式、处理异常字符等 处理冗余的模板内容 消除文档中的额外空白和格式不一致 去除文档脚注、页眉页脚、版权信息    查询扩写 在 RAG 系统的检索步骤中，用户的查询会转换为向量后进行检索 单个向量查询只能覆盖向量空间中一个有限区域 如果查询中的嵌入向量未能包含所有关键信息，则可能检索到不相关的 Chunk 单点查询的局限性 - 限制系统在庞大文档库中的搜索范围，导致错失与查询语义相关的内容   查询扩写 通过 LLM 从原始查询语句生成多个语义相关的查询，可以覆盖向量空间中的不同区域 提高检索的全面性和准确性 扩写后的查询在被嵌入后，能够击中不同的语义区域 确保系统能够从更广泛的文档中检索到与用户需求相关的有用信息     通过查询扩写，原始问题被分解为多个子查询 每个子查询独立检索相关文档并生成相应的结果 系统将所有子查询的检索结果进行合并和重新排序   能够有效扩展用户的查询意图，确保在复杂信息库中进行更全面的文...</div></div></div></a><a class="pagination-related" href="/2024/08/14/rag-llm-prompt-engineering/" title="RAG - LLM + Prompt Engineering"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/llm-prompting.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-14</div><div class="info-item-2">RAG - LLM + Prompt Engineering</div></div><div class="info-2"><div class="info-item-1">RAG 生成流程    经过 RAG 索引流程（外部知识的解析和向量化）和 RAG 检索流程（语义相似性的匹配及混合检索），进入到 RAG 生成流程 在 RAG 生成流程中，需要组合指令，即携带查询问题及检索到的相关信息输入的 LLM，由 LLM 理解并生成最终的回复 RAG 的本质是通过 LLM 提供外部知识来增强其理解和回答领域问题的能力 LLM 在 RAG 系统中起到了大脑的作用 在面对复杂且多样化的 RAG 任务时，LLM 的性能直接决定了系统的整体效果   提示词工程是生成流程中的另一个关键环节 通过有效的指令的设计和组合，可以帮助 LLM 更好地理解输入内容，从而生成更加精确和相关的回答 精心设计的问题提示词，往往能提升生成效果    LLM发展  RAG 目前更关注通用大模型   原理 Google 于 2017 年发布论文 Attention Is All You Need，引入了 Transformer 模型 Transformer 模型是深度学习领域的一个突破性架构，LLM 的成功得益于对 Transformer 模型的应用 与传统的 RNN（循环神经网络） 相比，Transform...</div></div></div></a><a class="pagination-related" href="/2024/08/13/rag-hybrid-retrieval-rerank/" title="RAG - Hybrid retrieval + Rerank"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-rerank-9097303.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-13</div><div class="info-item-2">RAG - Hybrid retrieval + Rerank</div></div><div class="info-2"><div class="info-item-1">向量检索 当前主流的 RAG 检索方式主要采用向量检索，通过语义相似度来匹配 Chunk 向量检索并非万能，在某些场景下无法替代传统关键词检索的优势 当需要精准搜索的时候，向量检索的准确性就往往不如关键词检索 当用户输入的问题非常简短，语义匹配的效果可能不尽理想   关键词检索的适用场景 精确匹配 少量字符的匹配 - 不适合用向量检索 低频词汇的匹配       混合检索 结合关键词检索和语义匹配的优势   在 RAG 检索场景中，首要目标是确保最相关的结果能够出现在候选列表中 向量检索和关键词检索各具优势，混合检索通过结合多种检索技术，弥补各自不足，提供一种更加全面的搜索方案 重排序技术在检索系统中扮演着至关重要的角色 即使检索算法已经能够捕捉到所有相关的结果，重排序过程依然不可或缺 确保最符合用户意图和查询语义的结果优先展示，提升用户的搜索体验和结果的准确性     在多个数据集和多个检索任务中，混合检索和重排序的组合均取得了最佳表现     融合检索 &#x2F; 多路召回    https://python.langchain.com/v0.2/api_reference/community/r...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Embedding"><span class="toc-number">1.</span> <span class="toc-text">Embedding</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vector-Store"><span class="toc-number">2.</span> <span class="toc-text">Vector Store</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">2.2.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text">流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG"><span class="toc-number">2.5.</span> <span class="toc-text">RAG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E5%9E%8B"><span class="toc-number">2.6.</span> <span class="toc-text">选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chroma"><span class="toc-number">3.</span> <span class="toc-text">Chroma</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-Collection"><span class="toc-number">3.1.</span> <span class="toc-text">Client + Collection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Indexing"><span class="toc-number">3.2.</span> <span class="toc-text">Indexing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Retrieval"><span class="toc-number">3.3.</span> <span class="toc-text">Retrieval</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Persistence"><span class="toc-number">3.4.</span> <span class="toc-text">Persistence</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>