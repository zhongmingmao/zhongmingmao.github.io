<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>RAG - Evolution | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="演进">
<meta property="og:type" content="article">
<meta property="og:title" content="RAG - Evolution">
<meta property="og:url" content="https://blog.zhongmingmao.top/2024/08/16/rag-evolution/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="演进">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp">
<meta property="article:published_time" content="2024-08-15T16:06:25.000Z">
<meta property="article:modified_time" content="2024-10-24T14:43:43.602Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="LLM">
<meta property="article:tag" content="RAG">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RAG - Evolution",
  "url": "https://blog.zhongmingmao.top/2024/08/16/rag-evolution/",
  "image": "https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp",
  "datePublished": "2024-08-15T16:06:25.000Z",
  "dateModified": "2024-10-24T14:43:43.602Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2024/08/16/rag-evolution/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RAG - Evolution',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">RAG - Evolution</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">RAG - Evolution</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-08-15T16:06:25.000Z" title="Created 2024-08-16 00:06:25">2024-08-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ai/">AI</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ai/rag/">RAG</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>7mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2024-10-24 22:43:43&quot;}" hidden></div><h1 id="演进"><a href="#演进" class="headerlink" title="演进"></a>演进</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241023221218155.png" alt="image-20241023221218155"></p>
<span id="more"></span>

<ol>
<li><strong>Naive</strong> RAG -&gt; <strong>Advanced</strong> RAG -&gt; <strong>Modular</strong> RAG</li>
<li>三个范式之间具有<strong>继承</strong>与<strong>发展</strong>的关系<ul>
<li><strong>Advanced</strong> RAG 是 <strong>Modular</strong> RAG 的一种<strong>特例</strong>形式</li>
<li><strong>Naive</strong> RAG 是 <strong>Advanced</strong> RAG 的<strong>基础</strong>特例</li>
</ul>
</li>
<li>RAG 技术<strong>不断演进</strong>，以适应<strong>更复杂</strong>的任务和场景需求</li>
</ol>
<h1 id="Naive-RAG"><a href="#Naive-RAG" class="headerlink" title="Naive RAG"></a>Naive RAG</h1><ol>
<li>Naive RAG 是<strong>最基础</strong>的形式，依赖核心的<strong>索引</strong>和<strong>检索</strong>策略来<strong>增强</strong>生成模型的输出</li>
<li>Naive RAG 适用于一些<strong>基础任务</strong>和<strong>产品 MVP 阶段</strong></li>
</ol>
<h1 id="Advanced-RAG"><a href="#Advanced-RAG" class="headerlink" title="Advanced RAG"></a>Advanced RAG</h1><blockquote>
<p>通过增加<strong>检索前</strong>、<strong>检索中</strong>以及<strong>检索后</strong>的优化策略，提高<strong>检索的准确性</strong>和<strong>生成的关联性</strong> - 适用于<strong>复杂</strong>任务</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241023222632284.png" alt="image-20241023222632284"></p>
<ol>
<li>Advanced RAG 通过优化<strong>检索前</strong>、<strong>检索中</strong>、<strong>检索后</strong>的各个环节</li>
<li>在<strong>索引质量</strong>、<strong>检索效果</strong>以及<strong>生成内容的上下文相关性</strong>方面都取得显著提升</li>
</ol>
<h2 id="检索前"><a href="#检索前" class="headerlink" title="检索前"></a>检索前</h2><blockquote>
<p>通过<strong>索引</strong>、<strong>分块</strong>、<strong>查询优化</strong>和<strong>内容向量化</strong>等技术手段，提高<strong>检索内容的精确性</strong>和<strong>生成内容的相关性</strong></p>
</blockquote>
<h3 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h3><blockquote>
<p>overlap</p>
</blockquote>
<ol>
<li>经典的 <strong>Chunking</strong> 技术，通过在<strong>相邻</strong>的 <strong>Chunk</strong> 之间创建<strong>重叠</strong>区域，确保<strong>关键信息</strong>不会因简单的 Chunking 而<strong>丢失</strong></li>
<li>在 <strong>Indexing</strong> 过程中，通过在 <strong>Chunk</strong> 之间保留<strong>重复</strong>部分<ul>
<li>保证了检索时<strong>上下文</strong>信息的<strong>连贯性</strong>，进而提高了检索的精度</li>
</ul>
</li>
</ol>
<h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><ol>
<li>为每个 <strong>Chunk</strong> 添加<strong>元数据</strong>，能够使系统在检索时<strong>快速过滤</strong>掉无关内容</li>
</ol>
<h3 id="分层索引"><a href="#分层索引" class="headerlink" title="分层索引"></a>分层索引</h3><ol>
<li>在 <strong>Indexing</strong> 过程中，可以采用<strong>句子级</strong>、<strong>段落级</strong>甚至<strong>文档级</strong>的<strong>多层次</strong>嵌入方法</li>
<li>系统可以根据查询的具体要求，<strong>灵活</strong>地在<strong>不同层次</strong>上进行检索<ul>
<li><strong>复杂</strong>的<strong>长句</strong>查询 - <strong>段落级别</strong>的嵌入能够提供<strong>更加全面的语义匹配</strong></li>
<li><strong>简短</strong>查询 - <strong>句子级</strong>的嵌入能够提供<strong>更加精确</strong>的结果</li>
</ul>
</li>
</ol>
<h3 id="句子窗口"><a href="#句子窗口" class="headerlink" title="句子窗口"></a>句子窗口</h3><ol>
<li>将文档中的<strong>每个句子</strong>独立嵌入，从而提高<strong>检索的精确度</strong></li>
<li>在检索过程中，系统找到<strong>与 Query 最相关</strong>的句子后，会<strong>扩展</strong>句子前后的<strong>上下文窗口</strong><ul>
<li>保证<strong>生成模型</strong>能够获取<strong>足够的背景信息</strong>进行<strong>推理</strong></li>
</ul>
</li>
<li>既能<strong>精准定位关键信息</strong>，又能确保<strong>生成的上下文连贯</strong></li>
</ol>
<h3 id="查询重写"><a href="#查询重写" class="headerlink" title="查询重写"></a>查询重写</h3><ol>
<li>针对用户输入的<strong>原始查询</strong>进行<strong>重新表诉</strong>，使其更加<strong>清晰易懂</strong>，并且<strong>与检索任务匹配</strong></li>
<li>针对用户的<strong>模糊提问</strong>，系统可以通过<strong>重写</strong>，使<strong>查询</strong>更加<strong>具体化</strong>，从而检索到更加<strong>精准</strong>的内容</li>
</ol>
<h3 id="查询扩展"><a href="#查询扩展" class="headerlink" title="查询扩展"></a>查询扩展</h3><ol>
<li>通过增加<strong>同义词</strong>、相关<strong>词汇</strong>或者<strong>概念</strong>，<strong>扩展</strong>用户的原始查询，增加了检索结果的<strong>广度</strong></li>
<li>当用户输入<strong>简短</strong>或<strong>不完整</strong>的查询时，系统能够通过<strong>扩展词汇</strong>找到更多潜在的内容，从而<strong>提升检索效果</strong></li>
</ol>
<h3 id="内容向量化"><a href="#内容向量化" class="headerlink" title="内容向量化"></a>内容向量化</h3><blockquote>
<p>长短不一</p>
</blockquote>
<ol>
<li>在 RAG 系统中，<strong>Document</strong> 或 <strong>Query</strong> 的<strong>长度</strong>对<strong>向量化</strong>过程有着<strong>显著影响</strong></li>
<li>对于<strong>短句子</strong>或者<strong>短语</strong>，其生成的向量更加聚焦于<strong>具体细节</strong>，能够实现更加<strong>精确</strong>的<strong>句子级别</strong>匹配</li>
<li><strong>段落</strong>或<strong>文档</strong>级别的向量化涵盖了<strong>更广泛的上下文信息</strong>，能够捕捉到内容的<strong>整体语义</strong></li>
</ol>
<h2 id="检索中"><a href="#检索中" class="headerlink" title="检索中"></a>检索中</h2><blockquote>
<p>核心环节</p>
</blockquote>
<h3 id="动态嵌入"><a href="#动态嵌入" class="headerlink" title="动态嵌入"></a>动态嵌入</h3><ol>
<li>通过<strong>动态嵌入模型</strong>根据上下文<strong>实时调整</strong>单词的<strong>嵌入表示</strong>，能够捕捉单词在<strong>不同上下文</strong>中的<strong>不同含义</strong></li>
<li>动态嵌入可以根据<strong>具体语境</strong>生成合适的向量，从而提高检索的精确性</li>
<li><strong>现代</strong>的高质量 Embedding 模型本质上都是<strong>动态</strong>的，本质上是通过<strong>上下文信息</strong>进行训练并生成动态的嵌入表示<ul>
<li><strong>传统</strong>的 Embedding 模型（<strong>Word2Vec</strong>、GloVe）都是基于<strong>预先构建</strong>的<strong>词汇表</strong>生成的</li>
<li>每个<strong>单词</strong>的嵌入表示都是<strong>固定不变</strong>的，无法根据上下文变化进行动态调整</li>
</ul>
</li>
</ol>
<h3 id="领域特定嵌入微调"><a href="#领域特定嵌入微调" class="headerlink" title="领域特定嵌入微调"></a>领域特定嵌入微调</h3><blockquote>
<p>jina-embeddings-v2-base-code</p>
</blockquote>
<ol>
<li>在实际应用中，<strong>不同领域</strong>的数据<strong>语境差异</strong>较大</li>
<li><strong>通用的嵌入模型</strong>无法覆盖某些<strong>特定领域</strong>的专业术语或特定语义</li>
<li>通过对通用嵌入模型进行<strong>微调</strong>，可以<strong>增强</strong>其在<strong>特定领域</strong>的表现</li>
</ol>
<h3 id="假设文档嵌入"><a href="#假设文档嵌入" class="headerlink" title="假设文档嵌入"></a>假设文档嵌入</h3><blockquote>
<p>HyDE - <strong>Hypothetical</strong> Document Embeddings - 通过<strong>假设文档</strong>，系统可以<strong>捕捉</strong>到<strong>更准确</strong>的相关文档</p>
</blockquote>
<ol>
<li>HyDE 通过<strong>生成假设文档</strong>并将其<strong>向量化</strong>，以提升<strong>查询</strong>与<strong>检索结果</strong>之间的<strong>语义匹配度</strong></li>
<li>用户输入 <strong>Query</strong> 时，LLM 首先基于 <strong>Query</strong> 生成一个<strong>假设性答案</strong><ul>
<li>该答案<strong>不一定</strong>是<strong>真实存在</strong>的文档内容，但能反映<strong>查询</strong>的<strong>核心语义</strong></li>
</ul>
</li>
<li>根据<strong>假设性文档</strong>进行<strong>检索</strong>，系统可能最终找到<strong>类似</strong>的<strong>真实文档</strong></li>
</ol>
<h3 id="混合检索"><a href="#混合检索" class="headerlink" title="混合检索"></a>混合检索</h3><ol>
<li>结合<strong>向量搜索</strong>和<strong>关键词搜索</strong>等多种检索方法，能够同时利用<strong>语义匹配</strong>与<strong>关键词匹配</strong>的优势</li>
</ol>
<h3 id="小到大检索"><a href="#小到大检索" class="headerlink" title="小到大检索"></a>小到大检索</h3><blockquote>
<p><strong>小块</strong>有助于<strong>提高精度</strong>，而<strong>大块</strong>则提供<strong>丰富的背景信息</strong>，使得生成的内容更加<strong>全面</strong> – <strong>分层检索</strong></p>
</blockquote>
<ol>
<li>首先通过<strong>较小内容块</strong>（单句或短段落）进行<strong>嵌入</strong>和<strong>检索</strong>，确保模型能找到<strong>与查询最匹配</strong>的<strong>小范围上下文</strong></li>
<li>检索到相关内容后，在<strong>生成阶段</strong>使用对应的<strong>较大内容块</strong>（完整段落或全文）为模型提供<strong>更广泛的上下文支持</strong></li>
</ol>
<h3 id="递归块合并"><a href="#递归块合并" class="headerlink" title="递归块合并"></a>递归块合并</h3><ol>
<li><strong>逐级扩展</strong>检索内容，确保生成阶段能够捕捉到<strong>更全面</strong>的上下文信息</li>
<li>在<strong>细粒度</strong>的<strong>子块检索</strong>后，自动<strong>将相关的父块合并</strong>，以便为生成模型提供<strong>完整的上下文</strong></li>
</ol>
<h2 id="检索后"><a href="#检索后" class="headerlink" title="检索后"></a>检索后</h2><h3 id="重排序"><a href="#重排序" class="headerlink" title="重排序"></a>重排序</h3><ol>
<li><strong>初始检索</strong>可以找到多个与查询相关的内容块，但这些内容的相关性存在差异，需要<strong>进一步排序</strong>以优化生成结果</li>
<li>通过<strong>重排序模型</strong>根据<strong>上下文的重要性</strong>、<strong>相关性评分</strong>等因素对<strong>已检索</strong>的内容<strong>重新打分</strong>，确保<strong>最相关</strong>的信息被<strong>优先处理</strong></li>
</ol>
<h3 id="提示压缩"><a href="#提示压缩" class="headerlink" title="提示压缩"></a>提示压缩</h3><ol>
<li><strong>删除冗余信息</strong>、<strong>合并相关内容</strong>、<strong>突出关键信息</strong>等方式来<strong>压缩</strong>提示，为生成模型提供更<strong>简洁</strong>、更<strong>相关</strong>的输入</li>
</ol>
<h3 id="上下文重构"><a href="#上下文重构" class="headerlink" title="上下文重构"></a>上下文重构</h3><ol>
<li>通过对<strong>检索到的内容</strong>进行<strong>加工</strong>或<strong>重组</strong>，以便<strong>更好地符合查询的需求</strong></li>
<li>将多个检索到的<strong>上下文片段</strong>整合成一个<strong>更具连贯性的文本块</strong>，减少<strong>重复</strong>或者<strong>冲突</strong>的内容，为 LLM 提供<strong>统一</strong>、<strong>清晰</strong>的输入</li>
</ol>
<h3 id="内容过滤"><a href="#内容过滤" class="headerlink" title="内容过滤"></a>内容过滤</h3><ol>
<li>根据<strong>预设规则</strong>，过滤掉<strong>与查询无直接关联</strong>的内容，<strong>语义相似度较低</strong>的片段，<strong>冗长且无关</strong>的背景信息，避免影响生成结果</li>
</ol>
<h3 id="多级推理"><a href="#多级推理" class="headerlink" title="多级推理"></a>多级推理</h3><ol>
<li>系统通过<strong>多个推理步骤</strong>，逐步<strong>整合</strong>信息，以回答复杂查询，常用于需要<strong>跨多个上下文</strong>或<strong>多步推理</strong>的问题</li>
</ol>
<h3 id="知识注入"><a href="#知识注入" class="headerlink" title="知识注入"></a>知识注入</h3><ol>
<li>在检索后通过<strong>外部知识库</strong>或者预定义的领域知识，<strong>增强</strong>生成的上下文内容</li>
<li>适用于对<strong>准确性要求较高</strong>的场景，系统需要补充<strong>额外的专业知识</strong></li>
</ol>
<h1 id="Modular-RAG"><a href="#Modular-RAG" class="headerlink" title="Modular RAG"></a>Modular RAG</h1><blockquote>
<p>打破传统的<strong>链式</strong>结构，允许不同<strong>模块</strong>之间的<strong>灵活组合</strong>以及<strong>流程</strong>的<strong>适应性编排</strong> - 更高的<strong>灵活性</strong>和<strong>可扩展性</strong></p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241024021807679.png" alt="image-20241024021807679"></p>
<ol>
<li>Modular RAG <strong>沿袭</strong>了 <strong>Naive RAG</strong> 和 <strong>Advanced RAG</strong> 的<strong>核心原则</strong>，但<strong>超越</strong>了两者，提供了更强的<strong>适应性</strong>和<strong>灵活性</strong></li>
<li>通过多种<strong>优化策略</strong>和独有的<strong>编排功能</strong>，提高 RAG 系统的<strong>场景适应性</strong></li>
<li>Modular RAG 将 RAG 的过程细分为<strong>多个可优化的模块</strong>，支持<strong>高度定制化</strong>和<strong>优化</strong></li>
<li>Modular RAG 通过将 <strong>Advanced RAG</strong> 的<strong>优化策略</strong>自由组合<ul>
<li>根据不同的应用场景<strong>定制化</strong>处理检索和生成任务，显著提升效率和效果</li>
</ul>
</li>
<li>在 Modular RAG 中，<strong>Orchestration</strong> 是区别于 <strong>Advanced RAG</strong> 最显著部分<ul>
<li>通过<strong>自由</strong>的流程控制和决策来优化检索和生成的全流程</li>
<li>核心思想 - 通过<strong>智能路由和调度</strong>，<strong>动态地决定</strong>查询处理的路径和步骤，从而在复杂场景下提升 RAG 系统的性能</li>
</ul>
</li>
</ol>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><blockquote>
<p><strong>路由</strong>是<strong>编排</strong>流程中的关键步骤 - 根据 Query 的特点和上下文，<strong>选择最合适的流程</strong></p>
</blockquote>
<h3 id="Query-Analysis"><a href="#Query-Analysis" class="headerlink" title="Query Analysis"></a>Query Analysis</h3><ol>
<li>对 Query 进行<strong>语义分析</strong>，判断其<strong>类型</strong>和<strong>难度</strong></li>
<li>直接问答式的查询 - 不需要复杂的检索过程</li>
<li>涉及<strong>多步推理</strong>的复杂问题 - 需要走<strong>更长的检索路径</strong></li>
</ol>
<h3 id="Pipeline-Selection"><a href="#Pipeline-Selection" class="headerlink" title="Pipeline Selection"></a>Pipeline Selection</h3><ol>
<li>根据 <strong>Query Analysis</strong> 的结果，<strong>动态选择</strong>合适的 <strong>Pipeline</strong></li>
<li>简单查询 - 禁用 LLM 的知识来回答，效率高</li>
<li>需要<strong>领域知识</strong>以及<strong>复杂推理</strong>的查询 - 集合<strong>外部文档及知识</strong>进行<strong>深度检索生成</strong></li>
</ol>
<h2 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h2><blockquote>
<p>管理 Query 的<strong>执行顺序</strong>，并<strong>动态调整</strong>检索和生成步骤</p>
</blockquote>
<h3 id="Query-Scheduling"><a href="#Query-Scheduling" class="headerlink" title="Query Scheduling"></a>Query Scheduling</h3><ol>
<li>当系统接收到 Query 时，判断是否<strong>需要进行检索</strong></li>
<li>根据 <strong>Query 重要性</strong>、<strong>上下文信息</strong>、<strong>已有生成结果的质量</strong>等多维度因素进行评估</li>
</ol>
<h3 id="Judgment-of-Retrieval-Needs"><a href="#Judgment-of-Retrieval-Needs" class="headerlink" title="Judgment of Retrieval Needs"></a>Judgment of Retrieval Needs</h3><ol>
<li>通过特定的判断节点来确定<strong>是否需要额外检索</strong></li>
<li>在某些情况下，可能会<strong>多次判断</strong>是否有必要执行<strong>新一轮的检索</strong></li>
</ol>
<h2 id="Knowledge-Guide"><a href="#Knowledge-Guide" class="headerlink" title="Knowledge Guide"></a>Knowledge Guide</h2><blockquote>
<p>结合<strong>知识图谱</strong>和<strong>推理路径</strong>来<strong>增强</strong>查询处理过程</p>
</blockquote>
<h3 id="Knowledge-Graph"><a href="#Knowledge-Graph" class="headerlink" title="Knowledge Graph"></a>Knowledge Graph</h3><ol>
<li>在处理<strong>复杂查询</strong>时，系统可以调用<strong>知识图谱</strong>来<strong>辅助检索</strong></li>
<li>提升了<strong>检索结果的准确性</strong>，还可以通过<strong>知识图谱中的上下文关系</strong>，推导出更为<strong>精确</strong>的答案</li>
<li>当查询涉及<strong>多个实体的关系</strong>，知识图谱能够提供<strong>更深层次的推理支持</strong></li>
</ol>
<h3 id="Reasoning-Path"><a href="#Reasoning-Path" class="headerlink" title="Reasoning Path"></a>Reasoning Path</h3><ol>
<li>通过推理路径，系统可以设计出一条<strong>符合查询需求</strong>的<strong>推理链条</strong></li>
<li>系统根据该<strong>推理链条</strong>，进行逐步的<strong>推理</strong>和<strong>检索</strong></li>
<li>适用于处理具有<strong>强逻辑性</strong>的问题 - 跨多个文档的<strong>关系推理</strong>或<strong>时间序列推理</strong></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2024/08/16/rag-evolution/">https://blog.zhongmingmao.top/2024/08/16/rag-evolution/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ai/">AI</a><a class="post-meta__tags" href="/tags/llm/">LLM</a><a class="post-meta__tags" href="/tags/rag/">RAG</a></div><div class="post-share"><div class="social-share" data-image="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evolution.webp" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/08/17/rag-graphrag/" title="RAG - GraphRAG"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/graphrag-9781829.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">RAG - GraphRAG</div></div><div class="info-2"><div class="info-item-1">向量检索 信息片段之间的连接能力有限   RAG 在跨越多个信息片段以获取综合见解时表现不足 当要回答一个复杂问题时，必须要通过共享属性在不同信息之间建立联系 RAG 无法有效捕捉这些关系 限制了 RAG 在处理需要多跳推理或整合多源数据的复杂查询时的能力       归纳总结能力不足   在处理大型数据集或长文档时，RAG 难以有效地归纳和总结复杂的语义概念 RAG 在需要全面理解和总结复杂语义信息的场景中表现不佳  GraphRAG 利用 LLM 生成的知识图谱来改进 RAG 的检索部分   GraphRAG 利用结构化的实体和关系信息，使得检索过程更加精准和全面 GraphRAG 在处理多跳问题和复杂文档分析时表现出色 GraphRAG 在处理复杂信息处理任务时，显著提升问答性能，提供比 RAG 更为准确和全面的答案 GraphRAG 通过知识图谱有效地连接不同的信息片段 不仅能够提供准确答案，还能展示答案之间的内在联系，提供更丰富和有价值的结果     GraphRAG 先利用知识图谱，关联查询的实体和关系从与知识图谱实体直接相关的文档中检索片段，提供一个更全面、指标化、高信息密度的总结   主...</div></div></div></a><a class="pagination-related" href="/2024/08/15/rag-optimization-evaluation/" title="RAG - Optimization + Evaluation"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evaluation.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">RAG - Optimization + Evaluation</div></div><div class="info-2"><div class="info-item-1">RAG   检索优化数据清洗和预处理 在 RAG 索引流程中，文档解析之后，文档切块之前，进行数据清洗和预处理 减少脏数据和噪音，提升文本的整体质量和信息密度   手段：清除冗余信息、统一格式、处理异常字符等 处理冗余的模板内容 消除文档中的额外空白和格式不一致 去除文档脚注、页眉页脚、版权信息    查询扩写 在 RAG 系统的检索步骤中，用户的查询会转换为向量后进行检索 单个向量查询只能覆盖向量空间中一个有限区域 如果查询中的嵌入向量未能包含所有关键信息，则可能检索到不相关的 Chunk 单点查询的局限性 - 限制系统在庞大文档库中的搜索范围，导致错失与查询语义相关的内容   查询扩写 通过 LLM 从原始查询语句生成多个语义相关的查询，可以覆盖向量空间中的不同区域 提高检索的全面性和准确性 扩写后的查询在被嵌入后，能够击中不同的语义区域 确保系统能够从更广泛的文档中检索到与用户需求相关的有用信息     通过查询扩写，原始问题被分解为多个子查询 每个子查询独立检索相关文档并生成相应的结果 系统将所有子查询的检索结果进行合并和重新排序   能够有效扩展用户的查询意图，确保在复杂信息库中进行更全面的文...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/qdrant.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-09</div><div class="info-item-2">RAG - Qdrant</div></div><div class="info-2"><div class="info-item-1">Features   Getting StartedIntroduction Vector databases are a relatively new way for interacting with abstract data representations derived from opaque machine learning models such as deep learning architectures. These representations are often called vectors or embeddings and they are a compressed version of the data used to train a machine learning model to accomplish a task like sentiment analysis, speech recognition, object detection, and many others.  What is Qdrant? Qdrant “is a vector similarity s...</div></div></div></a><a class="pagination-related" href="/2024/08/17/rag-graphrag/" title="RAG - GraphRAG"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/graphrag-9781829.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-17</div><div class="info-item-2">RAG - GraphRAG</div></div><div class="info-2"><div class="info-item-1">向量检索 信息片段之间的连接能力有限   RAG 在跨越多个信息片段以获取综合见解时表现不足 当要回答一个复杂问题时，必须要通过共享属性在不同信息之间建立联系 RAG 无法有效捕捉这些关系 限制了 RAG 在处理需要多跳推理或整合多源数据的复杂查询时的能力       归纳总结能力不足   在处理大型数据集或长文档时，RAG 难以有效地归纳和总结复杂的语义概念 RAG 在需要全面理解和总结复杂语义信息的场景中表现不佳  GraphRAG 利用 LLM 生成的知识图谱来改进 RAG 的检索部分   GraphRAG 利用结构化的实体和关系信息，使得检索过程更加精准和全面 GraphRAG 在处理多跳问题和复杂文档分析时表现出色 GraphRAG 在处理复杂信息处理任务时，显著提升问答性能，提供比 RAG 更为准确和全面的答案 GraphRAG 通过知识图谱有效地连接不同的信息片段 不仅能够提供准确答案，还能展示答案之间的内在联系，提供更丰富和有价值的结果     GraphRAG 先利用知识图谱，关联查询的实体和关系从与知识图谱实体直接相关的文档中检索片段，提供一个更全面、指标化、高信息密度的总结   主...</div></div></div></a><a class="pagination-related" href="/2024/08/15/rag-optimization-evaluation/" title="RAG - Optimization + Evaluation"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-evaluation.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-15</div><div class="info-item-2">RAG - Optimization + Evaluation</div></div><div class="info-2"><div class="info-item-1">RAG   检索优化数据清洗和预处理 在 RAG 索引流程中，文档解析之后，文档切块之前，进行数据清洗和预处理 减少脏数据和噪音，提升文本的整体质量和信息密度   手段：清除冗余信息、统一格式、处理异常字符等 处理冗余的模板内容 消除文档中的额外空白和格式不一致 去除文档脚注、页眉页脚、版权信息    查询扩写 在 RAG 系统的检索步骤中，用户的查询会转换为向量后进行检索 单个向量查询只能覆盖向量空间中一个有限区域 如果查询中的嵌入向量未能包含所有关键信息，则可能检索到不相关的 Chunk 单点查询的局限性 - 限制系统在庞大文档库中的搜索范围，导致错失与查询语义相关的内容   查询扩写 通过 LLM 从原始查询语句生成多个语义相关的查询，可以覆盖向量空间中的不同区域 提高检索的全面性和准确性 扩写后的查询在被嵌入后，能够击中不同的语义区域 确保系统能够从更广泛的文档中检索到与用户需求相关的有用信息     通过查询扩写，原始问题被分解为多个子查询 每个子查询独立检索相关文档并生成相应的结果 系统将所有子查询的检索结果进行合并和重新排序   能够有效扩展用户的查询意图，确保在复杂信息库中进行更全面的文...</div></div></div></a><a class="pagination-related" href="/2024/08/14/rag-llm-prompt-engineering/" title="RAG - LLM + Prompt Engineering"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/llm-prompting.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-14</div><div class="info-item-2">RAG - LLM + Prompt Engineering</div></div><div class="info-2"><div class="info-item-1">RAG 生成流程    经过 RAG 索引流程（外部知识的解析和向量化）和 RAG 检索流程（语义相似性的匹配及混合检索），进入到 RAG 生成流程 在 RAG 生成流程中，需要组合指令，即携带查询问题及检索到的相关信息输入的 LLM，由 LLM 理解并生成最终的回复 RAG 的本质是通过 LLM 提供外部知识来增强其理解和回答领域问题的能力 LLM 在 RAG 系统中起到了大脑的作用 在面对复杂且多样化的 RAG 任务时，LLM 的性能直接决定了系统的整体效果   提示词工程是生成流程中的另一个关键环节 通过有效的指令的设计和组合，可以帮助 LLM 更好地理解输入内容，从而生成更加精确和相关的回答 精心设计的问题提示词，往往能提升生成效果    LLM发展  RAG 目前更关注通用大模型   原理 Google 于 2017 年发布论文 Attention Is All You Need，引入了 Transformer 模型 Transformer 模型是深度学习领域的一个突破性架构，LLM 的成功得益于对 Transformer 模型的应用 与传统的 RNN（循环神经网络） 相比，Transform...</div></div></div></a><a class="pagination-related" href="/2024/08/13/rag-hybrid-retrieval-rerank/" title="RAG - Hybrid retrieval + Rerank"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-rerank-9097303.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-13</div><div class="info-item-2">RAG - Hybrid retrieval + Rerank</div></div><div class="info-2"><div class="info-item-1">向量检索 当前主流的 RAG 检索方式主要采用向量检索，通过语义相似度来匹配 Chunk 向量检索并非万能，在某些场景下无法替代传统关键词检索的优势 当需要精准搜索的时候，向量检索的准确性就往往不如关键词检索 当用户输入的问题非常简短，语义匹配的效果可能不尽理想   关键词检索的适用场景 精确匹配 少量字符的匹配 - 不适合用向量检索 低频词汇的匹配       混合检索 结合关键词检索和语义匹配的优势   在 RAG 检索场景中，首要目标是确保最相关的结果能够出现在候选列表中 向量检索和关键词检索各具优势，混合检索通过结合多种检索技术，弥补各自不足，提供一种更加全面的搜索方案 重排序技术在检索系统中扮演着至关重要的角色 即使检索算法已经能够捕捉到所有相关的结果，重排序过程依然不可或缺 确保最符合用户意图和查询语义的结果优先展示，提升用户的搜索体验和结果的准确性     在多个数据集和多个检索任务中，混合检索和重排序的组合均取得了最佳表现     融合检索 &#x2F; 多路召回    https://python.langchain.com/v0.2/api_reference/community/r...</div></div></div></a><a class="pagination-related" href="/2024/08/12/rag-vector-stores/" title="RAG - Vector Stores"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector_stores.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-12</div><div class="info-item-2">RAG - Vector Stores</div></div><div class="info-2"><div class="info-item-1">Embedding Vector Store概述 在 AI 时代，文字、图像、语音、视频等多模态数据的复杂性显著增加 多模态数据具有非结构化和多维特征 向量表示能够有效表示语义和捕捉潜在的语义关系 促使向量数据库成为存储、检索和分析高维向量的关键工具     Qdrant &#x2F; Milvus   优势  SQL vs NoSQL   传统数据库通常分为关系型（SQL）数据库和非关系型（NoSQL）数据库 存储复杂、非结构化或半结构化信息的需求，主要依赖于 NoSQL 的能力     Store Desc Note    Key-Value 用于简单的数据存储，通过 Key 来快速访问数据 精准定位信息   Document 用于存储文档结构的数据，如 JSON 格式 复杂的结构化信息   Graph 用于表示和存储复杂的关系数据，常用于社交网络、推荐等场景 复杂的关系数据   Vector 用于存储和检索基于向量表示的数据，用于 AI 模型的高维度和复杂的嵌入向量 语义最相关的数据    向量数据库的核心在于能够基于向量之间的相似性，能够快速、精确地定位和检索数据 向量数据库不仅为嵌入向量提供了...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%94%E8%BF%9B"><span class="toc-number">1.</span> <span class="toc-text">演进</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Naive-RAG"><span class="toc-number">2.</span> <span class="toc-text">Naive RAG</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Advanced-RAG"><span class="toc-number">3.</span> <span class="toc-text">Advanced RAG</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%89%8D"><span class="toc-number">3.1.</span> <span class="toc-text">检索前</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">3.1.1.</span> <span class="toc-text">滑动窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.2.</span> <span class="toc-text">元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%B4%A2%E5%BC%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">分层索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A5%E5%AD%90%E7%AA%97%E5%8F%A3"><span class="toc-number">3.1.4.</span> <span class="toc-text">句子窗口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%86%99"><span class="toc-number">3.1.5.</span> <span class="toc-text">查询重写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%A9%E5%B1%95"><span class="toc-number">3.1.6.</span> <span class="toc-text">查询扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%90%91%E9%87%8F%E5%8C%96"><span class="toc-number">3.1.7.</span> <span class="toc-text">内容向量化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E4%B8%AD"><span class="toc-number">3.2.</span> <span class="toc-text">检索中</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%B5%8C%E5%85%A5"><span class="toc-number">3.2.1.</span> <span class="toc-text">动态嵌入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%86%E5%9F%9F%E7%89%B9%E5%AE%9A%E5%B5%8C%E5%85%A5%E5%BE%AE%E8%B0%83"><span class="toc-number">3.2.2.</span> <span class="toc-text">领域特定嵌入微调</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%87%E8%AE%BE%E6%96%87%E6%A1%A3%E5%B5%8C%E5%85%A5"><span class="toc-number">3.2.3.</span> <span class="toc-text">假设文档嵌入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E6%A3%80%E7%B4%A2"><span class="toc-number">3.2.4.</span> <span class="toc-text">混合检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E5%88%B0%E5%A4%A7%E6%A3%80%E7%B4%A2"><span class="toc-number">3.2.5.</span> <span class="toc-text">小到大检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%9D%97%E5%90%88%E5%B9%B6"><span class="toc-number">3.2.6.</span> <span class="toc-text">递归块合并</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%90%8E"><span class="toc-number">3.3.</span> <span class="toc-text">检索后</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%BA%8F"><span class="toc-number">3.3.1.</span> <span class="toc-text">重排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E5%8E%8B%E7%BC%A9"><span class="toc-number">3.3.2.</span> <span class="toc-text">提示压缩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E9%87%8D%E6%9E%84"><span class="toc-number">3.3.3.</span> <span class="toc-text">上下文重构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E8%BF%87%E6%BB%A4"><span class="toc-number">3.3.4.</span> <span class="toc-text">内容过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E6%8E%A8%E7%90%86"><span class="toc-number">3.3.5.</span> <span class="toc-text">多级推理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E6%B3%A8%E5%85%A5"><span class="toc-number">3.3.6.</span> <span class="toc-text">知识注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Modular-RAG"><span class="toc-number">4.</span> <span class="toc-text">Modular RAG</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Routing"><span class="toc-number">4.1.</span> <span class="toc-text">Routing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-Analysis"><span class="toc-number">4.1.1.</span> <span class="toc-text">Query Analysis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipeline-Selection"><span class="toc-number">4.1.2.</span> <span class="toc-text">Pipeline Selection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scheduling"><span class="toc-number">4.2.</span> <span class="toc-text">Scheduling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-Scheduling"><span class="toc-number">4.2.1.</span> <span class="toc-text">Query Scheduling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Judgment-of-Retrieval-Needs"><span class="toc-number">4.2.2.</span> <span class="toc-text">Judgment of Retrieval Needs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge-Guide"><span class="toc-number">4.3.</span> <span class="toc-text">Knowledge Guide</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Knowledge-Graph"><span class="toc-number">4.3.1.</span> <span class="toc-text">Knowledge Graph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reasoning-Path"><span class="toc-number">4.3.2.</span> <span class="toc-text">Reasoning Path</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/Java-Foreign-Function-API.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Foreign Function API"/></a><div class="content"><a class="title" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API">New Java Feature - Foreign Function API</a><time datetime="2025-01-16T16:06:25.000Z" title="Created 2025-01-17 00:06:25">2025-01-17</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>