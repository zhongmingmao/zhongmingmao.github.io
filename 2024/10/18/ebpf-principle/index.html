<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>eBPF - Principle | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="发展历程 1992 年，在 BSD 操作系统中引入了革命性的包过滤机制 BPF，性能非常好 BPF 的两大设计 内核态引入一个新的虚拟机，所有指令都在内核虚拟机中运行 用户态使用 BPF 字节码来定义过滤表达式，然后传递给内核，由内核虚拟机解释执行   BPF 使得包过滤可以直接在内核中执行，避免向用户态复制每个数据包，从而极大提升了包过滤的性能，被各大操作系统广泛接受 BPF 诞生 5 年后，在">
<meta property="og:type" content="article">
<meta property="og:title" content="eBPF - Principle">
<meta property="og:url" content="https://blog.zhongmingmao.top/2024/10/18/ebpf-principle/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="发展历程 1992 年，在 BSD 操作系统中引入了革命性的包过滤机制 BPF，性能非常好 BPF 的两大设计 内核态引入一个新的虚拟机，所有指令都在内核虚拟机中运行 用户态使用 BPF 字节码来定义过滤表达式，然后传递给内核，由内核虚拟机解释执行   BPF 使得包过滤可以直接在内核中执行，避免向用户态复制每个数据包，从而极大提升了包过滤的性能，被各大操作系统广泛接受 BPF 诞生 5 年后，在">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png">
<meta property="article:published_time" content="2024-10-17T16:06:25.000Z">
<meta property="article:modified_time" content="2025-02-06T17:23:07.520Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="eBPF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "eBPF - Principle",
  "url": "https://blog.zhongmingmao.top/2024/10/18/ebpf-principle/",
  "image": "https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png",
  "datePublished": "2024-10-17T16:06:25.000Z",
  "dateModified": "2025-02-06T17:23:07.520Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2024/10/18/ebpf-principle/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'eBPF - Principle',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">eBPF - Principle</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">eBPF - Principle</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-10-17T16:06:25.000Z" title="Created 2024-10-18 00:06:25">2024-10-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ebpf/">eBPF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>3mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-02-07 01:23:07&quot;}" hidden></div><h1 id="发展历程"><a href="#发展历程" class="headerlink" title="发展历程"></a>发展历程</h1><ol>
<li><strong>1992</strong> 年，在 BSD 操作系统中引入了<strong>革命性</strong>的包过滤机制 <strong>BPF</strong>，性能非常好</li>
<li>BPF 的两大设计<ul>
<li><strong>内核态</strong>引入一个新的<strong>虚拟机</strong>，所有指令都在<strong>内核虚拟机</strong>中运行</li>
<li><strong>用户态</strong>使用 <strong>BPF 字节码</strong>来定义<strong>过滤表达式</strong>，然后<strong>传递给内核</strong>，由内核虚拟机<strong>解释执行</strong></li>
</ul>
</li>
<li>BPF 使得<strong>包过滤</strong>可以直接在<strong>内核</strong>中执行，<strong>避免向用户态复制每个数据包</strong>，从而极大提升了包过滤的性能，被各大<strong>操作系统</strong>广泛接受</li>
<li>BPF 诞生 5 年后，在 <strong>Linux 2.1.75</strong> 首次<strong>引入</strong>了 BPF 技术，在 <strong>Linux 3.0</strong> 中增加的 <strong>BPF JIT</strong>，替换掉性能更差的<strong>解释器</strong>，进一步优化了 BPF 指令运行的<strong>效率</strong></li>
<li>直到此时，<strong>BPF</strong> 的应用领域还仅限于<strong>网络包过滤</strong></li>
<li><strong>2014</strong> 年，将 BPF 扩展为一个<strong>通用的虚拟机</strong>，即 <strong>eBPF</strong><ul>
<li>eBPF 不仅扩展了<strong>寄存器的数量</strong>，引入了<strong>全新的 BPF 映射存储</strong></li>
<li>还在 <strong>4.x</strong> 内核中将原本<strong>单一的数据包过滤事件</strong>逐步扩展到了<strong>内核态函数</strong>、<strong>用户态函数</strong>、<strong>跟踪点</strong>、<strong>性能事件</strong>以及<strong>安全控制</strong>等</li>
</ul>
</li>
<li>eBPF 的诞生了 BPF 技术的<strong>转折点</strong>，使得 BPF 不再仅限于<strong>网络栈</strong>，而是成为<strong>内核</strong>的一个<strong>顶级子系统</strong> - 最活跃</li>
<li>eBPF 无需<strong>修改内核源码</strong>和<strong>重新编译</strong>就可以<strong>扩展内核</strong>的功能</li>
</ol>
<span id="more"></span>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/b44562381748de369b50403219c0d1ff.jpg" alt="b44562381748de369b50403219c0d1ff"></p>
<h1 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h1><ol>
<li>eBPF 程序并不像<strong>常规的线程</strong>那样，启动后就一直运行在那里，它需要<strong>内核事件触发</strong>后才会<strong>执行</strong><ul>
<li>事件 - <strong>系统调用</strong>、<strong>内核跟踪点</strong>、<strong>内核函数</strong>和<strong>用户态函数</strong>的<strong>调用退出</strong>、<strong>网络事件</strong>等</li>
</ul>
</li>
<li>借助于强大的<strong>内核态</strong>插桩（<strong>kprobe</strong>）和<strong>用户态</strong>插桩（<strong>uprobe</strong>），eBPF 程序几乎可以在<strong>内核和应用的任意位置</strong>进行<strong>插桩</strong></li>
<li>确保<strong>安全</strong>和<strong>稳定</strong>是 eBPF 的<strong>首要任务</strong>，不安全的 eBPF 程序<strong>不会提交</strong>到<strong>内核虚拟机</strong>中执行</li>
</ol>
<blockquote>
<p>执行过程</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/linux_ebpf_internals.png" alt="linux_ebpf_internals"></p>
<ol>
<li>借助 <strong>LLVM</strong> 把编写的 <strong>eBPF 程序</strong>转换为 <strong>BPF 字节码</strong>，然后再通过 <strong>bpf 系统调用</strong>提交给<strong>内核</strong>执行</li>
<li>内核在接受 BPF 字节码之前，会首先通过<strong>验证器</strong>对<strong>字节码</strong>进行<strong>校验</strong>，只有<strong>校验通过</strong>的 <strong>BPF 字节码</strong>才会<strong>提交</strong>到 <strong>JIT</strong> 执行</li>
<li>如果 BPF 字节码中包含了<strong>不安全</strong>的操作，验证器会<strong>直接拒绝</strong> BPF 程序的执行，典型的验证过程<ul>
<li>只有<strong>特权进程</strong>才可以执行 <strong>bpf 系统调用</strong></li>
<li>BPF 程序不能包含<strong>无限循环</strong></li>
<li>BPF 程序不能导致<strong>内核崩溃</strong></li>
<li>BPF 程序必须在<strong>有限时间</strong>内完成</li>
</ul>
</li>
<li><strong>BPF 程序</strong>可以利用 <strong>BPF 映射</strong>进行<strong>存储</strong>，而<strong>用户程序</strong>也需要通过 <strong>BPF 映射</strong>与<strong>运行在内核中的 BPF 程序</strong>进行<strong>交互</strong></li>
<li><strong>eBPF 程序</strong>的运行需要经历<strong>编译</strong>、<strong>加载</strong>、<strong>验证</strong>和<strong>内核态执行</strong>等过程，而<strong>用户态程序</strong>则需要借助 <strong>BPF 映射</strong>来获取<strong>内核态 eBPF 程序的运行状态</strong></li>
</ol>
<blockquote>
<p>在<strong>性能观测</strong>中，BPF 程序收集<strong>内核运行状态</strong>存储在 <strong>BPF 映射</strong>中，<strong>用户程序</strong>再从 <strong>BPF 映射</strong>中读取这些状态</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-maps.webp" alt="ebpf-maps"></p>
<h1 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h1><ol>
<li>eBPF 程序必须被<strong>验证器校验通过</strong>才能执行，且不能包含<strong>无法到达的指令</strong></li>
<li>eBPF 程序<strong>不能随意调用内核函数</strong>，只能调用在 <strong>API</strong> 中<strong>定义</strong>的<strong>辅助函数</strong></li>
<li>eBPF 程序<strong>栈</strong>空间最多只有 <strong>512 字节</strong>，要<strong>更大的存储</strong>，只能借助于 <strong>BPF 映射</strong></li>
<li>在内核 <strong>5.2</strong> 之前，eBPF 字节码最多只支持 <strong>4096 条指令</strong>，在 5.2 内核版本将该限制提高到了 <strong>100 万条</strong></li>
<li>内核快速发展，在<strong>不同版本内核</strong>中运行时，需要<strong>访问内核数据结构</strong>的 eBPF 程序很可能需要<strong>调整源码</strong>，并<strong>重新编译</strong></li>
<li>eBPF 很多新特性都是在 <strong>4.x</strong> 版本中才逐步增加的，要<strong>稳定运行</strong> eBPF 程序，内核版本至少要 **4.9+**，推荐 <strong>5.x</strong></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2024/10/18/ebpf-principle/">https://blog.zhongmingmao.top/2024/10/18/ebpf-principle/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/ebpf/">eBPF</a></div><div class="post-share"><div class="social-share" data-image="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Observability - OpenTelemetry Doc V1</div></div><div class="info-2"><div class="info-item-1">架构 OpenTelemetry 也被称为 OTel，是一个供应商中立的、开源的可观测性框架， 可用于插桩、生成、采集和导出链路、 指标和日志等遥测数据     概述 专注于数据标准，不提供存储和可视化   OpenTelemetry 是一个可观测性框架和工具包， 旨在创建和管理遥测数据，如链路、 指标和日志 OpenTelemetry 是供应商和工具无关的，这意味着它可以与各种可观测性后端一起使用， 包括 Jaeger 和 Prometheus 这类开源工具以及商业化产品 OpenTelemetry 不是像 Jaeger、Prometheus 或其他商业供应商那样的可观测性后端 OpenTelemetry 专注于遥测数据的生成、采集、管理和导出 OpenTelemetry 的一个主要目标是， 无论应用程序或系统采用何种编程语言、基础设施或运行时环境，你都可以轻松地将其仪表化 遥测数据的存储和可视化是有意留给其他工具处理    可观测性 可观测性是通过检查系统输出来理解系统内部状态的能力 在软件的背景下，这意味着能够通过检查遥测数据（包括链路、指标和日志）来理解系统的内部状态   要使系统可观测，必须对...</div></div></div></a><a class="pagination-related" href="/2024/10/17/ebpf-overview/" title="eBPF - Overview"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">eBPF - Overview</div></div><div class="info-2"><div class="info-item-1">eBPF Extended Berkeley Packet Filter   eBPF 是一种数据包过滤技术，从 BPF 技术扩展而来 BPF 提供了一种在内核事件和用户程序事件发生时安全注入代码的机制，让非内核开发人员也可以对内核进行控制 随着内核的发展，BPF 从最初的数据包过滤，扩展到网络、内核、安全、跟踪等，扩展后的 BPF 被称为 eBPF，早期的 BPF 被称为经典 BPF，即 cBPF 现代内核所运行的都是 eBPF    特性 在 eBPF 之前，内核模块是注入内核的最主要机制 由于缺乏对内核模块的安全控制，内核的基本功能很容易被一个有缺陷的内核模块破坏 eBPF 借助 JIT，在内核中运行一个虚拟机，保证只有被验证安全的 eBPF 指令才会被内核执行 同时，eBPF 指令依然运行在内核中，无需向用户态复制数据，极大地提高了事件处理的效率 eBPF 在故障诊断、网络优化、安全控制、性能监控等领域获得了大量应用 高性能网络负载均衡器 - Katran 容器网络方案 - Cilium 内核跟踪排错工具 - BCC + bpftrace    概览 技术栈 掌握 eBPF 并不需要掌握内核开发...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/10/17/ebpf-overview/" title="eBPF - Overview"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-17</div><div class="info-item-2">eBPF - Overview</div></div><div class="info-2"><div class="info-item-1">eBPF Extended Berkeley Packet Filter   eBPF 是一种数据包过滤技术，从 BPF 技术扩展而来 BPF 提供了一种在内核事件和用户程序事件发生时安全注入代码的机制，让非内核开发人员也可以对内核进行控制 随着内核的发展，BPF 从最初的数据包过滤，扩展到网络、内核、安全、跟踪等，扩展后的 BPF 被称为 eBPF，早期的 BPF 被称为经典 BPF，即 cBPF 现代内核所运行的都是 eBPF    特性 在 eBPF 之前，内核模块是注入内核的最主要机制 由于缺乏对内核模块的安全控制，内核的基本功能很容易被一个有缺陷的内核模块破坏 eBPF 借助 JIT，在内核中运行一个虚拟机，保证只有被验证安全的 eBPF 指令才会被内核执行 同时，eBPF 指令依然运行在内核中，无需向用户态复制数据，极大地提高了事件处理的效率 eBPF 在故障诊断、网络优化、安全控制、性能监控等领域获得了大量应用 高性能网络负载均衡器 - Katran 容器网络方案 - Cilium 内核跟踪排错工具 - BCC + bpftrace    概览 技术栈 掌握 eBPF 并不需要掌握内核开发...</div></div></div></a><a class="pagination-related" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-23</div><div class="info-item-2">Observability - Prometheus Concepts</div></div><div class="info-2"><div class="info-item-1">Data model Prometheus fundamentally stores all data as time series streams of timestamped values belonging to the same metric and the same set of labeled dimensions.   Besides stored time series, Prometheus may generate temporary derived time series as the result of queries.    Metric names and labelsEvery time series is uniquely identified by its metric name and optional key-value pairs called labels. Metric names Metric names SHOULD specify the general feature of a system that is measured e.g. http_req...</div></div></div></a><a class="pagination-related" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-22</div><div class="info-item-2">Observability - Prometheus Introduction</div></div><div class="info-2"><div class="info-item-1">Summary Open source metrics and monitoring for your systems and services. Monitor your applications, systems, and services with the leading open source monitoring solution. Instrument, collect, store, and query your metrics for alerting, dashboarding, and other use cases.       Feature Desc    Dimensional data model Prometheus models time series in a flexible dimensional data model.Time series are identified by a metric name and a set of key-value pairs.   Powerful queries The PromQL query language allow...</div></div></div></a><a class="pagination-related" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-21</div><div class="info-item-2">Observability - OpenTelemetry Java Zero Code</div></div><div class="info-2"><div class="info-item-1">Java Agent Zero-code instrumentation with Java uses a Java agent JAR attached to any Java 8+ application. It dynamically injects bytecode to capture telemetry from many popular libraries and frameworks. It can be used to capture telemetry data at the “edges” of an app or service such as inbound requests, outbound HTTP calls, database calls, and so on.      Getting startedSetup Download opentelemetry-javaagent.jar from Releases of the opentelemetry-java-instrumentation repository place the JAR in your pre...</div></div></div></a><a class="pagination-related" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-20</div><div class="info-item-2">Observability - OpenTelemetry Java</div></div><div class="info-2"><div class="info-item-1">Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.    Overview The API is a set of classes and interfaces for recording telemetry across key observability signals.  It supports multiple implementations, with a low-overhead minimalist Noop and SDK reference implementation provided out of the box.  It is designed to be taken as a direct dependency by libraries, framewor...</div></div></div></a><a class="pagination-related" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-05</div><div class="info-item-2">Observability - OpenTelemetry Python</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development   Version supportOpenTelemetry-Python supports Python 3.9 and higher.   Installation The API and SDK packages are available on PyPI, and can be installed via pip:  12pip install opentelemetry-apipip install opentelemetry-sdk   In addition, there are several extension packages which can be installed separately as:  12pip install opentelemetry-exporter-&#123;exporter&#125;pip install opentelemetry-instrumentation-&#123;instrumen...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">发展历程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">局限性</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>