<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>应用编排与管理 -- 核心原理 | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="资源元信息Kubernetes资源对象 Spec（specification）：期望的状态 Status：观测到的状态 Metadata：元数据 Labels：识别资源 Annotations：描述资源 OwnerReference：描述多个资源之间的相互关系    Labels 标识型的 KV 元数据 标签名包含域名前缀：用来描述打标签的系统和工具   作用 用于筛选资源 唯一的组合资源的方法">
<meta property="og:type" content="article">
<meta property="og:title" content="应用编排与管理 -- 核心原理">
<meta property="og:url" content="https://blog.zhongmingmao.top/2021/07/11/cloud-native-k8s-orchestration-core-principle/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="资源元信息Kubernetes资源对象 Spec（specification）：期望的状态 Status：观测到的状态 Metadata：元数据 Labels：识别资源 Annotations：描述资源 OwnerReference：描述多个资源之间的相互关系    Labels 标识型的 KV 元数据 标签名包含域名前缀：用来描述打标签的系统和工具   作用 用于筛选资源 唯一的组合资源的方法">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png">
<meta property="article:published_time" content="2021-07-11T02:23:04.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.571Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="Alibaba">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "应用编排与管理 -- 核心原理",
  "url": "https://blog.zhongmingmao.top/2021/07/11/cloud-native-k8s-orchestration-core-principle/",
  "image": "https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png",
  "datePublished": "2021-07-11T02:23:04.000Z",
  "dateModified": "2023-04-03T10:04:59.571Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2021/07/11/cloud-native-k8s-orchestration-core-principle/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '应用编排与管理 -- 核心原理',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">应用编排与管理 -- 核心原理</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">应用编排与管理 -- 核心原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2021-07-11T02:23:04.000Z" title="Created 2021-07-11 10:23:04">2021-07-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/kubernetes/">Kubernetes</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/kubernetes/alibaba/">Alibaba</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>13mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h1 id="资源元信息"><a href="#资源元信息" class="headerlink" title="资源元信息"></a>资源元信息</h1><h2 id="Kubernetes资源对象"><a href="#Kubernetes资源对象" class="headerlink" title="Kubernetes资源对象"></a>Kubernetes资源对象</h2><ol>
<li>Spec（<strong>specification</strong>）：<strong>期望的状态</strong></li>
<li>Status：<strong>观测到的状态</strong></li>
<li>Metadata：<strong>元数据</strong><ul>
<li>Labels：<strong>识别</strong>资源</li>
<li>Annotations：<strong>描述</strong>资源</li>
<li>OwnerReference：描述多个资源之间的<strong>相互关系</strong></li>
</ul>
</li>
</ol>
<h2 id="Labels"><a href="#Labels" class="headerlink" title="Labels"></a>Labels</h2><ol>
<li><strong>标识型</strong>的 <strong>KV</strong> 元数据<ul>
<li>标签名包含<strong>域名前缀</strong>：用来描述打标签的系统和工具</li>
</ul>
</li>
<li>作用<ul>
<li>用于<strong>筛选资源</strong></li>
<li>唯一的<strong>组合资源</strong>的方法</li>
</ul>
</li>
<li>可以使用 <strong>Selector</strong> 来查询（类<strong>SQL</strong>）</li>
</ol>
<span id="more"></span>

<h2 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h2><table>
<thead>
<tr>
<th>Pod</th>
<th>Tie</th>
<th>Env</th>
</tr>
</thead>
<tbody><tr>
<td>pod1</td>
<td>front</td>
<td>dev</td>
</tr>
<tr>
<td>pod2</td>
<td>back</td>
<td>prod</td>
</tr>
<tr>
<td>pod3</td>
<td>front</td>
<td>test</td>
</tr>
<tr>
<td>pod4</td>
<td>back</td>
<td>gray</td>
</tr>
</tbody></table>
<ol>
<li><strong>相等型</strong><ul>
<li>可以包含多个相等条件，多个相等条件之间是<strong>逻辑与</strong>的关系，如<code>Tie=front, Env=dev</code>命中 pod1</li>
</ul>
</li>
<li><strong>集合型</strong><ul>
<li><code>Env in (test, gray)</code>：命中 pod3 和 pod4</li>
<li><code>Tie notin (front, back)</code>：无命中</li>
</ul>
</li>
<li>其他<ul>
<li><code>release</code>：存在 release 标签</li>
<li><code>!release</code>：不存在 release 标签</li>
</ul>
</li>
<li>相等型和集合型的 Selector 同样可以通过**<code>,</code><strong>来连接（关系：</strong>逻辑与**）</li>
</ol>
<h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><ol>
<li>Key:Value</li>
<li>作用<ul>
<li>一般是<strong>系统或者工具</strong>用来存储资源的<strong>非标志性</strong>信息</li>
<li>扩展资源的 <strong>spec&#x2F;status</strong> 的描述</li>
</ul>
</li>
<li>特点<ul>
<li>一般<strong>比 Label 更大</strong></li>
<li>可以包含<strong>特殊字符</strong></li>
<li><strong>结构化、非结构化</strong></li>
</ul>
</li>
</ol>
<h2 id="OwnerReference"><a href="#OwnerReference" class="headerlink" title="OwnerReference"></a>OwnerReference</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210709175553707.png" alt="image-20210709175553707"></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h3><figure class="highlight yaml"><figcaption><span>pod1.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">Tie:</span> <span class="string">front</span></span><br><span class="line">    <span class="attr">Env:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">&#x27;nginx:1.21.1&#x27;</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><figcaption><span>pod2.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod2</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">Tie:</span> <span class="string">back</span></span><br><span class="line">    <span class="attr">Env:</span> <span class="string">prod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">&#x27;nginx:1.21.1&#x27;</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><figcaption><span>pod3.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod3</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">Tie:</span> <span class="string">front</span></span><br><span class="line">    <span class="attr">Env:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">&#x27;nginx:1.21.1&#x27;</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><figcaption><span>pod4.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod4</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">Tie:</span> <span class="string">back</span></span><br><span class="line">    <span class="attr">Env:</span> <span class="string">gray</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">&#x27;nginx:1.21.1&#x27;</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><figcaption><span>rs.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rs1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">Env:</span> <span class="string">prod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">Env:</span> <span class="string">prod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;nginx:1.21.1&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><h4 id="Labels-1"><a href="#Labels-1" class="headerlink" title="Labels"></a>Labels</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods</span><br><span class="line">No resources found.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f pod1.yaml</span><br><span class="line">pod/pod1 created</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f pod2.yaml</span><br><span class="line">pod/pod2 created</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods --show-labels</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">pod1   1/1     Running   0          66s   Env=dev,Tie=front</span><br><span class="line">pod2   1/1     Running   0          63s   Env=prod,Tie=back</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods pod1 -o yaml | head</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Pod&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;Env&quot;:&quot;dev&quot;,&quot;Tie&quot;:&quot;front&quot;&#125;,&quot;name&quot;:&quot;pod1&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;image&quot;:&quot;nginx:1.21.1&quot;,&quot;name&quot;:&quot;nginx&quot;&#125;]&#125;&#125;</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T07:43:40Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    Env: dev</span><br><span class="line">    Tie: front</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label pods pod1 Env=test</span><br><span class="line">error: &#x27;Env&#x27; already has a value (dev), and --overwrite is false</span><br><span class="line"></span><br><span class="line">$ kubectl get pods pod1 --show-labels</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          5m18s   Env=dev,Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl label pods pod1 Env=test --overwrite</span><br><span class="line">pod/pod1 labeled</span><br><span class="line"></span><br><span class="line">$ kubectl get pods pod1 --show-labels</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          5m32s   Env=test,Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl label pods pod1 Env-</span><br><span class="line">pod/pod1 labeled</span><br><span class="line"></span><br><span class="line">$ kubectl get pods pod1 --show-labels</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          6m54s   Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl label pods pod1 Env=dev</span><br><span class="line">pod/pod1 labeled</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f pod3.yaml</span><br><span class="line">pod/pod3 created</span><br><span class="line"></span><br><span class="line">$ kubectl apply -f pod4.yaml</span><br><span class="line">pod/pod4 created</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          9m20s   Env=dev,Tie=front</span><br><span class="line">pod2   1/1     Running   0          9m17s   Env=prod,Tie=back</span><br><span class="line">pod3   1/1     Running   0          17s     Env=test,Tie=front</span><br><span class="line">pod4   1/1     Running   0          14s     Env=gray,Tie=back</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods --show-labels -l Tie=front</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          12m     Env=dev,Tie=front</span><br><span class="line">pod3   1/1     Running   0          3m52s   Env=test,Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels -l Tie=front,Env=dev</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">pod1   1/1     Running   0          13m   Env=dev,Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels -l &#x27;Env in (dev,test)&#x27;</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          14m     Env=dev,Tie=front</span><br><span class="line">pod3   1/1     Running   0          5m35s   Env=test,Tie=front</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels -l &#x27;Env notin (dev,test)&#x27;</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod2   1/1     Running   0          15m     Env=prod,Tie=back</span><br><span class="line">pod4   1/1     Running   0          6m15s   Env=gray,Tie=back</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels -l &#x27;Env&#x27;</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE     LABELS</span><br><span class="line">pod1   1/1     Running   0          15m     Env=dev,Tie=front</span><br><span class="line">pod2   1/1     Running   0          15m     Env=prod,Tie=back</span><br><span class="line">pod3   1/1     Running   0          6m39s   Env=test,Tie=front</span><br><span class="line">pod4   1/1     Running   0          6m36s   Env=gray,Tie=back</span><br><span class="line"></span><br><span class="line">$ kubectl get pods --show-labels -l &#x27;!Env&#x27;</span><br><span class="line">No resources found.</span><br></pre></td></tr></table></figure>

<h4 id="Annotations-1"><a href="#Annotations-1" class="headerlink" title="Annotations"></a>Annotations</h4><p>kubectl.kubernetes.io&#x2F;last-applied-configuration</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl annotate pods pod1 my-annotate=&#x27;zhongmingmao&#x27;</span><br><span class="line">pod/pod1 annotated</span><br><span class="line"></span><br><span class="line">$ kubectl get pods pod1 -o yaml | head -n 11</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Pod&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;Env&quot;:&quot;dev&quot;,&quot;Tie&quot;:&quot;front&quot;&#125;,&quot;name&quot;:&quot;pod1&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;image&quot;:&quot;nginx:1.21.1&quot;,&quot;name&quot;:&quot;nginx&quot;&#125;]&#125;&#125;</span><br><span class="line">    my-annotate: zhongmingmao</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T07:43:40Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    Env: dev</span><br><span class="line">    Tie: front</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;apiVersion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Pod&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;annotations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;Env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;Tie&quot;</span><span class="punctuation">:</span> <span class="string">&quot;front&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pod1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;namespace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;spec&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;containers&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx:1.21.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="OwnerReference-1"><a href="#OwnerReference-1" class="headerlink" title="OwnerReference"></a>OwnerReference</h4><p><strong>generation: 1，observedGeneration: 1</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f rs.yaml</span><br><span class="line">replicaset.apps/rs1 created</span><br><span class="line"></span><br><span class="line">$ kubectl get rs rs1 -o yaml</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: ReplicaSet</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;ReplicaSet&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;rs1&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;replicas&quot;:2,&quot;selector&quot;:&#123;&quot;matchLabels&quot;:&#123;&quot;Env&quot;:&quot;prod&quot;&#125;&#125;,&quot;template&quot;:&#123;&quot;metadata&quot;:&#123;&quot;labels&quot;:&#123;&quot;Env&quot;:&quot;prod&quot;&#125;&#125;,&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;image&quot;:&quot;nginx:1.21.1&quot;,&quot;name&quot;:&quot;nginx&quot;&#125;]&#125;&#125;&#125;&#125;</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T08:15:25Z&quot;</span><br><span class="line">  generation: 1</span><br><span class="line">  name: rs1</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;4851&quot;</span><br><span class="line">  selfLink: /apis/extensions/v1beta1/namespaces/default/replicasets/rs1</span><br><span class="line">  uid: 207573cc-f015-4299-99ba-5ed2070cafbd</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      Env: prod</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        Env: prod</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx:1.21.1</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: nginx</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">      dnsPolicy: ClusterFirst</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      schedulerName: default-scheduler</span><br><span class="line">      securityContext: &#123;&#125;</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">status:</span><br><span class="line">  availableReplicas: 2</span><br><span class="line">  fullyLabeledReplicas: 2</span><br><span class="line">  observedGeneration: 1</span><br><span class="line">  readyReplicas: 2</span><br><span class="line">  replicas: 2</span><br></pre></td></tr></table></figure>

<p>原本已经有一个 Env&#x3D;prod 的 Pod，ReplicaSet会再创建一个Pod（rs1-bf69l），保证replicas&#x3D;2，pod1也被rs1<strong>控制</strong>了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods --show-labels</span><br><span class="line">NAME        READY   STATUS    RESTARTS   AGE    LABELS</span><br><span class="line">pod1        1/1     Running   0          35m    Env=dev,Tie=front</span><br><span class="line">pod2        1/1     Running   0          35m    Env=prod,Tie=back</span><br><span class="line">pod3        1/1     Running   0          26m    Env=test,Tie=front</span><br><span class="line">pod4        1/1     Running   0          26m    Env=gray,Tie=back</span><br><span class="line">rs1-bf69l   1/1     Running   0          4m2s   Env=prod</span><br><span class="line"></span><br><span class="line">$ kubectl get pods rs1-bf69l -o yaml | head -n 16</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T08:15:25Z&quot;</span><br><span class="line">  generateName: rs1-</span><br><span class="line">  labels:</span><br><span class="line">    Env: prod</span><br><span class="line">  name: rs1-bf69l</span><br><span class="line">  namespace: default</span><br><span class="line">  ownerReferences:</span><br><span class="line">  - apiVersion: apps/v1</span><br><span class="line">    blockOwnerDeletion: true</span><br><span class="line">    controller: true</span><br><span class="line">    kind: ReplicaSet</span><br><span class="line">    name: rs1</span><br><span class="line">    uid: 207573cc-f015-4299-99ba-5ed2070cafbd</span><br><span class="line"></span><br><span class="line">$ kubectl get pods pod2 -o yaml | head -n 19</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Pod&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;Env&quot;:&quot;prod&quot;,&quot;Tie&quot;:&quot;back&quot;&#125;,&quot;name&quot;:&quot;pod2&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;image&quot;:&quot;nginx:1.21.1&quot;,&quot;name&quot;:&quot;nginx&quot;&#125;]&#125;&#125;</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T07:43:43Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    Env: prod</span><br><span class="line">    Tie: back</span><br><span class="line">  name: pod2</span><br><span class="line">  namespace: default</span><br><span class="line">  ownerReferences:</span><br><span class="line">  - apiVersion: apps/v1</span><br><span class="line">    blockOwnerDeletion: true</span><br><span class="line">    controller: true</span><br><span class="line">    kind: ReplicaSet</span><br><span class="line">    name: rs1</span><br><span class="line">    uid: 207573cc-f015-4299-99ba-5ed2070cafbd</span><br><span class="line">    </span><br><span class="line">$ kubectl get pods pod1 -o yaml | head -n 16</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Pod&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;Env&quot;:&quot;dev&quot;,&quot;Tie&quot;:&quot;front&quot;&#125;,&quot;name&quot;:&quot;pod1&quot;,&quot;namespace&quot;:&quot;default&quot;&#125;,&quot;spec&quot;:&#123;&quot;containers&quot;:[&#123;&quot;image&quot;:&quot;nginx:1.21.1&quot;,&quot;name&quot;:&quot;nginx&quot;&#125;]&#125;&#125;</span><br><span class="line">    my-annotate: zhongmingmao</span><br><span class="line">  creationTimestamp: &quot;2021-07-11T07:43:40Z&quot;</span><br><span class="line">  labels:</span><br><span class="line">    Env: dev</span><br><span class="line">    Tie: front</span><br><span class="line">  name: pod1</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;4270&quot;</span><br><span class="line">  selfLink: /api/v1/namespaces/default/pods/pod1</span><br><span class="line">  uid: b2afe81d-630c-4455-b60e-fe82a52898ce</span><br></pre></td></tr></table></figure>

<h1 id="控制器模式"><a href="#控制器模式" class="headerlink" title="控制器模式"></a>控制器模式</h1><h2 id="控制循环"><a href="#控制循环" class="headerlink" title="控制循环"></a>控制循环</h2><ol>
<li>逻辑组件（各自独立运行）：控制器（<strong>Controller</strong>）、被控制的系统（<strong>System</strong>）、能够<strong>观测</strong>被控制系统的传感器（<strong>Sensor</strong>） </li>
<li>过程<ul>
<li>外界通过修改资源 spec 来控制资源</li>
<li>控制器比较资源 spec 和 status，从而计算一个 diff<ul>
<li>diff：最后用来会决定对系统执行什么样的控制操作</li>
</ul>
</li>
<li>控制器会使得系统产生新的输出，并被 Sensor 以资源 status 的形式上报</li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210710182325761.png" alt="image-20210710182325761"></p>
<h2 id="Sensor"><a href="#Sensor" class="headerlink" title="Sensor"></a>Sensor</h2><ol>
<li>Reflector：获取资源数据<ul>
<li>List：用来在 <strong>Controller 重启</strong>以及 <strong>Watch 中断</strong>的情况下，进行系统资源的<strong>全量</strong>更新</li>
<li>Watch：在<strong>多次 List 之间</strong>进行<strong>增量</strong>的资源更新</li>
</ul>
</li>
<li>Reflector在获取新资源数据后，会在 Delta 队列中塞入一个 Delta 记录<ul>
<li>Delta 记录：<strong>资源对象 + 事件类型</strong></li>
<li>Delta 队列中可以保证<strong>同一个资源对象在Delta队列中仅有一条记录</strong>，避免Reflector重新 List 和 Watch 时产生的重复对象</li>
</ul>
</li>
<li>Informer不断地从 Delta 队列中弹出 Delta 记录，然后将资源对象交给Indexer，最后把事件交给Event Handling Callback<ul>
<li>Indexer会把资源记录在一个<strong>缓存</strong>中，默认用资源的<strong>命名空间</strong>来做<strong>索引</strong>的，并且可以多个Controller所<strong>共享</strong></li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711145216571.png" alt="image-20210711145216571"></p>
<h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><ol>
<li>Controller：<strong>Event Handling Callback + Worker</strong></li>
<li>Event Handling Callback：关注资源的新增、更新和删除的事件，并根据控制器的逻辑决定是否需要处理</li>
<li>对于需要处理的事件，会把<strong>事件关联资源的命名空间以及名字</strong>塞入到一个工作队列中，由后续 Worker 池中的一个 Worker 来处理<ul>
<li>工作队列会对存储的对象进行去重，避免多个 Worker 处理同一个资源</li>
</ul>
</li>
<li>Worker 在处理资源对象时，一般需要用资源的名字来<strong>重新获取</strong>最新的资源数据，用来创建或者更新资源对象、调用其他外部服务等<ul>
<li>如果 Worker 处理失败，一般情况下会把资源的名字重新加入到工作队列中，方便后续重试</li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711150816206.png" alt="image-20210711150816206"></p>
<h2 id="样例-–-扩容"><a href="#样例-–-扩容" class="headerlink" title="样例 – 扩容"></a>样例 – 扩容</h2><ol>
<li>ReplicaSet：一个用来描述<strong>无状态应用的扩缩容行为</strong>的资源</li>
<li>本例中，Reflector会 Watch 到 ReplicaSet 和 Pod 两种资源的变化，产生两个 Delta 记录</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711152427548.png" alt="image-20210711152427548"></p>
<h3 id="Delta-1"><a href="#Delta-1" class="headerlink" title="Delta 1"></a>Delta 1</h3><ol>
<li>ReplicaSet发生变化后，在 Delta 队列中增加 Delta 1（<strong>Object&#x3D;rsA, Type&#x3D;Updated</strong>）</li>
<li>Informer<ul>
<li>一方面， 通过 Indexer 把<strong>新的ReplicaSet</strong>更新到缓存中，并使用 nsA 作为索引</li>
<li>另一方面，调用 Update Handler<ul>
<li>RS Controller 发现ReplicaSet发生变化后，会把字符串<strong>nsA&#x2F;rsA</strong> 加入到工作队列</li>
<li>Worker 池中的一个 Worker 从工作队列中取到<strong>nsA&#x2F;rsA</strong>的 Key，然后通过 Indexer 从缓存中取得最新的ReplicaSet</li>
<li>Worker 通过比较ReplicaSet的**spec(3)<strong>和</strong>status(2)**，发现该ReplicaSet需要扩容</li>
<li>因此Worker 创建一个 Pod（Ownereference为 rsA）</li>
<li>然后Reflector会 Watch 到 Pod 的新增事件，往Delta队列增加Delta 2（<strong>Object&#x3D;pod3,Type&#x3D;Added</strong>）</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711152128032.png" alt="image-20210711152128032"></p>
<h3 id="Delta-2"><a href="#Delta-2" class="headerlink" title="Delta 2"></a>Delta 2</h3><ol>
<li>接上，增加Delta 2（<strong>Object&#x3D;pod3,Type&#x3D;Added</strong>）</li>
<li>Informer<ul>
<li>一方面，通过 Indexer 把 pod3 记录到缓存中</li>
<li>另一方面，调用 Add Handler<ul>
<li>通过检查pod3的Ownereference找到对应的ReplicaSet，并将 nsA&#x2F;rsA 的 Key 加入到工作队列</li>
<li>Worker 在得到 nsA&#x2F;rsA 后，通过 Indexer 从缓存中获得新的rsA记录，并得到由rsA所有创建的 Pod</li>
<li>由于 rsA 的 staus（所创建的 Pod 的数量）不是最新的，更新 rsA的staus，使得 rsA 的<strong>spec(3)</strong> 和 **status(3)**达成一致</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711152149482.png" alt="image-20210711152149482"></p>
<h2 id="声明式-API"><a href="#声明式-API" class="headerlink" title="声明式 API"></a>声明式 API</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711143934721.png" alt="image-20210711143934721"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cloud-native-alibaba-1253868755.cos.ap-guangzhou.myqcloud.com/kubernetes/image-20210711144016246.png" alt="image-20210711144016246"></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a target="_blank" rel="noopener" href="https://edu.aliyun.com/course/1651">CNCF × Alibaba 云原生技术公开课</a></li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2021/07/11/cloud-native-k8s-orchestration-core-principle/">https://blog.zhongmingmao.top/2021/07/11/cloud-native-k8s-orchestration-core-principle/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/kubernetes/">Kubernetes</a><a class="post-meta__tags" href="/tags/alibaba/">Alibaba</a></div><div class="post-share"><div class="social-share" data-image="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2021/07/11/cloud-native-k8s-orchestration-deployment/" title="应用编排与管理 -- Deployment"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">应用编排与管理 -- Deployment</div></div><div class="info-2"><div class="info-item-1">作用每个 Deployment 管理一组相同的应用 Pod（相同的一个副本）    实践YAML 文件nginx-deployment123456789101112131415161718192021apiVersion: apps/v1kind: Deploymentmetadata:  name: nginx-deployment  labels:    app: nginxspec:  replicas: 3 # 期望的 Pod 数量  selector:   # Pod Selector    matchLabels:      app: nginx  template:   # Pod Template    metadata:      labels:        app: nginx    spec:      containers:        - name: nginx          image: nginx:1.7.9          ports:          - containerPort: 80  查看 Deployment123456789$ kubectl g...</div></div></div></a><a class="pagination-related" href="/2021/07/08/cloud-native-k8s-pod-container-design-pattern/" title="Kubernetes -- Pod + 容器设计模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Kubernetes -- Pod + 容器设计模式</div></div><div class="info-2"><div class="info-item-1">基本概念容器 ► Pod  ► Kubernetes 容器：一个视图被隔离、资源受限制的进程 容器 PID&#x3D;1 的进程为应用本身（管理容器 &#x3D; 管理应用）   Pod：进程组 Kubernetes：操作系统 容器镜像：软件安装包    进程组 容器是单进程模型（容器 &#x3D;&#x3D; 应用 &#x3D;&#x3D; 进程，只能管理 PID&#x3D;1 的进程，并不是说容器内只能运行一个进程） 容器内 PID&#x3D;1 的进程为应用进程，本身不具备进程管理能力 如果将 PID&#x3D;1 的进程改为 systemd，导致：管理容器 &#x3D; 管理systemd !&#x3D; 管理应用   因此需要引入 Pod     原子调度单位紧密协作：必须部署在同一台机器上并共享某些信息  关系 亲密关系 – 调度解决 两个应用（Pod）需要运行在同一台宿主机上   超亲密关系 – Pod 解决 会发生直接的文件交换 使用 localhost 或者 Socket 文件进行本地通信 会发生非常频繁的 RPC 调用 会共享某些 Linux Namespace    实现机制解决的...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2021/07/12/cloud-native-k8s-config/" title="应用配置管理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-10.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-12</div><div class="info-item-2">应用配置管理</div></div><div class="info-2"><div class="info-item-1">Pod 配置管理    Key Value    独立资源 ConfigMap    Secret    ServiceAccount   Pod.spec Resources    SecurityContext    InitContainers     ConfigMap用途 管理容器运行时所需要的配置文件、环境变量、命令行参数等可变配置 用于解耦容器镜像和可变配置，从而保证工作负载（Pod）的可移植性  创建指定键值对12345678910111213141516$ kubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charmconfigmap/special-config created$ kubectl get configmaps special-config -o yamlapiVersion: v1data:  special.how: very  special.type: charmkind: ConfigMapmetadata:  ...</div></div></div></a><a class="pagination-related" href="/2021/07/12/cloud-native-k8s-orchestration-daemonset/" title="应用编排与管理 -- DaemonSet"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-22.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-12</div><div class="info-item-2">应用编排与管理 -- DaemonSet</div></div><div class="info-2"><div class="info-item-1">作用 保证集群内每一个或者一些节点都运行一组相同的 Pod 跟踪集群节点状态，保证新加入的节点自动创建对应的 Pod 跟踪集群节点状态，保证移除的节点删除对应的 Pod 跟踪 Pod 状态，保证每个节点 Pod 处于运行状态    实践YAML 文件ds.yaml12345678910111213141516171819apiVersion: apps/v1kind: DaemonSetmetadata:  name: fluentd-elasticsearch  namespace: kube-system  labels:    k8s-app: fluentd-loggingspec:  selector:    matchLabels:      name: fluentd-elasticsearch  template: # Pod Template    metadata:      labels:        name: fluentd-elasticsearch    spec:      containers:        - name: fluentd-elasticsearch...</div></div></div></a><a class="pagination-related" href="/2021/07/12/cloud-native-k8s-orchestration-job-cronjob/" title="应用编排与管理 -- Job + CronJob"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-17.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-12</div><div class="info-item-2">应用编排与管理 -- Job + CronJob</div></div><div class="info-2"><div class="info-item-1">Job作用 创建一个或多个 Pod 来确保指定数量的 Pod 可以成功地运行终止 跟踪 Pod 状态，根据配置及时重试失败的 Pod 确定依赖关系，保证上一个任务运行完毕后再运行下一个任务 控制任务并行度，并根据配置确保 Pod 队列大小    实践YAML 文件job.yaml123456789101112131415161718apiVersion: batch/v1kind: Jobmetadata:  name: pispec:  backoffLimit: 4 # 重试次数  template:       # Pod Selector    spec:      containers:        - name: pi          image: perl          ports: null          command:            - perl            - &#x27;-Mbignum=bpi&#x27;            - &#x27;-wle&#x27;            - print bpi(2000)      restartP...</div></div></div></a><a class="pagination-related" href="/2021/07/11/cloud-native-k8s-orchestration-deployment/" title="应用编排与管理 -- Deployment"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-4.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-11</div><div class="info-item-2">应用编排与管理 -- Deployment</div></div><div class="info-2"><div class="info-item-1">作用每个 Deployment 管理一组相同的应用 Pod（相同的一个副本）    实践YAML 文件nginx-deployment123456789101112131415161718192021apiVersion: apps/v1kind: Deploymentmetadata:  name: nginx-deployment  labels:    app: nginxspec:  replicas: 3 # 期望的 Pod 数量  selector:   # Pod Selector    matchLabels:      app: nginx  template:   # Pod Template    metadata:      labels:        app: nginx    spec:      containers:        - name: nginx          image: nginx:1.7.9          ports:          - containerPort: 80  查看 Deployment123456789$ kubectl g...</div></div></div></a><a class="pagination-related" href="/2021/07/08/cloud-native-k8s-pod-container-design-pattern/" title="Kubernetes -- Pod + 容器设计模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-6.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-08</div><div class="info-item-2">Kubernetes -- Pod + 容器设计模式</div></div><div class="info-2"><div class="info-item-1">基本概念容器 ► Pod  ► Kubernetes 容器：一个视图被隔离、资源受限制的进程 容器 PID&#x3D;1 的进程为应用本身（管理容器 &#x3D; 管理应用）   Pod：进程组 Kubernetes：操作系统 容器镜像：软件安装包    进程组 容器是单进程模型（容器 &#x3D;&#x3D; 应用 &#x3D;&#x3D; 进程，只能管理 PID&#x3D;1 的进程，并不是说容器内只能运行一个进程） 容器内 PID&#x3D;1 的进程为应用进程，本身不具备进程管理能力 如果将 PID&#x3D;1 的进程改为 systemd，导致：管理容器 &#x3D; 管理systemd !&#x3D; 管理应用   因此需要引入 Pod     原子调度单位紧密协作：必须部署在同一台机器上并共享某些信息  关系 亲密关系 – 调度解决 两个应用（Pod）需要运行在同一台宿主机上   超亲密关系 – Pod 解决 会发生直接的文件交换 使用 localhost 或者 Socket 文件进行本地通信 会发生非常频繁的 RPC 调用 会共享某些 Linux Namespace    实现机制解决的...</div></div></div></a><a class="pagination-related" href="/2021/07/07/cloud-native-k8s-core-concept/" title="Kubernetes -- 核心概念"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-18.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-07</div><div class="info-item-2">Kubernetes -- 核心概念</div></div><div class="info-2"><div class="info-item-1">核心功能 Kubernetes是工业级容器编排平台，源于希腊语，意为『舵手』、『飞行员』 Kubernetes是自动化的容器编排平台：部署、弹性、管理 核心功能 服务发现与负载均衡 容器自动装箱（调度） 存储编排 自动容器恢复 自动发布与回滚 配置与密文管理 批量执行（Job） 水平伸缩（弹性）      调度Placement（红色容器）：调度器观察正在被调度容器的大小，为其寻找一个能满足其资源需求的节点   自动恢复 将失败节点上的容器迁移到健康节点   水平伸缩  架构 Master    组件 职责 扩展性    API Server 用来处理 API 操作Kubernetes中所有组件都会与 API Server 进行连接组件与组件之间一般不进行独立的连接，依赖于 API Server 进行消息的传送 水平扩展   Controller 用来完成集群状态的管理（如自动恢复、水平扩张等） 热备   Scheduler 用来完成调度操作 热备   etcd 分布式存储系统，用来存储 API Server 所需要的元数据本身为高可用系统，可以保证 Master 组件的高可用性    Node Nod...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E5%85%83%E4%BF%A1%E6%81%AF"><span class="toc-number">1.</span> <span class="toc-text">资源元信息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.1.</span> <span class="toc-text">Kubernetes资源对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Labels"><span class="toc-number">1.2.</span> <span class="toc-text">Labels</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Selector"><span class="toc-number">1.3.</span> <span class="toc-text">Selector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annotations"><span class="toc-number">1.4.</span> <span class="toc-text">Annotations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OwnerReference"><span class="toc-number">1.5.</span> <span class="toc-text">OwnerReference</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.6.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#YAML"><span class="toc-number">1.6.1.</span> <span class="toc-text">YAML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.2.</span> <span class="toc-text">操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Labels-1"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">Labels</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Annotations-1"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">Annotations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OwnerReference-1"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">OwnerReference</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">控制器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.1.</span> <span class="toc-text">控制循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sensor"><span class="toc-number">2.2.</span> <span class="toc-text">Sensor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller"><span class="toc-number">2.3.</span> <span class="toc-text">Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B-%E2%80%93-%E6%89%A9%E5%AE%B9"><span class="toc-number">2.4.</span> <span class="toc-text">样例 – 扩容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Delta-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">Delta 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delta-2"><span class="toc-number">2.4.2.</span> <span class="toc-text">Delta 2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F-API"><span class="toc-number">2.5.</span> <span class="toc-text">声明式 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">3.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/Java-Foreign-Function-API.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Foreign Function API"/></a><div class="content"><a class="title" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API">New Java Feature - Foreign Function API</a><time datetime="2025-01-16T16:06:25.000Z" title="Created 2025-01-17 00:06:25">2025-01-17</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>