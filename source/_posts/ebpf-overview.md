---
title: eBPF - Overview
mathjax: true
date: 2024-10-17 00:06:25
cover: https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf.png
categories:
  - eBPF
tags:
  - eBPF
  - Observability
---

# eBPF

> Extended Berkeley **Packet Filter**

1. **eBPF** 是一种**数据包过滤**技术，从 **BPF** 技术扩展而来
2. **BPF** 提供了一种在**内核事件**和**用户程序事件**发生时**安全注入代码**的机制，让**非内核开发人员**也可以对**内核**进行**控制**
3. 随着内核的发展，BPF 从最初的**数据包过滤**，扩展到**网络**、**内核**、**安全**、**跟踪**等，扩展后的 BPF 被称为 **eBPF**，早期的 BPF 被称为**经典 BPF**，即 **cBPF**
4. **现代内核**所运行的都是 **eBPF**

<!-- more -->

# 特性

1. 在 eBPF 之前，**内核模块**是**注入内核**的最主要机制
2. 由于缺乏对**内核模块**的**安全控制**，内核的**基本功能**很容易被一个有**缺陷**的内核模块**破坏**
3. **eBPF** 借助 **JIT**，在**内核**中运行一个**虚拟机**，保证只有**被验证安全**的 **eBPF 指令**才会被内核执行
4. 同时，**eBPF 指令**依然运行在**内核**中，**无需向用户态复制数据**，极大地提高了**事件处理**的效率
5. eBPF 在**故障诊断**、**网络优化**、**安全控制**、**性能监控**等领域获得了大量应用
   - 高性能网络负载均衡器 - **Katran**
   - 容器网络方案 - **Cilium**
   - 内核跟踪排错工具 - **BCC** + **bpftrace**

# 概览

![image-20250206234335580](https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250206234335580.png)

# 技术栈

> 掌握 **eBPF** 并不需要掌握**内核开发**

1. **开源项目**已经提供了**大量工具**，能解决故障诊断、性能监控、安全控制等**绝大部分场景**中的问题
2. 需要**开发**新的 **eBPF 程序**时，**内核社区**提供了**libbpf** 库
   - **避免直接调用内核函数**
   - 提供**跨内核版本**的**兼容性** - **一次编译到处执行**

![dcd84984b168a5534d69a445b08c692d](https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/dcd84984b168a5534d69a445b08c692d.jpg)
