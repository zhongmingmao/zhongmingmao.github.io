---
title: RAG - Chatbot
mathjax: true
date: 2024-08-10 00:06:25
cover: https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20240903105543068.png
categories:
  - AI
  - RAG
tags:
  - AI
  - LLM
  - RAG
  - ChatOps
  - Chatbot
---

# Fine-tuning vs RAG

> 核心诉求 - **实时更新**知识库，不需要模型去深度探讨问题，使用**已有知识经验**去解答问题

|          | Fine-tuning                                        | RAG                                            |
| -------- | -------------------------------------------------- | ---------------------------------------------- |
| 知识整合 | 直接把数据融入到**模型参数**                       | 存储在**外部知识库**                           |
| 知识更新 | 每次更新内容都需要**重新训练模型**，更新成本**高** | 只需要在外部知识库**插入记录**，更新成本**低** |
| 响应速度 | 很快，**直接给出回答**                             | 现在**外部知识库**进行**检索**，然后再**生成** |
| 实时更新 | 很难做到实时更新                                   | 外部知识库可以**实时更新**                     |
| 人为干预 | 只能通过 **Prompt** 干预                           | 可以通过**外部知识库的语料**和 **Prompt** 控制 |
| 领域定制 | 可以针对**特定领域**进行**深度定制**               | 依赖**通用模型能力**                           |

<!-- more -->

> 适合使用 Fine-tuning 的场景

1. 特定场景下的**高一致性**和**定制化**
2. 数据量**充足**且**稳定**
   - **训练** - 拥有**高质量**的**对话原始数据**
   - **微调** - 基于现有对话数据做对话助手
3. **强个性化**需求
   - 文言文的理解和输出 - 需要使用**大量**文言文语料**微调**后，才能满足需求
4. **高速响应**
   - Fine-tuning 能够**直接输出**有效内容，而 RAG 需要先**检索**再**生成**

# LLM

1. LLM 针对**输入**是有**长度限制**的，计量单位为 **Token**（英文单词、英文短语、汉字）
2. GPT-3.5 的最大 Token 数为 **4K**，包含了**输入**和**输出**的总和

# 架构

![image-20240903121555102](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20240903121555102.png)

# 实现

## Context

![image-20240903122544420](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/image-20240903122544420.png)

## Framework

> LlamaIndex

![star-history-framework](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/star-history-framework.png)

## SSE vs WebSocket

> HTTP Server-Sent Events - 流式对话

|            | SSE                                                    | WebSocket                                                   |
| ---------- | ------------------------------------------------------ | ----------------------------------------------------------- |
| 通信方向   | **单向**通信                                           | **双向**通信                                                |
| 协议       | 基于 HTTP 协议<br />**兼容性好**，各种网关防火墙都支持 | 基于 WebSocket 协议<br />需要整条链路的网关都支持 WebSocket |
| 自动重连   | 自带**重连**机制                                       | 需要手动实现                                                |
| 性能       | 轻量，服务器资源占用低                                 | 每个应用都会占用一个 WebSocket 连接                         |
| 浏览器支持 | 除 IE 外                                               | 基本都支持                                                  |

