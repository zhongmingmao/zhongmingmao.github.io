---
title: RAG - Data Processing
mathjax: true
date: 2024-08-07 00:06:25
cover: https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/rag-data-processing.png
categories:
  - AI
  - RAG
tags:
  - AI
  - RAG
  - LLM
---

# æ•°æ®å­˜å‚¨

1. LLM å˜æˆ**ç”Ÿäº§åŠ›**ï¼Œæœ‰ä¸¤ä¸ªåˆ¶çº¦å› ç´  - äº¤äº’è¿‡ç¨‹ä¸­çš„**é•¿æ–‡æœ¬** + å†…å®¹çš„**å®æ—¶æ›´æ–°**
2. åœ¨**ä¼ ç»Ÿ**çš„åº”ç”¨å¼€å‘ä¸­ï¼Œæ•°æ®å­˜å‚¨åœ¨**æ•°æ®åº“**ä¸­ï¼Œä¿ç•™äº†åº”ç”¨çš„**å…¨éƒ¨è®°å¿†**
3. åœ¨ AI æ—¶ä»£ï¼Œ**å‘é‡æ•°æ®åº“**å……å½“äº†è¿™ä¸€è§’è‰²
   - åœ¨ RAG ç³»ç»Ÿä¸­ï¼Œæ•°æ®è¢«è½¬æ¢ä¸º**é«˜ç»´å‘é‡**å½¢å¼ï¼Œä½¿å¾—è¯­è¨€æ¨¡å‹èƒ½å¤Ÿè¿›è¡Œé«˜æ•ˆçš„**è¯­ä¹‰ç›¸ä¼¼åº¦**è®¡ç®—å’Œæ£€ç´¢
4. åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼ŒæŸ¥æ‰¾å˜æˆäº†**è®¡ç®—**æ¯æ¡è®°å½•çš„**å‘é‡è¿‘ä¼¼åº¦**ï¼Œç„¶åæŒ‰ç…§**åˆ†å€¼**å€’åºè¿”å›ç»“æœ
5. RAG å°±**å¦‚ä½•å­˜å‚¨å‘é‡**çš„æ–¹æ³•è®ºï¼Œæ ¹æ®ä¸åŒçš„**å®ç°ç­–ç•¥**ï¼Œè¡ç”Ÿå‡ºäº†ä¸åŒçš„ RAG æŠ€æœ¯
   - åˆ©ç”¨**å›¾ç»“æ„**è¡¨ç¤ºå’Œæ£€ç´¢çŸ¥è¯†çš„ **GraphRAG**
   - ç»“åˆçŸ¥è¯†å›¾è°±å¢å¼ºç”Ÿæˆèƒ½åŠ›çš„ **KG-RAG** - Knowledge Graph Augmented Generation
6. AI åº”ç”¨çš„**æ•°æ®å»ºæ¨¡**å¼ºè°ƒçš„æ˜¯æ•°æ®çš„**è¯­ä¹‰è¡¨ç¤ºå’Œå…³è”**ï¼Œä»¥æ”¯æŒæ›´çµæ´»çš„**æŸ¥è¯¢**å’Œ**æ¨ç†**
7. **é«˜è´¨é‡çš„æ•°æ®å¤„ç†**ï¼Œä¸ä»…å½±å“**æ£€ç´¢çš„å‡†ç¡®æ€§**ï¼Œè¿˜ç›´æ¥å†³å®šäº† LLM **ç”Ÿæˆå†…å®¹çš„è´¨é‡å’Œå¯é æ€§**

<!-- more -->

# Embedding

1. å°†æ‰€æœ‰å†…å®¹è½¬æˆ**æ–‡æœ¬** + **é¢å¤–æ•°æ®**ï¼ˆç”¨æ¥å…³è”æ•°æ®ï¼‰
2. é€‰æ‹©ä¸€ä¸ª **Embedding** æ¨¡å‹ï¼ŒæŠŠ**æ–‡æœ¬**è½¬æˆ**å‘é‡**ï¼Œå¹¶å­˜å‚¨åˆ°**å‘é‡æ•°æ®åº“**ä¸­

| å‚å•†   | LLM      | Embedding                                                    | å›½äº§ |
| ------ | -------- | ------------------------------------------------------------ | ---- |
| ç™¾åº¦   | æ–‡å¿ƒä¸€è¨€ | Embedding-V1<br />bge-large-zh<br />bge-large-en<br />tao-8k |      |
| é˜¿é‡Œ   | é€šä¹‰åƒé—® | text-embedding-v1<br />text-embedding-async-v1<br />text-embedding-v2<br />text-embedding-async-v2 | Y    |
| æ™ºè°±   | ChatGLM  | Embedding-3<br />Embedding-2                                 | Y    |
| OpenAI | GPT ç³»åˆ— | text-embedding-3-small<br />text-embedding-3-large<br />text-embedding-ada-002 | N    |
| Cohere | Cohere   | embed-english-v3.0<br />embed-multilingual-v3.0<br />embed-english-light-v3.0<br />embed-multilingual-light-v3.0 | N    |

# å‘é‡æ•°æ®åº“

| åç§°         | å¼€æº | åˆ†å¸ƒå¼éƒ¨ç½² | è¯­è¨€              | ç‰¹æ€§                                                         |
| ------------ | ---- | ---------- | ----------------- | ------------------------------------------------------------ |
| Pinecone     | å¦   | æ˜¯         | Python / Go       | æ‰˜ç®¡æœåŠ¡ï¼Œä¸“æ³¨é«˜æ•ˆç›¸ä¼¼æ€§æœç´¢<br />æ”¯æŒå®æ—¶æŸ¥è¯¢å’Œæ‰©å±•         |
| **Faiss**    | æ˜¯   | æ˜¯         | C++ / Python      | A library for efficient similarity search and clustering of dense vectors. |
| **Milvus**   | æ˜¯   | æ˜¯         | C++ / Go / Python | å¼€æº + æ”¯æŒ**å¤§è§„æ¨¡**å‘é‡æœç´¢<br />æ”¯æŒ**æ··åˆæœç´¢**å’Œ**ç»„ä»¶çº§æ‰©å±•** |
| **Qdrant**   | æ˜¯   | æ˜¯         | **Rust**          | **é«˜æ•ˆ**è¯­ä¹‰æœç´¢ + **å®æ—¶æ›´æ–°**<br />ä¸°å¯Œçš„è¿‡æ»¤æ”¯æŒ          |
| **Weaviate** | æ˜¯   | æ˜¯         | Go                | **äº‘åŸç”Ÿ** + æ”¯æŒ **AI æœç´¢**<br />**GraphQL** æ¥å£ + çµæ´»çš„æ¨¡å¼ç®¡ç† |
| **Chroma**   | æ˜¯   | æ˜¯         | Python            | **AI åº”ç”¨ä¼˜åŒ–**ï¼Œçµæ´» API æ”¯æŒ<br />æ•°æ®ç®¡ç†ç®€ä¾¿             |

![star-history-vector-db](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/star-history-vector-db.png)

![vector](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/vector.webp)

1. å‘é‡æ•°æ®åº“æ˜¯ä¸€ç§ä¸“é—¨ä¸ºå­˜å‚¨ã€ç®¡ç†å’ŒæŸ¥è¯¢**é«˜ç»´å‘é‡**æ•°æ®è€Œè®¾è®¡çš„æ•°æ®åº“
2. å‘é‡æ•°æ®åº“ï¼Œåœ¨æ•°æ®åº“é‡Œå­˜ä¸€ä¸ª**å›ºå®šé•¿åº¦**çš„å‘é‡ï¼Œæ¯ä¸ª**å…ƒç´ **éƒ½æ˜¯**å°æ•°**
3. æŸ¥è¯¢å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‘é‡ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œè®¡ç®—ä¸¤ä¸ªå‘é‡çš„**è·ç¦»**ï¼Œç„¶åæŒ‰ç…§è·ç¦»å€’æ’ï¼Œæ‰¾åˆ°æœ€è¿‘çš„è®°å½•

# Qdrant

## æ¦‚è¿°

> **Vector Search Engine** for the next generation of **AI applications**

1. **Qdrant** (read: *quadrant*) is a **vector similarity search engine** and **vector database**.
2. It provides a **production-ready** service with a **convenient API** to **store**, **search**, and **manage** pointsâ€”vectors with an **additional payload**
3. Qdrant is tailored to **extended filtering** support.
4. It makes it useful for all sorts of **neural-network** or **semantic-based matching**, faceted search, and other applications.
5. Qdrant is written in **Rust** ğŸ¦€, which makes it **fast** and **reliable** even under high load.
6. With Qdrant, **embeddings** or **neural network encoders** can be turned into **full-fledged applications** for **matching**, **searching**, **recommending**, and much more!
7. API - **REST** / **gRPC**

## è·ç¦»

| Algorithm  | Desc                                                         |
| ---------- | ------------------------------------------------------------ |
| ä½™å¼¦ç›¸ä¼¼åº¦ | é€‚ç”¨äº**æ¯”è¾ƒ**å‘é‡çš„**æ–¹å‘**ï¼Œä¸è€ƒè™‘å‘é‡çš„**å¤§å°** - æ–‡æœ¬ç›¸ä¼¼åº¦ã€ä¿¡æ¯æ£€ç´¢ |
| æ¬§å¼è·ç¦»   | é€‚ç”¨äº**åº¦é‡**ä¸¤ç‚¹ä¹‹é—´çš„**ç›´çº¿è·ç¦»**ï¼Œè€ƒè™‘å‘é‡çš„**å¤§å°**å’Œ**æ–¹å‘** - å‡ ä½•è®¡ç®—ã€å›¾åƒå¤„ç†ç­‰ |
| ç‚¹ç§¯       | é€‚ç”¨äº**åº¦é‡**å‘é‡çš„**ç›¸å¯¹ä½ç½®å’Œæ–¹å‘** - çº¿æ€§ä»£æ•°å’Œä¿¡å·å¤„ç†ç­‰**ç¦»æ•£æ•°æ®è®¡ç®—** |
| æ›¼å“ˆé¡¿è·ç¦» | é€‚ç”¨äº**åº¦é‡**ä¸¤ç‚¹ä¹‹é—´çš„**ç½‘æ ¼è·ç¦»**ï¼Œé€‚åˆ**ç½‘æ ¼çŠ¶**æˆ–**ç¦»æ•£ç©ºé—´** - è·¯å¾„è§„åˆ’ã€ç‰¹å¾å·¥ç¨‹ç­‰ |

## æ¶æ„

![qdrant_overview_high_level](https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/qdrant_overview_high_level.png)

### æ•°æ®å¤„ç†

1. å¼€å‘è€…é’ˆå¯¹æ–‡æ¡£ç­‰èµ„æ–™è¿›è¡Œæ•´ç†å’Œåˆ†å‰²ï¼Œé€šè¿‡ **Embedding æ¨¡å‹**è®¡ç®—å‡º **Chunk å‘é‡**
2. ç„¶åå°†**å‘é‡**å’Œå‘é‡å…³è”çš„æ•°æ®ï¼ˆ**Playload**ï¼‰å†™å…¥åˆ° Qdrant

### æ•°æ®æŸ¥è¯¢

1. åº”ç”¨é€šè¿‡ SDK æˆ–è€…æ¥å£è®¿é—® Qdrant
2. é€šè¿‡æŸ¥è¯¢å‚æ•°ï¼ˆå‘é‡+å­—æ®µï¼‰ï¼Œåœ¨å‘é‡æ•°æ®åº“ä¸­æ‰¾åˆ°å‘é‡**è·ç¦»æœ€è¿‘**çš„è®°å½•
3. æŒ‰ç…§è·ç¦»**æ’åº**åï¼Œè¿”å›ç»™åº”ç”¨ï¼Œåº”ç”¨æ‹¿åˆ°å¯¹åº”è®°å½•ï¼Œé€šè¿‡ Playload ç»§ç»­åç»­çš„æ“ä½œ

### åŸºæœ¬æ¦‚å¿µ

1. **Collections**
   - ç±»ä¼¼äº MySQL ä¸­çš„**è¡¨**ï¼Œé‡Œé¢å­˜å‚¨å®é™…çš„è®°å½•
2. **Points**
   - ç±»ä¼¼äº MySQL ä¸­çš„**è®°å½•**ï¼Œç”± 3 éƒ¨åˆ†ç»„æˆ
   - idx - å”¯ä¸€ ID
   - vector - å›ºå®šé•¿åº¦çš„å‘é‡ï¼Œåœ¨åˆ›å»º Collection æ—¶ï¼Œå·²ç»ç¡®å®š
   - playload - JSON å¯¹è±¡ï¼Œæ ¸å¿ƒæ•°æ®
3. **Storage**
   - vector å’Œ playload ä¼š**åˆ†å¼€å­˜å‚¨**ï¼Œé€šè¿‡ **payload ç´¢å¼•**è¿›è¡Œå…³è”
     - ä¸ºäº†ä¿è¯**æ•°æ®å®Œæ•´**ï¼ŒQdrant ä½¿ç”¨ **WAL ä¸¤é˜¶æ®µæäº¤** - Write-Ahead Logging
   - vector å­˜å‚¨
     - **InMemory** - æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åŠ è½½åˆ°å†…å­˜ï¼Œè¶…é«˜æ€§èƒ½ï¼Œåªæœ‰åœ¨éœ€è¦æŒä¹…åŒ–æ—¶æ‰ä¼šå†™å…¥ç£ç›˜
     - **Memmap** - å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å…³è”åˆ°**è™šæ‹Ÿå†…å­˜åœ°å€**
   - playload å­˜å‚¨
     - **InMemory**
     - **OnDisk** - ç›´æ¥å­˜å‚¨åˆ°å†…ç½®çš„ **RocksDB** ä¸­

## å®è·µç»éªŒ

1. å‘é‡æ•°æ®åº“å¤„äº**é«˜é€Ÿå‘å±•**é˜¶æ®µï¼Œéœ€è¦æŒç»­å…³æ³¨
2. å‘é‡æ˜¯æ²¡åŠæ³•ä¿®æ”¹çš„ï¼Œåœ¨æµ‹è¯•é˜¶æ®µï¼Œä¸è¦å…¨é‡å†™å…¥ï¼Œ**èŠ‚çœ Embedding è´¹ç”¨**
   - å¦‚æœæ–‡æœ¬çš„**åˆ‡ç‰‡è§„åˆ™**å‘ç”Ÿå˜åŠ¨çš„è¯ï¼Œä¹Ÿä¼šæ¶‰åŠåˆ°**å…¨é‡** Collection æ›´æ–° - **é«˜æˆæœ¬**
3. **Collection** çš„å‘é‡ç»´åº¦è¦ä¸ **Embedding æ¨¡å‹**ä¿æŒä¸€è‡´
4. **Payload** ä¸­å¯ä»¥**è‡ªå®šä¹‰æ•°æ®**
   - ä½†ä¸è¦åœ¨ Payload ä¸­å­˜å‚¨**é•¿æ–‡æœ¬**ï¼Œåªå­˜æ”¾**å…³é”®**çš„ ID æ•°æ®ï¼Œ**ç¡®å®šæ€§**çš„ä¿¡æ¯ä½¿ç”¨**ä¼ ç»Ÿæ•°æ®åº“**
5. Qdrant # **write_consistency_factor**
   - å‰¯æœ¬æ•°é‡ - éœ€è¦å¹³è¡¡**ä¸€è‡´æ€§**å’Œ**æ€§èƒ½** - ç±»ä¼¼äº **Kafka**
6. ä¸ºäº†**é€šç”¨æ€§**ï¼Œä¼ å…¥çš„**é•¿æ–‡æœ¬**ï¼Œç»Ÿä¸€æŠ½è±¡ä¸º **document**ï¼Œè€Œæ–‡æ¡£**æ‹†åˆ†**åçš„å—ç»Ÿä¸€æŠ½è±¡ä¸º **node**
7. æ•°æ®**è‡ªåŠ¨æ›´æ–°** + è´¨é‡ç›‘æ§ï¼ˆ**å‰”é™¤ä½æ•ˆæ•°æ®**ï¼‰

