---
title: MQ - Context
mathjax: true
date: 2024-10-06 00:06:25
cover: https://mq-1253868755.cos.ap-guangzhou.myqcloud.com/0ccbe5e6-1c1d-4316-b8c0-96abf58ed229_1446x680.jpg
categories:
  - MQ
tags:
  - MQ
---

# MQ

1. 消息队列 - 具有**缓冲**作用、具备**发布**和**订阅**能力的**存储引擎**
2. 消息队列的**最基本**功能 - **生产** + **消费**
3. 标准消息队列 - **功能齐全**
   - 在发布订阅的基础上，高阶能力 - **死信队列**、**顺序消息**、**延时消息**等
   - 实现**高吞吐**、**低延时**、**高可靠**的特征

<!-- more -->

# 社区

| Year   | MQ             |
| ------ | -------------- |
| < 2000 | 史前消息队列   |
| 2001   | JMS - ActiveMQ |
| 2006   | AMQP           |
| 2007   | RabbitMQ       |
| 2011   | Kafka          |
| 2013   | RocketMQ       |
| 2017   | **Pulsar**     |

## Timeline

## Kafka

1. Kafka 于 **2011** 年贡献给 **ASF**，主要满足**大数据**领域中的**高吞吐量**、**低延迟**的场景
2. 核心功能简单，只提供**生产**和**消费**，后来加入了**幂等**和**事务**

## RabbitMQ

1. RabbitMQ 于 **2007** 年开源，使用 Erlang，主要满足业务中**消息总线**的场景
2. 特点为功能丰富（支持**延时消息**、**死信队列**、**优先级队列**、**事务消息**等），在**低流量**下**稳定性较高**
3. 缺点 - 在**大流量**的情况下，会有明显的**性能瓶颈**和**稳定性分险**
4. **ActiveMQ** 基于 **JMS** 协议（国内较少使用），而 **RabbitMQ** 基于 **AMQP** 协议
5. **AMQP** 是消息队列**协议规范**，并非一款具体的消息队列
   - 不同消息队列的**访问协议**是不一样的，导致不同的消息队列需要用到**不同的 SDK** 访问

## RocketMQ

1. RocketMQ 由阿里于 2013 年研发，**2016** 年开源，可满足**大规模**的**微服务**场景
   - **功能丰富**，基本可以满足**业务消息**场景下的**所有需求**
   - **稳定性**、**数据可靠性**表现较好
   - **性能**介于 **RabbitMQ** 和 **Kafka** 之间
   - **RocketMQ** 的定位为 **RabbitMQ** 的升级版
2. **功能**
   - RocketMQ 与 **RabbitMQ** 类似，**功能丰富**，常用于**业务消息**
   - RocketMQ 在**移动互联网**浪潮下发展起来，场景更复杂，支持更多功能 - **消息 Tag**、**消息轨迹**、**消息查询**等
3. **架构+性能**
   - **RabbitMQ** 在设计时，**分布式的设计理念**不成熟，导致其在**架构**上**存在较大缺陷**
     - 在遇到**大流量**、**高并发**的时候，容易出现**集群不可用**、**网络分区**等情况
   - **RocketMQ** 在**分布式架构**上实现得更**合理优雅**，在**大流量**、**高并发**的场景下表现**优秀稳定**

## Pulsar

1. Pulsar 于 **2017** 年由 Yahoo 开发
   - 一开始定位为**流计算**领域，同时发展**消息**和**流**两个方向
   - 架构设计优秀 - **计算存储分离**、弹性、多租户
   - 在**功能**上，追赶 **RabbitMQ** 和 **RocketMQ**；在**性能**上，与 **Kafka** 相当，但**稳定性**有待提升
2. **功能**
   - Pulsar 与 Kafka 类似，主要定位在**流领域**，主打**大吞吐**的**流式计算**
   - **Kafka** 的功能相对简单，支持基本的**发布订阅**、**幂等**、**事务消息**
   - **Pulsar** 在 **Kafka** 的基础上，有望支持 **RocketMQ** 和 **RabbitMQ** 功能，**功能最为丰富**
3. **架构+性能**
   - **Pulsar** 的架构设计比 Kafka 更符合当下**云原生架构**
   - **Pulsar** 的定位为 **Kafka** 的升级版，主要解决 Kafka 的一些痛点问题
     - 集群**扩缩容慢**
     - **分区迁移**需要 **Rebalance**
     - 无法支持**超多分区**
   - Pulsar 与 Kafka 目前**没有特别大的性能差距**
4. Pulsar **发展时间短**且**架构复杂**，支持较多功能，**稳定性**不如 Kafka

# 演进

|      | 发展趋势                                |
| ---- | --------------------------------------- |
| 需求 | **消息 -> 流 -> 消息与流融合**          |
| 架构 | **单机 -> 分布式 -> 云原生/Serverless** |

1. 在 90 年代到 21 世纪初，以 **AMQP** 为代表的 MQ 主要满足**业务**上对**消息**的需求 - **异步通信** + **架构解耦**
2. 2010 年左右，移动互联网兴起，传统的 MQ 在架构上无法满足**大流量高吞吐**的需求 - **Kafka** - **分布式**
3. 随着场景越来越复杂，**业务消息**的数据量越来越大
   - 基于 **AMQP** 的 **RabbitMQ** 在**性能**和**架构**上无法满足需求 - **RocketMQ**
4. 随着**云原生**和 **Serverless** 的兴起，在**弹性**和**成本**的驱动下
   - MQ 利用云上的**弹性计算和存储**等基础设施去实施**架构**上的 **Serverless**
   - **按需使用**、**按量付费**，最终达到**免运维**、**低成本**
5. 随着**云原生架构设计**的 **Pulsar** 开始走向成熟，**业界的 MQ** 也出现了**计算存储分离**、**分层存储**、**多租户**、**弹性计算**等概念

# 消息 + 流

1. 概念
   - 消息 - 即**业务消息**，在业务架构（**微服务架构**）中用来作为**消息**传递，作为系统的**消息总线**
   - 流 - 在**大数据架构**中用来做**大流量**时的**数据削峰**
2. 在**业务消息**中，经常使用 **RocketMQ** 或者 **RabbitMQ**，而在**大数据系统**中，经常使用 **Kafka** 或者 **Pulsar** - 更高的**研发**和**运维**成本

| MQ           | Message + Streaming                                          |
| ------------ | ------------------------------------------------------------ |
| ~~RabbitMQ~~ | 因为开发语言、架构和社区的活跃度和定位等原因，基本不会走这个方向 |
| Kafka        | 虽然强调云原生，但主要工作在自身的**架构优化**上（如移除 ZooKeeper），在**消息方向**暂时没有提出明确的概念 |
| RocketMQ     | 在**消息领域**已经非常成熟，社区希望打通**流**的场景         |
| **Pulsar**   | 新兴架构，没有历史包袱，主打**云原生**的**消息**和**流**的融合架构，希望满足**更多场景**，解决更多业务需求 |

> 降本增效

1. **弹性计算** - **计算存储分离**架构
2. **低存储成本** - **分层存储**
3. **资源复用** - **多租户**
