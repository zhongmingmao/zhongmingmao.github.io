---
title: Beam - Paradigm
mathjax: true
date: 2024-09-24 00:06:25
cover: https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-beam-model.webp
categories:
  - Big Data
  - Beam
tags:
  - Big Data
  - Beam
---

# Why

1. Apache Beam 本身并不是一个**数据处理平台**，本身也无法对数据进行处理
   - Apache Beam 所提供的是一个**统一的编程模型**思想
   - 通过 Apache Beam 统一的 API 来编写处理逻辑，该处理逻辑会被转化为**底层运行引擎相应的 API** 去运行
2. SDK 会变，但背后的**设计原理**却不会改变

<!-- more -->

# 生态

![image-20241119165246495](https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241119165246495.png)

| Layer                      | Desc                                                         |
| -------------------------- | ------------------------------------------------------------ |
| Runner                     | **现有**的各种大数据处理平台，如 Apache **Spark**、Apache **Flink** |
| **可移植**的**统一模型层** | 各个 Runner 将会依据中间**抽象**出来的模型思想<br />**Runner** 将**提供**一套**符合该模型**的 **APIs** 出来，以供上层转换 |
| SDK                        | 提供不同语言版本的 API 来编写数据处理逻辑<br />这些数据处理逻辑会被转换成 **Runner 中相应的 API** 来运行 |

# 基本概念

1. 数据可以分成**有界数据**和**无界数据**
   - 其中有界数据是无界数据的**特例**，可以将所有的数据**抽象**看作**无界数据**
2. 每个数据都有两个**时域**，即**事件时间**和**处理时间**
   - 处理无界数据时，数据会有**延迟**、**丢失**的情况
   - 因此，无法保证是否接收完了**所有发生在某一时刻之前**的数据 - **事件时间**
   - **流处理**必须在**数据的完整性**和**数据处理的延时**性上做出**取舍**

## Window

1. 窗口将**无界数据**根据**事件时间**分成一个个**有限**的数据集 - **批处理**的特例
2. 在**批处理**中，可以把一个**无限小**到**无穷大**的时间窗口赋予给数据集

## Watermark

1. 水位线是用来表示与数据**事件时间**相关联的**输入完整性**的概念
2. 对于**事件时间**为 **X** 的水位线
   - 数据处理逻辑已经得到了**所有事件时间小于 X** 的**无界数据**
3. 在数据处理中，水位线是用来测量**数据进度**的

## Triggers

1. 触发器指的是表示**具体在什么时候**，数据处理逻辑会**真正**地触发**窗口中的数据**被**计算**
2. 触发器能让我们可以在有需要时对数据进行**多次运算**
   - 如某时间窗口内的数据有**更新**，这一窗口内的数据结果需要**重新计算**

## Accumulation

1. 累加模式指的是如果我们在**同一窗口**中得到**多个运算结果**，应该如何处理这些运算结果
2. 这些结果之间可能**完全不相关**，但也可能会**重叠**在一起

# 编程模型

## WWWH

> **What** results are being calculated?

1. 明确需要做的计算，得到怎样的结果 - Beam SDK 中的各种 **transform** 操作
2. 包括常用的批处理逻辑、训练机器学习模型的逻辑等

> **Where** in **event time** they are being computed?

1. 计算在什么**事件时间范围**的数据 - **窗口**

> **When** in **processing time** they are materialized?

1. 何时将**计算结果**输出 - 可以通过**水位线**和**触发器**配合触发计算
2. 在 Apache Beam 中，可以有多种多样的**触发器信号**
   - 根据**处理时间**的信号来触发 - 即**每隔一段时间**则重新计算一遍窗口中的数据
   - 根据**元素计数**的信号来触发 - 即在一个窗口中的数据达到一定的数量，则计算该窗口中的数据

> **How** earlier results relate to later refinements?

1. 后续数据的处理结果如何影响之前的处理结果 - **累加模式**
2. 常见的累加模式 - **丢弃**（结果之间是独立且不同的）、**累积**（后来的结果是建立在先前的结果上）
3. 每一次通过**计算一个窗口**中的数据而得到的结果，称之为**窗格**（Pane）
   - 累加模式中的丢弃，实际丢弃的是窗格

## 小结

1. Beam 编程模型是将**所有的数据处理逻辑**都分割成**四个维度**，统一成了 Beam SDK
2. 基于 Beam SDK 构建数据处理业务逻辑时
   - 只需要根据业务需求，按照这四个维度调用具体的 API，即可生成符合要求的数据处理逻辑
   - Beam 会**自动转化**数据处理逻辑，并提交到具体的 **Runner** 上去执行
3. 无论是 **Runner 自身的 API** 还是 **Beam 的 SDK 设计**，都需要有能力去解决上述四个问题
4. Beam 编程模型贯穿 Beam 生态圈中的每一层
