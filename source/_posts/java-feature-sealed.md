---
title: Java Feature - Sealed
mathjax: true
date: 2024-10-11 00:06:25
cover: https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/java-feature-sealed.png
categories:
  - Java
  - Feature
tags:
  - Java
  - Java Feature
---

# 概述

1. **封闭类**在 **JDK 17** 正式发布

<!-- more -->

# OOP

> 问题根源 - **无限制的扩展性**

![image-20241204185327701](https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241204185327701.png)

# 限制可扩展性

1. **OOP** 的最佳实践 - 把**可扩展性**限制在**可控范围**，而不是**无限**的扩展性
2. **继承**的**安全缺陷**
   - 一个**可扩展**的类，**子类**和**父类**可能会**相互影响**，导致**不可预知**的行为
   - 涉及**敏感信息**的类，增加可扩展性并非优先选项，尽量避免父类或者子类的影响
3. 设计 API
   - 一个**类**，如果没有真实的**可扩展**需求，使用 **final** 修饰符
   - 一个**方法**，子类如果没有**重写**的必要性，使用 **final** 修饰符
4. 限制**不可预测**的**可扩展性**，可以实现代码的**安全性**和**健壮性**
5. 在 **JDK 17** 之前，限制可扩展性的两种方法 - 使用**私有类**或者 **final** 修饰符
   - **私有类**不是公开接口，只能**内部使用**，而 **final** 修饰符**彻底放弃**了**可扩展性**
   - 可扩展性 - **全开放** or **全封闭**
6. 从 **JDK 17** 开始
   - 使用类修饰符 **sealed** 修饰的类是**封闭类**，使用类修饰符 **sealed** 修饰的接口是**封闭接口**
   - 封闭类和封闭接口 - **限制**可以扩展或实现它们的其它类或接口
   - 把**可扩展性**限制在**可控范围**

# 封闭类

1. 被扩展的**父类**称为**封闭类**，扩展而来的**子类**称为**许可类**
2. 使用类修饰符 **sealed** 声明**封闭类**
   - 在所有的 **extends** 和 **implements** 语句之后，使用 **permits** 指定**允许扩展**该**封闭类**的**子类**
3. 由 **permits** 关键字指定的**许可子类**，必须和**封闭类**处于同一个 **module** 或者 **package**
   - 如果**封闭类**和**许可类**在**同一个 module** 中，它们可以处于**不同的 package**
4. 如果允许**许可子类**和**封闭类**在**同一个源码文件**中，封闭类可以**不使用 permits 语句**
   - **编译器**将**检索源码文件**，在**编译期**为封闭类添加上许可子类
   - 最佳实践 - **总是使用 permits 语句** - 语义明确 + 可读性强

![image-20241204194040271](https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241204194040271.png)

# 许可类

> 约束

1. **许可类**必须和**封闭类**处于同一 **module** 或者 **package** - 在**编译**期间，封闭类**可以访问**它的许可类
2. **许可类**必须是**封闭类**的**直接扩展类** - 许可类**不具备传递性**
3. **许可类**必须声明**是否继续保持封闭**
   - **许可类**可以声明为终极类（**final**），**关闭扩展性**
   - **许可类**可以声明为封闭类（**sealed**），**延续受限的扩展性**
   - **许可类**可以声明为解封类（**non-sealed**），支持**不受限制的扩展性**

> Circle 是解封类，Square 是封闭类，ColoredSquare 是终极类
> ColoredCircle 既不是封闭类，也不是许可类
>
> Square 是 Shape 的许可类，ColoredSquare 是 Square 的许可类，但 **ColoredSquare 并非 Shape 的许可类**

![image-20241204200048232](https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241204200048232.png)

# 限定优先级

> **由高到低**

1. 使用**私有类**
2. 使用 **final** 修饰符
3. 使用 **sealed** 修饰符
4. 不受限制的扩展性
