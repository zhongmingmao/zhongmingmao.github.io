---
title: Cloud Computing - Virtual network
mathjax: false
date: 2022-10-14 00:06:25
cover: https://cloud-computing-1253868755.cos.ap-guangzhou.myqcloud.com/aws-vpc.jpg
categories:
  - Cloud Computing
  - IaaS
tags:
  - Cloud Computing
  - IaaS
---

# VPC

> `Virtual Private Cloud`：构建在`云`上，相互`隔离`，用户可以`自主控制`的`私有`网络环境

| 概念     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| `网段`   | 私有网络的内部 IP 区段，通常采用 `CIDR` 表达                 |
| `子网`   | 私有网络的`下级网络结构`，一个私有网络可以划分出`多个子网`，阿里云将子网称为`交换机` |
| `路由表` | 定义私有网络内`流量的路由规则`，每个`子网`都必须有一张`关联的路由表`（自动创建`默认路由表`） |
| `网关`   | 是对`进出`私有网络的流量进行`把守`和`分发`的重要节点         |
| `安全组` | 私有网络内`虚拟机`进出流量的`通行或拦截规则`，相当于虚拟机`外层`的`网络防火墙` |

<!-- more -->

> VPC 属于`局域网`，VPC 创建成功后，`网段无法修改`，至少要创建一个`子网`（`交换机`）（网段也不能变更）

> 可以建立`跨可用区`的私有网络
> 高可用：让主力集群在一个可用区工作，备用集群在另一个可用区随时待命，按需切换

> 关键：`提前规划` VPC 和各子网的`网段`
> 在没有 VPC 的情况下创建虚拟机，一般会`自动生成 VPC` -- 生产慎用！

# VM

> VM 通过`弹性网卡`（Elastic network interface，`ENI`）来与 VPC 连接
> `ENI` 一方面与 `VM` 绑定，另一方面则嵌入到某个 `VPC` 中的某个 `vSwitch`（拥有最少一个`私有 IP`）

> `弹性`网卡（`ENI`）

1. 一个 VM 可以`绑定多块网卡`，区分`主网卡`和`辅助网卡`
2. 一块网卡`隶属`于一个`子网`，可以配置`同一子网内的多个私有 IP`
3. `辅助网卡`可以`动态解绑`，并能绑定到`另一台 VM` 上

> 创建 VM 时选择 `VPC` 中的某个`vSwitch`：新 VM `自动生成的主网卡`，接入了`所选 VPC` 的`所选 vSwitch`

# 公网 IP

> 在`生产`环境，`不要依赖`自动生成的公网 IP，推荐使用`弹性 IP`（Elastic IP，`EIP`）
> `自动生成`的本质：从公有云的 `IP 池`中`临时租用`，如果 VM 关闭或者重启，下次获得公网 IP 可能是不同的

![image-20230524194102521](https://cloud-computing-1253868755.cos.ap-guangzhou.myqcloud.com/image-20230524194102521.png)

> 弹性 IP `一旦生成`，它所对应的 `IP` 是`固定`的，适合需要`稳定 IP` 的生产环境
> 弹性的语义：可以非常`自由`地`解绑`和`再次绑定`到`任意目标`（拥有了该 IP 的`所有权`）

# 网关

> 弹性 IP 是`双向`的

> 网关：用来统一协调管理私有网络`与外部通信`的组件

## NAT

> Network Address `Translation`：允许多台`没有公网 IP` 的虚拟机访问外网

### SNAT

> `源地址`转换（`从内到外`的单向连通）：让私有网络的虚拟机`共享某个公网 IP` 接入互联网

## VPN

> VPN 能够`基于互联网`提供`私有加密`的通信，非常适合用来从`任意其他私有设施`安全地连接到 VPC

# 多 VPC

1. VPC 和 VPC 的互联，推荐使用`对等连接`（VPC `Peering`）	
   - 能够在`不添加额外设备`的情况下，让两个 VPC 无缝互联，并且支持`跨区域`
2. VPC Peering 的实施前提：两个 VPC 的`网段没有交集`
3. VPC Peering `不具备传递性`，如果需要多 VPC 间任意路径的互联互通，则需要更为复杂和强大的`专用网络设施`

# 混合云

> 公有云中的私有网络，可以与企业本地数据中心进行互联

1. 先考虑使用`轻量`的 `VPN` 方式：通过`公网`线路为两边建立连接渠道
2. 如果需要保证`延迟`和`带宽`，一般需要`专线`进行连接
3. `高可用`：专线 + VPN - 组合













