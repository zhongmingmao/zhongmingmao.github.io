---
title: Observability - Concept
mathjax: true
date: 2024-10-13 00:06:25
cover: https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-concept.webp
categories:
  - Cloud Native
  - Observability
tags:
  - Cloud Native
  - Observability
---

# 概述

1. 可观测性 - 从系统**向外部输出的信息**来推**断出**系统**内部状态的好坏**
2. 可观测强调的是一种**度量能力**
   - 在**不发布新代码**（如新增诊断日志）的情况下**理解系统内部状态** - 系统具有可观测性

<!-- more -->

# Metrics + Logs + Tracing

> Metrics + Logs + Tracing 只是**遥测数据类型**，而 **Observability** 并非具体技术，而是**系统属性**，类似于 **HA**

| Key     | Desc                                                         |
| ------- | ------------------------------------------------------------ |
| Metrics | 在**一段时间内**测量的数值，默认是**结构化**的，便于**查询**和**存储优化** |
| Logs    | 对**特定时间**发生的**事件**的**文本记录**，一般是**非结构化**字符串，会在程序**执行期间**被写入磁盘 |
| Tracing | 表示**请求**通过**分布式系统**的**端到端**的路径，执行的每个操作被称为 **Span** |

> **Tracing** 一般会通过**可视化**的**瀑布图**展现出来

![image-20241207180541812](https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241207180541812.png)

## Metrics

1. 由于 **Metrics** 最大的特点是**聚合性**
   - Metrics 生成的数值是反映**预定义时间段内**系统状态的**汇总报告** - 缺乏**颗粒度**
2. Metrics 之间可能**彼此不相关**
3. Metrics 常用于 - **静态仪表盘**的构建、随时间变化的**趋势分析**、监控维度是否保持在定义的**阈值**内
   - 但都**不是 Observability**，因为对于**故障排查**来说，这些信息**远远不够**

## Logs

1. Logs 本质上是**离散事件**，为了便于阅读，一般是一大块**非结构化**文本
   - 需要通过**日志解析器**（复杂规则）才能完成结构化、索引、搜索
2. 结构化 - 创建结构化的日志数据，如 Docker 日志

## Tracing

1. Tracing 的主要问题 - 仅依靠开发人员进行 **Instrument**，是远远不够的
2. **实现复杂度**
   - 大量的应用程序需要使用额外的开源框架或库构建的
   - 在**多语言**架构下，会变得更具有挑战性
3. **实现成本**
   - Instrument 的成本比较高，比较很难做到**全面覆盖**，适用于具体的业务场景
   - 随着产品迭代，可能需要反复增加 Instrument，增加工作量且降低系统可靠性

# Structured Events

> **Observability** 定义的是一种**度量**能力，帮助用户更好地**理解**和**解释**系统当前所处的**任何状态**

1. **Structured Events** 是 **Observability** 的基础
2. **事件**是指特定请求与服务交互时所有信息的**记录**，通过事件能了解到**服务**所受到的**影响**
3. Structured Events 的定义
   - 在请求**第一次**进入服务时，会有一个 **Empty Map** 被**初始化**出来
   - 在该请求的生命周期内发生的任何**细节**或者有价值的**上下文**，都会附加到 **Map** 中
   - 当请求即将**退出**或者**出错**时，刚所发生的事情都被记录下来了
   - 写入该 Map 的数据被组织和格式化为 **Key-Value Pair**，以便于搜索 - **Structured Events**
4. 在**调试服务问题**时，可以比较 Structured Events，**及时发现异常** - 任意宽度 - **基数** + **维度**

## 基数

1. 在**数据库**中，基数是指包含在一个集合中的**唯一值的数量**
   - 低基数（性别） - 很多重复的值；高基数（User Id） - 很大比例是完全唯一的值
2. **高基数信息**在调试或者理解系统的数据时非常有用 - userid + requestid - **精确定位**

## 维度

1. **基数**是数据中值的**唯一性**，而**维度**是数据中 **Key 的数量**
2. 在**可观测系统**中，**遥测数据**被生成**任意宽度**的**结构化事件**，其中可以包含成百上千的**键值对**（即**维度**）
3. 事件**范围**越广，事件发生时获取到的**上下文**就越丰富，越容易**定位问题**

# 对比

## 传统监控

1. 仪表盘 - 受到告警时，某项指标超过了阈值，但不能完全了解系统发生了什么
2. 传统监控只能解决 **Known-Unknowns** 问题 - 完全**被动**
   - 每次出现故障时，复盘的结果是增加一些指标或者告警，然后这些告警可能再也不会被触发
   - 例如 - CPU 使用率达到了 90%，但却不知道原因

## 可观测性

1. **可观测性**通过查看和分析**高纬度**和**高基数**的数据，发现在复杂系统中的**隐藏问题** - 无需**预设**问题发生的**模式**
   - 通过数据的**关联**，允许从**任何角度**分析问题，而不是依靠直觉和经验
2. 针对**应用软件**监控，不仅仅是**基础设施**，目标是保障**应用软件**的**可靠性**和**稳定性**
3. **全面搜集** + **关联数据**
   - 数据采集 - 底层操作系统、各种语言环境的网络协议、前端用户访问数据
   - 利用数据所提供的**可视化**、**交互性**来真正让可观测性落地
4. 可观测性强调的是从**应用**和**业务**维度，用各种数据**垂直**且**实时**地描述**应用的全貌**
   - 采用的不是传统的**分层**逻辑，不是用不同的**独立的监控系统**分开关注每一层的情况
5. 传统运维的**仪表盘**在**分布式架构**中的用处越来越小
   - 对于复杂系统来说，很多之前**没有发生过**的问题，单靠**仪表盘**是**不能有效发现根本原因**
