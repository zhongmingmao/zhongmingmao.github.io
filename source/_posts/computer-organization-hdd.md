---
title: 计算机组成 -- HDD
mathjax: false
date: 2020-02-01 02:13:24
categories:
    - Computer Basics
    - Computer Organization
tags:
    - Computer Basics
    - Computer Organization
---

## 物理构造
一块机械硬盘由**盘面**、**磁头**、**悬臂**三个部件组成
<img src="https://computer-composition-1253868755.cos.ap-guangzhou.myqcloud.com/computer-organization-hdd-physical-structure.jpg" width=1000/>

<!-- more -->

### 盘面
1. **盘面**（Disk Platter）是我们**实际存储数据**的盘片
2. 盘面本身通常是用**铝**、**玻璃**或者**陶瓷**这样的材质去做成**光滑**盘片，然后在盘面上有一层**磁性的涂层**，数据就存储在磁性的涂层上
3. 盘面中间有一个受**电机**控制的转轴（控制盘面去**旋转**），转速：**RPM**（Rotations Per **Minute**）

### 磁头
1. 通过**磁头**（Drive Head），从**盘面**上读取数据，然后再通过电路信号传输给**控制电路**和**接口**，再到**总线**上
2. 通常，**一个盘面上会有两个磁头**，分别是盘面的**正反面**，盘面在正反面都有对应的磁性涂层来存储数据
   - 一块硬盘不会只有一个盘面，而且上下**堆叠**了很多个盘面，各个盘面之间是**平行**的，每个盘面的正反两面都有对应的磁头

### 悬臂
1. **悬臂**（Actutor Arm）链接在磁头上，并且在一定范围内去把磁头**定位**到盘面的某个特定**磁道**（Track）上
2. 一个盘面通常是**圆形**的，由很多**同心圆**组成，每个同心圆都是一个**磁道**，每个磁道都有**编号**

## 随机读写
1. 一个**磁道**，会分成多个**扇区**（Sector），上下平行的盘面的**相同扇区**，组成一个**柱面**（Cylinder）
2. 数据读取的步骤
   - 把**盘面旋转**到某个位置，在这个位置，**悬臂**可以**定位**到整个盘面的某个**子区间**（称为**几何区间**）
   - 把**悬臂移动**到**特定磁道的特定扇区**（在几何扇区里面，找到实际的扇区）
   - 找到实际的扇区后，**磁头落下**，读取正对着扇区的数据
3. HDD的随机IOPS
   - **平均延时**（Average **Latency**）：盘面**旋转**，把几何扇面对准悬臂的时间，和**转速**相关
     - **随机**情况下，平均找到一个几何扇区，需要旋转**半圈**盘面
     - 7200RPM的硬盘，一秒旋转**240个半圈**，即平均延时为**1s/240 ≈ 4.17ms**
   - **平均寻道时间**（Average **Seek** Time）：在盘面旋转之后，悬臂**定位**到扇区的时间
     - 一般在**4~10ms**
   - 因此，随机在整个硬盘上找一个数据，需要**8~14ms**
     - HDD是**机械结构**的，只有一个电机转轴，也只有一个悬臂，没有办法**并行**地去定位或者读取数据
     - 对于7200RPM的HDD，**随机的IOPS**为**1s/8ms=125**或者**1s/14ms≈70**

## 顺序读写
1. 把**顺序存放**的数据，尽可能地放在**同一个柱面**上
2. 这样，只需要**旋转一次盘面**，进行**一次寻道**，就可以去写入或者读取**同一个垂直空间**上的**多个盘面**的数据
3. 如果一个柱面上的数据不够，也不要去动悬臂（**慢**），而是通过**电机转动盘面**，这样就可以**顺序**读完一个**磁道**上的所有数据
4. HDD**顺序读写的吞吐率**能达到**200MB/s**

## Partial Stroking
1. HDD的**随机IOPS**只有**100**，很难满足现代互联网**高并发**的请求
2. 访问一次数据的时间 ≈ **平均延时 + 平均寻道时间**，考虑缩短其中一个
3. 一般情况下，HDD的**平均寻道时间**都比**平均延时**要**长**，先考虑**缩短平均寻道时间**
   - **放弃寻道**，把**所有数据**都放在一个**磁道**上，**IOPS=1s/4ms=250**
   - 如果只用一个磁道，能存储的数据非常有限，因此在实践中，通常只用**1/2**或者**1/4**的磁道
   - 对于一块7200RPM的HDD
     - 平均延时为4.17ms，平均寻道时间为9ms，原本的**IOPS=1s/(4.17ms+9ms)≈75.9**
   - 如果只用其中1/4的磁道，**IOPS=1s/(4.17ms+9ms/4)≈155.8**
     - IOPS提升了一倍，和15000RPM的HDD性能差不多
     - 硬盘能利用的空间为原来的1/4，但价格却没有15000RPM的HDD的1/4
     - 这样**通过软件去格式化硬盘**，只**保留部分磁道**让系统可用的情况，可以大大提升硬件的**性价比**