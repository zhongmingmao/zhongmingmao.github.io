<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Observability - OpenTelemetry Node.js | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development    Client instrumentation for the browser is experimental and mostly unspecified.">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - OpenTelemetry Node.js">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/03/cloud-native-observability-opentelemetry-js/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development    Client instrumentation for the browser is experimental and mostly unspecified.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg">
<meta property="article:published_time" content="2025-01-02T16:06:25.000Z">
<meta property="article:modified_time" content="2025-07-20T12:14:09.107Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="OpenTelemetry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/03/cloud-native-observability-opentelemetry-js/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - OpenTelemetry Node.js',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-20 20:14:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">627</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Observability - OpenTelemetry Node.js</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2025-01-02T16:06:25.000Z" title="Created 2025-01-03 00:06:25">2025-01-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>34min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><h2 id="Status-and-Releases"><a href="#Status-and-Releases" class="headerlink" title="Status and Releases"></a>Status and Releases</h2><table>
<thead>
<tr>
<th>Traces</th>
<th>Metrics</th>
<th>Logs</th>
</tr>
</thead>
<tbody><tr>
<td>Stable</td>
<td>Stable</td>
<td>Development</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>Client instrumentation</strong> for the <strong>browser</strong> is <strong>experimental</strong> and mostly <strong>unspecified</strong>.</p>
</blockquote>
<span id="more"></span>

<h2 id="Version-Support"><a href="#Version-Support" class="headerlink" title="Version Support"></a>Version Support</h2><ol>
<li>OpenTelemetry JavaScript supports <strong>all active or maintenance LTS versions of Node.js</strong>.<ul>
<li>Previous versions of Node.js may work, but are not tested by OpenTelemetry.</li>
</ul>
</li>
<li>OpenTelemetry JavaScript has <strong>no official supported</strong> list of browsers. It is aimed to work on currently supported versions of <strong>major browsers</strong>.</li>
<li>OpenTelemetry JavaScript follows DefinitelyType’s support policy for <strong>TypeScript</strong> which sets a support window of <strong>2 years</strong>.<ul>
<li>Support for TypeScript versions older than 2 years will be <strong>dropped in minor releases</strong> of OpenTelemetry JavaScript.</li>
</ul>
</li>
</ol>
<h2 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h2><blockquote>
<p>OpenTelemetry JavaScript consists of the following repositories</p>
</blockquote>
<table>
<thead>
<tr>
<th>Repositories</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>opentelemetry-js</td>
<td>core repository containing the core distribution API and SDK.</td>
</tr>
<tr>
<td>opentelemetry-js-contrib</td>
<td>contributions that are not part of the core distribution of the API and SDK.</td>
</tr>
</tbody></table>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h2><h3 id="Example-Application"><a href="#Example-Application" class="headerlink" title="Example Application"></a>Example Application</h3><h4 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h4><blockquote>
<p>To begin, set up an empty <code>package.json</code> in a new directory:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm init -y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Next, install <strong>Express</strong> dependencies.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install express</span><br></pre></td></tr></table></figure>

<h4 id="Create-and-launch-an-HTTP-Server"><a href="#Create-and-launch-an-HTTP-Server" class="headerlink" title="Create and launch an HTTP Server"></a>Create and launch an HTTP Server</h4><blockquote>
<p>Create a file named <code>app.ts</code> (or <code>app.js</code> if not using TypeScript) and add the following code to it:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*app.js*/</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="built_in">parseInt</span>(process.<span class="property">env</span>.<span class="property">PORT</span> || <span class="string">&#x27;8080&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRandomNumber</span>(<span class="params">min, max</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min + <span class="number">1</span>) + min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/rolldice&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="title function_">getRandomNumber</span>(<span class="number">1</span>, <span class="number">6</span>).<span class="title function_">toString</span>());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Listening for requests on http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Run the application with the following command and open <a target="_blank" rel="noopener" href="http://localhost:8080/rolldice">http://localhost:8080/rolldice</a> in your web browser to ensure it is working.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node app.js</span><br></pre></td></tr></table></figure>

<h3 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h3><blockquote>
<p>The following shows how to install, initialize, and run an application instrumented with <strong>OpenTelemetry</strong>.</p>
</blockquote>
<h4 id="More-Dependencies"><a href="#More-Dependencies" class="headerlink" title="More Dependencies"></a>More Dependencies</h4><ol>
<li>First, install the <strong>Node SDK</strong> and <strong>autoinstrumentations</strong> package.</li>
<li>The <strong>Node SDK</strong> lets you <strong>initialize OpenTelemetry</strong> with <strong>several configuration defaults</strong> that are correct for the <strong>majority</strong> of <strong>use cases</strong>.</li>
<li>The <strong>auto-instrumentations-node</strong> package installs <strong>instrumentation libraries</strong><ul>
<li>that will <strong>automatically create spans</strong> corresponding to code called in libraries.</li>
</ul>
</li>
<li>In this case, it provides instrumentation for Express, letting the example app automatically create spans for <strong>each incoming request</strong>.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @opentelemetry/sdk-node \</span><br><span class="line">  @opentelemetry/api \</span><br><span class="line">  @opentelemetry/auto-instrumentations-node \</span><br><span class="line">  @opentelemetry/sdk-metrics \</span><br><span class="line">  @opentelemetry/sdk-trace-node</span><br></pre></td></tr></table></figure>

<h4 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h4><ol>
<li>The <strong>instrumentation setup and configuration</strong> must be <strong>run before</strong> your <strong>application code</strong>.<ul>
<li>One tool commonly used for this task is the <strong>–require</strong> flag</li>
</ul>
</li>
<li>Create a file named instrumentation.ts (or <strong>instrumentation.js</strong> if not using TypeScript) , which will contain your <strong>instrumentation setup code</strong>.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="comment">// Require dependencies</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">NodeSDK</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ConsoleSpanExporter</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-trace-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    getNodeAutoInstrumentations,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/auto-instrumentations-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">PeriodicExportingMetricReader</span>,</span><br><span class="line">    <span class="title class_">ConsoleMetricExporter</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-metrics&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">    <span class="attr">traceExporter</span>: <span class="keyword">new</span> <span class="title class_">ConsoleSpanExporter</span>(),</span><br><span class="line">    <span class="attr">metricReader</span>: <span class="keyword">new</span> <span class="title class_">PeriodicExportingMetricReader</span>(&#123;</span><br><span class="line">        <span class="attr">exporter</span>: <span class="keyword">new</span> <span class="title class_">ConsoleMetricExporter</span>(),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="title function_">getNodeAutoInstrumentations</span>()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">sdk.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Run-the-instrumented-app"><a href="#Run-the-instrumented-app" class="headerlink" title="Run the instrumented app"></a>Run the instrumented app</h3><ol>
<li>Now you can run your application as you normally would, but you can use the <strong>–require</strong> flag to <strong>load the instrumentation</strong> before the application code.</li>
<li>Make sure you don’t have <strong>other conflicting –require flags</strong><ul>
<li>such as <strong>–require @opentelemetry&#x2F;auto-instrumentations-node&#x2F;register</strong> on your <strong>NODE_OPTIONS</strong> environment variable.</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node --require ./instrumentation.js app.js</span><br></pre></td></tr></table></figure>

<blockquote>
<p>After a while you should see the <strong>spans</strong> printed in the console by the <code>ConsoleSpanExporter</code>.</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  resource<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      &#x27;host.name&#x27;<span class="punctuation">:</span> &#x27;macos.local&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;host.arch&#x27;<span class="punctuation">:</span> &#x27;arm64&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;host.id&#x27;<span class="punctuation">:</span> &#x27;<span class="number">359031</span>FF<span class="number">-956E-5</span>B48<span class="number">-89</span>FD<span class="number">-8</span>A78A79AE606&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.pid&#x27;<span class="punctuation">:</span> <span class="number">48319</span><span class="punctuation">,</span></span><br><span class="line">      &#x27;process.executable.name&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.executable.path&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.command_args&#x27;<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">        &#x27;--require&#x27;<span class="punctuation">,</span></span><br><span class="line">        &#x27;./instrumentation.js&#x27;<span class="punctuation">,</span></span><br><span class="line">        &#x27;/Users/zhongmingmao/workspace/o11y/demo/voyager-o11y-demo-nodejs/app.js&#x27;</span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.version&#x27;<span class="punctuation">:</span> &#x27;<span class="number">22.17</span><span class="number">.1</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.name&#x27;<span class="punctuation">:</span> &#x27;nodejs&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.description&#x27;<span class="punctuation">:</span> &#x27;Node.js&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.command&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/workspace/o11y/demo/voyager-o11y-demo-nodejs/app.js&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.owner&#x27;<span class="punctuation">:</span> &#x27;zhongmingmao&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;service.name&#x27;<span class="punctuation">:</span> &#x27;unknown_service<span class="punctuation">:</span>/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.language&#x27;<span class="punctuation">:</span> &#x27;nodejs&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.name&#x27;<span class="punctuation">:</span> &#x27;opentelemetry&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.version&#x27;<span class="punctuation">:</span> &#x27;<span class="number">2.0</span><span class="number">.1</span>&#x27;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  instrumentationScope<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> &#x27;@opentelemetry/instrumentation-express&#x27;<span class="punctuation">,</span></span><br><span class="line">    version<span class="punctuation">:</span> &#x27;<span class="number">0.52</span><span class="number">.0</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">    schemaUrl<span class="punctuation">:</span> undefined</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  traceId<span class="punctuation">:</span> &#x27;<span class="number">1</span>c4d83abd23a4fa49ad4e6a955e5a03a&#x27;<span class="punctuation">,</span></span><br><span class="line">  parentSpanContext<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    traceId<span class="punctuation">:</span> &#x27;<span class="number">1</span>c4d83abd23a4fa49ad4e6a955e5a03a&#x27;<span class="punctuation">,</span></span><br><span class="line">    spanId<span class="punctuation">:</span> &#x27;d598ef141c576722&#x27;<span class="punctuation">,</span></span><br><span class="line">    traceFlags<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    traceState<span class="punctuation">:</span> undefined</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  traceState<span class="punctuation">:</span> undefined<span class="punctuation">,</span></span><br><span class="line">  name<span class="punctuation">:</span> &#x27;request handler - /rolldice&#x27;<span class="punctuation">,</span></span><br><span class="line">  id<span class="punctuation">:</span> &#x27;f3353278dc575cf5&#x27;<span class="punctuation">,</span></span><br><span class="line">  kind<span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  timestamp<span class="punctuation">:</span> <span class="number">1752998752442000</span><span class="punctuation">,</span></span><br><span class="line">  duration<span class="punctuation">:</span> <span class="number">5187</span><span class="punctuation">,</span></span><br><span class="line">  attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    &#x27;http.route&#x27;<span class="punctuation">:</span> &#x27;/rolldice&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;express.name&#x27;<span class="punctuation">:</span> &#x27;/rolldice&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;express.type&#x27;<span class="punctuation">:</span> &#x27;request_handler&#x27;</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  status<span class="punctuation">:</span> <span class="punctuation">&#123;</span> code<span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  events<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  links<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  descriptor<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> &#x27;v8js.memory.heap.space.physical_size&#x27;<span class="punctuation">,</span></span><br><span class="line">    type<span class="punctuation">:</span> &#x27;OBSERVABLE_GAUGE&#x27;<span class="punctuation">,</span></span><br><span class="line">    description<span class="punctuation">:</span> &#x27;Committed size of a heap space.&#x27;<span class="punctuation">,</span></span><br><span class="line">    unit<span class="punctuation">:</span> &#x27;By&#x27;<span class="punctuation">,</span></span><br><span class="line">    valueType<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    advice<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  dataPointType<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  dataPoints<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &#x27;v8js.heap.space.name&#x27;<span class="punctuation">:</span> &#x27;read_only_space&#x27; <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      startTime<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">1752998810</span><span class="punctuation">,</span> <span class="number">399000000</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      endTime<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">1752999110</span><span class="punctuation">,</span> <span class="number">405000000</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      value<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &#x27;v8js.heap.space.name&#x27;<span class="punctuation">:</span> &#x27;new_space&#x27; <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      startTime<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">1752998810</span><span class="punctuation">,</span> <span class="number">399000000</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      endTime<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">1752999110</span><span class="punctuation">,</span> <span class="number">405000000</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      value<span class="punctuation">:</span> <span class="number">557056</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h2><h3 id="Example-Application-1"><a href="#Example-Application-1" class="headerlink" title="Example Application"></a>Example Application</h3><blockquote>
<p>Copy the following file into an empty directory and call it index.html.</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document Load Instrumentation Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      https://www.w3.org/TR/trace-context/</span></span><br><span class="line"><span class="comment">      Set the `traceparent` in the server&#x27;s HTML template code. It should be</span></span><br><span class="line"><span class="comment">      dynamically generated server side to have the server&#x27;s request trace ID,</span></span><br><span class="line"><span class="comment">      a parent span ID that was set on the server&#x27;s request span, and the trace</span></span><br><span class="line"><span class="comment">      flags to indicate the server&#x27;s sampling decision</span></span><br><span class="line"><span class="comment">      (01 = sampled, 00 = not sampled).</span></span><br><span class="line"><span class="comment">      &#x27;&#123;version&#125;-&#123;traceId&#125;-&#123;spanId&#125;-&#123;sampleDecision&#125;&#x27;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;traceparent&quot;</span> <span class="attr">content</span>=<span class="string">&quot;00-ab42124a3c573678d4d8b21ba52df3bf-d21f7bc17caa5aba-01&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    Example of using Web Tracer with document load instrumentation with console</span><br><span class="line">    exporter and collector exporter</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><p>To <strong>create traces</strong> in the browser, you will need <u>@opentelemetry&#x2F;sdk-trace-web</u>, and the instrumentation <u>@opentelemetry&#x2F;instrumentation-document-load</u></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm init -y</span><br><span class="line">npm install @opentelemetry/api \</span><br><span class="line">  @opentelemetry/sdk-trace-web \</span><br><span class="line">  @opentelemetry/instrumentation-document-load \</span><br><span class="line">  @opentelemetry/context-zone</span><br></pre></td></tr></table></figure>

<h4 id="Initialization-and-Configuration"><a href="#Initialization-and-Configuration" class="headerlink" title="Initialization and Configuration"></a>Initialization and Configuration</h4><blockquote>
<p>Then acquire <a target="_blank" rel="noopener" href="https://parceljs.org/">parcel</a>, which will (among other things) let you work in TypeScript.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev parcel</span><br></pre></td></tr></table></figure>

<ol>
<li>Create an empty code file named document-load with a .ts or .js extension, as appropriate, based on the language you’ve chosen to write your app in. </li>
<li>Add the following code to your HTML right <strong>before</strong> the <code>&lt;/body&gt;</code> closing tag:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;module&quot;</span> src=<span class="string">&quot;document-load.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>We will add some code that will trace the <strong>document load timings</strong> and output those as <strong>OpenTelemetry Spans</strong>.</p>
</blockquote>
<h4 id="Creating-a-Tracer-Provider"><a href="#Creating-a-Tracer-Provider" class="headerlink" title="Creating a Tracer Provider"></a>Creating a Tracer Provider</h4><p>Add the following code to the <code>document-load.ts|js</code> to create a tracer provider, which brings the <strong>instrumentation</strong> to trace <strong>document load</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* document-load.ts|js file - the code snippet is the same for both the languages */</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">WebTracerProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/sdk-trace-web&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DocumentLoadInstrumentation</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/instrumentation-document-load&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ZoneContextManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/context-zone&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; registerInstrumentations &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/instrumentation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = <span class="keyword">new</span> <span class="title class_">WebTracerProvider</span>();</span><br><span class="line"></span><br><span class="line">provider.<span class="title function_">register</span>(&#123;</span><br><span class="line">    <span class="comment">// Changing default contextManager to use ZoneContextManager - supports asynchronous operations - optional</span></span><br><span class="line">    <span class="attr">contextManager</span>: <span class="keyword">new</span> <span class="title class_">ZoneContextManager</span>(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Registering instrumentations</span></span><br><span class="line"><span class="title function_">registerInstrumentations</span>(&#123;</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="keyword">new</span> <span class="title class_">DocumentLoadInstrumentation</span>()],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now build the app with <strong>parcel</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npx parcel index.html</span><br><span class="line">Server running at http://localhost:1234</span><br><span class="line">✨ Built in 7ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>and open the development web server (e.g. at <code>http://localhost:1234</code>) to see if your code works.<br>There will be no output of traces yet, for this we need to add an <strong>exporter</strong>.</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250720164709184.png" alt="image-20250720164709184"></p>
<h4 id="Creating-an-Exporter"><a href="#Creating-an-Exporter" class="headerlink" title="Creating an Exporter"></a>Creating an Exporter</h4><ol>
<li>In the following example, we will use the <code>ConsoleSpanExporter</code> which prints all spans to the console.</li>
<li>In order to <strong>visualize</strong> and <strong>analyze</strong> your <strong>traces</strong>, you will need to export them to a <strong>tracing backend</strong>.</li>
<li>You may also want to use the <strong>BatchSpanProcessor</strong> to export spans in batches in order to more <strong>efficiently</strong> use resources.</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* document-load.ts|js file - the code is the same for both the languages */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    <span class="title class_">ConsoleSpanExporter</span>,</span><br><span class="line">    <span class="title class_">SimpleSpanProcessor</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/sdk-trace-base&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">WebTracerProvider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/sdk-trace-web&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">DocumentLoadInstrumentation</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/instrumentation-document-load&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ZoneContextManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/context-zone&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; registerInstrumentations &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/instrumentation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = <span class="keyword">new</span> <span class="title class_">WebTracerProvider</span>(&#123;</span><br><span class="line">    <span class="attr">spanProcessors</span>: [<span class="keyword">new</span> <span class="title class_">SimpleSpanProcessor</span>(<span class="keyword">new</span> <span class="title class_">ConsoleSpanExporter</span>())],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">provider.<span class="title function_">register</span>(&#123;</span><br><span class="line">    <span class="comment">// Changing default contextManager to use ZoneContextManager - supports asynchronous operations - optional</span></span><br><span class="line">    <span class="attr">contextManager</span>: <span class="keyword">new</span> <span class="title class_">ZoneContextManager</span>(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Registering instrumentations</span></span><br><span class="line"><span class="title function_">registerInstrumentations</span>(&#123;</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="keyword">new</span> <span class="title class_">DocumentLoadInstrumentation</span>()],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now, <strong>rebuild</strong> your application and open the browser again. In the <strong>console</strong> of the developer toolbar you should see some traces being exported:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250720165200866.png" alt="image-20250720165200866"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;service.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unknown_service&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opentelemetry&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;instrumentationScope&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@opentelemetry/instrumentation-document-load&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.48.0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;traceId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ab42124a3c573678d4d8b21ba52df3bf&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;parentSpanContext&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;traceId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ab42124a3c573678d4d8b21ba52df3bf&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;spanId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d21f7bc17caa5aba&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;traceFlags&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;isRemote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;documentLoad&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2a0091fcc2ed3065&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="number">1753001481973300</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="number">133000</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;http.url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:1234/&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.user_agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fetchStart&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001481</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">973300000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unloadEventStart&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001481</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">988000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;unloadEventEnd&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001481</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">988000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;domInteractive&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">53000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;domContentLoadedEventStart&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">79400000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;domContentLoadedEventEnd&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">79700000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;domComplete&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">106000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loadEventStart&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">106100000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;loadEventEnd&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">106300000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;firstPaint&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">76000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;firstContentfulPaint&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="number">1753001482</span><span class="punctuation">,</span></span><br><span class="line">                <span class="number">76000000</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;droppedAttributesCount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Add-Instrumentations"><a href="#Add-Instrumentations" class="headerlink" title="Add Instrumentations"></a>Add Instrumentations</h4><p>If you want to instrument <strong>Ajax</strong> requests, <strong>User Interactions</strong> and others, you can register additional instrumentations for those:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">registerInstrumentations</span>(&#123;</span><br><span class="line">  <span class="attr">instrumentations</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">UserInteractionInstrumentation</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">XMLHttpRequestInstrumentation</span>(),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Meta-Packages-for-Web"><a href="#Meta-Packages-for-Web" class="headerlink" title="Meta Packages for Web"></a>Meta Packages for Web</h3><ol>
<li>To leverage the <strong>most common instrumentations all in one</strong> you can simply use the OpenTelemetry Meta Packages for <strong>Web</strong></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@opentelemetry/auto-instrumentations-web">https://www.npmjs.com/package/@opentelemetry/auto-instrumentations-web</a></li>
</ol>
<h1 id="Instrumentation-1"><a href="#Instrumentation-1" class="headerlink" title="Instrumentation"></a>Instrumentation</h1><blockquote>
<p>TBD</p>
</blockquote>
<h1 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h1><blockquote>
<p>How to instrument libraries an app <strong>depends on</strong></p>
</blockquote>
<ol>
<li>When you develop an app, you might use <strong>third-party</strong> libraries and frameworks to accelerate your work.</li>
<li>If you then instrument your app using OpenTelemetry<ul>
<li>you might want to <strong>avoid</strong> spending additional time to <strong>manually</strong> add traces, logs, and metrics to the third-party libraries and frameworks you use.</li>
</ul>
</li>
<li>Many libraries and frameworks already support OpenTelemetry or are supported through OpenTelemetry instrumentation<ul>
<li>so that they can <strong>generate telemetry</strong> you can export to an <strong>observability back end</strong>.</li>
</ul>
</li>
<li>If you are instrumenting an app or service that use third-party libraries or frameworks<ul>
<li>follow these instructions to learn how to use <strong>natively instrumented libraries</strong> and <strong>instrumentation libraries</strong> for your dependencies.</li>
</ul>
</li>
</ol>
<h2 id="Use-natively-instrumented-libraries"><a href="#Use-natively-instrumented-libraries" class="headerlink" title="Use natively instrumented libraries"></a>Use natively instrumented libraries</h2><ol>
<li>If a library comes with OpenTelemetry support <strong>by default</strong><ul>
<li>you can get traces, metrics, and logs <strong>emitted from that library</strong> by adding and setting up the <strong>OpenTelemetry SDK</strong> with your app.</li>
</ul>
</li>
<li>The library might require some <strong>additional configuration</strong> for the instrumentation.<ul>
<li>Instrumentation for <strong>Next.js</strong></li>
</ul>
</li>
</ol>
<h2 id="Use-Instrumentation-Libraries"><a href="#Use-Instrumentation-Libraries" class="headerlink" title="Use Instrumentation Libraries"></a>Use Instrumentation Libraries</h2><ol>
<li>If a library does not come with OpenTelemetry <strong>out of the box</strong><ul>
<li>you can use <a target="_blank" rel="noopener" href="https://opentelemetry.io/docs/specs/otel/glossary/#instrumentation-library">instrumentation libraries</a> in order to generate telemetry data for a library or framework.</li>
</ul>
</li>
<li>For example, the <strong>instrumentation library for Express</strong> will <strong>automatically create spans</strong> based on the <strong>inbound HTTP requests</strong>.</li>
</ol>
<h3 id="Setup-1"><a href="#Setup-1" class="headerlink" title="Setup"></a>Setup</h3><ol>
<li>Each <strong>instrumentation library</strong> is an <strong>NPM package</strong>.</li>
<li>For example, here’s how you can install the <strong>instrumentation-express</strong> and <strong>instrumentation-http</strong> instrumentation libraries to instrument <strong>inbound</strong> and <strong>outbound</strong> HTTP traffic</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/instrumentation-http @opentelemetry/instrumentation-express</span><br></pre></td></tr></table></figure>

<ol>
<li>OpenTelemetry JavaScript also defines metapackages <strong>auto-instrumentation-node</strong> and <strong>auto-instrumentation-web</strong><ul>
<li>that bundle all <strong>Node.js-</strong> or **web-**based instrumentation libraries into a <strong>single package</strong>.</li>
</ul>
</li>
<li>It’s a <strong>convenient</strong> way to add <strong>automatically-generated telemetry</strong> for all your libraries with <strong>minimal effort</strong></li>
</ol>
<blockquote>
<p>Node.js</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/auto-instrumentations-node</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Browser</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/auto-instrumentations-web</span><br></pre></td></tr></table></figure>

<ol>
<li>That using those <strong>metapackages</strong> increases your <strong>dependency graph size</strong>.</li>
<li>Use <strong>individual instrumentation libraries</strong> if you know exactly which ones you need.</li>
</ol>
<h3 id="Registration"><a href="#Registration" class="headerlink" title="Registration"></a>Registration</h3><ol>
<li>After installing the instrumentation libraries you need, register them with the <strong>OpenTelemetry SDK</strong> for <strong>Node.js</strong>.</li>
<li>If you followed the Getting Started you already use the <strong>metapackages</strong>.</li>
<li>If you followed the instructions to initialize the SDK for <strong>manual instrumentation</strong>, update your instrumentation.ts (or instrumentation.js) as follows</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> &#123; getNodeAutoInstrumentations &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/auto-instrumentations-node&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// This registers all instrumentation packages</span></span><br><span class="line">  <span class="attr">instrumentations</span>: [<span class="title function_">getNodeAutoInstrumentations</span>()]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To <strong>disable individual instrumentation libraries</strong> you can apply the following change:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> &#123; getNodeAutoInstrumentations &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/auto-instrumentations-node&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// This registers all instrumentation packages</span></span><br><span class="line">  <span class="attr">instrumentations</span>: [</span><br><span class="line">    <span class="title function_">getNodeAutoInstrumentations</span>(&#123;</span><br><span class="line">      <span class="string">&#x27;@opentelemetry/instrumentation-fs&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">enabled</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To <strong>only load individual instrumentation libraries</strong>, replace [<strong>getNodeAutoInstrumentations()</strong>] with the list of those you need:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">HttpInstrumentation</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;@opentelemetry/instrumentation-http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ExpressInstrumentation</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;@opentelemetry/instrumentation-express&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">instrumentations</span>: [</span><br><span class="line">    <span class="comment">// Express instrumentation expects HTTP layer to be instrumented</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HttpInstrumentation</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ExpressInstrumentation</span>(),</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><ol>
<li>Some instrumentation libraries offer <strong>additional</strong> configuration options.</li>
<li>For example, <strong>Express instrumentation</strong> offers ways to <strong>ignore specified middleware</strong> or <strong>enrich spans created automatically with a request hook</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="variable constant_">SEMATTRS_HTTP_METHOD</span>,</span><br><span class="line">  <span class="variable constant_">SEMATTRS_HTTP_URL</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/semantic-conventions&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="title class_">ExpressInstrumentation</span>,</span><br><span class="line">  <span class="title class_">ExpressLayerType</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/instrumentation-express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expressInstrumentation = <span class="keyword">new</span> <span class="title class_">ExpressInstrumentation</span>(&#123;</span><br><span class="line">  <span class="attr">requestHook</span>: <span class="keyword">function</span> (<span class="params">span, info</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (info.<span class="property">layerType</span> === <span class="title class_">ExpressLayerType</span>.<span class="property">REQUEST_HANDLER</span>) &#123;</span><br><span class="line">      span.<span class="title function_">setAttribute</span>(<span class="variable constant_">SEMATTRS_HTTP_METHOD</span>, info.<span class="property">request</span>.<span class="property">method</span>);</span><br><span class="line">      span.<span class="title function_">setAttribute</span>(<span class="variable constant_">SEMATTRS_HTTP_URL</span>, info.<span class="property">request</span>.<span class="property">baseUrl</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Exporters"><a href="#Exporters" class="headerlink" title="Exporters"></a>Exporters</h1><blockquote>
<p>Process and export your telemetry data</p>
</blockquote>
<ol>
<li>Send telemetry to the <strong>OpenTelemetry Collector</strong> to make sure it’s exported correctly.<ul>
<li>Using the Collector in <strong>production environments</strong> is a <strong>best practice</strong>.</li>
</ul>
</li>
<li>To visualize your telemetry, export it to a backend such as <strong>Jaeger</strong>, <strong>Zipkin</strong>, <strong>Prometheus</strong>, or a vendor-specific backend.</li>
</ol>
<h2 id="Available-exporters"><a href="#Available-exporters" class="headerlink" title="Available exporters"></a>Available exporters</h2><ol>
<li>OpenTelemetry Protocol (OTLP) exporters are designed with the <strong>OpenTelemetry data model</strong> in mind, emitting OTel data without any loss of information.</li>
<li>Furthermore, many tools that operate on telemetry data support <strong>OTLP</strong> (such as <strong>Prometheus</strong>, <strong>Jaeger</strong>, and most vendors)<ul>
<li>providing you with a <strong>high degree of flexibility</strong> when you need it.</li>
</ul>
</li>
</ol>
<h2 id="OTLP"><a href="#OTLP" class="headerlink" title="OTLP"></a>OTLP</h2><h3 id="Collector-Setup"><a href="#Collector-Setup" class="headerlink" title="Collector Setup"></a>Collector Setup</h3><blockquote>
<p>In an empty directory, create a file called <code>collector-config.yaml</code> with the following content:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now run the collector in a docker container:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 4317:4317 -p 4318:4318 --rm -v $(pwd)/collector-config.yaml:/etc/otelcol/config.yaml otel/opentelemetry-collector:0.130.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>This collector is now able to accept <strong>telemetry</strong> via <strong>OTLP</strong></p>
</blockquote>
<h3 id="Dependencies-1"><a href="#Dependencies-1" class="headerlink" title="Dependencies"></a>Dependencies</h3><ol>
<li>If you want to send telemetry data to an <strong>OTLP endpoint</strong> (like the <strong>OpenTelemetry Collector</strong>, <strong>Jaeger</strong> or <strong>Prometheus</strong>)</li>
<li>You can choose between three different <strong>protocols</strong> to transport your data:</li>
</ol>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Package</th>
</tr>
</thead>
<tbody><tr>
<td>HTTP&#x2F;protobuf</td>
<td>@opentelemetry&#x2F;exporter-trace-otlp-proto</td>
</tr>
<tr>
<td>HTTP&#x2F;JSON</td>
<td>@opentelemetry&#x2F;exporter-trace-otlp-http</td>
</tr>
<tr>
<td>gRPC</td>
<td>@opentelemetry&#x2F;exporter-trace-otlp-grpc</td>
</tr>
</tbody></table>
<blockquote>
<p>Start by installing the respective exporter packages as a dependency for your project:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/exporter-trace-otlp-proto \</span><br><span class="line">  @opentelemetry/exporter-metrics-otlp-proto</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/exporter-trace-otlp-http \</span><br><span class="line">  @opentelemetry/exporter-metrics-otlp-http</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save @opentelemetry/exporter-trace-otlp-grpc \</span><br><span class="line">  @opentelemetry/exporter-metrics-otlp-grpc</span><br></pre></td></tr></table></figure>

<h3 id="Usage-with-Node-js"><a href="#Usage-with-Node-js" class="headerlink" title="Usage with Node.js"></a>Usage with Node.js</h3><ol>
<li>Next, configure the exporter to point at an OTLP endpoint.</li>
<li>For example you can update the file instrumentation.ts (or instrumentation.js if you use JavaScript) from the Getting Started like the following to export <strong>traces</strong> and <strong>metrics</strong> via OTLP (<strong>http&#x2F;protobuf</strong>) :</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> opentelemetry = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    getNodeAutoInstrumentations,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/auto-instrumentations-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">OTLPTraceExporter</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/exporter-trace-otlp-proto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">OTLPMetricExporter</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/exporter-metrics-otlp-proto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">PeriodicExportingMetricReader</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-metrics&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> opentelemetry.<span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">    <span class="attr">traceExporter</span>: <span class="keyword">new</span> <span class="title class_">OTLPTraceExporter</span>(&#123;</span><br><span class="line">        <span class="comment">// optional - default url is http://localhost:4318/v1/traces</span></span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;http://localhost:4318/v1/traces&#x27;</span>,</span><br><span class="line">        <span class="comment">// optional - collection of custom headers to be sent with each request, empty by default</span></span><br><span class="line">        <span class="attr">headers</span>: &#123;&#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">metricReader</span>: <span class="keyword">new</span> <span class="title class_">PeriodicExportingMetricReader</span>(&#123;</span><br><span class="line">        <span class="attr">exporter</span>: <span class="keyword">new</span> <span class="title class_">OTLPMetricExporter</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://localhost:4318/v1/metrics&#x27;</span>, <span class="comment">// url is optional and can be omitted - default is http://localhost:4318/v1/metrics</span></span><br><span class="line">            <span class="attr">headers</span>: &#123;&#125;, <span class="comment">// an optional object containing custom headers to be sent with each request</span></span><br><span class="line">            <span class="attr">concurrencyLimit</span>: <span class="number">1</span>, <span class="comment">// an optional limit on pending requests</span></span><br><span class="line">        &#125;),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="title function_">getNodeAutoInstrumentations</span>()],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">sdk.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250720180659812.png" alt="image-20250720180659812"></p>
<h3 id="Usage-in-the-Browser"><a href="#Usage-in-the-Browser" class="headerlink" title="Usage in the Browser"></a>Usage in the Browser</h3><blockquote>
<p>When you use the <strong>OTLP exporter</strong> in a <strong>browser-based application</strong>, you need to note that:</p>
</blockquote>
<ol>
<li>Using <strong>gRPC</strong> for exporting is <strong>not supported</strong></li>
<li><strong>Content Security Policies</strong> (CSPs) of your website might <strong>block</strong> your exports</li>
<li><strong>Cross-Origin Resource Sharing</strong> (CORS) headers might <strong>not allow</strong> your exports to be sent</li>
<li>You might need to expose your collector to the <strong>public internet</strong></li>
</ol>
<h4 id="Use-OTLP-exporter-with-HTTP-JSON-or-HTTP-protobuf"><a href="#Use-OTLP-exporter-with-HTTP-JSON-or-HTTP-protobuf" class="headerlink" title="Use OTLP exporter with HTTP&#x2F;JSON or HTTP&#x2F;protobuf"></a>Use OTLP exporter with HTTP&#x2F;JSON or HTTP&#x2F;protobuf</h4><ol>
<li>OpenTelemetry Collector Exporter with <strong>gRPC</strong> works only with <strong>Node.js</strong><ul>
<li>therefore you are limited to use the OpenTelemetry Collector Exporter with <strong>HTTP&#x2F;JSON</strong> or OpenTelemetry Collector Exporter with <strong>HTTP&#x2F;protobuf</strong>.</li>
</ul>
</li>
<li>Make sure that the <strong>receiving end</strong> of your <strong>exporter</strong> (collector or <strong>observability backend</strong>) accepts <strong>http&#x2F;json</strong> if you are using OpenTelemetry Collector Exporter with <strong>HTTP&#x2F;JSON</strong>, and that you are exporting your data to the right endpoint with your port set to <strong>4318</strong>.</li>
</ol>
<h4 id="Configure-CSPs"><a href="#Configure-CSPs" class="headerlink" title="Configure CSPs"></a>Configure CSPs</h4><ol>
<li>If your website is making use of <strong>Content Security Policies</strong> (CSPs), make sure that the <strong>domain</strong> of your <strong>OTLP endpoint</strong> is <strong>included</strong>.</li>
<li>If your collector endpoint is <strong><a target="_blank" rel="noopener" href="https://collector.example.com:4318/v1/traces">https://collector.example.com:4318/v1/traces</a></strong>, add the following directive:<ul>
<li><code>connect-src collector.example.com:4318/v1/traces</code></li>
</ul>
</li>
<li>If your <strong>CSP</strong> is <strong>not including</strong> the <strong>OTLP endpoint</strong><ul>
<li>you will see an <strong>error message</strong>, stating that the <strong>request to your endpoint</strong> is <strong>violating the CSP directive</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Configure-CORS-headers"><a href="#Configure-CORS-headers" class="headerlink" title="Configure CORS headers"></a>Configure CORS headers</h4><ol>
<li>If your <strong>website</strong> and <strong>collector</strong> are hosted at a <strong>different origin</strong>, your <strong>browser</strong> might <strong>block</strong> the <strong>requests</strong> going out to your <strong>collector</strong>.</li>
<li>You need to configure <strong>special headers</strong> for <strong>Cross-Origin Resource Sharing</strong> (CORS).</li>
<li>The <strong>OpenTelemetry Collector</strong> provides a feature for <strong>http-based receivers</strong><ul>
<li>to add the <strong>required headers</strong> to allow the <strong>receiver</strong> to <strong>accept traces from a web browser</strong>:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">include_metadata:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">cors:</span></span><br><span class="line">          <span class="attr">allowed_origins:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">https://foo.bar.com</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">https://*.test.com</span></span><br><span class="line">          <span class="attr">allowed_headers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Example-Header</span></span><br><span class="line">          <span class="attr">max_age:</span> <span class="number">7200</span></span><br></pre></td></tr></table></figure>

<h4 id="Securely-expose-your-collector"><a href="#Securely-expose-your-collector" class="headerlink" title="Securely expose your collector"></a>Securely expose your collector</h4><ol>
<li>To <strong>receive telemetry</strong> from a <strong>web application</strong> you need to allow the browsers of your end-users to send data to your collector.</li>
<li>If your <strong>web application</strong> is accessible from the <strong>public internet</strong>, you also have to make your <strong>collector accessible for everyone</strong>.</li>
<li>It is recommended that you <strong>do not expose</strong> your collector <strong>directly</strong>, but that you put a <strong>reverse proxy</strong> (NGINX, Apache HTTP Server, …) in front of it.<ul>
<li>The <strong>reverse proxy</strong> can take care of <strong>SSL-offloading</strong>, setting the right <strong>CORS headers</strong>, and many other features specific to web applications.</li>
</ul>
</li>
<li>Below you will find a configuration for the popular <strong>NGINX</strong> web server to get you started:</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># Take care of preflight requests</span></span><br><span class="line">        <span class="attribute">if</span> (<span class="variable">$request_method</span> = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Max-Age&#x27;</span> <span class="number">1728000</span>;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;name.of.your.website.example.com&#x27;</span> always;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;Accept,Accept-Language,Content-Language,Content-Type&#x27;</span> always;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span> always;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Content-Type&#x27;</span> <span class="string">&#x27;text/plain charset=UTF-8&#x27;</span>;</span><br><span class="line">             <span class="attribute">add_header</span> <span class="string">&#x27;Content-Length&#x27;</span> <span class="number">0</span>;</span><br><span class="line">             <span class="attribute">return</span> <span class="number">204</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;name.of.your.website.example.com&#x27;</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span> <span class="string">&#x27;true&#x27;</span> always;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;Accept,Accept-Language,Content-Language,Content-Type&#x27;</span> always;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://collector:4318;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h2><blockquote>
<p>To <strong>debug</strong> your <strong>instrumentation</strong> or see the values <strong>locally</strong> in <strong>development</strong>, you can use exporters writing telemetry data to the console (<strong>stdout</strong>).</p>
</blockquote>
<h2 id="Batching-span-and-log-records"><a href="#Batching-span-and-log-records" class="headerlink" title="Batching span and log records"></a>Batching span and log records</h2><ol>
<li>The OpenTelemetry SDK provides a set of <strong>default span and log record processors</strong><ul>
<li>that allow you to either emit spans <strong>one-by-on</strong> (“<strong>simple</strong>”) or <strong>batched</strong>.</li>
</ul>
</li>
<li>Using <strong>batching</strong> is <strong>recommended</strong>, but if you do not want to batch your spans or log records, you can use a simple processor instead as follows:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*instrumentation.js*/</span></span><br><span class="line"><span class="keyword">const</span> opentelemetry = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    getNodeAutoInstrumentations,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/auto-instrumentations-node&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> opentelemetry.<span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">    <span class="attr">spanProcessors</span>: [<span class="keyword">new</span> <span class="title class_">SimpleSpanProcessor</span>(exporter)],</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="title function_">getNodeAutoInstrumentations</span>()],</span><br><span class="line">&#125;);</span><br><span class="line">sdk.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<h1 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h1><blockquote>
<p>OpenTelemetry JavaScript Context API Documentation</p>
</blockquote>
<ol>
<li>In order for OpenTelemetry to work, it must <strong>store</strong> and <strong>propagate</strong> important telemetry data.<ul>
<li>For example, when a <strong>request</strong> is <strong>received</strong> and a <strong>span</strong> is <strong>started</strong> it must be available to a component which creates its <strong>child span</strong>.</li>
</ul>
</li>
<li>To solve this problem, OpenTelemetry stores the span in the <strong>Context</strong>.</li>
</ol>
<h2 id="Context-Manager"><a href="#Context-Manager" class="headerlink" title="Context Manager"></a>Context Manager</h2><ol>
<li>The context API depends on a <strong>context manager</strong> to work.</li>
<li>Typically the <strong>context manager</strong> is <strong>provided</strong> by your <strong>SDK</strong>, however it is possible to <strong>register</strong> one <strong>directly</strong> like this:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AsyncHooksContextManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/context-async-hooks&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> contextManager = <span class="keyword">new</span> <span class="title class_">AsyncHooksContextManager</span>();</span><br><span class="line">contextManager.<span class="title function_">enable</span>();</span><br><span class="line">api.<span class="property">context</span>.<span class="title function_">setGlobalContextManager</span>(contextManager);</span><br></pre></td></tr></table></figure>

<h2 id="Root-Context"><a href="#Root-Context" class="headerlink" title="Root Context"></a>Root Context</h2><ol>
<li>The <strong>ROOT_CONTEXT</strong> is the <strong>empty context</strong>.</li>
<li>If <strong>no context</strong> is <strong>active</strong>, the <strong>ROOT_CONTEXT</strong> is <strong>active</strong>.</li>
</ol>
<h2 id="Context-Keys"><a href="#Context-Keys" class="headerlink" title="Context Keys"></a>Context Keys</h2><blockquote>
<p>Context entries are <strong>key-value pairs</strong>. Keys can be created by calling <strong>api.createContextKey(description)</strong>.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key1 = api.<span class="title function_">createContextKey</span>(<span class="string">&#x27;My first key&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> key2 = api.<span class="title function_">createContextKey</span>(<span class="string">&#x27;My second key&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Basic-Operations"><a href="#Basic-Operations" class="headerlink" title="Basic Operations"></a>Basic Operations</h2><h3 id="Get-Entry"><a href="#Get-Entry" class="headerlink" title="Get Entry"></a>Get Entry</h3><blockquote>
<p>Entries are <strong>accessed</strong> using the <strong>context.getValue(key)</strong> method.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = api.<span class="title function_">createContextKey</span>(<span class="string">&#x27;some key&#x27;</span>);</span><br><span class="line"><span class="comment">// ROOT_CONTEXT is the empty context</span></span><br><span class="line"><span class="keyword">const</span> ctx = api.<span class="property">ROOT_CONTEXT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> value = ctx.<span class="title function_">getValue</span>(key);</span><br></pre></td></tr></table></figure>

<h3 id="Set-Entry"><a href="#Set-Entry" class="headerlink" title="Set Entry"></a>Set Entry</h3><blockquote>
<p><strong>Copy On Write</strong></p>
</blockquote>
<ol>
<li>Entries are <strong>created</strong> by using the <strong>context.setValue(key, value)</strong> method. </li>
<li>Setting a context entry <strong>creates a new context</strong> with <strong>all the entries</strong> of the <strong>previous context</strong>, but with the <strong>new entry</strong>.</li>
<li>Setting a context entry <strong>does not modify</strong> the <strong>previous context</strong>.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = api.<span class="title function_">createContextKey</span>(<span class="string">&#x27;some key&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = api.<span class="property">ROOT_CONTEXT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add a new entry</span></span><br><span class="line"><span class="keyword">const</span> ctx2 = ctx.<span class="title function_">setValue</span>(key, <span class="string">&#x27;context 2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ctx2 contains the new entry</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx2.<span class="title function_">getValue</span>(key)); <span class="comment">// &quot;context 2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ctx is unchanged</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="title function_">getValue</span>(key)); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="Delete-Entry"><a href="#Delete-Entry" class="headerlink" title="Delete Entry"></a>Delete Entry</h3><blockquote>
<p><strong>Copy On Write</strong></p>
</blockquote>
<ol>
<li>Entries are <strong>removed</strong> by calling <code>context.deleteValue(key)</code>. </li>
<li>Deleting a context entry <strong>creates a new context</strong> with <strong>all the entries</strong> of the <strong>previous context</strong>, but <strong>without</strong> the entry identified by the key.</li>
<li>Deleting a context entry <strong>does not modify</strong> the <strong>previous context</strong>.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> api <span class="keyword">from</span> <span class="string">&#x27;@opentelemetry/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = api.<span class="title function_">createContextKey</span>(<span class="string">&#x27;some key&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ctx = api.<span class="property">ROOT_CONTEXT</span>;</span><br><span class="line"><span class="keyword">const</span> ctx2 = ctx.<span class="title function_">setValue</span>(key, <span class="string">&#x27;context 2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// remove the entry</span></span><br><span class="line"><span class="keyword">const</span> ctx3 = ctx.<span class="title function_">deleteValue</span>(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ctx3 does not contain the entry</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx3.<span class="title function_">getValue</span>(key)); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ctx2 is unchanged</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx2.<span class="title function_">getValue</span>(key)); <span class="comment">// &quot;context 2&quot;</span></span><br><span class="line"><span class="comment">// ctx is unchanged</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ctx.<span class="title function_">getValue</span>(key)); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="Active-Context"><a href="#Active-Context" class="headerlink" title="Active Context"></a>Active Context</h2><ol>
<li>IMPORTANT: This assumes you have configured a Context Manager. <strong>Without</strong> one, <strong>api.context.active()</strong> will <strong>ALWAYS</strong> return the <strong>ROOT_CONTEXT</strong>.</li>
<li>The <strong>active context</strong> is the context which is returned by <strong>api.context.active()</strong>.</li>
<li>The context object contains <strong>entries</strong> which allow <strong>tracing components</strong> which are tracing a <strong>single thread of execution</strong><ul>
<li>to <strong>communicate</strong> with <strong>each other</strong> and ensure the trace is successfully created.</li>
</ul>
</li>
<li>For example, when a <strong>span</strong> is <strong>created</strong> it may be added to the <strong>context</strong>.<ul>
<li>Later, when <strong>another span</strong> is <strong>created</strong> it may use the <strong>span from the context</strong> as its <strong>parent span</strong>.</li>
</ul>
</li>
<li>This is accomplished through the use of mechanisms like <strong>async_hooks</strong> or <strong>AsyncLocalStorage</strong> in node, or zone.js on the web<ul>
<li>in order to <strong>propagate</strong> the <strong>context</strong> through a <strong>single execution</strong>.</li>
</ul>
</li>
<li>If <strong>no context</strong> is <strong>active</strong>, the <strong>ROOT_CONTEXT</strong> is returned, which is just the <strong>empty context</strong> object.</li>
</ol>
<h1 id="Propagation"><a href="#Propagation" class="headerlink" title="Propagation"></a>Propagation</h1><blockquote>
<p>Context propagation for the JS SDK</p>
</blockquote>
<ol>
<li>With <strong>context propagation</strong>, Signals can be <strong>correlated</strong> with each other, regardless of where they are generated.</li>
<li>Although not limited to tracing<ul>
<li><strong>context propagation</strong> allows traces to build <strong>causal information</strong> about a system <strong>across services</strong> that are </li>
<li>arbitrarily distributed across <strong>process</strong> and <strong>network</strong> boundaries.</li>
</ul>
</li>
<li>For the <strong>vast majority</strong> of use cases<ul>
<li>libraries that <strong>natively support</strong> OpenTelemetry or <strong>instrumentation libraries</strong> will <strong>automatically propagate trace context</strong> across services for you.</li>
<li>It is only in <strong>rare cases</strong> that you will need to <strong>propagate context manually</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Automatic-context-propagation"><a href="#Automatic-context-propagation" class="headerlink" title="Automatic context propagation"></a>Automatic context propagation</h2><p>Instrumentation libraries like <strong>@opentelemetry&#x2F;instrumentation-http</strong> or <strong>@opentelemetry&#x2F;instrumentation-express</strong> propagate context across services</p>
<blockquote>
<p>Start by creating a new folder called dice-client and install the required dependencies:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm init -y</span><br><span class="line">npm install undici \</span><br><span class="line">  @opentelemetry/instrumentation-undici \</span><br><span class="line">  @opentelemetry/sdk-node</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Next, create a new file called client.ts (or client.js) with the following content:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">NodeSDK</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">SimpleSpanProcessor</span>,</span><br><span class="line">    <span class="title class_">ConsoleSpanExporter</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-trace-node&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">UndiciInstrumentation</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/instrumentation-undici&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">    <span class="attr">spanProcessors</span>: [<span class="keyword">new</span> <span class="title class_">SimpleSpanProcessor</span>(<span class="keyword">new</span> <span class="title class_">ConsoleSpanExporter</span>())],</span><br><span class="line">    <span class="attr">instrumentations</span>: [<span class="keyword">new</span> <span class="title class_">UndiciInstrumentation</span>()],</span><br><span class="line">&#125;);</span><br><span class="line">sdk.<span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&#x27;undici&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">request</span>(<span class="string">&#x27;http://localhost:8080/rolldice&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    response.<span class="property">body</span>.<span class="title function_">json</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(json));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Make sure that you have the instrumented version of app.ts (or app.js) from the Getting Started running in one shell:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node --require ./instrumentation.js app.js</span><br><span class="line">Listening for requests on http://localhost:8080</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Start a second shell and run the client.ts (or client.js):</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node client.js</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Both shells should emit <strong>span details</strong> to the console. The client output looks similar to the following:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  resource<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      &#x27;host.name&#x27;<span class="punctuation">:</span> &#x27;macos.local&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;host.arch&#x27;<span class="punctuation">:</span> &#x27;arm64&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;host.id&#x27;<span class="punctuation">:</span> &#x27;<span class="number">359031</span>FF<span class="number">-956E-5</span>B48<span class="number">-89</span>FD<span class="number">-8</span>A78A79AE606&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.pid&#x27;<span class="punctuation">:</span> <span class="number">11706</span><span class="punctuation">,</span></span><br><span class="line">      &#x27;process.executable.name&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.executable.path&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.command_args&#x27;<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        &#x27;/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">        &#x27;/Users/zhongmingmao/workspace/o11y/demo/voyager-o11y-demo-js-nodejs-client/client.js&#x27;</span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.version&#x27;<span class="punctuation">:</span> &#x27;<span class="number">22.17</span><span class="number">.1</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.name&#x27;<span class="punctuation">:</span> &#x27;nodejs&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.runtime.description&#x27;<span class="punctuation">:</span> &#x27;Node.js&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.command&#x27;<span class="punctuation">:</span> &#x27;/Users/zhongmingmao/workspace/o11y/demo/voyager-o11y-demo-js-nodejs-client/client.js&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;process.owner&#x27;<span class="punctuation">:</span> &#x27;zhongmingmao&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;service.name&#x27;<span class="punctuation">:</span> &#x27;unknown_service<span class="punctuation">:</span>/Users/zhongmingmao/.asdf/installs/nodejs/<span class="number">22.17</span><span class="number">.1</span>/bin/node&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.language&#x27;<span class="punctuation">:</span> &#x27;nodejs&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.name&#x27;<span class="punctuation">:</span> &#x27;opentelemetry&#x27;<span class="punctuation">,</span></span><br><span class="line">      &#x27;telemetry.sdk.version&#x27;<span class="punctuation">:</span> &#x27;<span class="number">2.0</span><span class="number">.1</span>&#x27;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  instrumentationScope<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> &#x27;@opentelemetry/instrumentation-undici&#x27;<span class="punctuation">,</span></span><br><span class="line">    version<span class="punctuation">:</span> &#x27;<span class="number">0.14</span><span class="number">.0</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">    schemaUrl<span class="punctuation">:</span> undefined</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  traceId<span class="punctuation">:</span> &#x27;a791aae12c1bfc6264884fde5c42be29&#x27;<span class="punctuation">,</span></span><br><span class="line">  parentSpanContext<span class="punctuation">:</span> undefined<span class="punctuation">,</span></span><br><span class="line">  traceState<span class="punctuation">:</span> undefined<span class="punctuation">,</span></span><br><span class="line">  name<span class="punctuation">:</span> &#x27;GET&#x27;<span class="punctuation">,</span></span><br><span class="line">  id<span class="punctuation">:</span> &#x27;<span class="number">6</span>db7a93cbaa5dfb1&#x27;<span class="punctuation">,</span></span><br><span class="line">  kind<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  timestamp<span class="punctuation">:</span> <span class="number">1753012207997000</span><span class="punctuation">,</span></span><br><span class="line">  duration<span class="punctuation">:</span> <span class="number">20464.958</span><span class="punctuation">,</span></span><br><span class="line">  attributes<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    &#x27;http.request.method&#x27;<span class="punctuation">:</span> &#x27;GET&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;http.request.method_original&#x27;<span class="punctuation">:</span> &#x27;GET&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;url.full&#x27;<span class="punctuation">:</span> &#x27;http<span class="punctuation">:</span><span class="comment">//localhost:8080/rolldice&#x27;,</span></span><br><span class="line">    &#x27;url.path&#x27;<span class="punctuation">:</span> &#x27;/rolldice&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;url.query&#x27;<span class="punctuation">:</span> &#x27;&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;url.scheme&#x27;<span class="punctuation">:</span> &#x27;http&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;server.address&#x27;<span class="punctuation">:</span> &#x27;localhost&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;server.port&#x27;<span class="punctuation">:</span> <span class="number">8080</span><span class="punctuation">,</span></span><br><span class="line">    &#x27;network.peer.address&#x27;<span class="punctuation">:</span> &#x27;<span class="punctuation">:</span><span class="punctuation">:</span><span class="number">1</span>&#x27;<span class="punctuation">,</span></span><br><span class="line">    &#x27;network.peer.port&#x27;<span class="punctuation">:</span> <span class="number">8080</span><span class="punctuation">,</span></span><br><span class="line">    &#x27;http.response.status_code&#x27;<span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    &#x27;http.response.header.content-length&#x27;<span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  status<span class="punctuation">:</span> <span class="punctuation">&#123;</span> code<span class="punctuation">:</span> <span class="number">0</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  events<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  links<span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Your client and server application successfully <strong>report connected spans</strong>.</li>
<li>If you send <strong>both</strong> to a <strong>backend</strong> now the <strong>visualization</strong> will show this dependency for you.</li>
</ol>
<h1 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h1><blockquote>
<p>Add details about your applications’ <strong>environment</strong> to your telemetry</p>
</blockquote>
<ol>
<li>A resource represents the entity <strong>producing telemetry</strong> as <strong>resource</strong> attributes.</li>
<li>For example, a process producing telemetry that is running in a container on <strong>Kubernetes</strong><ul>
<li>has a <strong>process name</strong>, a <strong>pod name</strong>, a <strong>namespace</strong>, and possibly a <strong>deployment name</strong>.</li>
<li>All four of these <strong>attributes</strong> can be included in the <strong>resource</strong>.</li>
</ul>
</li>
<li>In your <strong>observability backend</strong>, you can use <strong>resource</strong> information to better <strong>investigate</strong> interesting behavior</li>
<li>For example, if your trace or metrics data indicate latency in your system, you can narrow it down to a specific container, pod, or Kubernetes deployment.</li>
<li>Below you will find introductions on how to set up <strong>resource detection</strong> with the <strong>Node.js SDK</strong>.</li>
</ol>
<h1 id="Sampling"><a href="#Sampling" class="headerlink" title="Sampling"></a>Sampling</h1><blockquote>
<p><strong>Reduce</strong> the <strong>amount</strong> of telemetry created</p>
</blockquote>
<p>Sampling is a process that <strong>restricts</strong> the <strong>amount</strong> of <strong>traces</strong> that are generated by a system. The JavaScript SDK offers several <strong>head samplers</strong>.</p>
<h2 id="Default-behavior"><a href="#Default-behavior" class="headerlink" title="Default behavior"></a>Default behavior</h2><p>By default, <strong>all spans</strong> are sampled, and thus, <strong>100%</strong> of traces are sampled. If you do not need to manage data volume, don’t bother setting a sampler.</p>
<h2 id="TraceIDRatioBasedSampler"><a href="#TraceIDRatioBasedSampler" class="headerlink" title="TraceIDRatioBasedSampler"></a>TraceIDRatioBasedSampler</h2><ol>
<li>When sampling, the most common <strong>head sampler</strong> to use is the <strong>TraceIdRatioBasedSampler</strong>.</li>
<li>It <strong>deterministically</strong> samples a <strong>percentage</strong> of traces that you pass in as a parameter.</li>
</ol>
<h3 id="Environment-Variables"><a href="#Environment-Variables" class="headerlink" title="Environment Variables"></a>Environment Variables</h3><ol>
<li>You can configure the <strong>TraceIdRatioBasedSampler</strong> with <strong>environment variables</strong></li>
<li>This tells the SDK to <strong>sample spans</strong> such that only <strong>10%</strong> of traces get <strong>created</strong>.</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_TRACES_SAMPLER=&quot;traceidratio&quot;</span><br><span class="line">export OTEL_TRACES_SAMPLER_ARG=&quot;0.1&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Node-js-1"><a href="#Node-js-1" class="headerlink" title="Node.js"></a>Node.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">TraceIdRatioBasedSampler</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-trace-node&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> samplePercentage = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sdk = <span class="keyword">new</span> <span class="title class_">NodeSDK</span>(&#123;</span><br><span class="line">  <span class="comment">// Other SDK configuration parameters go here</span></span><br><span class="line">  <span class="attr">sampler</span>: <span class="keyword">new</span> <span class="title class_">TraceIdRatioBasedSampler</span>(samplePercentage),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Browser-1"><a href="#Browser-1" class="headerlink" title="Browser"></a>Browser</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="title class_">WebTracerProvider</span>,</span><br><span class="line">  <span class="title class_">TraceIdRatioBasedSampler</span>,</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;@opentelemetry/sdk-trace-web&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> samplePercentage = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> provider = <span class="keyword">new</span> <span class="title class_">WebTracerProvider</span>(&#123;</span><br><span class="line">  <span class="attr">sampler</span>: <span class="keyword">new</span> <span class="title class_">TraceIdRatioBasedSampler</span>(samplePercentage),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/03/cloud-native-observability-opentelemetry-js/">https://blog.zhongmingmao.top/2025/01/03/cloud-native-observability-opentelemetry-js/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/opentelemetry/">OpenTelemetry</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Observability - OpenTelemetry Go</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Observability - OpenTelemetry Doc V2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-05</div><div class="title">Observability - OpenTelemetry Python</div></div></a></div><div><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="title">Observability - OpenTelemetry Go</div></div></a></div><div><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="title">Observability - OpenTelemetry Doc V2</div></div></a></div><div><a href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="title">Observability - OpenTelemetry Doc V1</div></div></a></div><div><a href="/2024/10/14/cloud-native-observability-opentelemetry/" title="Observability - OpenTelemetry"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-14</div><div class="title">Observability - OpenTelemetry</div></div></a></div><div><a href="/2024/10/13/cloud-native-observability-concept/" title="Observability - Concept"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-concept.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-13</div><div class="title">Observability - Concept</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">627</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Status-and-Releases"><span class="toc-number">1.1.</span> <span class="toc-text">Status and Releases</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Version-Support"><span class="toc-number">1.2.</span> <span class="toc-text">Version Support</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Repositories"><span class="toc-number">1.3.</span> <span class="toc-text">Repositories</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started"><span class="toc-number">2.</span> <span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-js"><span class="toc-number">2.1.</span> <span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-Application"><span class="toc-number">2.1.1.</span> <span class="toc-text">Example Application</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dependencies"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-and-launch-an-HTTP-Server"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">Create and launch an HTTP Server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instrumentation"><span class="toc-number">2.1.2.</span> <span class="toc-text">Instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#More-Dependencies"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">More Dependencies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Setup"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">Setup</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-the-instrumented-app"><span class="toc-number">2.1.3.</span> <span class="toc-text">Run the instrumented app</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Browser"><span class="toc-number">2.2.</span> <span class="toc-text">Browser</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-Application-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Example Application</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Installation"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Initialization-and-Configuration"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">Initialization and Configuration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating-a-Tracer-Provider"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">Creating a Tracer Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating-an-Exporter"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">Creating an Exporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Add-Instrumentations"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">Add Instrumentations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meta-Packages-for-Web"><span class="toc-number">2.2.2.</span> <span class="toc-text">Meta Packages for Web</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Instrumentation-1"><span class="toc-number">3.</span> <span class="toc-text">Instrumentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Libraries"><span class="toc-number">4.</span> <span class="toc-text">Libraries</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Use-natively-instrumented-libraries"><span class="toc-number">4.1.</span> <span class="toc-text">Use natively instrumented libraries</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Use-Instrumentation-Libraries"><span class="toc-number">4.2.</span> <span class="toc-text">Use Instrumentation Libraries</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Registration"><span class="toc-number">4.2.2.</span> <span class="toc-text">Registration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration"><span class="toc-number">4.2.3.</span> <span class="toc-text">Configuration</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Exporters"><span class="toc-number">5.</span> <span class="toc-text">Exporters</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Available-exporters"><span class="toc-number">5.1.</span> <span class="toc-text">Available exporters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OTLP"><span class="toc-number">5.2.</span> <span class="toc-text">OTLP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector-Setup"><span class="toc-number">5.2.1.</span> <span class="toc-text">Collector Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependencies-1"><span class="toc-number">5.2.2.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Usage-with-Node-js"><span class="toc-number">5.2.3.</span> <span class="toc-text">Usage with Node.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Usage-in-the-Browser"><span class="toc-number">5.2.4.</span> <span class="toc-text">Usage in the Browser</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Use-OTLP-exporter-with-HTTP-JSON-or-HTTP-protobuf"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">Use OTLP exporter with HTTP&#x2F;JSON or HTTP&#x2F;protobuf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-CSPs"><span class="toc-number">5.2.4.2.</span> <span class="toc-text">Configure CSPs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-CORS-headers"><span class="toc-number">5.2.4.3.</span> <span class="toc-text">Configure CORS headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Securely-expose-your-collector"><span class="toc-number">5.2.4.4.</span> <span class="toc-text">Securely expose your collector</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Console"><span class="toc-number">5.3.</span> <span class="toc-text">Console</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Batching-span-and-log-records"><span class="toc-number">5.4.</span> <span class="toc-text">Batching span and log records</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Context"><span class="toc-number">6.</span> <span class="toc-text">Context</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-Manager"><span class="toc-number">6.1.</span> <span class="toc-text">Context Manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Context"><span class="toc-number">6.2.</span> <span class="toc-text">Root Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-Keys"><span class="toc-number">6.3.</span> <span class="toc-text">Context Keys</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Operations"><span class="toc-number">6.4.</span> <span class="toc-text">Basic Operations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Get-Entry"><span class="toc-number">6.4.1.</span> <span class="toc-text">Get Entry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-Entry"><span class="toc-number">6.4.2.</span> <span class="toc-text">Set Entry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Delete-Entry"><span class="toc-number">6.4.3.</span> <span class="toc-text">Delete Entry</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Context"><span class="toc-number">6.5.</span> <span class="toc-text">Active Context</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Propagation"><span class="toc-number">7.</span> <span class="toc-text">Propagation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Automatic-context-propagation"><span class="toc-number">7.1.</span> <span class="toc-text">Automatic context propagation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Resources"><span class="toc-number">8.</span> <span class="toc-text">Resources</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sampling"><span class="toc-number">9.</span> <span class="toc-text">Sampling</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Default-behavior"><span class="toc-number">9.1.</span> <span class="toc-text">Default behavior</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TraceIDRatioBasedSampler"><span class="toc-number">9.2.</span> <span class="toc-text">TraceIDRatioBasedSampler</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-Variables"><span class="toc-number">9.2.1.</span> <span class="toc-text">Environment Variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-1"><span class="toc-number">9.2.2.</span> <span class="toc-text">Node.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Browser-1"><span class="toc-number">9.2.3.</span> <span class="toc-text">Browser</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/09/new-java-feature-sealed/" title="New Java Feature - Sealed"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/new-java-feature-sealed.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Sealed"/></a><div class="content"><a class="title" href="/2025/01/09/new-java-feature-sealed/" title="New Java Feature - Sealed">New Java Feature - Sealed</a><time datetime="2025-01-08T16:06:25.000Z" title="Created 2025-01-09 00:06:25">2025-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/08/new-java-feature-record/" title="New Java Feature - Record"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/new-java-feature-record.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Record"/></a><div class="content"><a class="title" href="/2025/01/08/new-java-feature-record/" title="New Java Feature - Record">New Java Feature - Record</a><time datetime="2025-01-07T16:06:25.000Z" title="Created 2025-01-08 00:06:25">2025-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/07/new-java-feature-text-blocks/" title="New Java Feature - Text Blocks"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/text-blocks-java-17-new-feature.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Text Blocks"/></a><div class="content"><a class="title" href="/2025/01/07/new-java-feature-text-blocks/" title="New Java Feature - Text Blocks">New Java Feature - Text Blocks</a><time datetime="2025-01-06T16:06:25.000Z" title="Created 2025-01-07 00:06:25">2025-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/06/new-java-feature-jshell/" title="New Java Feature - JShell"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/java-feature-jshell.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - JShell"/></a><div class="content"><a class="title" href="/2025/01/06/new-java-feature-jshell/" title="New Java Feature - JShell">New Java Feature - JShell</a><time datetime="2025-01-05T16:06:25.000Z" title="Created 2025-01-06 00:06:25">2025-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Python"/></a><div class="content"><a class="title" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python">Observability - OpenTelemetry Python</a><time datetime="2025-01-04T16:06:25.000Z" title="Created 2025-01-05 00:06:25">2025-01-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2025 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>