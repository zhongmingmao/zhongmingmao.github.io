<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Observability - OpenTelemetry Python | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development   Version supportOpenTelemetry-Python supports Python 3.9 and higher.">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - OpenTelemetry Python">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/05/cloud-native-observability-opentelemetry-python/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development   Version supportOpenTelemetry-Python supports Python 3.9 and higher.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg">
<meta property="article:published_time" content="2025-01-04T16:06:25.000Z">
<meta property="article:modified_time" content="2025-07-31T15:54:52.386Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="OpenTelemetry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/05/cloud-native-observability-opentelemetry-python/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - OpenTelemetry Python',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-31 23:54:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">626</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Observability - OpenTelemetry Python</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2025-01-04T16:06:25.000Z" title="Created 2025-01-05 00:06:25">2025-01-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>20min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><h2 id="Status-and-Releases"><a href="#Status-and-Releases" class="headerlink" title="Status and Releases"></a>Status and Releases</h2><table>
<thead>
<tr>
<th>Traces</th>
<th>Metrics</th>
<th>Logs</th>
</tr>
</thead>
<tbody><tr>
<td>Stable</td>
<td>Stable</td>
<td>Development</td>
</tr>
</tbody></table>
<h2 id="Version-support"><a href="#Version-support" class="headerlink" title="Version support"></a>Version support</h2><p>OpenTelemetry-Python supports Python <strong>3.9</strong> and higher.</p>
<span id="more"></span>

<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><blockquote>
<p>The API and SDK packages are available on PyPI, and can be installed via pip:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-api</span><br><span class="line">pip install opentelemetry-sdk</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In addition, there are several extension packages which can be installed separately as:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-exporter-&#123;exporter&#125;</span><br><span class="line">pip install opentelemetry-instrumentation-&#123;instrumentation&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>These are for <strong>exporter</strong> and <strong>instrumentation</strong> libraries respectively.</li>
<li>The <strong>Jaeger</strong>, <strong>Zipkin</strong>, <strong>Prometheus</strong>, <strong>OTLP</strong> and <strong>OpenCensus</strong> Exporters can be found in the exporter directory of the repository.</li>
<li><strong>Instrumentations</strong> and <strong>additional exporters</strong> can be found in the <strong>contrib repository</strong> instrumentation and exporter directories.</li>
</ol>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Example-Application"><a href="#Example-Application" class="headerlink" title="Example Application"></a>Example Application</h2><ol>
<li>The following example uses a basic <strong>Flask</strong> application.</li>
<li>You can use OpenTelemetry Python with other web frameworks as well, such as <strong>Django</strong> and <strong>FastAPI</strong>.</li>
</ol>
<h2 id="Installation-1"><a href="#Installation-1" class="headerlink" title="Installation"></a>Installation</h2><blockquote>
<p>To begin, set up an environment in a new directory:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir otel-getting-started</span><br><span class="line">cd otel-getting-started</span><br><span class="line">python3 -m venv venv</span><br><span class="line">source ./venv/bin/activate</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now install Flask:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask</span><br></pre></td></tr></table></figure>

<h3 id="Create-and-launch-an-HTTP-Server"><a href="#Create-and-launch-an-HTTP-Server" class="headerlink" title="Create and launch an HTTP Server"></a>Create and launch an HTTP Server</h3><blockquote>
<p>Create a file <code>app.py</code> and add the following code to it:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from random import randint</span><br><span class="line">from flask import Flask, request</span><br><span class="line">import logging</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;/rolldice&quot;)</span><br><span class="line">def roll_dice():</span><br><span class="line">    player = request.args.get(&#x27;player&#x27;, default=None, type=str)</span><br><span class="line">    result = str(roll())</span><br><span class="line">    if player:</span><br><span class="line">        logger.warning(&quot;%s is rolling the dice: %s&quot;, player, result)</span><br><span class="line">    else:</span><br><span class="line">        logger.warning(&quot;Anonymous player is rolling the dice: %s&quot;, result)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def roll():</span><br><span class="line">    return randint(1, 6)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Run the application with the following command and open <a target="_blank" rel="noopener" href="http://localhost:8080/rolldice">http://localhost:8080/rolldice</a> in your web browser to ensure it is working.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask run -p 8080</span><br></pre></td></tr></table></figure>

<h2 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h2><ol>
<li>Zero-code instrumentation will <strong>generate telemetry data</strong> on your behalf.</li>
<li>There are several options you can take, Here we’ll use the <strong>opentelemetry-instrument</strong> agent.</li>
<li>Install the <strong>opentelemetry-distro</strong> package<ul>
<li>which contains the OpenTelemetry <strong>API</strong>, <strong>SDK</strong> and also the tools <strong>opentelemetry-bootstrap</strong> and <strong>opentelemetry-instrument</strong> you will use below.</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-distro</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Run the <code>opentelemetry-bootstrap</code> command:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opentelemetry-bootstrap -a install</span><br></pre></td></tr></table></figure>

<blockquote>
<p>This will install <strong>Flask instrumentation</strong>.</p>
</blockquote>
<h2 id="Run-the-instrumented-app"><a href="#Run-the-instrumented-app" class="headerlink" title="Run the instrumented app"></a>Run the instrumented app</h2><blockquote>
<p>You can now run your instrumented app with <strong>opentelemetry-instrument</strong> and have it print to the console for now:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true</span><br><span class="line">opentelemetry-instrument \</span><br><span class="line">    --traces_exporter console \</span><br><span class="line">    --metrics_exporter console \</span><br><span class="line">    --logs_exporter console \</span><br><span class="line">    --service_name dice-server \</span><br><span class="line">    flask run -p 8080</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Open <a target="_blank" rel="noopener" href="http://localhost:8080/rolldice">http://localhost:8080/rolldice</a> in your web browser and reload the page a few times.<br>After a while you should see the <strong>spans</strong> printed in the console, such as the following:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GET /rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x830764002fc7a5dea65898ae9a6e99f3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x6374fc33cf0505e9&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;trace_state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[]&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SpanKind.SERVER&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T13:43:04.764170Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T13:43:04.764971Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;status_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNSET&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;http.method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GET&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.server_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.scheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.host.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.host.port&quot;</span><span class="punctuation">:</span> <span class="number">8080</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.peer.ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.peer.port&quot;</span><span class="punctuation">:</span> <span class="number">63562</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.user_agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;curl/8.7.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.status_code&quot;</span><span class="punctuation">:</span> <span class="number">200</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opentelemetry&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.36.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;service.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dice-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.auto.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.57b0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;schema_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>The generated span tracks the <strong>lifetime</strong> of a <strong>request</strong> to the <code>/rolldice</code> route.</li>
<li>The log line emitted during the request contains the same <strong>trace ID</strong> and <strong>span ID</strong> and is exported to the <strong>console</strong> via the log exporter.</li>
<li>Send a few more requests to the endpoint, and then either wait for a little bit or terminate the app and you’ll see <strong>metrics</strong> in the console output</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;arms_python_process_runtime_cpython_context_switches&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Runtime context switches&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;switches&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;data_points&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;involuntary&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;start_time_unix_nano&quot;</span><span class="punctuation">:</span> <span class="number">1753969441098665000</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;time_unix_nano&quot;</span><span class="punctuation">:</span> <span class="number">1753969621342108000</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;exemplars&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;voluntary&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;start_time_unix_nano&quot;</span><span class="punctuation">:</span> <span class="number">1753969441098683000</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;time_unix_nano&quot;</span><span class="punctuation">:</span> <span class="number">1753969621342108000</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">1748</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;exemplars&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;aggregation_temporality&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;is_monotonic&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Add-manual-instrumentation-to-automatic-instrumentation"><a href="#Add-manual-instrumentation-to-automatic-instrumentation" class="headerlink" title="Add manual instrumentation to automatic instrumentation"></a>Add manual instrumentation to automatic instrumentation</h2><ol>
<li><strong>Automatic instrumentation</strong> captures <strong>telemetry</strong> at the <strong>edges</strong> of your systems<ul>
<li>such as <strong>inbound</strong> and <strong>outbound</strong> HTTP requests, but it doesn’t capture what’s going on <strong>in</strong> your application.</li>
</ul>
</li>
<li>For that you’ll need to write some <strong>manual instrumentation</strong>.</li>
</ol>
<h3 id="Traces"><a href="#Traces" class="headerlink" title="Traces"></a>Traces</h3><blockquote>
<p>First, modify <code>app.py</code> to include code that initializes a <strong>tracer</strong> and uses it to <strong>create a trace</strong> that’s a <strong>child</strong> of the one that’s <strong>automatically generated</strong>:</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> opentelemetry <span class="keyword">import</span> trace</span><br><span class="line"></span><br><span class="line"><span class="comment"># Acquire a tracer</span></span><br><span class="line">tracer = trace.get_tracer(<span class="string">&quot;diceroller.tracer&quot;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/rolldice&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll_dice</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(roll())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll</span>():</span><br><span class="line">    <span class="comment"># This creates a new span that&#x27;s the child of the current one</span></span><br><span class="line">    <span class="keyword">with</span> tracer.start_as_current_span(<span class="string">&quot;roll&quot;</span>) <span class="keyword">as</span> rollspan:</span><br><span class="line">        res = randint(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">        rollspan.set_attribute(<span class="string">&quot;roll.value&quot;</span>, res)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now run the app again:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-exporter-otlp opentelemetry-exporter-otlp-proto-grpc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true</span><br><span class="line">opentelemetry-instrument \</span><br><span class="line">    --traces_exporter console \</span><br><span class="line">    --metrics_exporter console \</span><br><span class="line">    --logs_exporter console \</span><br><span class="line">    --service_name dice-server \</span><br><span class="line">    flask run -p 8080</span><br></pre></td></tr></table></figure>

<blockquote>
<p>When you send a request to the server, you’ll see <strong>two spans</strong> in the trace emitted to the console<br>and the one called <code>roll</code> registers its parent as the automatically created one:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;roll&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0xe5ce795920be73e103e6a87eb783a1e0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x40ed371e8ea05a37&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;trace_state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[]&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SpanKind.INTERNAL&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x13203181a224a866&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T14:06:12.732153Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T14:06:12.732172Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;status_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNSET&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;roll.value&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opentelemetry&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.36.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;service.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dice-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.auto.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.57b0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;schema_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GET /rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0xe5ce795920be73e103e6a87eb783a1e0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x13203181a224a866&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;trace_state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[]&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;kind&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SpanKind.SERVER&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T14:06:12.731589Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-07-31T14:06:12.732397Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;status_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNSET&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;http.method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GET&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.server_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.scheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.host.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.host.port&quot;</span><span class="punctuation">:</span> <span class="number">8080</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.peer.ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;net.peer.port&quot;</span><span class="punctuation">:</span> <span class="number">64172</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.user_agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;curl/8.7.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/rolldice&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;http.status_code&quot;</span><span class="punctuation">:</span> <span class="number">200</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;links&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resource&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opentelemetry&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.sdk.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.36.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;service.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dice-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;telemetry.auto.version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.57b0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;schema_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <strong>parent_id</strong> of roll is the same as the <strong>span_id</strong> for &#x2F;rolldice, indicating a <strong>parent-child relationship</strong>!</p>
</blockquote>
<h3 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h3><blockquote>
<p>Now modify app.py to include code that initializes a <strong>meter</strong> and uses it to <strong>create a counter</strong> instrument which counts the number of rolls for each possible roll value:</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># These are the necessary import declarations</span></span><br><span class="line"><span class="keyword">from</span> opentelemetry <span class="keyword">import</span> trace</span><br><span class="line"><span class="keyword">from</span> opentelemetry <span class="keyword">import</span> metrics</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># Acquire a tracer</span></span><br><span class="line">tracer = trace.get_tracer(<span class="string">&quot;diceroller.tracer&quot;</span>)</span><br><span class="line"><span class="comment"># Acquire a meter.</span></span><br><span class="line">meter = metrics.get_meter(<span class="string">&quot;diceroller.meter&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now create a counter instrument to make measurements with</span></span><br><span class="line">roll_counter = meter.create_counter(</span><br><span class="line">    <span class="string">&quot;dice.rolls&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;The number of rolls by roll value&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/rolldice&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll_dice</span>():</span><br><span class="line">    <span class="comment"># This creates a new span that&#x27;s the child of the current one</span></span><br><span class="line">    <span class="keyword">with</span> tracer.start_as_current_span(<span class="string">&quot;roll&quot;</span>) <span class="keyword">as</span> roll_span:</span><br><span class="line">        player = request.args.get(<span class="string">&#x27;player&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">        result = <span class="built_in">str</span>(roll())</span><br><span class="line">        roll_span.set_attribute(<span class="string">&quot;roll.value&quot;</span>, result)</span><br><span class="line">        <span class="comment"># This adds 1 to the counter for the given roll value</span></span><br><span class="line">        roll_counter.add(<span class="number">1</span>, &#123;<span class="string">&quot;roll.value&quot;</span>: result&#125;)</span><br><span class="line">        <span class="keyword">if</span> player:</span><br><span class="line">            logger.warn(<span class="string">&quot;%s is rolling the dice: %s&quot;</span>, player, result)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logger.warn(<span class="string">&quot;Anonymous player is rolling the dice: %s&quot;</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roll</span>():</span><br><span class="line">    <span class="keyword">return</span> randint(<span class="number">1</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now run the app again:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true</span><br><span class="line">opentelemetry-instrument \</span><br><span class="line">    --traces_exporter console \</span><br><span class="line">    --metrics_exporter console \</span><br><span class="line">    --logs_exporter console \</span><br><span class="line">    --service_name dice-server \</span><br><span class="line">    flask run -p 8080</span><br></pre></td></tr></table></figure>

<h2 id="Send-telemetry-to-an-OpenTelemetry-Collector"><a href="#Send-telemetry-to-an-OpenTelemetry-Collector" class="headerlink" title="Send telemetry to an OpenTelemetry Collector"></a>Send telemetry to an OpenTelemetry Collector</h2><ol>
<li>The <strong>OpenTelemetry Collector</strong> is a <strong>critical component</strong> of most <strong>production</strong> deployments.</li>
<li>Some examples of when it’s beneficial to use a collector<ul>
<li><strong>A single telemetry sink</strong> shared by <strong>multiple services</strong>, to reduce <strong>overhead</strong> of <strong>switching exporters</strong></li>
<li><strong>Aggregating traces</strong> across <strong>multiple services</strong>, running on <strong>multiple hosts</strong></li>
<li>A central place to <strong>process traces</strong> prior to <strong>exporting</strong> them to a <strong>backend</strong></li>
</ul>
</li>
<li>Unless you have just a <strong>single service</strong> or are <strong>experimenting</strong>, you’ll want to use a collector in production deployments.</li>
</ol>
<h3 id="Configure-and-run-a-local-collector"><a href="#Configure-and-run-a-local-collector" class="headerlink" title="Configure and run a local collector"></a>Configure and run a local collector</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`.</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Then run the docker command to acquire and run the collector based on this configuration:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 4317:4317 \</span><br><span class="line">    -v ./otel-collector-config.yaml:/etc/otel-collector-config.yaml \</span><br><span class="line">    otel/opentelemetry-collector:0.131.0 \</span><br><span class="line">    --config=/etc/otel-collector-config.yaml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You will now have an <strong>collector instance</strong> running locally, listening on port 4317.</p>
</blockquote>
<h3 id="Modify-the-command-to-export-spans-and-metrics-via-OTLP"><a href="#Modify-the-command-to-export-spans-and-metrics-via-OTLP" class="headerlink" title="Modify the command to export spans and metrics via OTLP"></a>Modify the command to export spans and metrics via OTLP</h3><ol>
<li>The next step is to modify the command to send <strong>spans</strong> and <strong>metrics</strong> to the <strong>collector</strong> via <strong>OTLP</strong> instead of the console.</li>
<li>To do this, install the <strong>OTLP exporter</strong> package:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-exporter-otlp</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <strong>opentelemetry-instrument</strong> agent will <strong>detect the package</strong> you just installed and <strong>default</strong> to <strong>OTLP export</strong> when it’s run next.</p>
</blockquote>
<h3 id="Run-the-application"><a href="#Run-the-application" class="headerlink" title="Run the application"></a>Run the application</h3><blockquote>
<p>Run the application like before, but don’t export to the console:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true</span><br><span class="line">opentelemetry-instrument --logs_exporter otlp flask run -p 8080</span><br></pre></td></tr></table></figure>

<ol>
<li>By default, <strong>opentelemetry-instrument</strong> exports <strong>traces</strong> and <strong>metrics</strong> over <strong>OTLP&#x2F;gRPC</strong> and will send them to localhost:4317</li>
<li>which is what the <strong>collector</strong> is listening on.</li>
</ol>
<h1 id="Propagation"><a href="#Propagation" class="headerlink" title="Propagation"></a>Propagation</h1><h2 id="Automatic-context-propagation"><a href="#Automatic-context-propagation" class="headerlink" title="Automatic context propagation"></a>Automatic context propagation</h2><ol>
<li>Instrumentation libraries for popular Python frameworks and libraries<ul>
<li>such as <strong>Jinja2</strong>, <strong>Flask</strong>, <strong>Django</strong>, and Celery.propagate context across services for you.</li>
</ul>
</li>
<li>Use <strong>instrumentation libraries</strong> to propagate context.<ul>
<li>Although it is possible to propagate context <strong>manually</strong></li>
<li>the Python <strong>auto-instrumentation</strong> and <strong>instrumentation libraries</strong> are <strong>well-tested</strong> and easier to use.</li>
</ul>
</li>
</ol>
<h1 id="Distro"><a href="#Distro" class="headerlink" title="Distro"></a>Distro</h1><ol>
<li>In order to make using <strong>OpenTelemetry</strong> and <strong>auto-instrumentation</strong> as quick as possible <strong>without sacrificing flexibility</strong><ul>
<li>OpenTelemetry distros provide a mechanism to <strong>automatically configure</strong> some of the more common options for users.</li>
</ul>
</li>
<li>By harnessing their power, users of OpenTelemetry can <strong>configure the components as they need</strong>.</li>
<li>The <strong>opentelemetry-distro</strong> package provides some <strong>defaults</strong> to users looking to get started, it configures:<ul>
<li>the SDK <strong>TracerProvider</strong></li>
<li>a <strong>BatchSpanProcessor</strong></li>
<li>the <strong>OTLP SpanExporter</strong> to send data to an OpenTelemetry Collector</li>
</ul>
</li>
<li>The package also provides a <strong>starting point</strong> for anyone interested in <strong>producing</strong> an <strong>alternative distro</strong>.</li>
<li>The <strong>interfaces</strong> implemented by the package are <strong>loaded</strong> by the <strong>auto-instrumentation</strong><ul>
<li>via the <strong>opentelemetry_distro</strong> and <strong>opentelemetry_configurator</strong> entry points to <strong>configure the application</strong> before <strong>any other code</strong> is executed.</li>
</ul>
</li>
<li>In order to <strong>automatically export data</strong> from OpenTelemetry to the OpenTelemetry collector, installing the package will set up all the required entry points.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-distro[otlp] opentelemetry-instrumentation</span><br></pre></td></tr></table></figure>

<h1 id="Zero-code-Instrumentation"><a href="#Zero-code-Instrumentation" class="headerlink" title="Zero-code Instrumentation"></a>Zero-code Instrumentation</h1><h2 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h2><ol>
<li><strong>Automatic instrumentation</strong> with Python uses a <strong>Python agent</strong> that can be <strong>attached</strong> to <strong>any Python application</strong>.</li>
<li>This agent primarily uses <strong>monkey patching</strong> to <strong>modify library functions at runtime</strong><ul>
<li>allowing for the <strong>capture</strong> of <strong>telemetry data</strong> from many <strong>popular libraries and frameworks</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><blockquote>
<p>Run the following commands to install the appropriate packages.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install opentelemetry-distro opentelemetry-exporter-otlp</span><br><span class="line">opentelemetry-bootstrap -a install</span><br></pre></td></tr></table></figure>

<ol>
<li>The <code>opentelemetry-distro</code> package installs the <strong>API</strong>, <strong>SDK</strong>, and the <code>opentelemetry-bootstrap</code> and <code>opentelemetry-instrument</code> tools.</li>
<li>You must install a <strong>distro package</strong> to get <strong>auto instrumentation</strong> working.<ul>
<li>The <strong>opentelemetry-distro</strong> package contains the <strong>default distro</strong> to <strong>automatically configure</strong> some of the <strong>common options</strong> for users.</li>
</ul>
</li>
<li>The <strong>opentelemetry-bootstrap -a install</strong> command<ul>
<li><strong>reads</strong> through the <strong>list of packages installed</strong> in your active <strong>site-packages</strong> folder, </li>
<li>and <strong>installs</strong> the <strong>corresponding instrumentation libraries</strong> for these <strong>packages</strong>, if applicable.</li>
<li>For example, if you already installed the <strong>flask</strong> package<ul>
<li>running <strong>opentelemetry-bootstrap -a install</strong> will install <strong>opentelemetry-instrumentation-flask</strong> for you.</li>
</ul>
</li>
<li>The <strong>OpenTelemetry Python agent</strong> will use <strong>monkey patching</strong> to <strong>modify functions</strong> in these libraries at <strong>runtime</strong>.</li>
</ul>
</li>
<li>Running <strong>opentelemetry-bootstrap without arguments</strong> lists the <strong>recommended instrumentation libraries</strong> to be installed.</li>
</ol>
<h3 id="Configuring-the-agent"><a href="#Configuring-the-agent" class="headerlink" title="Configuring the agent"></a>Configuring the agent</h3><ol>
<li>The agent is <strong>highly configurable</strong>.</li>
<li>One option is to configure the agent by way of configuration properties from the <strong>CLI</strong>:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opentelemetry-instrument \</span><br><span class="line">    --traces_exporter console,otlp \</span><br><span class="line">    --metrics_exporter console \</span><br><span class="line">    --service_name your-service-name \</span><br><span class="line">    --exporter_otlp_endpoint 0.0.0.0:4317 \</span><br><span class="line">    python myapp.py</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Alternatively, you can use <strong>environment variables</strong> to configure the agent:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OTEL_SERVICE_NAME=your-service-name \</span><br><span class="line">OTEL_TRACES_EXPORTER=console,otlp \</span><br><span class="line">OTEL_METRICS_EXPORTER=console \</span><br><span class="line">OTEL_EXPORTER_OTLP_TRACES_ENDPOINT=0.0.0.0:4317</span><br><span class="line">opentelemetry-instrument \</span><br><span class="line">    python myapp.py</span><br></pre></td></tr></table></figure>

<h3 id="Supported-libraries-and-frameworks"><a href="#Supported-libraries-and-frameworks" class="headerlink" title="Supported libraries and frameworks"></a>Supported libraries and frameworks</h3><blockquote>
<p>A number of popular Python libraries are <strong>auto-instrumented</strong>, including <strong>Flask</strong> and <strong>Django</strong>.</p>
</blockquote>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><h3 id="Configuration-properties"><a href="#Configuration-properties" class="headerlink" title="Configuration properties"></a>Configuration properties</h3><blockquote>
<p>Here’s an example of agent configuration via <strong>configuration properties</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opentelemetry-instrument \</span><br><span class="line">    --traces_exporter console,otlp \</span><br><span class="line">    --metrics_exporter console \</span><br><span class="line">    --service_name your-service-name \</span><br><span class="line">    --exporter_otlp_endpoint 0.0.0.0:4317 \</span><br><span class="line">    python myapp.py</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Here’s an explanation of what each configuration does:</p>
</blockquote>
<ol>
<li>traces_exporter<ul>
<li>specifies which traces exporter to use.</li>
<li>In this case, traces are being exported to <strong>console</strong> (stdout) and with <strong>otlp</strong>.</li>
<li>The <strong>otlp</strong> option tells <strong>opentelemetry-instrument</strong> to send the <strong>traces</strong> to an <strong>endpoint</strong> that <strong>accepts OTLP via gRPC</strong>.</li>
<li>In order to use <strong>HTTP</strong> instead of <strong>gRPC</strong>, add <strong>–exporter_otlp_protocol http&#x2F;protobuf</strong>.</li>
</ul>
</li>
<li>metrics_exporter<ul>
<li>specifies which metrics exporter to use.</li>
<li>In this case, metrics are being exported to <strong>console</strong> (stdout).</li>
<li>It is currently required for your to specify a metrics exporter.</li>
<li>If you <strong>aren’t exporting metrics</strong>, specify <strong>none</strong> as the value instead.</li>
</ul>
</li>
<li>service_name<ul>
<li>sets the name of the service associated with your <strong>telemetry</strong>, and is sent to your <strong>Observability backend</strong>.</li>
</ul>
</li>
<li>exporter_otlp_endpoint<ul>
<li>sets the endpoint where telemetry is exported to.</li>
<li>If <strong>omitted</strong>, the <strong>default Collector endpoint</strong> will be used, which is <strong>0.0.0.0:4317 for gRPC</strong> and <strong>0.0.0.0:4318 for HTTP</strong>.</li>
</ul>
</li>
<li>exporter_otlp_headers<ul>
<li>is required depending on your chosen <strong>Observability backend</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Environment-Variables"><a href="#Environment-Variables" class="headerlink" title="Environment Variables"></a>Environment Variables</h3><ol>
<li>In some cases, configuring via <strong>environment variables</strong> is <strong>more preferred</strong>.<ul>
<li><strong>Any</strong> setting configurable with a command-line argument can also be configured with an Environment Variable.</li>
</ul>
</li>
<li>You can apply the following steps to <strong>determine</strong> the <strong>correct name mapping</strong> of the <strong>desired configuration property</strong>:<ul>
<li>Convert the <strong>configuration property</strong> to <strong>uppercase</strong>.</li>
<li><strong>Prefix</strong> environment variable with <code>OTEL_</code></li>
<li>For example, <code>exporter_otlp_endpoint</code> would convert to <code>OTEL_EXPORTER_OTLP_ENDPOINT</code>.</li>
</ul>
</li>
</ol>
<h3 id="Python-specific-Configuration"><a href="#Python-specific-Configuration" class="headerlink" title="Python-specific Configuration"></a>Python-specific Configuration</h3><blockquote>
<p>There are some Python specific configuration options you can set by prefixing environment variables with <code>OTEL_PYTHON_</code>.</p>
</blockquote>
<h4 id="Excluded-URLs"><a href="#Excluded-URLs" class="headerlink" title="Excluded URLs"></a>Excluded URLs</h4><ol>
<li><strong>Comma-separated regular expressions</strong> representing which URLs to exclude across all instrumentations:<ul>
<li><code>OTEL_PYTHON_EXCLUDED_URLS</code></li>
</ul>
</li>
<li>You can also exclude URLs for <strong>specific instrumentations</strong> by using a variable <code>OTEL_PYTHON_&lt;library&gt;_EXCLUDED_URLS</code><ul>
<li>where library is the <strong>uppercase</strong> version of one of the following:</li>
<li><strong>Django</strong>, Falcon, <strong>FastAPI</strong>, <strong>Flask</strong>, Pyramid, Requests, Starlette, Tornado, urllib, urllib3.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Examples</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_EXCLUDED_URLS=&quot;client/.*/info,healthcheck&quot;</span><br><span class="line">export OTEL_PYTHON_URLLIB3_EXCLUDED_URLS=&quot;client/.*/info&quot;</span><br><span class="line">export OTEL_PYTHON_REQUESTS_EXCLUDED_URLS=&quot;healthcheck&quot;</span><br></pre></td></tr></table></figure>

<h4 id="Request-Attribute-Names"><a href="#Request-Attribute-Names" class="headerlink" title="Request Attribute Names"></a>Request Attribute Names</h4><blockquote>
<p><strong>Comma-separated</strong> list of names that will be extracted from the request object and set as <strong>attributes</strong> on <strong>spans</strong>.</p>
</blockquote>
<ol>
<li>OTEL_PYTHON_DJANGO_TRACED_REQUEST_ATTRS</li>
<li>OTEL_PYTHON_FALCON_TRACED_REQUEST_ATTRS</li>
<li>OTEL_PYTHON_TORNADO_TRACED_REQUEST_ATTRS</li>
</ol>
<blockquote>
<p>Examples</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_DJANGO_TRACED_REQUEST_ATTRS=&#x27;path_info,content_type&#x27;</span><br><span class="line">export OTEL_PYTHON_FALCON_TRACED_REQUEST_ATTRS=&#x27;query_string,uri_template&#x27;</span><br><span class="line">export OTEL_PYTHON_TORNADO_TRACED_REQUEST_ATTRS=&#x27;uri,query&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h4><blockquote>
<p>There are some configuration options used to control the logs that are outputted.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>OTEL_PYTHON_LOG_CORRELATION</td>
<td>to enable <strong>trace context injection</strong> into logs (true, false)</td>
</tr>
<tr>
<td>OTEL_PYTHON_LOG_FORMAT</td>
<td>to instruct the instrumentation to use a <strong>custom logging format</strong></td>
</tr>
<tr>
<td>OTEL_PYTHON_LOG_LEVEL</td>
<td>to set a <strong>custom log level</strong> (info, error, debug, warning)</td>
</tr>
<tr>
<td>OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED</td>
<td>to enable <strong>auto-instrumentation</strong> of <strong>logs</strong>.<br />Attaches <strong>OTLP handler</strong> to <strong>Python root logger</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>Examples</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_LOG_CORRELATION=true</span><br><span class="line">export OTEL_PYTHON_LOG_FORMAT=&quot;%(msg)s [span_id=%(span_id)s]&quot;</span><br><span class="line">export OTEL_PYTHON_LOG_LEVEL=debug</span><br><span class="line">export OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION_ENABLED=true</span><br></pre></td></tr></table></figure>

<h4 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h4><blockquote>
<p>There are some more configuration options that can be set that don’t fall into a specific category.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>OTEL_PYTHON_DJANGO_INSTRUMENT</td>
<td>set to <code>false</code> to disable the default enabled state for the Django instrumentation</td>
</tr>
<tr>
<td>OTEL_PYTHON_ELASTICSEARCH_NAME_PREFIX</td>
<td>changes the default prefixes for Elasticsearch operation names from “Elasticsearch” to whatever is used here</td>
</tr>
<tr>
<td>OTEL_PYTHON_GRPC_EXCLUDED_SERVICES</td>
<td>comma-separated list of specific services to exclude for the gRPC instrumentation</td>
</tr>
<tr>
<td>OTEL_PYTHON_ID_GENERATOR</td>
<td>to specify which IDs generator to use for the global Tracer Provider</td>
</tr>
<tr>
<td>OTEL_PYTHON_INSTRUMENTATION_SANITIZE_REDIS</td>
<td>to enable query sanitization</td>
</tr>
</tbody></table>
<blockquote>
<p>Examples</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PYTHON_DJANGO_INSTRUMENT=false</span><br><span class="line">export OTEL_PYTHON_ELASTICSEARCH_NAME_PREFIX=my-custom-prefix</span><br><span class="line">export OTEL_PYTHON_GRPC_EXCLUDED_SERVICES=&quot;GRPCTestServer,GRPCHealthServer&quot;</span><br><span class="line">export OTEL_PYTHON_ID_GENERATOR=xray</span><br><span class="line">export OTEL_PYTHON_INSTRUMENTATION_SANITIZE_REDIS=true</span><br></pre></td></tr></table></figure>

<h3 id="Disabling-Specific-Instrumentations"><a href="#Disabling-Specific-Instrumentations" class="headerlink" title="Disabling Specific Instrumentations"></a>Disabling Specific Instrumentations</h3><ol>
<li>The <strong>Python agent</strong> by default will <strong>detect a Python program’s packages</strong> and <strong>instrument any packages</strong> it can.<ul>
<li>This makes instrumentation <strong>easy</strong>, but can result in <strong>too much</strong> or <strong>unwanted</strong> data.</li>
</ul>
</li>
<li>You can <strong>omit</strong> specific packages from <strong>instrumentation</strong> by using the <strong>OTEL_PYTHON_DISABLED_INSTRUMENTATIONS</strong> environment variable.</li>
<li>The environment variable can be set to a <strong>comma-separated list</strong> of <strong>instrumentations entry point names</strong> to <strong>exclude</strong> from instrumentation.</li>
<li>Most of the time the <strong>entry point name</strong> is the same as the <strong>package name</strong> and it is set in <ul>
<li>the <strong>project.entry-points.opentelemetry_instrumentor</strong> table in the package <strong>pyproject.toml</strong> file.</li>
</ul>
</li>
<li>For example, if your Python program uses the <code>redis</code>,<code>kafka-python</code> and <code>grpc</code> packages<ul>
<li>by default the agent will use the <code>opentelemetry-instrumentation-redis</code>, <code>opentelemetry-instrumentation-kafka-python</code> and <code>opentelemetry-instrumentation-grpc</code> packages to instrument them.</li>
<li>To disable this, you can set <code>OTEL_PYTHON_DISABLED_INSTRUMENTATIONS=redis,kafka,grpc_client</code>.</li>
</ul>
</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/05/cloud-native-observability-opentelemetry-python/">https://blog.zhongmingmao.top/2025/01/05/cloud-native-observability-opentelemetry-python/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/opentelemetry/">OpenTelemetry</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/06/new-java-feature-jshell/" title="New Java Feature - JShell"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/java-feature-jshell.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">New Java Feature - JShell</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Observability - OpenTelemetry Go</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="title">Observability - OpenTelemetry Go</div></div></a></div><div><a href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="title">Observability - OpenTelemetry Node.js</div></div></a></div><div><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="title">Observability - OpenTelemetry Doc V2</div></div></a></div><div><a href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="title">Observability - OpenTelemetry Doc V1</div></div></a></div><div><a href="/2024/10/14/cloud-native-observability-opentelemetry/" title="Observability - OpenTelemetry"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-14</div><div class="title">Observability - OpenTelemetry</div></div></a></div><div><a href="/2024/10/13/cloud-native-observability-concept/" title="Observability - Concept"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-concept.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-13</div><div class="title">Observability - Concept</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">626</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Status-and-Releases"><span class="toc-number">1.1.</span> <span class="toc-text">Status and Releases</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Version-support"><span class="toc-number">1.2.</span> <span class="toc-text">Version support</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation"><span class="toc-number">1.3.</span> <span class="toc-text">Installation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started"><span class="toc-number">2.</span> <span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-Application"><span class="toc-number">2.1.</span> <span class="toc-text">Example Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation-1"><span class="toc-number">2.2.</span> <span class="toc-text">Installation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-and-launch-an-HTTP-Server"><span class="toc-number">2.2.1.</span> <span class="toc-text">Create and launch an HTTP Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation"><span class="toc-number">2.3.</span> <span class="toc-text">Instrumentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-the-instrumented-app"><span class="toc-number">2.4.</span> <span class="toc-text">Run the instrumented app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Add-manual-instrumentation-to-automatic-instrumentation"><span class="toc-number">2.5.</span> <span class="toc-text">Add manual instrumentation to automatic instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Traces"><span class="toc-number">2.5.1.</span> <span class="toc-text">Traces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metrics"><span class="toc-number">2.5.2.</span> <span class="toc-text">Metrics</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Send-telemetry-to-an-OpenTelemetry-Collector"><span class="toc-number">2.6.</span> <span class="toc-text">Send telemetry to an OpenTelemetry Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Configure-and-run-a-local-collector"><span class="toc-number">2.6.1.</span> <span class="toc-text">Configure and run a local collector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Modify-the-command-to-export-spans-and-metrics-via-OTLP"><span class="toc-number">2.6.2.</span> <span class="toc-text">Modify the command to export spans and metrics via OTLP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-the-application"><span class="toc-number">2.6.3.</span> <span class="toc-text">Run the application</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Propagation"><span class="toc-number">3.</span> <span class="toc-text">Propagation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Automatic-context-propagation"><span class="toc-number">3.1.</span> <span class="toc-text">Automatic context propagation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Distro"><span class="toc-number">4.</span> <span class="toc-text">Distro</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-code-Instrumentation"><span class="toc-number">5.</span> <span class="toc-text">Zero-code Instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview-1"><span class="toc-number">5.1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup"><span class="toc-number">5.1.1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring-the-agent"><span class="toc-number">5.1.2.</span> <span class="toc-text">Configuring the agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Supported-libraries-and-frameworks"><span class="toc-number">5.1.3.</span> <span class="toc-text">Supported libraries and frameworks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration"><span class="toc-number">5.2.</span> <span class="toc-text">Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration-properties"><span class="toc-number">5.2.1.</span> <span class="toc-text">Configuration properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-Variables"><span class="toc-number">5.2.2.</span> <span class="toc-text">Environment Variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-specific-Configuration"><span class="toc-number">5.2.3.</span> <span class="toc-text">Python-specific Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Excluded-URLs"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">Excluded URLs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Request-Attribute-Names"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">Request Attribute Names</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logging"><span class="toc-number">5.2.3.3.</span> <span class="toc-text">Logging</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Other"><span class="toc-number">5.2.3.4.</span> <span class="toc-text">Other</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disabling-Specific-Instrumentations"><span class="toc-number">5.2.4.</span> <span class="toc-text">Disabling Specific Instrumentations</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/08/new-java-feature-record/" title="New Java Feature - Record"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/new-java-feature-record.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Record"/></a><div class="content"><a class="title" href="/2025/01/08/new-java-feature-record/" title="New Java Feature - Record">New Java Feature - Record</a><time datetime="2025-01-07T16:06:25.000Z" title="Created 2025-01-08 00:06:25">2025-01-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/07/new-java-feature-text-blocks/" title="New Java Feature - Text Blocks"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/text-blocks-java-17-new-feature.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Text Blocks"/></a><div class="content"><a class="title" href="/2025/01/07/new-java-feature-text-blocks/" title="New Java Feature - Text Blocks">New Java Feature - Text Blocks</a><time datetime="2025-01-06T16:06:25.000Z" title="Created 2025-01-07 00:06:25">2025-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/06/new-java-feature-jshell/" title="New Java Feature - JShell"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/java-feature-jshell.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - JShell"/></a><div class="content"><a class="title" href="/2025/01/06/new-java-feature-jshell/" title="New Java Feature - JShell">New Java Feature - JShell</a><time datetime="2025-01-05T16:06:25.000Z" title="Created 2025-01-06 00:06:25">2025-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Python"/></a><div class="content"><a class="title" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python">Observability - OpenTelemetry Python</a><time datetime="2025-01-04T16:06:25.000Z" title="Created 2025-01-05 00:06:25">2025-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Go"/></a><div class="content"><a class="title" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go">Observability - OpenTelemetry Go</a><time datetime="2025-01-03T16:06:25.000Z" title="Created 2025-01-04 00:06:25">2025-01-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2025 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>