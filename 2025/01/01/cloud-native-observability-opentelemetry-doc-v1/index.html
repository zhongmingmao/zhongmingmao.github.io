<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Observability - OpenTelemetry Doc V1 | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="架构 OpenTelemetry 也被称为 OTel，是一个供应商中立的、开源的可观测性框架， 可用于插桩、生成、采集和导出链路、 指标和日志等遥测数据">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - OpenTelemetry Doc V1">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="架构 OpenTelemetry 也被称为 OTel，是一个供应商中立的、开源的可观测性框架， 可用于插桩、生成、采集和导出链路、 指标和日志等遥测数据">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png">
<meta property="article:published_time" content="2024-12-31T16:06:25.000Z">
<meta property="article:modified_time" content="2025-02-17T11:01:20.469Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="OpenTelemetry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - OpenTelemetry Doc V1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-17 19:01:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">622</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Observability - OpenTelemetry Doc V1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2024-12-31T16:06:25.000Z" title="Created 2025-01-01 00:06:25">2025-01-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">37.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>223min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><blockquote>
<p>OpenTelemetry 也被称为 <strong>OTel</strong>，是一个<strong>供应商中立</strong>的、开源的可观测性框架， 可用于<strong>插桩</strong>、<strong>生成</strong>、<strong>采集</strong>和<strong>导出</strong>链路、 指标和日志等遥测数据</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-diagram.svg" alt="otel-diagram"></p>
<span id="more"></span>

<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>专注于数据标准，不提供存储和可视化</p>
</blockquote>
<ol>
<li>OpenTelemetry 是一个可观测性<strong>框架</strong>和<strong>工具包</strong>， 旨在<strong>创建</strong>和<strong>管理</strong>遥测数据，如链路、 指标和日志</li>
<li>OpenTelemetry 是<strong>供应商和工具无关</strong>的，这意味着它可以与<strong>各种可观测性后端</strong>一起使用， 包括 Jaeger 和 Prometheus 这类开源工具以及商业化产品<ul>
<li>OpenTelemetry 不是像 Jaeger、Prometheus 或其他商业供应商那样的可观测性后端</li>
<li>OpenTelemetry 专注于遥测数据的<strong>生成</strong>、<strong>采集</strong>、<strong>管理</strong>和<strong>导出</strong></li>
<li>OpenTelemetry 的一个主要目标是， 无论应用程序或系统采用何种编程语言、基础设施或运行时环境，你都可以轻松地将其<strong>仪表化</strong></li>
<li>遥测数据的<strong>存储</strong>和<strong>可视化</strong>是有意留给<strong>其他工具</strong>处理</li>
</ul>
</li>
</ol>
<h2 id="可观测性"><a href="#可观测性" class="headerlink" title="可观测性"></a>可观测性</h2><ol>
<li>可观测性是通过<strong>检查系统输出</strong>来<strong>理解系统内部状态</strong>的能力<ul>
<li>在<strong>软件</strong>的背景下，这意味着能够通过检查遥测数据（包括<strong>链路</strong>、<strong>指标</strong>和<strong>日志</strong>）来理解系统的内部状态</li>
</ul>
</li>
<li>要使系统可观测，必须对其进行<strong>仪表化</strong><ul>
<li><strong>代码</strong>必须发出<strong>链路</strong>、<strong>指标</strong>或<strong>日志</strong>，然后，仪表化的数据必须发送到<strong>可观测性后端</strong></li>
</ul>
</li>
</ol>
<h2 id="OpenTelemetry"><a href="#OpenTelemetry" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h2><blockquote>
<p>OpenTelemetry 满足可观测性的需求，并遵循两个关键原则</p>
</blockquote>
<ol>
<li>你所生成的数据归属于你自己，<strong>不会被供应商锁定</strong></li>
<li>你只需要学习<strong>一套 API 和约定</strong></li>
</ol>
<h3 id="主要组件"><a href="#主要组件" class="headerlink" title="主要组件"></a>主要组件</h3><ol>
<li>适用于所有组件的<strong>规范</strong></li>
<li>定义遥测数据形状的<strong>标准协议</strong></li>
<li>为常见遥测数据类型定义标准命名方案的<strong>语义约定</strong></li>
<li>定义如何<strong>生成</strong>遥测数据的 <strong>API</strong></li>
<li><strong>实现</strong>规范、API 和遥测数据<strong>导出</strong>的<strong>语言 SDK</strong></li>
<li>实现<strong>常见库和框架</strong>的<strong>仪表化</strong>的<strong>库生态系统</strong></li>
<li>可<strong>自动生成</strong>遥测数据的自动仪表化组件，无需更改代码</li>
<li>OpenTelemetry Collector：<strong>接收</strong>、<strong>处理</strong>和<strong>导出</strong>遥测数据的<strong>代理</strong></li>
<li>各种其他工具<ul>
<li>OpenTelemetry <strong>Operator</strong> for Kubernetes</li>
<li>OpenTelemetry <strong>Helm Charts</strong></li>
<li><strong>FaaS</strong></li>
</ul>
</li>
</ol>
<h3 id="可扩展性"><a href="#可扩展性" class="headerlink" title="可扩展性"></a>可扩展性</h3><blockquote>
<p>OpenTelemetry 被设计为可扩展的 - 几乎<strong>每个层面</strong>都可以实现扩展</p>
</blockquote>
<ol>
<li>向 OpenTelemetry <strong>Collector</strong> 添加<strong>接收器</strong>以支持来自自定义源的遥测数据</li>
<li>将<strong>自定义仪表化库</strong>加载到 <strong>SDK</strong> 中</li>
<li>创建适用于特定用例的 SDK 或 Collector 的<strong>分发</strong><ul>
<li>A <strong>distribution</strong>, not to be confused with a <strong>fork</strong>, is <strong>customized version</strong> of an <strong>OpenTelemetry component</strong>.</li>
</ul>
</li>
<li>为尚不支持 OpenTelemetry 协议（OTLP）的自定义<strong>后端</strong>创建新的<strong>导出器</strong></li>
<li>为非标准上下文传播格式创建自定义<strong>传播器</strong></li>
</ol>
<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="Observability"><a href="#Observability" class="headerlink" title="Observability"></a>Observability</h3><ol>
<li>可观测性让你能够从<strong>外部</strong>理解一个系统，它允许你在不了解系统内部运作的情况下，对该系统提出问题<ul>
<li>可观测性能帮你轻松排查和处理<strong>新出现的问题</strong>，也就是所谓的”<strong>未知的未知</strong>“</li>
</ul>
</li>
<li>要对你的系统提出这些问题，你的应用程序必须进行<strong>适当的插桩</strong><ul>
<li>应用程序代码必须能够发出<strong>信号</strong>， 例如<strong>链路</strong>、 <strong>指标</strong>和<strong>日志</strong></li>
<li>当开发人员不需要添加更多插桩就能排查问题时， 我们就可以说这个应用程序已经完成了适当的插桩，因为他们已经拥有了所需的所有信息</li>
</ul>
</li>
<li>OpenTelemetry 就是一种为<strong>应用程序代码</strong>进行<strong>插桩</strong>的机制，它的目的是帮助使<strong>系统</strong>变得<strong>可观测</strong></li>
</ol>
<h3 id="可靠性-指标"><a href="#可靠性-指标" class="headerlink" title="可靠性 + 指标"></a>可靠性 + 指标</h3><blockquote>
<p>Telemetry</p>
</blockquote>
<ol>
<li>Telemetry 指的是系统及其行为<strong>发出的数据</strong>。这些数据可以是<strong>链路</strong>、<strong>指标</strong>和<strong>日志</strong>的形式</li>
</ol>
<blockquote>
<p>可靠性</p>
</blockquote>
<ol>
<li>服务是否在按<strong>用户期望</strong>的方式运行？</li>
</ol>
<blockquote>
<p>指标</p>
</blockquote>
<ol>
<li>指标是对<strong>一段时间内</strong>基础设施或应用程序的数值数据的<strong>汇总</strong></li>
<li>例如：系统错误率、CPU 使用率和特定服务的请求率</li>
</ol>
<blockquote>
<p><strong>SLI</strong> - Service Level <strong>Indicator</strong> - <strong>技术指标</strong></p>
</blockquote>
<ol>
<li>即服务水平<strong>指标</strong>（Service Level Indicator），代表对<strong>服务行为</strong>的衡量</li>
<li>一个好的 SLI 应该从<strong>用户的角度</strong>来衡量你的服务 - 网页加载的速度</li>
</ol>
<blockquote>
<p><strong>SLO</strong> - Service Level <strong>Objective</strong> - <strong>业务价值</strong></p>
</blockquote>
<ol>
<li>服务水平<strong>目标</strong>（Service Level Objective）是一种向组织内部或其他团队<strong>传达服务可靠性</strong>的方法</li>
<li>SLO 通过将具体的<strong>技术指标</strong>（SLI）与<strong>业务目标</strong>关联起来，使<strong>技术性能</strong>变得<strong>对业务有意义</strong></li>
<li>网站页面加载时间（<strong>SLI</strong>）必须在3秒内，以确保良好的用户体验和提高转化率（<strong>业务价值</strong>）</li>
</ol>
<h3 id="分布式链路"><a href="#分布式链路" class="headerlink" title="分布式链路"></a>分布式链路</h3><ol>
<li>分布式链路让你能够观察<strong>请求</strong>如何在<strong>复杂的分布式系统</strong>中<strong>传播</strong></li>
<li>提高了应用程序或系统<strong>健康状况</strong>的<strong>可见性</strong>，并让你能够调试那些难以在本地重现的行为</li>
<li>对于<strong>分布式系统</strong>来说，分布式链路是<strong>必不可少</strong>的，因为这些系统通常存在不确定性问题，或者过于复杂而无法在本地重现</li>
</ol>
<h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><ol>
<li>日志是由服务或其他组件发出的<strong>带时间戳的消息</strong></li>
<li>与<strong>链路</strong>不同，它们<strong>不一定</strong>与特定的用户<strong>请求</strong>或<strong>事务</strong>相关联</li>
<li>日志虽然有用，但仅靠它们来<strong>追踪代码执行</strong>还不够，因为日志通常<strong>缺乏上下文信息</strong>，比如它们是从哪里被调用的<ul>
<li>当日志作为 <strong>span</strong>（跨度）的一部分，或者与 <strong>trace</strong>（链路）和 span 关联起来时，它们的价值就会大大增加</li>
</ul>
</li>
</ol>
<h4 id="Spans"><a href="#Spans" class="headerlink" title="Spans"></a>Spans</h4><ol>
<li>Span（跨度）是分布式链路中的<strong>基本构建块</strong>，它代表了一个<strong>具体</strong>的<strong>操作</strong>或<strong>工作单元</strong></li>
<li>每个 span 都记录了<strong>请求</strong>中的<strong>特定动作</strong>，帮助我们了解操作执行过程中发生的<strong>详细</strong>情况</li>
<li>一个 span 包含<strong>名称</strong>、<strong>时间相关的数据</strong>、<strong>结构化的日志消息</strong>，以及其他<strong>元数据</strong>（属性），这些信息共同描绘了该<strong>操作的完整画面</strong></li>
<li><strong>属性</strong> - 附加在 span 上的<strong>额外信息</strong> - 提供了更多关于<strong>操作上下文</strong>的细节</li>
</ol>
<h4 id="分布式链路-1"><a href="#分布式链路-1" class="headerlink" title="分布式链路"></a>分布式链路</h4><ol>
<li>记录了<strong>请求</strong>（无论是来自应用程序还是终端用户）在<strong>多服务架构</strong>（如微服务和无服务器应用）中<strong>传播</strong>的<strong>路径</strong></li>
<li>一个 <strong>Trace</strong> 由一个或多个 <strong>Span</strong> 组成<ul>
<li>第一个 Span 被称为<strong>根 Span</strong>，它代表了一个请求从开始到结束的全过程</li>
<li>根 Span 下的<strong>子 Span</strong> 则提供了请求过程中<strong>更详细的上下文信息</strong>（或者说，构成了<strong>请求的各个步骤</strong>）</li>
</ul>
</li>
<li>如果没有链路，在分布式系统中找出<strong>性能问题</strong>的根源将会非常具有挑战性<ul>
<li>链路通过<strong>分解</strong>请求在分布式系统中的<strong>流转过程</strong>，使得<strong>调试</strong>和<strong>理解</strong>分布式系统变得不那么令人生畏</li>
</ul>
</li>
</ol>
<blockquote>
<p>许多<strong>可观测性后端</strong>会将<strong>链路</strong>可视化为<strong>瀑布图</strong> - 清晰地展示了根 span 与其子 span 之间的<strong>父子关系</strong> - 表现为<strong>嵌套结构</strong></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/waterfall-trace.svg" alt="waterfall-trace"></p>
<h2 id="上下文传播"><a href="#上下文传播" class="headerlink" title="上下文传播"></a>上下文传播</h2><ol>
<li>通过上下文传播，<strong>信号</strong>可以<strong>相互关联</strong>， 无论它们是在何处生成的</li>
<li>尽管它不仅限于链路追踪，但它允许 <strong>trace</strong> 跨<strong>进程</strong>和<strong>网络</strong>边界<strong>任意分布</strong>的服务构建相关系统的关联信息</li>
</ol>
<h3 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h3><ol>
<li><p>上下文是一个<strong>对象</strong>，它包含<strong>发送</strong>和<strong>接收</strong>服务 （或<strong>执行单元</strong>） 用于将一个信号与另一个信号<strong>关联</strong>起来的信息</p>
</li>
<li><p>如果服务 A <strong>调用</strong>服务 B</p>
<ul>
<li><p>那么服务 A 中 ID 在上下文中的 span 将用作服务 B 中创建的下一个 span 的<strong>父 span</strong></p>
</li>
<li><p>上下文中的 <strong>trace ID</strong> 也将用于服务 B 中创建的下一个 span， 这表示该 span 与服务 A 中的 span <strong>属于同一 trace</strong> 的一部分</p>
</li>
</ul>
</li>
</ol>
<h3 id="传播"><a href="#传播" class="headerlink" title="传播"></a>传播</h3><ol>
<li>传播是<strong>上下文</strong>在<strong>服务</strong>和<strong>进程</strong>之间<strong>移动</strong>的机制</li>
<li>它<strong>序列化或反序列化上下文对象</strong>并提供要<strong>从一个服务传播到另一个服务</strong>的相关信息</li>
<li>传播通常由<strong>检测库</strong>处理并且<strong>对用户是透明的</strong>，但如果你需要<strong>手动传播上下文</strong>，则可以使用<strong>传播 API</strong></li>
<li>OpenTelemetry 维护着几个官方传播器，默认传播器使用 <strong>W3C Trace Context</strong>规范指定的标头</li>
</ol>
<h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><ol>
<li>OpenTelemetry 的目的是<strong>收集</strong>、<strong>处理</strong>和<strong>导出信号</strong></li>
<li>信号是<strong>系统输出</strong>，描述了操作系统和平台上运行的应用程序的<strong>底层活动</strong><ul>
<li>信号可以是你希望在<strong>特定时间点</strong>测量的某项<strong>指标</strong>，如温度或内存使用率， 也可以是<strong>贯穿分布式系统组件的事件</strong>，你希望对其进行<strong>跟踪</strong></li>
<li>可以将不同的信号<strong>组合</strong>在一起，从<strong>不同角度</strong>观察同一种技术的内部运作方式</li>
</ul>
</li>
<li>目前，OpenTelemetry 支持以下类型的信号 - <strong>Traces</strong> + <strong>Metrics</strong> + <strong>Logs</strong> + <strong>Baggage</strong><ul>
<li><strong>事件</strong>是一种<strong>特定类型的日志</strong>，而 <strong>profiles</strong> 正在由 <strong>Profiling</strong> 工作组开发</li>
</ul>
</li>
</ol>
<h3 id="Traces"><a href="#Traces" class="headerlink" title="Traces"></a>Traces</h3><blockquote>
<p>The <strong>path</strong> of a <strong>request</strong> through your application.</p>
</blockquote>
<ol>
<li>Traces give us the <strong>big picture</strong> of <strong>what happens</strong> when a <strong>request</strong> is made to an application. </li>
<li>Whether your application is <strong>a monolith with a single database</strong> or <strong>a sophisticated mesh of services</strong><ul>
<li>traces are <strong>essential</strong> to understanding the <strong>full “path”</strong> a request takes in your application.</li>
</ul>
</li>
</ol>
<blockquote>
<p>hello span</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5b8aa5a2d2c872e8321cf37308d69df2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;051581bf3cb55c13&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114201Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114687Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;some_route1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Guten Tag!&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114561Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;event_attributes&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>This is the <strong>root span</strong>, denoting the <strong>beginning</strong> and <strong>end</strong> of the <strong>entire operation</strong>. </li>
<li>Note that it has a <strong>trace_id</strong> field indicating the trace, but has <strong>no parent_id</strong>. That’s how you know it’s the <strong>root span</strong>.</li>
</ol>
<blockquote>
<p>hello-greetings span</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello-greetings&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5b8aa5a2d2c872e8321cf37308d69df2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5fb397be34d26b51&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;051581bf3cb55c13&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114304Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T22:52:58.114561Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;some_route2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hey there!&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114561Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;event_attributes&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bye now!&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114585Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;event_attributes&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>This span <strong>encapsulates specific tasks</strong>, like saying greetings, and its parent is the hello span.</li>
<li>Note that it <strong>shares</strong> the <strong>same trace_id</strong> as the <strong>root span</strong>, indicating it’s a <strong>part</strong> of the <strong>same trace</strong>.</li>
<li>Additionally, it has a <strong>parent_id</strong> that matches the <strong>span_id</strong> of the hello span.</li>
</ol>
<blockquote>
<p>hello-salutations span</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello-salutations&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5b8aa5a2d2c872e8321cf37308d69df2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;93564f51e1abe1c2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;051581bf3cb55c13&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114492Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114631Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;some_route3&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hey there!&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-29T18:52:58.114561Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;event_attributes&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>This span represents the third operation in this trace and, like the previous one, it’s a child of the hello span. </li>
<li>That also makes it a <strong>sibling</strong> of the hello-greetings span.</li>
</ol>
<blockquote>
<p>Summary</p>
</blockquote>
<ol>
<li>These three blocks of JSON all <strong>share</strong> the <strong>same trace_id</strong>, and the <strong>parent_id</strong> field represents a <strong>hierarchy</strong>. That makes it a <strong>Trace</strong>!</li>
<li>Another thing you’ll note is that each <strong>Span</strong> looks like a <strong>structured log</strong>. That’s because it kind of is! <ul>
<li>One way to think of Traces is that they’re a <strong>collection</strong> of <strong>structured logs</strong> with <strong>context</strong>, <strong>correlation</strong>, <strong>hierarchy</strong>, and more baked in.</li>
<li>However, these “<strong>structured logs</strong>” can come from different <strong>processes</strong>, <strong>services</strong>, <strong>VMs</strong>, <strong>data centers</strong>, and so on.</li>
<li>This is what allows tracing to represent an <strong>end-to-end view</strong> of any system.</li>
</ul>
</li>
</ol>
<blockquote>
<p>To understand how <strong>tracing</strong> in <strong>OpenTelemetry</strong> works, let’s look at a list of components that will play a part in <strong>instrumenting</strong> our <strong>code</strong>.</p>
</blockquote>
<h4 id="Tracer-Provider"><a href="#Tracer-Provider" class="headerlink" title="Tracer Provider"></a>Tracer Provider</h4><ol>
<li>A Tracer Provider (sometimes called TracerProvider) is a <strong>factory</strong> for <strong>Tracers</strong>. </li>
<li>In most applications, a Tracer Provider is <strong>initialized once</strong> and its lifecycle matches the <strong>application’s lifecycle</strong>.</li>
<li><strong>Tracer Provider initialization</strong> also includes <strong>Resource</strong> and <strong>Exporter</strong> initialization.<ul>
<li>It is typically the <strong>first step</strong> in <strong>tracing</strong> with <strong>OpenTelemetry</strong>.</li>
<li>In some language SDKs, a <strong>global Tracer Provider</strong> is already initialized for you.</li>
</ul>
</li>
</ol>
<h4 id="Tracer"><a href="#Tracer" class="headerlink" title="Tracer"></a>Tracer</h4><ol>
<li>A Tracer <strong>creates spans</strong> containing more <strong>information about what is happening</strong> for a <strong>given operation</strong>, such as a request in a service.</li>
<li><strong>Tracers</strong> are created from <strong>Tracer Providers</strong>.</li>
</ol>
<h4 id="Trace-Exporters"><a href="#Trace-Exporters" class="headerlink" title="Trace Exporters"></a>Trace Exporters</h4><ol>
<li>Trace Exporters <strong>send traces</strong> to a <strong>consumer</strong>.</li>
<li>This consumer can be <strong>standard output</strong>, the <strong>OpenTelemetry Collector</strong>, or any open source or vendor <strong>backend</strong> of your choice.</li>
</ol>
<h4 id="Context-Propagation"><a href="#Context-Propagation" class="headerlink" title="Context Propagation"></a>Context Propagation</h4><ol>
<li>Context Propagation is the core concept that <strong>enables Distributed Tracing</strong>.</li>
<li>With Context Propagation, <strong>Spans</strong> can be <strong>correlated with each other</strong> and <strong>assembled into a trace</strong>, regardless of <strong>where</strong> Spans are <strong>generated</strong>.</li>
</ol>
<h4 id="Spans-1"><a href="#Spans-1" class="headerlink" title="Spans"></a>Spans</h4><ol>
<li>A span represents a <strong>unit</strong> of <strong>work</strong> or <strong>operation</strong>.</li>
<li>Spans are the building <strong>blocks</strong> of Traces.</li>
<li>In OpenTelemetry, they include the following information<ul>
<li>Name</li>
<li>Parent span ID (<strong>empty</strong> for <strong>root</strong> spans)</li>
<li>Start and End Timestamps</li>
<li>Span Context</li>
<li>Attributes</li>
<li>Span Events</li>
<li>Span Links</li>
<li>Span Status</li>
</ul>
</li>
</ol>
<blockquote>
<p>Sample span</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/v1/sys/health&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;trace_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7bba9f33312b3dbb8b2c2c62bb7abe2d&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;span_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;086e83747d0e381e&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;parent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-10-22 16:04:01.209458162 +0000 UTC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-10-22 16:04:01.209514132 +0000 UTC&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status_code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;STATUS_CODE_OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status_message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;attributes&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;net.transport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IP.TCP&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;net.peer.ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;172.17.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;net.peer.port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;51820&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;net.host.ip&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.177.2.152&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;net.host.port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;26040&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GET&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/v1/sys/health&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.server_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mortar-gateway&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.route&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/v1/sys/health&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.user_agent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Consul Health Check&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.scheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.177.2.152:26040&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http.flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;events&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-10-22 16:04:01.209512872 +0000 UTC&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Spans can be <strong>nested</strong>, as is implied by the presence of a <strong>parent span ID</strong>: child spans represent <strong>sub-operations</strong>.</li>
<li>This allows spans to <strong>more accurately</strong> capture the work done in an application.</li>
</ol>
<h5 id="Span-Context"><a href="#Span-Context" class="headerlink" title="Span Context"></a>Span Context</h5><ol>
<li>Span context is an <strong>immutable object</strong> on every span that contains the following<ul>
<li>The <strong>Trace ID</strong> representing the trace that the span is a <strong>part</strong> of</li>
<li>The span’s <strong>Span ID</strong></li>
<li><strong>Trace Flags</strong>, a <strong>binary encoding</strong> containing <strong>information</strong> about the <strong>trace</strong></li>
<li><strong>Trace State</strong>, a list of <strong>key-value pairs</strong> that can carry <strong>vendor-specific trace information</strong></li>
</ul>
</li>
<li>Span context is the part of a span that is <strong>serialized</strong> and <strong>propagated</strong> alongside <strong>Distributed Context</strong> and <strong>Baggage</strong>.</li>
<li>Because Span Context contains the <strong>Trace ID</strong>, it is used when creating <strong>Span Links</strong>.</li>
</ol>
<h5 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h5><ol>
<li>Attributes are <strong>key-value pairs</strong> that contain <strong>metadata</strong> that you can use to <strong>annotate a Span</strong> to <strong>carry information</strong> about the <strong>operation</strong> it is tracking.</li>
<li>For example, if a span tracks an operation that adds an item to a user’s shopping cart in an eCommerce system<ul>
<li>you can capture the user’s ID, the ID of the item to add to the cart, and the cart ID.</li>
</ul>
</li>
<li>You can <strong>add attributes</strong> to spans <strong>during</strong> or <strong>after</strong> span <strong>creation</strong>.<ul>
<li><strong>Prefer</strong> adding attributes at <strong>span creation</strong> to make the attributes available to SDK <strong>sampling</strong>.</li>
<li>If you have to add a value after span creation, update the span with the value.</li>
</ul>
</li>
<li>Attributes have the following <strong>rules</strong> that each language SDK implements<ul>
<li><strong>Keys</strong> must be <strong>non-null string values</strong></li>
<li><strong>Values</strong> must be a <strong>non-null string</strong>, <strong>boolean</strong>, <strong>floating point value</strong>, <strong>integer</strong>, or an <strong>array</strong> of these values</li>
</ul>
</li>
<li>Additionally, there are <strong>Semantic Attributes</strong>, which are <strong>known naming conventions</strong> for <strong>metadata</strong> that is <strong>typically present</strong> in <strong>common</strong> operations.<ul>
<li>It’s helpful to use <strong>semantic attribute naming</strong> wherever possible so that <strong>common kinds of metadata</strong> are <strong>standardized</strong> across systems.</li>
</ul>
</li>
</ol>
<h5 id="Span-Events"><a href="#Span-Events" class="headerlink" title="Span Events"></a>Span Events</h5><ol>
<li>A Span Event can be thought of as a <strong>structured log message</strong> (or <strong>annotation</strong>) on a Span<ul>
<li>typically used to denote a meaningful, <strong>singular point in time</strong> during the Span’s duration.</li>
</ul>
</li>
<li>For example, consider two scenarios in a web browser<ul>
<li>Tracking a page load - <strong>Span</strong></li>
<li>Denoting when a page becomes interactive - <strong>Span Event</strong></li>
</ul>
</li>
<li>A <strong>Span</strong> is best used to the first scenario because it’s an <strong>operation</strong> with a <strong>start</strong> and an <strong>end</strong>.</li>
<li>A <strong>Span Event</strong> is best used to track the second scenario because it represents a meaningful, <strong>singular point in time</strong>.</li>
</ol>
<blockquote>
<p>When to use <strong>span events</strong> versus <strong>span attributes</strong></p>
</blockquote>
<ol>
<li>Since <strong>span events</strong> also <strong>contain attributes</strong>, the question of when to use events instead of attributes might not always have an obvious answer.</li>
<li>To inform your decision, consider whether a <strong>specific timestamp</strong> is <strong>meaningful</strong>.</li>
<li>When you’re tracking an <strong>operation</strong> with a <strong>span</strong> and the operation completes, you might want to <strong>add data</strong> from the operation to your <strong>telemetry</strong>.<ul>
<li>If the <strong>timestamp</strong> in which the operation completes is <strong>meaningful</strong> or <strong>relevant</strong>, attach the data to a <strong>span event</strong>.</li>
<li>If the <strong>timestamp isn’t meaningful</strong>, attach the data as <strong>span attributes</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Span-Links"><a href="#Span-Links" class="headerlink" title="Span Links"></a>Span Links</h5><blockquote>
<p><strong>Causal relationship</strong></p>
</blockquote>
<ol>
<li>Links exist so that you can <strong>associate</strong> one <strong>span</strong> with one or more spans, implying a <strong>causal relationship</strong>.<ul>
<li>For example, let’s say we have a distributed system where some <strong>operations</strong> are <strong>tracked by a trace</strong>.</li>
</ul>
</li>
<li>In response to some of these operations, an <strong>additional operation</strong> is <strong>queued</strong> to be executed, but its execution is <strong>asynchronous</strong>.<ul>
<li>We can track this <strong>subsequent operation with a trace</strong> as well.</li>
</ul>
</li>
<li>We would like to <strong>associate</strong> the <strong>trace</strong> for the <strong>subsequent operations with the first trace</strong><ul>
<li>but we cannot <strong>predict</strong> when the <strong>subsequent operations</strong> will <strong>start</strong>.</li>
<li>We need to <strong>associate</strong> these <strong>two traces</strong>, so we will use a span link.</li>
</ul>
</li>
<li>You can link the <strong>last span from the first trace</strong> to the <strong>first span in the second trace</strong>.<ul>
<li>Now, they are <strong>causally associated</strong> with one another.</li>
</ul>
</li>
<li>Links are <strong>optional</strong> but serve as a good way to <strong>associate trace spans</strong> with one another.</li>
</ol>
<h5 id="Span-Status"><a href="#Span-Status" class="headerlink" title="Span Status"></a>Span Status</h5><ol>
<li>Each span has a status. The three possible values are - <strong>Unset</strong> + <strong>Error</strong> + <strong>Ok</strong></li>
<li>The <strong>default value</strong> is <strong>Unset</strong><ul>
<li>A span status that is Unset means that the <strong>operation</strong> it <strong>tracked successfully completed without an error</strong>.</li>
</ul>
</li>
<li>When a span status is <strong>Error</strong>, then that means <strong>some error occurred</strong> in the operation it tracks.<ul>
<li>For example, this could be due to an <strong>HTTP 500</strong> error on a server handling a request.</li>
</ul>
</li>
<li>When a span status is <strong>Ok</strong>, then that means the span was <strong>explicitly marked</strong> as <strong>error-free</strong> by the <strong>developer</strong> of an application.<ul>
<li>it’s <strong>not required</strong> to set a span status as <strong>Ok</strong> when a span is known to have <strong>completed without error</strong>, as this is covered by <strong>Unset</strong>.</li>
<li>What <strong>Ok</strong> does is represent an <strong>unambiguous “final call”</strong> on the status of a span that has been <strong>explicitly set</strong> by a <strong>user</strong>.</li>
<li>This is helpful in any situation where a developer wishes for there to be <strong>no other interpretation of a span</strong> other than “<strong>successful</strong>”.</li>
</ul>
</li>
<li>To reiterate<ul>
<li><strong>Unset</strong> represents a span that <strong>completed without an error.</strong> </li>
<li><strong>Ok</strong> represents when a developer <strong>explicitly marks</strong> a span as <strong>successful</strong>.<ul>
<li><strong>In most cases</strong>, it is <strong>not necessary</strong> to explicitly mark a span as Ok.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="Span-Kind"><a href="#Span-Kind" class="headerlink" title="Span Kind"></a>Span Kind</h5><ol>
<li>When a span is created, it is one of <strong>Client</strong>, <strong>Server</strong>, <strong>Internal</strong>, <strong>Producer</strong>, or <strong>Consumer</strong>. </li>
<li>This span kind provides a <strong>hint</strong> to the <strong>tracing backend</strong> as to how the trace should be <strong>assembled</strong>.<ul>
<li>The <strong>parent</strong> of a <strong>server span</strong> is often a <strong>remote client span</strong>, and the child of a client span is usually a server span.</li>
<li>Similarly, the <strong>parent</strong> of a <strong>consumer span</strong> is always a <strong>producer</strong> and the child of a producer span is always a consumer.</li>
<li>If <strong>not provided</strong>, the span kind is assumed to be <strong>internal</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Client</p>
</blockquote>
<ol>
<li>A client span represents a <strong>synchronous outgoing remote call</strong> such as an outgoing <strong>HTTP</strong> request or <strong>database</strong> call. </li>
<li>Note that in this context, “<strong>synchronous</strong>” does not refer to async&#x2F;await, but to the fact that it is <strong>not queued</strong> for later processing.</li>
</ol>
<blockquote>
<p>Server</p>
</blockquote>
<ol>
<li>A server span represents a <strong>synchronous incoming remote call</strong> such as an incoming <strong>HTTP</strong> request or <strong>remote procedure call</strong>.</li>
</ol>
<blockquote>
<p>Internal</p>
</blockquote>
<ol>
<li>Internal spans represent operations which <strong>do not cross a process boundary</strong>.</li>
<li>Things like instrumenting a <strong>function call</strong> or an Express middleware may use internal spans.</li>
</ol>
<blockquote>
<p>Producer</p>
</blockquote>
<ol>
<li>Producer spans represent the <strong>creation</strong> of a <strong>job</strong> which may be <strong>asynchronously processed later</strong>.</li>
<li>It may be a <strong>remote job</strong> such as one <strong>inserted into a job queue</strong> or a <strong>local job</strong> handled by an <strong>event listener</strong>.</li>
</ol>
<blockquote>
<p>Consumer</p>
</blockquote>
<ol>
<li>Consumer spans represent the processing of a job <strong>created by a producer</strong> and may <strong>start long after</strong> the <strong>producer</strong> span has already <strong>ended</strong>.</li>
</ol>
<h3 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h3><blockquote>
<p>A <strong>measurement</strong> captured at <strong>runtime</strong>.</p>
</blockquote>
<ol>
<li>A metric is a <strong>measurement</strong> of a service captured at <strong>runtime</strong>.</li>
<li>The moment of <strong>capturing a measurements</strong> is known as a <strong>metric event</strong><ul>
<li>which consists not only of the <strong>measurement</strong> itself, but also the <strong>time</strong> at which it was captured and <strong>associated metadata</strong>.</li>
</ul>
</li>
<li><strong>Application and request metrics</strong> are important <strong>indicators</strong> of <strong>availability</strong> and <strong>performance</strong>.<ul>
<li>Custom metrics can provide <strong>insights</strong> into how <strong>availability indicators</strong> impact <strong>user experience</strong> or the <strong>business</strong>.</li>
<li><strong>Collected data</strong> can be used to <strong>alert of an outage</strong> or <strong>trigger scheduling decisions</strong> to <strong>scale up</strong> a deployment <strong>automatically</strong> upon high demand.</li>
</ul>
</li>
</ol>
<blockquote>
<p>To understand how metrics in OpenTelemetry works, let’s look at a list of components that will play a part in <strong>instrumenting</strong> our code.</p>
</blockquote>
<h4 id="Meter-Provider"><a href="#Meter-Provider" class="headerlink" title="Meter Provider"></a>Meter Provider</h4><ol>
<li>A Meter Provider (sometimes called MeterProvider) is a <strong>factory</strong> for <strong>Meters</strong>.</li>
<li><strong>In most applications</strong>, a Meter Provider is <strong>initialized once</strong> and its lifecycle matches the <strong>application’s lifecycle</strong>.</li>
<li>Meter Provider initialization also includes <strong>Resource</strong> and <strong>Exporter</strong> initialization.</li>
<li>It is typically the <strong>first step</strong> in <strong>metering</strong> with OpenTelemetry.<ul>
<li>In some language SDKs, a <strong>global Meter Provider</strong> is already initialized for you.</li>
</ul>
</li>
</ol>
<h4 id="Meter"><a href="#Meter" class="headerlink" title="Meter"></a>Meter</h4><ol>
<li>A Meter <strong>creates metric instruments</strong>, capturing <strong>measurements</strong> about a service at <strong>runtime</strong>.</li>
<li>Meters are created from <strong>Meter Providers</strong>.</li>
</ol>
<h4 id="Metric-Exporter"><a href="#Metric-Exporter" class="headerlink" title="Metric Exporter"></a>Metric Exporter</h4><ol>
<li>Metric Exporters <strong>send metric data</strong> to a <strong>consumer</strong>. </li>
<li>This consumer can be <strong>standard output</strong>, the <strong>OpenTelemetry Collector</strong>, or any open source or vendor <strong>backend</strong> of your choice.</li>
</ol>
<h4 id="Metric-Instruments"><a href="#Metric-Instruments" class="headerlink" title="Metric Instruments"></a>Metric Instruments</h4><ol>
<li>In OpenTelemetry <strong>measurements</strong> are captured by <strong>metric instruments</strong>.</li>
<li>A metric instrument is defined by - <strong>Name</strong> + <strong>Kind</strong> + <strong>Unit</strong> (optional) + <strong>Description</strong> (optional)</li>
<li>The <strong>name</strong>, <strong>unit</strong>, and <strong>description</strong><ul>
<li>are <strong>chosen by the developer</strong> or <strong>defined via semantic conventions</strong> for common ones like request and process metrics.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The instrument <strong>kind</strong> is one of the following:</p>
</blockquote>
<ol>
<li><strong>Counter</strong><ul>
<li>A value that <strong>accumulates over time</strong></li>
<li>you can think of this like an odometer on a car; it <strong>only ever goes up</strong>.</li>
</ul>
</li>
<li><strong>Asynchronous Counter</strong><ul>
<li>Same as the Counter, but is <strong>collected once</strong> for <strong>each export</strong>.</li>
<li>Could be used if you <strong>don’t have access to the continuous increments</strong>, but only to the <strong>aggregated value</strong>.</li>
</ul>
</li>
<li><strong>UpDownCounter</strong><ul>
<li>A value that <strong>accumulates over time</strong>, but can also <strong>go down again</strong>.</li>
<li>An example could be a <strong>queue length</strong>, it will <strong>increase</strong> and <strong>decrease</strong> with the number of work items in the queue.</li>
</ul>
</li>
<li><strong>Asynchronous UpDownCounter</strong><ul>
<li>Same as the UpDownCounter, but is <strong>collected once</strong> for <strong>each export</strong>.</li>
<li>Could be used if you <strong>don’t have access to the continuous changes</strong>, but only to the <strong>aggregated value</strong> (e.g., current queue size).</li>
</ul>
</li>
<li><strong>Gauge</strong><ul>
<li>Measures a <strong>current value</strong> at the <strong>time</strong> it is read.</li>
<li>An example would be the fuel gauge in a vehicle. Gauges are <strong>synchronous</strong>.</li>
</ul>
</li>
<li><strong>Asynchronous Gauge</strong><ul>
<li>Same as the Gauge, but is <strong>collected once</strong> for <strong>each export</strong>.</li>
<li>Could be used if you <strong>don’t have access to the continuous changes</strong>, but only to the <strong>aggregated value</strong>.</li>
</ul>
</li>
<li><strong>Histogram</strong><ul>
<li>A <strong>client-side aggregation</strong> of values, such as request latencies.</li>
<li>A histogram is a good choice if you are interested in <strong>value statistics</strong>.<ul>
<li>For example: How many requests take fewer than 1s?</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="Aggregation"><a href="#Aggregation" class="headerlink" title="Aggregation"></a>Aggregation</h4><ol>
<li>An aggregation is a technique whereby <strong>a large number of measurements</strong> are <strong>combined into</strong> either <strong>exact or estimated statistics</strong> about <strong>metric events</strong> that took place during a <strong>time window</strong>.</li>
<li>The <strong>OTLP protocol</strong> transports such <strong>aggregated metrics</strong>.<ul>
<li>The <strong>OpenTelemetry API</strong> provides a <strong>default aggregation</strong> for <strong>each instrument</strong> which can be <strong>overridden</strong> using the <strong>Views</strong>.</li>
<li>The OpenTelemetry project aims to provide default aggregations that are supported by <strong>visualizers</strong> and <strong>telemetry backends</strong>.</li>
</ul>
</li>
<li>Unlike <strong>request tracing</strong>, which is intended to <strong>capture request lifecycles</strong> and <strong>provide context</strong> to the <strong>individual pieces of a request</strong><ul>
<li><strong>metrics</strong> are intended to provide <strong>statistical information</strong> in <strong>aggregate</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h4><ol>
<li>A view provides <strong>SDK users</strong> with the flexibility to <strong>customize</strong> the <strong>metrics output</strong> by the SDK.</li>
<li>You can customize which <strong>metric instruments</strong> are to be <strong>processed</strong> or <strong>ignored</strong>.</li>
<li>You can also customize <strong>aggregation</strong> and what <strong>attributes</strong> you want to report on metrics.</li>
</ol>
<h4 id="Language-Support"><a href="#Language-Support" class="headerlink" title="Language Support"></a>Language Support</h4><blockquote>
<p><strong>Metrics</strong> are a <strong>stable</strong> signal in the OpenTelemetry <strong>specification</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Language</th>
<th>Metrics</th>
</tr>
</thead>
<tbody><tr>
<td>C++</td>
<td>Stable</td>
</tr>
<tr>
<td>C#&#x2F;.NET</td>
<td>Stable</td>
</tr>
<tr>
<td>Go</td>
<td>Stable</td>
</tr>
<tr>
<td>Java</td>
<td>Stable</td>
</tr>
<tr>
<td>JavaScript</td>
<td>Stable</td>
</tr>
<tr>
<td>PHP</td>
<td>Stable</td>
</tr>
<tr>
<td>Python</td>
<td>Stable</td>
</tr>
</tbody></table>
<h3 id="Logs"><a href="#Logs" class="headerlink" title="Logs"></a>Logs</h3><blockquote>
<p>A recording of an <strong>event</strong>.</p>
</blockquote>
<ol>
<li>A log is a <strong>timestamped text record</strong>, either <strong>structured</strong> (recommended) or <strong>unstructured</strong>, with <strong>optional metadata</strong>.</li>
<li>Of all telemetry signals, logs have the <strong>biggest legacy</strong>.</li>
<li>Most programming languages have <strong>built-in logging capabilities</strong> or well-known, widely used <strong>logging libraries</strong>.</li>
</ol>
<h4 id="OpenTelemetry-logs"><a href="#OpenTelemetry-logs" class="headerlink" title="OpenTelemetry logs"></a>OpenTelemetry logs</h4><ol>
<li>OpenTelemetry does not define a <strong>bespoke</strong> API or SDK to create logs.<ul>
<li>Instead, OpenTelemetry logs are the <strong>existing logs</strong> you already have from a <strong>logging framework</strong> or <strong>infrastructure component</strong>.</li>
<li>OpenTelemetry <strong>SDKs</strong> and <strong>autoinstrumentation</strong> utilize several components to automatically <strong>correlate logs with traces</strong>.</li>
</ul>
</li>
<li>OpenTelemetry’s support for logs is designed to be <strong>fully compatible</strong> with what you already have<ul>
<li>providing <strong>capabilities</strong> to <strong>wrap</strong> those logs with <strong>additional context</strong></li>
<li>and a <strong>common toolkit</strong> to <strong>parse</strong> and <strong>manipulate</strong> logs into a <strong>common format</strong> across many <strong>different sources</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>OpenTelemetry logs in the <strong>OpenTelemetry Collector</strong></p>
</blockquote>
<ol>
<li>Several <strong>receivers</strong> which <strong>parse</strong> logs from specific, known sources of log data.</li>
<li>The <strong>filelogreceiver</strong>, which <strong>reads logs from any file</strong> and provides features to <strong>parse</strong> them from <strong>different formats</strong> or use a <strong>regular expression</strong>.</li>
<li><strong>Processors</strong> like the <strong>transformprocessor</strong> which lets you <strong>parse nested data</strong>, <strong>flatten nested structures</strong>, <strong>add&#x2F;remove&#x2F;update values</strong>, and more.</li>
<li><strong>Exporters</strong> that let you <strong>emit log data</strong> in a <strong>non-OpenTelemetry format</strong>.</li>
<li>The <strong>first step</strong> in adopting OpenTelemetry frequently involves deploying a <strong>Collector</strong> as a <strong>general-purposes logging agent</strong>.</li>
</ol>
<blockquote>
<p>OpenTelemetry logs for <strong>applications</strong></p>
</blockquote>
<ol>
<li>In applications, OpenTelemetry logs are created with <strong>any</strong> logging library or built-in logging capabilities.</li>
<li>When you add <strong>autoinstrumentation</strong> or activate an <strong>SDK</strong><ul>
<li>OpenTelemetry will automatically <strong>correlate</strong> your <strong>existing logs</strong> with <strong>any active trace and span</strong>, wrapping the <strong>log body</strong> with their IDs.</li>
</ul>
</li>
<li>In other words, OpenTelemetry <strong>automatically correlates your logs and traces</strong>.</li>
</ol>
<blockquote>
<p>Language support - <strong>Logs</strong> are a <strong>stable</strong> signal in the OpenTelemetry <strong>specification</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Language</th>
<th>Traces</th>
<th>Metrics</th>
<th>Logs</th>
</tr>
</thead>
<tbody><tr>
<td>C++</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
</tr>
<tr>
<td>C#&#x2F;.NET</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
</tr>
<tr>
<td>Go</td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Beta</strong></td>
</tr>
<tr>
<td>Java</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
</tr>
<tr>
<td>JavaScript</td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Development</strong></td>
</tr>
<tr>
<td>PHP</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
</tr>
<tr>
<td>Python</td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Development</strong></td>
</tr>
</tbody></table>
<h4 id="Structured-Unstructured-Semistructured"><a href="#Structured-Unstructured-Semistructured" class="headerlink" title="Structured + Unstructured + Semistructured"></a>Structured + Unstructured + Semistructured</h4><ol>
<li>OpenTelemetry does <strong>not</strong> technically <strong>distinguish</strong> between <strong>structured</strong> and <strong>unstructured</strong> logs. You can use <strong>any log</strong> you have with OpenTelemetry.</li>
<li>However, <strong>not all log formats</strong> are <strong>equally useful</strong>!<ul>
<li><strong>Structured logs</strong>, in particular, are <strong>recommended</strong> for <strong>production observability</strong> because they are <strong>easy to parse and analyze at scale</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Structured-logs"><a href="#Structured-logs" class="headerlink" title="Structured logs"></a>Structured logs</h5><ol>
<li>A structured log is a log whose <strong>textual format</strong> follows a <strong>consistent</strong>, <strong>machine-readable</strong> format.</li>
<li>For <strong>applications</strong>, one of the most common formats is <strong>JSON</strong></li>
<li>For <strong>infrastructure components</strong>, Common Log Format (<strong>CLF</strong>) is commonly used</li>
<li>It is also common to have <strong>different</strong> structured log formats <strong>mixed together</strong>.<ul>
<li>For example, an Extended Log Format (<strong>ELF</strong>) log can mix <strong>JSON</strong> with the <strong>whitespace-separated</strong> data in a <strong>CLF</strong> log.</li>
</ul>
</li>
<li>Parse both the <strong>JSON</strong> and the <strong>ELF-related pieces</strong> into a <strong>shared format</strong> to make <strong>analysis</strong> on an <strong>observability backend</strong> easier.<ul>
<li>The <strong>filelogreceiver</strong> in the <strong>OpenTelemetry Collector</strong> contains <strong>standardized ways</strong> to <strong>parse</strong> logs like this.</li>
</ul>
</li>
<li>Structured logs are the <strong>preferred way</strong> to use logs.<ul>
<li>Because structured logs are <strong>emitted in a consistent format</strong>, they are <strong>straightforward to parse</strong></li>
<li>makes them <strong>easier to preprocess</strong> in an <strong>OpenTelemetry Collector</strong>, <strong>correlate</strong> with other data, and <strong>ultimate analyze</strong> in an <strong>Observability backend</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Unstructured-logs"><a href="#Unstructured-logs" class="headerlink" title="Unstructured logs"></a>Unstructured logs</h5><ol>
<li>Unstructured logs are logs that don’t follow a <strong>consistent structure</strong>.<ul>
<li>They may be more <strong>human-readable</strong>, and are often used in <strong>development</strong>.</li>
</ul>
</li>
<li>However, it is <strong>not preferred</strong> to use unstructured logs for <strong>production observability</strong> purposes<ul>
<li>since they are much <strong>more difficult to parse and analyze at scale</strong>.</li>
</ul>
</li>
<li>It is possible to <strong>store</strong> and <strong>analyze</strong> Unstructured logs in <strong>production</strong><ul>
<li>although you may need to do <strong>substantial work</strong> to <strong>parse</strong> or otherwise pre-process them to be <strong>machine-readable</strong>.</li>
</ul>
</li>
<li>This will typically be necessary for a <strong>logging backend</strong> to know how to <strong>sort</strong> and <strong>organize</strong> the logs by <strong>timestamp</strong>.</li>
<li>Although it’s possible to <strong>parse unstructured logs</strong> for <strong>analysis purposes</strong>, doing this may be <strong>more work</strong> than <strong>switching to structured logging</strong><ul>
<li>such as via a <strong>standard logging framework</strong> in your applications.</li>
</ul>
</li>
</ol>
<h5 id="Semistructured-logs"><a href="#Semistructured-logs" class="headerlink" title="Semistructured logs"></a>Semistructured logs</h5><ol>
<li>A semistructured log is a log that does use some <strong>self-consistent patterns</strong> to distinguish data so that it’s <strong>machine-readable</strong></li>
<li>but may <strong>not</strong> use the <strong>same formatting and delimiters</strong> between data across <strong>different systems</strong>.</li>
<li>Although <strong>machine-readable</strong>, semistructured logs may require <strong>several different parsers</strong> to allow for <strong>analysis at scale</strong>.</li>
</ol>
<h4 id="OpenTelemetry-logging-components"><a href="#OpenTelemetry-logging-components" class="headerlink" title="OpenTelemetry logging components"></a>OpenTelemetry logging components</h4><h5 id="Log-Appender-Bridge"><a href="#Log-Appender-Bridge" class="headerlink" title="Log Appender &#x2F; Bridge"></a>Log Appender &#x2F; Bridge</h5><ol>
<li>As an application <strong>developer</strong>, the Logs Bridge API should <strong>not be called</strong> by you <strong>directly</strong><ul>
<li>as it is provided for <strong>logging library authors</strong> to build log appenders &#x2F; bridges.</li>
</ul>
</li>
<li>Instead, you just use your <strong>preferred logging library</strong> and configure it to <strong>use a log appender</strong> (or <strong>log bridge</strong>)<ul>
<li>that is able to <strong>emit logs</strong> into an <strong>OpenTelemetry LogRecordExporter</strong>.</li>
</ul>
</li>
<li>OpenTelemetry language <strong>SDKs</strong> offer this functionality.</li>
</ol>
<h5 id="Logger-Provider"><a href="#Logger-Provider" class="headerlink" title="Logger Provider"></a>Logger Provider</h5><blockquote>
<p><strong>Part</strong> of the <strong>Logs Bridge API</strong> and should only be used if you are the <strong>author</strong> of a <strong>logging library</strong>.</p>
</blockquote>
<ol>
<li>A Logger Provider (sometimes called LoggerProvider) is a <strong>factory</strong> for <strong>Loggers</strong>.</li>
<li><strong>In most cases</strong>, the Logger Provider is <strong>initialized once</strong> and its lifecycle matches the <strong>application’s lifecycle</strong>.</li>
<li>Logger Provider initialization also includes <strong>Resource</strong> and <strong>Exporter</strong> initialization.</li>
</ol>
<h5 id="Logger"><a href="#Logger" class="headerlink" title="Logger"></a>Logger</h5><blockquote>
<p><strong>Part</strong> of the <strong>Logs Bridge API</strong> and should only be used if you are the <strong>author</strong> of a <strong>logging library</strong>.</p>
</blockquote>
<ol>
<li>A Logger <strong>creates log records</strong>. Loggers are created from <strong>Log Providers</strong>.</li>
</ol>
<h5 id="Log-Record-Exporter"><a href="#Log-Record-Exporter" class="headerlink" title="Log Record Exporter"></a>Log Record Exporter</h5><ol>
<li>Log Record Exporters <strong>send log records</strong> to a <strong>consumer</strong>.</li>
<li>This consumer can be <strong>standard output</strong>, the <strong>OpenTelemetry Collector</strong>, or any open source or vendor <strong>backend</strong> of your choice.</li>
</ol>
<h5 id="Log-Record"><a href="#Log-Record" class="headerlink" title="Log Record"></a>Log Record</h5><ol>
<li>A log record represents the recording of an <strong>event</strong>.</li>
<li>In OpenTelemetry a log record contains two kinds of fields<ul>
<li><strong>Named top-level fields</strong> of <strong>specific</strong> type and meaning</li>
<li><strong>Resource and attributes fields</strong> of <strong>arbitrary</strong> value and type</li>
</ul>
</li>
</ol>
<blockquote>
<p>The top-level fields are</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Timestamp</td>
<td>Time when the event <strong>occurred</strong>.</td>
</tr>
<tr>
<td>ObservedTimestamp</td>
<td>Time when the event was <strong>observed</strong>.</td>
</tr>
<tr>
<td>TraceId</td>
<td>Request trace ID.</td>
</tr>
<tr>
<td>SpanId</td>
<td>Request span ID.</td>
</tr>
<tr>
<td>TraceFlags</td>
<td><strong>W3C trace flag.</strong></td>
</tr>
<tr>
<td>SeverityText</td>
<td>The <strong>severity</strong> text (also known as <strong>log level</strong>).</td>
</tr>
<tr>
<td>SeverityNumber</td>
<td><strong>Numerical</strong> value of the <strong>severity</strong>.</td>
</tr>
<tr>
<td>Body</td>
<td>The body of the log record.</td>
</tr>
<tr>
<td>Resource</td>
<td>Describes the <strong>source</strong> of the log.</td>
</tr>
<tr>
<td>InstrumentationScope</td>
<td>Describes the <strong>scope</strong> that <strong>emitted</strong> the log.</td>
</tr>
<tr>
<td>Attributes</td>
<td><strong>Additional information</strong> about the event.</td>
</tr>
</tbody></table>
<h3 id="Baggage"><a href="#Baggage" class="headerlink" title="Baggage"></a>Baggage</h3><blockquote>
<p><strong>Contextual information</strong> that is passed <strong>between signals</strong>.</p>
</blockquote>
<ol>
<li>In OpenTelemetry, Baggage is <strong>contextual information</strong> that <strong>resides next to context</strong>.</li>
<li>Baggage is a <strong>key-value store</strong>, which means it lets you <strong>propagate any data</strong> you like <strong>alongside context</strong>.</li>
<li>Baggage means you can pass data <strong>across services and processes</strong>, making it available to add to <strong>traces</strong>, <strong>metrics</strong>, or <strong>logs</strong> in those services.</li>
</ol>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><ol>
<li>Baggage is often used in <strong>tracing</strong> to <strong>propagate additional data</strong> across services.</li>
<li>For example, imagine you have a <strong>clientId</strong> at the <strong>start of a request</strong>, but you’d like for that ID to be <strong>available on all spans in a trace</strong><ul>
<li><strong>some metrics</strong> in another service, and <strong>some logs</strong> along the way.</li>
</ul>
</li>
<li>Because the <strong>trace</strong> may <strong>span multiple services</strong><ul>
<li>you need some way to <strong>propagate</strong> that data <strong>without copying the clientId</strong> across many places in your <strong>codebase</strong>.</li>
</ul>
</li>
<li>By using <strong>Context Propagation</strong> to <strong>pass baggage across these services</strong>, the <strong>clientId</strong> is <strong>available</strong> to add to <strong>any</strong> additional spans, metrics, or logs.<ul>
<li>Additionally, instrumentations <strong>automatically propagate baggage</strong> for you.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-baggage.svg" alt="otel-baggage"></p>
<h4 id="What-should-OTel-Baggage-be-used-for"><a href="#What-should-OTel-Baggage-be-used-for" class="headerlink" title="What should OTel Baggage be used for?"></a>What should OTel Baggage be used for?</h4><ol>
<li>Baggage is best used to include information typically available <strong>only</strong> at the <strong>start</strong> of a request <strong>further downstream</strong>.<ul>
<li>This can include things like Account Identification, <strong>User IDs</strong>, Product IDs, and origin IPs, for example.</li>
</ul>
</li>
<li><strong>Propagating</strong> this information using <strong>baggage</strong> allows for <strong>deeper analysis</strong> of <strong>telemetry</strong> in a <strong>backend</strong>.</li>
<li>For example, if you include information like a <strong>User ID</strong> on a <strong>span</strong> that tracks a <strong>database call</strong><ul>
<li>you can much more easily answer questions like “**which users are experiencing the slowest database calls?**”</li>
<li>You can also <strong>log information</strong> about a <strong>downstream operation</strong> and include that <strong>same User ID</strong> in the <strong>log data</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-baggage-2.svg" alt="otel-baggage-2"></p>
<h4 id="Baggage-security-considerations"><a href="#Baggage-security-considerations" class="headerlink" title="Baggage security considerations"></a>Baggage security considerations</h4><ol>
<li><strong>Sensitive Baggage items</strong> can be <strong>shared</strong> with <strong>unintended resources</strong>, like third-party APIs.</li>
<li>This is because <strong>automatic instrumentation</strong> includes <strong>Baggage</strong> in most of your service’s <strong>network requests</strong>.</li>
<li>Specifically, <strong>Baggage</strong> and other parts of <strong>trace context</strong> are sent in <strong>HTTP headers</strong>, making it <strong>visible</strong> to anyone <strong>inspecting</strong> your <strong>network traffic</strong>.<ul>
<li>If traffic is <strong>restricted</strong> within your network, then this risk may not apply</li>
<li>But keep in mind that <strong>downstream services</strong> could <strong>propagate Baggage outside your network</strong>.</li>
</ul>
</li>
<li>Also, there are <strong>no built-in integrity checks</strong> to ensure that <strong>Baggage items</strong> are yours, so exercise <strong>caution</strong> when <strong>reading</strong> them.</li>
</ol>
<h4 id="Baggage-is-not-the-same-as-attributes"><a href="#Baggage-is-not-the-same-as-attributes" class="headerlink" title="Baggage is not the same as attributes"></a>Baggage is not the same as attributes</h4><blockquote>
<p>unassociated + <strong>explicitly</strong> - Baggage Span Processors</p>
</blockquote>
<ol>
<li>An important thing to note about <strong>baggage</strong> is that it is a <strong>separate key-value store</strong></li>
<li>and is <strong>unassociated</strong> with <strong>attributes</strong> on spans, metrics, or logs <strong>without explicitly adding</strong> them.</li>
<li>To <strong>add baggage entries to attributes</strong>, you need to <strong>explicitly read the data from baggage</strong> and <strong>add it as attributes</strong> to your <strong>spans</strong>, <strong>metrics</strong>, or <strong>logs</strong>.</li>
<li>Because a <strong>common use cases</strong> for <strong>Baggage</strong> is to add data to <strong>Span Attributes</strong> across a <strong>whole trace</strong><ul>
<li>several languages have <strong>Baggage Span Processors</strong> that <strong>add data from baggage as attributes on span creation</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h2><blockquote>
<p>How OpenTelemetry <strong>facilitates</strong> instrumentation</p>
</blockquote>
<ol>
<li>In order to make a system <strong>observable</strong>, it must be <strong>instrumented</strong><ul>
<li>That is, <strong>code</strong> from the <strong>system’s components</strong> must <strong>emit</strong> traces, metrics, and logs.</li>
</ul>
</li>
<li>Using OpenTelemetry, you can instrument your code in two primary ways<ul>
<li><strong>Code-based</strong> solutions via official <strong>APIs</strong> and <strong>SDKs</strong> for most languages</li>
<li><strong>Zero-code</strong> solutions</li>
</ul>
</li>
<li><strong>Code-based</strong> solutions<ul>
<li>allow you to get <strong>deeper insight</strong> and <strong>rich telemetry</strong> from your application itself.</li>
<li>They let you use the <strong>OpenTelemetry API</strong> to <strong>generate telemetry</strong> from your application<ul>
<li>which acts as an <strong>essential complement</strong> to the telemetry generated by <strong>zero-code</strong> solutions.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Zero-code</strong> solutions<ul>
<li>are great for <strong>getting started</strong>, or when you <strong>can’t modify the application</strong> you need to get telemetry out of.</li>
<li>They provide <strong>rich telemetry</strong> from <strong>libraries</strong> you use and&#x2F;or the <strong>environment</strong> your application runs in.</li>
<li>Another way to think of it is that they provide information about what’s happening at the <strong>edges</strong> of your application.</li>
</ul>
</li>
<li>You can use <strong>both</strong> solutions <strong>simultaneously</strong>.</li>
</ol>
<blockquote>
<p>Additional OpenTelemetry <strong>Benefits</strong></p>
</blockquote>
<ol>
<li>OpenTelemetry provides <strong>more than</strong> just <strong>zero-code</strong> and <strong>code-based</strong> telemetry solutions.</li>
<li><strong>Libraries</strong> can leverage the <strong>OpenTelemetry API</strong> as a <strong>dependency</strong><ul>
<li>which will have <strong>no impact</strong> on applications using that library, unless the <strong>OpenTelemetry SDK</strong> is <strong>imported</strong>.</li>
</ul>
</li>
<li>For <strong>each signal</strong> (traces, metrics, logs) you have <strong>several methods</strong> at your disposals to <strong>create</strong>, <strong>process</strong>, and <strong>export</strong> them.</li>
<li>With <strong>context propagation</strong> built into the implementations, you can <strong>correlate signals</strong> regardless of where they are generated.</li>
<li><strong>Resources</strong> and <strong>Instrumentation Scopes</strong> allow <strong>grouping of signals</strong>, by <strong>different entities</strong>, like, the <strong>host</strong>, <strong>operating system</strong> or <strong>K8s cluster</strong></li>
<li>Each <strong>language-specific implementation</strong> of the <strong>API</strong> and <strong>SDK</strong> follows the <strong>requirements</strong> and <strong>expectations</strong> of the <strong>OpenTelemetry specification</strong>.</li>
<li><strong>Semantic Conventions</strong> provide a <strong>common naming schema</strong> that can be used for <strong>standardization</strong> across code bases and platforms.</li>
</ol>
<h3 id="Zero-code"><a href="#Zero-code" class="headerlink" title="Zero-code"></a>Zero-code</h3><blockquote>
<p>Learn how to add observability to an application <strong>without</strong> the need to write code - <strong>libraries</strong></p>
</blockquote>
<ol>
<li>As <strong>ops</strong> you might want to add observability to one or more applications without having to edit the source.</li>
<li>quickly gain some observability for a service without having to use the <strong>OpenTelemetry API &amp; SDK</strong> for <strong>code-based</strong> instrumentation.</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/zero-code.svg" alt="zero-code"></p>
<ol>
<li>Zero-code instrumentation adds the <strong>OpenTelemetry API and SDK capabilities</strong> to your application typically as an <strong>agent</strong> or <strong>agent-like</strong> installation.</li>
<li>The specific mechanisms involved may differ by language<ul>
<li>ranging from <strong>bytecode manipulation</strong>, <strong>monkey patching</strong>, or <strong>eBPF</strong> to inject calls to the OpenTelemetry API and SDK into your application.</li>
</ul>
</li>
<li>Typically, zero-code instrumentation adds <strong>instrumentation</strong> for the <strong>libraries</strong> you’re using.<ul>
<li>This means that <strong>requests</strong> and <strong>responses</strong>, <strong>database calls</strong>, <strong>message queue calls</strong>, and so forth are what are <strong>instrumented</strong>.</li>
<li>Your <strong>application’s code</strong>, however, is <strong>not</strong> typically <strong>instrumented</strong>. To <strong>instrument</strong> your <strong>code</strong>, you’ll need to use <strong>code-based</strong> instrumentation.</li>
</ul>
</li>
<li>Additionally, zero-code instrumentation lets you configure the <strong>Instrumentation Libraries</strong> and <strong>exporters</strong> loaded.</li>
<li>You can configure zero-code instrumentation through <strong>environment variables</strong> and other <strong>language-specific mechanisms</strong><ul>
<li>such as <strong>system properties</strong> or <strong>arguments</strong> passed to <strong>initialization methods</strong>.</li>
</ul>
</li>
<li>To get started, you only need a <strong>service name</strong> configured so that you can <strong>identify the service</strong> in the <strong>observability backend</strong> of your choice.</li>
<li>Other configuration options are available, including:<ul>
<li><strong>Data source</strong> specific configuration</li>
<li><strong>Exporter</strong> configuration</li>
<li><strong>Propagator</strong> configuration</li>
<li><strong>Resource</strong> configuration</li>
</ul>
</li>
<li><strong>Automatic instrumentation</strong> is available for the following languages:<ul>
<li>.NET</li>
<li>Go</li>
<li>Java</li>
<li>JavaScript</li>
<li>PHP</li>
<li>Python</li>
</ul>
</li>
</ol>
<h3 id="Code-based"><a href="#Code-based" class="headerlink" title="Code-based"></a>Code-based</h3><blockquote>
<p>Learn the essential steps in setting up code-based instrumentation - <strong>application’s code</strong></p>
</blockquote>
<h4 id="Import-the-OpenTelemetry-API-and-SDK"><a href="#Import-the-OpenTelemetry-API-and-SDK" class="headerlink" title="Import the OpenTelemetry API and SDK"></a>Import the OpenTelemetry API and SDK</h4><ol>
<li>You’ll first need to <strong>import</strong> OpenTelemetry to your service <strong>code</strong>.</li>
<li>If you’re <strong>developing a library</strong> or some other component that is intended to be <strong>consumed by a runnable binary</strong><ul>
<li>then you would only take a <strong>dependency</strong> on the <strong>API</strong>.</li>
</ul>
</li>
<li>If your artifact is a <strong>standalone process or service</strong>, then you would take a <strong>dependency</strong> on the <strong>API</strong> and the <strong>SDK</strong>.</li>
</ol>
<table>
<thead>
<tr>
<th>Type</th>
<th>Dependency</th>
</tr>
</thead>
<tbody><tr>
<td>library</td>
<td>API</td>
</tr>
<tr>
<td>standalone process or service</td>
<td>API + SDK</td>
</tr>
</tbody></table>
<h4 id="Configure-the-OpenTelemetry-API"><a href="#Configure-the-OpenTelemetry-API" class="headerlink" title="Configure the OpenTelemetry API"></a>Configure the OpenTelemetry API</h4><ol>
<li>In order to create <strong>traces</strong> or <strong>metrics</strong>, you’ll need to first create a tracer and&#x2F;or meter <strong>provider</strong>.</li>
<li>In general, we <strong>recommend</strong> that the <strong>SDK</strong> should provide a <strong>single default provider</strong> for these objects. - <strong>factory</strong></li>
<li>You’ll then get a tracer or meter <strong>instance</strong> from that provider, and give it a <strong>name</strong> and <strong>version</strong>.</li>
<li>The <strong>name</strong> you choose here should <strong>identify what exactly is being instrumented</strong><ul>
<li>if you’re writing a <strong>library</strong>, then you should name it after your library as this name will <strong>namespace</strong> all <strong>spans</strong> or <strong>metric events</strong> produced.</li>
<li>It is also recommended that you supply a <strong>version string</strong> (i.e., semver:<strong>1.0.0</strong>) that corresponds to the current version of your library or service.</li>
</ul>
</li>
</ol>
<h4 id="Configure-the-OpenTelemetry-SDK"><a href="#Configure-the-OpenTelemetry-SDK" class="headerlink" title="Configure the OpenTelemetry SDK"></a>Configure the OpenTelemetry SDK</h4><ol>
<li>If you’re building a <strong>service process</strong><ul>
<li>you’ll also need to configure the <strong>SDK</strong> with <strong>appropriate options</strong> for <strong>exporting</strong> your <strong>telemetry data</strong> to some <strong>analysis backend</strong>.</li>
</ul>
</li>
<li>We recommend that this configuration be <strong>handled programmatically</strong> through a <strong>configuration file</strong> or some other mechanism.<ul>
<li>There are also <strong>per-language tuning options</strong> you may wish to take advantage of.</li>
</ul>
</li>
</ol>
<h4 id="Create-Telemetry-Data"><a href="#Create-Telemetry-Data" class="headerlink" title="Create Telemetry Data"></a>Create Telemetry Data</h4><ol>
<li>Once you’ve <strong>configured</strong> the <strong>API</strong> and <strong>SDK</strong><ul>
<li>you’ll then be free to create <strong>traces</strong> and <strong>metric events</strong> through the <strong>tracer</strong> and <strong>meter</strong> objects you obtained from the <strong>provider</strong>.</li>
</ul>
</li>
<li>Make use of <strong>Instrumentation Libraries</strong> for your dependencies - <a target="_blank" rel="noopener" href="https://opentelemetry.io/ecosystem/registry/">https://opentelemetry.io/ecosystem/registry/</a></li>
</ol>
<h4 id="Export-Data"><a href="#Export-Data" class="headerlink" title="Export Data"></a>Export Data</h4><ol>
<li>Once you’ve created <strong>telemetry data</strong>, you’ll want to <strong>send</strong> it somewhere.</li>
<li>OpenTelemetry supports two primary methods of <strong>exporting data</strong> from your <strong>process</strong> to an <strong>analysis backend</strong><ul>
<li>either <strong>directly from a process</strong> or by <strong>proxying</strong> it through the <strong>OpenTelemetry Collector</strong>.</li>
</ul>
</li>
<li>In-process export requires you to <strong>import</strong> and take a <strong>dependency</strong> on one or more <strong>exporters</strong><ul>
<li><strong>libraries</strong> that <strong>translate</strong> OpenTelemetry’s <strong>in-memory span and metric</strong> objects into the <strong>appropriate format</strong> for <strong>telemetry analysis tools</strong></li>
</ul>
</li>
<li>In addition, OpenTelemetry supports a <strong>wire protocol</strong> known as <strong>OTLP</strong>, which is supported by all <strong>OpenTelemetry SDKs</strong>.<ul>
<li>This protocol can be used to send data to the <strong>OpenTelemetry Collector</strong></li>
<li>Collector - a <strong>standalone binary process</strong> that can be run as a <strong>proxy</strong> or <strong>sidecar to your service instances</strong> or run on a <strong>separate host</strong>.</li>
<li>The Collector can then be configured to <strong>forward</strong> and <strong>export</strong> this data to your choice of <strong>analysis tools</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Libraries"><a href="#Libraries" class="headerlink" title="Libraries"></a>Libraries</h3><blockquote>
<p>Learn how to add <strong>native instrumentation</strong> to your <strong>library</strong>.</p>
</blockquote>
<ol>
<li>OpenTelemetry provides <strong>instrumentation libraries</strong> for <strong>many libraries</strong>, which is typically done through <strong>library hooks</strong> or <strong>monkey-patching library code</strong>.</li>
<li><strong>Native library instrumentation</strong> with OpenTelemetry provides <strong>better observability and developer experience</strong> for users<ul>
<li>removing the need for libraries to <strong>expose and document hooks</strong>.</li>
</ul>
</li>
<li>Other advantages provided by native instrumentation include:<ul>
<li><strong>Custom logging hooks</strong> can be <strong>replaced</strong> by common and easy to use <strong>OpenTelemetry APIs</strong>, users will only <strong>interact</strong> with OpenTelemetry.</li>
<li><strong>Traces</strong>, <strong>logs</strong>, <strong>metrics</strong> from <strong>library</strong> and <strong>application code</strong> are <strong>correlated</strong> and <strong>coherent</strong>.</li>
<li><strong>Common conventions</strong> allow users to get <strong>similar and consistent telemetry</strong> within <strong>same technology</strong> and <strong>across libraries and languages</strong>.</li>
<li><strong>Telemetry signals</strong> can be fine tuned (<strong>filtered</strong>, <strong>processed</strong>, <strong>aggregated</strong>) for <strong>various consumption scenarios</strong><ul>
<li>using a wide variety of well-documented OpenTelemetry <strong>extensibility</strong> points.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/native-vs-libraries.svg" alt="native-vs-libraries"></p>
<h4 id="Semantic-conventions"><a href="#Semantic-conventions" class="headerlink" title="Semantic conventions"></a>Semantic conventions</h4><ol>
<li><strong>Semantic conventions</strong> are the <strong>main source of truth</strong> about <strong>what information is included on spans</strong> produced by<ul>
<li><em>web frameworks</em>, <em>RPC clients</em>, <em>databases</em>, <em>messaging clients</em>, <em>infrastructure</em>, and more.</li>
</ul>
</li>
<li><strong>Conventions</strong> make instrumentation <strong>consistent</strong><ul>
<li><strong>users</strong> who work with telemetry don’t have to learn <strong>library specifics</strong></li>
<li><strong>observability vendors</strong> can build experiences for a wide variety of <strong>technologies</strong>, for example <strong>databases</strong> or <strong>messaging</strong> systems.</li>
</ul>
</li>
<li>When <strong>libraries</strong> follow <strong>conventions</strong>, many scenarios can be <strong>enabled</strong> without the user’s input or configuration.</li>
<li>Semantic conventions are always <strong>evolving</strong> and <strong>new conventions</strong> are <strong>constantly added</strong>.</li>
<li>Pay special attention to <strong>span names</strong>: strive to use <strong>meaningful names</strong> and consider <strong>cardinality</strong> when defining them.</li>
<li>Also set the <strong>schema_url</strong> <strong>attribute</strong> that you can use to record what <strong>version</strong> of the <strong>semantic conventions</strong> you’re using.</li>
</ol>
<h5 id="Defining-spans"><a href="#Defining-spans" class="headerlink" title="Defining spans"></a>Defining spans</h5><ol>
<li>From the perspective of a <strong>library user</strong> and what the user might be <strong>interested</strong> in knowing about the <strong>behavior</strong> and <strong>activity</strong> of the library.</li>
<li>As the <strong>library maintainer</strong>, you know the <strong>internals</strong><ul>
<li>but the <strong>user</strong> will most likely be <strong>less interested</strong> in the <strong>inner workings</strong> of the library and <strong>more interested</strong> in the <strong>functionality</strong> of their application.</li>
<li>Think about what information can be helpful in <strong>analyzing the usage</strong> of your library, then think about an appropriate way to <strong>model that data</strong>.</li>
</ul>
</li>
<li>Some aspects to consider include<ul>
<li><strong>Spans and span hierarchies</strong></li>
<li><strong>Numerical attributes</strong> on <strong>spans</strong>, as an <strong>alternative</strong> to <strong>aggregated metrics</strong></li>
<li><strong>Span events</strong></li>
<li><strong>Aggregated Metrics</strong></li>
</ul>
</li>
<li>For example, if your library is making requests to a database, create spans only for the <strong>logical request</strong> to the database.<ul>
<li>The <strong>physical requests</strong> over the <strong>network</strong> should <strong>be instrumented within the libraries</strong> implementing that functionality.</li>
</ul>
</li>
<li>You should also favor capturing other activities, like <strong>object&#x2F;data serialization</strong> as <strong>span events</strong>, rather than as additional spans.</li>
<li>Follow the <strong>semantic conventions</strong> when setting <strong>span attributes</strong>.</li>
</ol>
<h4 id="When-not-to-instrument"><a href="#When-not-to-instrument" class="headerlink" title="When not to instrument"></a>When not to instrument</h4><blockquote>
<p>only instrument your library at its own level + When in doubt, don’t instrument</p>
</blockquote>
<ol>
<li>Some libraries are <strong>thin clients</strong> wrapping <strong>network calls</strong>.<ul>
<li>Chances are that OpenTelemetry has an <strong>instrumentation library</strong> for the <strong>underlying RPC client</strong>.</li>
<li><a target="_blank" rel="noopener" href="https://opentelemetry.io/ecosystem/registry/">https://opentelemetry.io/ecosystem/registry/</a><ul>
<li>If a library <strong>exists</strong>, instrumenting the wrapper library might <strong>not be necessary</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>As a general guideline, <strong>only instrument your library at its own level</strong>.</li>
<li>Don’t instrument if <strong>all</strong> the following cases apply<ul>
<li>Your library is a <strong>thin proxy</strong> on top of documented or self-explanatory APIs.</li>
<li>OpenTelemetry has <strong>instrumentation</strong> for <strong>underlying network calls</strong>.</li>
<li>There are <strong>no conventions</strong> your library should <strong>follow</strong> to <strong>enrich telemetry</strong>.</li>
</ul>
</li>
<li><strong>When in doubt, don’t instrument.</strong><ul>
<li>If you choose <strong>not to instrument</strong>, still be useful to provide a way to <strong>configure OpenTelemetry handlers</strong> for your <strong>internal RPC client instance</strong>.</li>
<li>It’s <strong>essential</strong> in languages that <strong>don’t support fully automatic instrumentation</strong> and still useful in others.</li>
</ul>
</li>
</ol>
<h4 id="OpenTelemetry-API"><a href="#OpenTelemetry-API" class="headerlink" title="OpenTelemetry API"></a>OpenTelemetry API</h4><ol>
<li>The first step when <strong>instrumenting an application</strong> is to <strong>include</strong> the <strong>OpenTelemetry API package</strong> as a <strong>dependency</strong>.</li>
<li>OpenTelemetry has two main modules: <strong>API</strong> and <strong>SDK</strong>.<ul>
<li><strong>OpenTelemetry API</strong> is a set of <strong>abstractions</strong> and <strong>non-operational implementations</strong>.</li>
<li>Unless your application imports the <strong>OpenTelemetry SDK</strong><ul>
<li>your <strong>instrumentation does nothing</strong> and <strong>does not impact application performance</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Libraries</strong> should <strong>only use</strong> the <strong>OpenTelemetry API</strong><br>If you’re concerned about adding new dependencies, here are some considerations to help you decide how to <strong>minimize dependency conflicts</strong></p>
</blockquote>
<ol>
<li><strong>OpenTelemetry Trace API</strong> reached <strong>stability</strong> in <strong>early 2021</strong>. It follows <strong>Semantic Versioning 2.0</strong>.</li>
<li>Use the <strong>earliest stable OpenTelemetry API (1.0.*)</strong> and avoid updating it unless you have to use <strong>new features</strong>.</li>
<li>While your instrumentation <strong>stabilizes</strong>, consider shipping it as a <strong>separate package</strong>, so that it never causes issues for users who don’t use it.</li>
<li><strong>Semantic conventions</strong> are <strong>stable</strong>, but subject to <strong>evolution</strong><ul>
<li>while this <strong>does not cause any functional issues</strong>, you might need to <strong>update</strong> your instrumentation <strong>every once in a while</strong>.</li>
<li>Having it in a <strong>preview plugin</strong> or in <strong>OpenTelemetry contrib repository</strong><ul>
<li>may help <strong>keeping conventions up-to-date</strong> without <strong>breaking changes</strong> for your users.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>Getting a <strong>tracer</strong></p>
</blockquote>
<ol>
<li>All <strong>application configuration</strong> is <strong>hidden</strong> from your <strong>library</strong> through the <strong>Tracer API</strong>.</li>
<li><strong>Libraries</strong> might allow <strong>applications</strong> to <strong>pass instances of TracerProvider</strong> to facilitate <strong>dependency injection</strong> and ease of <strong>testing</strong><ul>
<li>or obtain it from <strong>global TracerProvider</strong>.</li>
</ul>
</li>
<li><strong>OpenTelemetry language implementations</strong> might have <strong>different preferences</strong> for <strong>passing instances</strong> or <strong>accessing the global</strong><ul>
<li>based on what’s idiomatic in each programming language.</li>
</ul>
</li>
<li>When obtaining the tracer, provide your <strong>library</strong> (or tracing plugin) <strong>name</strong> and <strong>version</strong><ul>
<li>they <strong>show up</strong> on the <strong>telemetry</strong> and help users <strong>process</strong> and <strong>filter</strong> telemetry</li>
<li>understand <strong>where it came from</strong>, and <strong>debug</strong> or <strong>report</strong> instrumentation issues.</li>
</ul>
</li>
</ol>
<h4 id="What-to-instrument"><a href="#What-to-instrument" class="headerlink" title="What to instrument"></a>What to instrument</h4><h5 id="Public-APIs"><a href="#Public-APIs" class="headerlink" title="Public APIs"></a>Public APIs</h5><ol>
<li>Public APIs are good candidates for <strong>tracing</strong><ul>
<li><strong>spans</strong> created for public API calls allow users to map <strong>telemetry</strong> to <strong>application code</strong>, understand the <strong>duration</strong> and <strong>outcome</strong> of library calls.</li>
</ul>
</li>
<li>Which calls to trace include<ul>
<li><strong>Public methods</strong> that <strong>make network calls internally</strong> or <strong>local operations that take significant time</strong> and may <strong>fail</strong>, for example <strong>I&#x2F;O</strong>.</li>
<li><strong>Handlers</strong> that <strong>process</strong> <strong>requests</strong> or <strong>messages</strong>.</li>
</ul>
</li>
<li>Follow <strong>conventions</strong> to <strong>populate attributes</strong>.</li>
</ol>
<blockquote>
<p>The following example shows how to instrument a Java application:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Tracer</span> <span class="variable">tracer</span> <span class="operator">=</span>  getTracer(TracerProvider.noop());</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setTracerProvider</span><span class="params">(TracerProvider tracerProvider)</span> &#123;</span><br><span class="line">    tracer = getTracer(tracerProvider);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Tracer <span class="title function_">getTracer</span><span class="params">(TracerProvider tracerProvider)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> tracerProvider.getTracer(<span class="string">&quot;demo-db-client&quot;</span>, <span class="string">&quot;0.1.0-beta1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Response <span class="title function_">selectWithTracing</span><span class="params">(Query query)</span> &#123;</span><br><span class="line">    <span class="comment">// check out conventions for guidance on span names and attributes</span></span><br><span class="line">    <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(String.format(<span class="string">&quot;SELECT %s.%s&quot;</span>, dbName, collectionName))</span><br><span class="line">            .setSpanKind(SpanKind.CLIENT)</span><br><span class="line">            .setAttribute(<span class="string">&quot;db.name&quot;</span>, dbName)</span><br><span class="line">            ...</span><br><span class="line">            .startSpan();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// makes span active and allows correlating logs and nest spans</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">unused</span> <span class="operator">=</span> span.makeCurrent()) &#123;</span><br><span class="line">        <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> query.runWithRetries();</span><br><span class="line">        <span class="keyword">if</span> (response.isSuccessful()) &#123;</span><br><span class="line">            span.setStatus(StatusCode.OK);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (span.isRecording()) &#123;</span><br><span class="line">           <span class="comment">// populate response attributes for response codes and other information</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        span.recordException(e);</span><br><span class="line">        span.setStatus(StatusCode.ERROR, e.getClass().getSimpleName());</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        span.end();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Nested-network-and-other-spans"><a href="#Nested-network-and-other-spans" class="headerlink" title="Nested network and other spans"></a>Nested network and other spans</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/nested-spans.svg" alt="nested-spans"></p>
<ol>
<li><strong>Network calls</strong> are usually <strong>traced</strong> with <strong>OpenTelemetry auto-instrumentations</strong> through corresponding <strong>client implementation</strong>.</li>
<li>If OpenTelemetry <strong>does not support tracing</strong> your <strong>network client</strong>, here are some considerations to help you decide the best course of action:<ul>
<li>Would tracing network calls improve <strong>observability</strong> for users or your <strong>ability</strong> to support them?</li>
<li>Is your library a <strong>wrapper</strong> on top of <strong>public, documented RPC API</strong>? <ul>
<li>Would users need to get support from the <strong>underlying service</strong> in case of issues?</li>
<li><strong>Instrument the library</strong> and make sure to trace <strong>individual network</strong> tries.</li>
</ul>
</li>
<li>Would tracing those calls with <strong>spans</strong> be <strong>very verbose</strong>? or would it <strong>noticeably impact performance</strong>?<ul>
<li>Use <strong>logs with verbosity</strong> or <strong>span events</strong><ul>
<li><strong>logs</strong> can be <strong>correlated</strong> to <strong>parent</strong> (public API calls)</li>
<li>while <strong>span events</strong> should be <strong>set on public API span</strong>.</li>
</ul>
</li>
<li>If they <strong>have to be spans</strong> (to <strong>carry and propagate unique trace context</strong>)<ul>
<li>put them <strong>behind a configuration option</strong> and <strong>disable them by default</strong>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>If OpenTelemetry already supports tracing your <strong>network calls</strong>, you probably don’t want to <strong>duplicate</strong> it. There might be some <strong>exceptions</strong>:<ul>
<li>To support users <strong>without auto-instrumentation</strong><ul>
<li>which might <strong>not work in certain environments</strong> or when users have <strong>concerns</strong> with <strong>monkey-patching</strong>.</li>
</ul>
</li>
<li>To enable <strong>custom or legacy correlation and context propagation protocols</strong> with <strong>underlying service</strong>.</li>
<li><strong>Enrich RPC spans</strong> with essential library or service-specific information <strong>not covered</strong> by <strong>auto-instrumentation</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>A <strong>generic solution</strong> to <strong>avoid duplication</strong> is <strong>under construction</strong>.</p>
</blockquote>
<h5 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h5><ol>
<li><strong>Traces</strong> are a kind of <strong>signal</strong> that your apps can emit. <strong>Events</strong> (or <strong>logs</strong>) and <strong>traces</strong> complement, <strong>not duplicate</strong>, each other.<ul>
<li>Whenever you have something that should have <strong>a certain level of verbosity</strong>, logs are a <strong>better choice</strong> than traces.</li>
</ul>
</li>
<li>If your app uses logging or some similar module, the <strong>logging module</strong> might already have <strong>OpenTelemetry integration</strong>.<ul>
<li>To find out, see the registry. - <a target="_blank" rel="noopener" href="https://opentelemetry.io/ecosystem/registry/">https://opentelemetry.io/ecosystem/registry/</a></li>
<li>Integrations usually stamp <strong>active trace context on all logs</strong>, so users can <strong>correlate</strong> them.</li>
</ul>
</li>
<li>If your language and ecosystem don’t have <strong>common logging support</strong>, use <strong>span events</strong> to <strong>share additional app details</strong>.<ul>
<li><strong>Events</strong> maybe <strong>more convenient</strong> if you want to add <strong>attributes</strong> as well.</li>
</ul>
</li>
<li>As a rule of thumb, use <strong>events or logs for verbose data</strong> instead of <strong>spans</strong>.<ul>
<li><strong>Always attach events to the span instance</strong> that your instrumentation created. </li>
<li><strong>Avoid using the active span</strong> if you can, since you don’t control what it <strong>refers</strong> to.</li>
</ul>
</li>
</ol>
<h4 id="Context-propagation"><a href="#Context-propagation" class="headerlink" title="Context propagation"></a>Context propagation</h4><h5 id="Extracting-context"><a href="#Extracting-context" class="headerlink" title="Extracting context"></a>Extracting context</h5><ol>
<li>If you work on a <strong>library</strong> or a <strong>service</strong> that <strong>receives upstream calls</strong><ul>
<li>such as a <strong>web framework</strong> or a <strong>messaging consumer</strong>,extract context from the incoming request or message.</li>
</ul>
</li>
<li>OpenTelemetry provides the <strong>Propagator API</strong>, which <strong>hides specific propagation standards</strong> and <strong>reads the trace Context from the wire</strong>.<ul>
<li>In case of a <strong>single response</strong>, there is just <strong>one context on the wire</strong>, which becomes the <strong>parent</strong> of the <strong>new span</strong> the library creates.</li>
</ul>
</li>
<li>After you <strong>create a span</strong>, pass <strong>new trace context</strong> to the <strong>application code</strong> (callback or handler), by making the span <strong>active</strong>;<ul>
<li>if possible, do this <strong>explicitly</strong>.</li>
</ul>
</li>
<li>In the case of a <strong>messaging system</strong>, you might <strong>receive more than one message at once</strong>.<ul>
<li><strong>Received messages</strong> become <strong>links</strong> on the <strong>span</strong> you create.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following Java example shows how to <strong>add trace context</strong> and <strong>activate a span</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extract the context</span></span><br><span class="line"><span class="type">Context</span> <span class="variable">extractedContext</span> <span class="operator">=</span> propagator.extract(Context.current(), httpExchange, getter);</span><br><span class="line"><span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(<span class="string">&quot;receive&quot;</span>)</span><br><span class="line">            .setSpanKind(SpanKind.SERVER)</span><br><span class="line">            .setParent(extractedContext)</span><br><span class="line">            .startSpan();</span><br><span class="line"></span><br><span class="line"><span class="comment">// make span active so any nested telemetry is correlated</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">unused</span> <span class="operator">=</span> span.makeCurrent()) &#123;</span><br><span class="line">  userCode();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">  span.recordException(e);</span><br><span class="line">  span.setStatus(StatusCode.ERROR);</span><br><span class="line">  <span class="keyword">throw</span> e;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  span.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Injecting-context"><a href="#Injecting-context" class="headerlink" title="Injecting context"></a>Injecting context</h5><ol>
<li>When you make an <strong>outbound call</strong>, you usually want to <strong>propagate context</strong> to the <strong>downstream service</strong>.<ul>
<li>In this case, <strong>create a new span</strong> to <strong>trace the outgoing call</strong> and use <strong>Propagator API</strong> to <strong>inject context</strong> into the message.</li>
</ul>
</li>
<li>There might be other cases where you might want to inject context, for example when <strong>creating messages</strong> for <strong>async processing</strong>.</li>
</ol>
<blockquote>
<p>The following Java example shows how to <strong>propagate context</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(<span class="string">&quot;send&quot;</span>)</span><br><span class="line">            .setSpanKind(SpanKind.CLIENT)</span><br><span class="line">            .startSpan();</span><br><span class="line"></span><br><span class="line"><span class="comment">// make span active so any nested telemetry is correlated</span></span><br><span class="line"><span class="comment">// even network calls might have nested layers of spans, logs or events</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">unused</span> <span class="operator">=</span> span.makeCurrent()) &#123;</span><br><span class="line">  <span class="comment">// inject the context</span></span><br><span class="line">  propagator.inject(Context.current(), transportLayer, setter);</span><br><span class="line">  send();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">  span.recordException(e);</span><br><span class="line">  span.setStatus(StatusCode.ERROR);</span><br><span class="line">  <span class="keyword">throw</span> e;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  span.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>There might be some <strong>exceptions</strong> where you don’t need to propagate context</p>
</blockquote>
<ol>
<li><strong>Downstream service</strong> does not support <strong>metadata</strong> or <strong>prohibits unknown fields</strong>.</li>
<li><strong>Downstream service</strong> does not define <strong>correlation protocols</strong>.<ul>
<li>Consider adding support for <strong>context propagation</strong> in a future version.</li>
</ul>
</li>
<li><strong>Downstream service</strong> supports <strong>custom correlation protocol</strong>.<ul>
<li>Best effort with <strong>custom propagator</strong></li>
<li>use <strong>OpenTelemetry trace context</strong> if <strong>compatible</strong> or generate and stamp <strong>custom correlation IDs</strong> on the span.</li>
</ul>
</li>
</ol>
<h5 id="In-process"><a href="#In-process" class="headerlink" title="In-process"></a>In-process</h5><ol>
<li>Make your spans <strong>active</strong> or <strong>current</strong>, as this enables <strong>correlating</strong> spans with <strong>logs</strong> and <strong>any nested auto-instrumentations</strong>.</li>
<li>If the <strong>library</strong> has a <strong>notion of context</strong>, support optional <strong>explicit</strong> trace context propagation in addition to active spans. - <strong>Go</strong><ul>
<li>Put <strong>spans</strong> (trace context) created by library in the <strong>context</strong> explicitly, document how to access it.</li>
<li>Allow users to pass <strong>trace context</strong> in your <strong>context</strong>.</li>
</ul>
</li>
<li><strong>Within</strong> the library, <strong>propagate trace context explicitly</strong>. Active spans might <strong>change</strong> during <strong>callbacks</strong>.<ul>
<li><strong>Capture active context</strong> from users on the <strong>public API</strong> surface <strong>as soon as</strong> you can, use it as a <strong>parent context</strong> for your spans.</li>
<li><strong>Pass context around</strong> and stamp <strong>attributes</strong>, <strong>exceptions</strong>, <strong>events</strong> on <strong>explicitly propagated instances</strong>.</li>
<li>This is <strong>essential</strong> if you <strong>start threads explicitly</strong><ul>
<li>do <strong>background processing</strong> or other things that can <strong>break</strong> due to <strong>async context flow limitations</strong> in your language. - <strong>Java</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="Additional-considerations"><a href="#Additional-considerations" class="headerlink" title="Additional considerations"></a>Additional considerations</h5><blockquote>
<p>Instrumentation registry</p>
</blockquote>
<ol>
<li>Add your <strong>instrumentation library</strong> to the <strong>OpenTelemetry registry</strong> so users can find it.</li>
</ol>
<blockquote>
<p>Performance</p>
</blockquote>
<ol>
<li><strong>OpenTelemetry API</strong> is <strong>no-op</strong> and <strong>very performant</strong> when there is <strong>no SDK</strong> in the application.</li>
<li>When OpenTelemetry <strong>SDK</strong> is configured, it <strong>consumes bound resources</strong>.</li>
<li><strong>Real-life applications</strong>, especially on the <strong>high scale</strong>, would frequently have <strong>head-based sampling</strong> configured.</li>
<li><strong>Sampled-out spans</strong> are <strong>affordable</strong><ul>
<li>and you can <strong>check</strong> if the <strong>span</strong> is <strong>recording</strong> to avoid <strong>extra allocations</strong> and <strong>potentially expensive calculations</strong> while <strong>populating attributes</strong>.</li>
</ul>
</li>
<li>The following Java example shows to <strong>provide attributes for sampling</strong> and <strong>check span recording</strong>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// some attributes are important for sampling, they should be provided at creation time</span></span><br><span class="line"><span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(String.format(<span class="string">&quot;SELECT %s.%s&quot;</span>, dbName, collectionName))</span><br><span class="line">        .setSpanKind(SpanKind.CLIENT)</span><br><span class="line">        .setAttribute(<span class="string">&quot;db.name&quot;</span>, dbName)</span><br><span class="line">        ...</span><br><span class="line">        .startSpan();</span><br><span class="line"></span><br><span class="line"><span class="comment">// other attributes, especially those that are expensive to calculate</span></span><br><span class="line"><span class="comment">// should be added if span is recording</span></span><br><span class="line"><span class="keyword">if</span> (span.isRecording()) &#123;</span><br><span class="line">    span.setAttribute(<span class="string">&quot;db.statement&quot;</span>, sanitize(query.statement()))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Error handling</p>
</blockquote>
<ol>
<li><strong>OpenTelemetry API</strong> does <strong>not fail</strong> on <strong>invalid arguments</strong>, never throws, and <strong>swallows exceptions</strong>, which means it’s <strong>forgiving at runtime</strong>.</li>
<li>This way <strong>instrumentation issues do not affect application logic</strong>. Test the instrumentation to notice issues OpenTelemetry <strong>hides at runtime</strong>.</li>
</ol>
<blockquote>
<p>Testing</p>
</blockquote>
<ol>
<li>Since OpenTelemetry has a <strong>variety</strong> of <strong>auto-instrumentations</strong>, try how your instrumentation <strong>interacts</strong> with <strong>other telemetry</strong><ul>
<li><strong>incoming requests</strong>, <strong>outgoing requests</strong>, <strong>logs</strong>, and so on.</li>
</ul>
</li>
<li>Use a <strong>typical application</strong>, with <strong>popular frameworks and libraries</strong> and <strong>all tracing enabled</strong> when trying out your instrumentation.</li>
<li>For <strong>unit testing</strong>, you can usually <strong>mock</strong> or fake <strong>SpanProcessor</strong> and <strong>SpanExporter</strong> as in the following Java example:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkInstrumentation</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">SpanExporter</span> <span class="variable">exporter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestExporter</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">Tracer</span> <span class="variable">tracer</span> <span class="operator">=</span> OpenTelemetrySdk.builder()</span><br><span class="line">           .setTracerProvider(SdkTracerProvider.builder()</span><br><span class="line">              .addSpanProcessor(SimpleSpanProcessor.create(exporter)).build()).build()</span><br><span class="line">           .getTracer(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">  <span class="comment">// run test ...</span></span><br><span class="line"></span><br><span class="line">  validateSpans(exporter.exportedSpans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestExporter</span> <span class="keyword">implements</span> <span class="title class_">SpanExporter</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> List&lt;SpanData&gt; exportedSpans = Collections.synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">export</span><span class="params">(Collection&lt;SpanData&gt; spans)</span> &#123;</span><br><span class="line">    exportedSpans.addAll(spans);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><blockquote>
<p>OpenTelemetry 让你无需使用<strong>特定供应商</strong>的 SDK 和工具就能<strong>生成</strong>和<strong>导出</strong>遥测数据 - <strong>避免厂商锁定</strong></p>
</blockquote>
<h3 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h3><blockquote>
<p>本节说明了针对所有实现的跨语言<strong>要求</strong>和<strong>期望</strong>。除了<strong>术语定义</strong>之外，规范还定义了以下内容</p>
</blockquote>
<table>
<thead>
<tr>
<th>Component</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>API</strong></td>
<td><strong>定义</strong>了用于<strong>生成</strong>和<strong>关联</strong>跟踪、指标和日志数据的<strong>数据类型</strong>和<strong>操作</strong></td>
</tr>
<tr>
<td><strong>SDK</strong></td>
<td>定义了 API <strong>特定语言实现</strong>的要求 - <strong>配置</strong>、<strong>数据处理</strong>和<strong>导出</strong>概念也在这里定义</td>
</tr>
<tr>
<td><strong>数据</strong></td>
<td>定义了 OpenTelemetry 协议（<strong>OTLP</strong>）和<strong>与供应商无关的</strong>、遥测后端可以提供支持的<strong>语义约定</strong></td>
</tr>
</tbody></table>
<h3 id="Collector"><a href="#Collector" class="headerlink" title="Collector"></a>Collector</h3><ol>
<li>OpenTelemetry Collector 是一个<strong>与供应商无关</strong>的<strong>代理</strong>，可以<strong>接收</strong>、<strong>处理</strong>和<strong>导出</strong>遥测数据</li>
<li>支持以<strong>多种格式</strong>接收遥测数据（例如 <strong>OTLP</strong>、<strong>Jaeger</strong>、<strong>Prometheus</strong> 以及许多商业&#x2F;专有工具）并将数据发送到一个或<strong>多个后端</strong></li>
<li>支持在导出之前<strong>处理</strong>和<strong>过滤</strong>遥测数据</li>
</ol>
<h3 id="API-SDK"><a href="#API-SDK" class="headerlink" title="API + SDK"></a>API + SDK</h3><ol>
<li>OpenTelemetry 还提供<strong>语言 SDK</strong>，允许你使用所选语言的 <strong>OpenTelemetry API</strong> 生成遥测数据，并将这些数据导出到首选后端</li>
<li>这些 SDK 还允许你结合<strong>常见库和框架的插桩库</strong>，以便你可以将其用于应用程序中的<strong>手动插桩</strong></li>
</ol>
<h3 id="插桩库"><a href="#插桩库" class="headerlink" title="插桩库"></a>插桩库</h3><ol>
<li>OpenTelemetry 支持通过大量组件来为所支持的语言根据<strong>流行的库和框架</strong>生成相关遥测数据</li>
<li>来自 <strong>HTTP 库</strong>的<strong>入站</strong>和<strong>出站</strong> HTTP 请求将生成有关这些请求的数据</li>
<li>让<strong>流行的库</strong>能够<strong>开箱即用</strong>地进行<strong>观测</strong>而无需拉入独立的组件中是一个长期目标</li>
</ol>
<h3 id="导出器"><a href="#导出器" class="headerlink" title="导出器"></a>导出器</h3><ol>
<li>Send <strong>telemetry</strong> to the <strong>OpenTelemetry Collector</strong> to make sure it’s <strong>exported correctly</strong>.</li>
<li>Using the <strong>Collector</strong> in <strong>production environments</strong> is a <strong>best practice</strong>.</li>
<li>To <strong>visualize</strong> your <strong>telemetry</strong>, export it to a <strong>backend</strong> such as <strong>Jaeger</strong>, <strong>Zipkin</strong>, <strong>Prometheus</strong>, or a vendor-specific backend.</li>
<li>Among exporters, <strong>OTLP</strong> exporters are designed with the <strong>OpenTelemetry data model</strong> in mind, emitting OTel data <strong>without any loss of information</strong>.</li>
<li>many tools that operate on <strong>telemetry data</strong> support <strong>OTLP</strong> (such as <strong>Prometheus</strong>, <strong>Jaeger</strong>, and <strong>most vendors</strong>)<ul>
<li>providing you with a <strong>high degree of flexibility</strong> when you need it.</li>
</ul>
</li>
</ol>
<h3 id="零代码插桩"><a href="#零代码插桩" class="headerlink" title="零代码插桩"></a>零代码插桩</h3><ol>
<li>如果适用，OpenTelemetry 的<strong>特定语言实现</strong>将提供一种<strong>无需修改源代码</strong>即可对应用程序进行插桩的方法</li>
<li>虽然<strong>底层机制</strong>取决于使用的语言，但至少会将 <strong>OpenTelemetry API 和 SDK 能力</strong>添加到你的<strong>应用程序</strong>中</li>
<li>此外，它们还可能添加一组<strong>插桩库</strong>和<strong>导出器</strong>依赖项</li>
</ol>
<h3 id="资源检测器"><a href="#资源检测器" class="headerlink" title="资源检测器"></a>资源检测器</h3><ol>
<li>资源以<strong>资源属性</strong>表示<strong>生成遥测数据</strong>的<strong>实体</strong><ul>
<li>在 <strong>Kubernetes</strong> 上运行的<strong>容器</strong>中<strong>生成遥测数据</strong>的<strong>进程</strong>具有 <strong>Pod 名称</strong>、<strong>命名空间</strong>和可能的 <strong>Deployment 名称</strong> - 这三个属性都可以包含在<strong>资源</strong>中</li>
</ul>
</li>
<li><strong>特定语言实现</strong>提供了从环境变量 <strong>OTEL_RESOURCE_ATTRIBUTES</strong> 和许多<strong>常见实体</strong>（如<strong>进程运行时</strong>、<strong>服务</strong>、<strong>主机</strong>或<strong>操作系统</strong>）中<strong>检测资源</strong>的功能</li>
</ol>
<h3 id="跨服务传播器"><a href="#跨服务传播器" class="headerlink" title="跨服务传播器"></a>跨服务传播器</h3><ol>
<li><strong>传播</strong>是一种用于<strong>跨服务和进程边界</strong>传递信息的机制</li>
<li>虽然<strong>不限于跟踪</strong>，但它是允许<strong>跟踪</strong>在<strong>跨越进程和网络边界的服务</strong>中建立<strong>系统因果关系</strong>的信息</li>
<li>对于绝大多数场景，<strong>上下文传播</strong>是通过<strong>插桩库</strong>为你完成的<ul>
<li>但如果需要，你可以自己使用 <strong>Propagators</strong> 来<strong>序列化和反序列化跨领域的关注点</strong>， 例如 <strong>span 的上下文</strong>和 <strong>baggage</strong></li>
</ul>
</li>
</ol>
<h3 id="采样器"><a href="#采样器" class="headerlink" title="采样器"></a>采样器</h3><ol>
<li>采样是<strong>限制系统生成跟踪数量</strong>的过程，特定语言的实现提供了几种<strong>头部采样器</strong></li>
</ol>
<h3 id="K8s-Operator"><a href="#K8s-Operator" class="headerlink" title="K8s Operator"></a>K8s Operator</h3><ol>
<li>OpenTelemetry Operator 是 <strong>Kubernetes Operator</strong> 的一种实现</li>
<li>Operator <strong>管理 OpenTelemetry Collector</strong> 以及使用 OpenTelemetry <strong>对工作负载进行自动插桩</strong></li>
</ol>
<h3 id="函数即服务资产"><a href="#函数即服务资产" class="headerlink" title="函数即服务资产"></a>函数即服务资产</h3><ol>
<li>OpenTelemetry 支持多种由<strong>不同云服务商</strong>提供的<strong>函数即服务</strong>的<strong>监控方法</strong></li>
<li>社区目前提供<strong>预构建的 Lambda 层</strong>，能够<strong>自动对你的应用进行插桩</strong>， 另外在<strong>手动或自动对应用进行插桩</strong>时可以使用的<strong>独立 Collector Lambda 层</strong>选项</li>
</ol>
<h2 id="语义约定"><a href="#语义约定" class="headerlink" title="语义约定"></a>语义约定</h2><ol>
<li>OpenTelemetry 定义了语义约定， 为不同类型的<strong>操作</strong>和<strong>数据</strong>指定<strong>通用名称</strong></li>
<li>使用语义约定的好处是<strong>遵循通用的命名方案</strong>，可以在代码库、库和平台之间实现<strong>标准化</strong></li>
<li>语义约定适用于<strong>链路追踪</strong>、<strong>指标</strong>、<strong>日志</strong>和<strong>资源</strong></li>
</ol>
<h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><ol>
<li>A resource represents the <strong>entity producing telemetry</strong> as <strong>resource attributes</strong>.</li>
<li>For example, a process producing telemetry that is running in a <strong>container</strong> on <strong>Kubernetes</strong><ul>
<li>has a <strong>process name</strong>, a <strong>pod name</strong>, a <strong>namespace</strong>, and possibly a <strong>deployment name</strong>.</li>
<li>All four of these attributes can be included in the resource.</li>
</ul>
</li>
<li>In your <strong>observability backend</strong>, you can use <strong>resource information</strong> to better investigate interesting behavior.<ul>
<li>if your <strong>trace</strong> or <strong>metrics</strong> data indicate <strong>latency</strong> in your system, you can <strong>narrow it down</strong> to a specific <strong>container</strong>, <strong>pod</strong>, or Kubernetes <strong>deployment</strong>.</li>
</ul>
</li>
<li>A <strong>resource</strong> is <strong>added</strong> to the <strong>TraceProvider</strong> or <strong>MetricProvider</strong> when they are <strong>created during initialization</strong>. This <strong>association cannot be changed later</strong>. <ul>
<li>After a resource is added, all <strong>spans</strong> and <strong>metrics</strong> produced from a <strong>Tracer</strong> or <strong>Meter</strong> from the <strong>provider</strong> will have the <strong>resource associated</strong> with them.</li>
</ul>
</li>
</ol>
<blockquote>
<p>If you use <strong>Jaeger</strong> as your observability backend, <strong>resource attributes</strong> are grouped under the <strong>Process</strong> tab</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/screenshot-jaeger-resources.png" alt="screenshot-jaeger-resources"></p>
<h3 id="Semantic-Attributes-with-SDK-provided-Default-Value"><a href="#Semantic-Attributes-with-SDK-provided-Default-Value" class="headerlink" title="Semantic Attributes with SDK-provided Default Value"></a>Semantic Attributes with SDK-provided Default Value</h3><ol>
<li>There are <strong>attributes</strong> provided by the <strong>OpenTelemetry SDK</strong>.</li>
<li>One of them is the <strong>service.name</strong>, which represents the <strong>logical name</strong> of the <strong>service</strong>.<ul>
<li>By default, <strong>SDKs</strong> will assign the value <strong>unknown_service</strong> for this value</li>
<li>so it is recommended to <strong>set it explicitly</strong>, either <strong>in code</strong> or via setting the <strong>environment</strong> variable <strong>OTEL_SERVICE_NAME</strong>.</li>
</ul>
</li>
<li>Additionally, the <strong>SDK</strong> will also provides the following <strong>resource attributes</strong> to <strong>identify itself</strong><ul>
<li><strong>telemetry.sdk.name</strong></li>
<li><strong>telemetry.sdk.language</strong></li>
<li><strong>telemetry.sdk.version</strong></li>
</ul>
</li>
</ol>
<h3 id="Resource-Detectors"><a href="#Resource-Detectors" class="headerlink" title="Resource Detectors"></a>Resource Detectors</h3><ol>
<li>Most language-specific SDKs provide a set of resource detectors that can be used to <strong>automatically</strong> detect resource information from the environment.</li>
<li>Common resource detectors include<ul>
<li><strong>Operating System</strong></li>
<li><strong>Host</strong></li>
<li><strong>Process and Process Runtime</strong></li>
<li><strong>Container</strong></li>
<li><strong>Kubernetes</strong></li>
<li><strong>Cloud-Provider-Specific Attributes</strong></li>
</ul>
</li>
</ol>
<h3 id="Custom-resources"><a href="#Custom-resources" class="headerlink" title="Custom resources"></a>Custom resources</h3><ol>
<li>You can also provide your own resource attributes.</li>
<li>You can either provide them <strong>in code</strong> or via populating the <strong>environment</strong> variable <strong>OTEL_RESOURCE_ATTRIBUTES</strong>. </li>
<li>If applicable, use the <strong>semantic conventions</strong> for <strong>your resource attributes</strong>.</li>
<li>For example, you can provide the name of your deployment environment using <strong>deployment.environment</strong></li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env</span> <span class="string">OTEL_RESOURCE_ATTRIBUTES=deployment.environment=production yourApp</span></span><br></pre></td></tr></table></figure>

<h2 id="Instrumentation-scope"><a href="#Instrumentation-scope" class="headerlink" title="Instrumentation scope"></a>Instrumentation scope</h2><ol>
<li>The Instrumentation scope represents a <strong>logical unit</strong> within the <strong>application code</strong> with which the <strong>emitted telemetry</strong> can be <strong>associated</strong>.</li>
<li><strong>Developers</strong> can <strong>decide</strong> what denotes a <strong>reasonable</strong> instrumentation scope.<ul>
<li>For example, they can select a <strong>module</strong>, a <strong>package</strong>, or a <strong>class</strong> as the instrumentation scope.</li>
<li>In the case of a <strong>library</strong> or <strong>framework</strong>, a <strong>common approach</strong> is to use an <strong>identifier</strong> as scope that is <strong>unique</strong> to the library or framework<ul>
<li>such as a <strong>fully qualified name and version</strong> of the library or framework.</li>
</ul>
</li>
<li>If the <strong>library</strong> itself doesn’t have <strong>built-in OpenTelemetry instrumentation</strong>, and an <strong>instrumentation library</strong> is used instead<ul>
<li>use the <strong>name and version</strong> of the <strong>instrumentation library</strong> as the instrumentation scope.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>instrumentation scope</strong> is <strong>defined</strong> by a <strong>name and version pair</strong> when a <strong>tracer</strong>, <strong>meter</strong> or <strong>logger</strong> instance is obtained from a <strong>provider</strong>.<ul>
<li>Each <strong>span</strong>, <strong>metric</strong>, or <strong>log record</strong> created by the instance is then associated with the <strong>provided instrumentation scope</strong>.</li>
</ul>
</li>
<li>In your <strong>observability backend</strong>, <strong>scoping</strong> allows you to <strong>slice and dice your telemetry data</strong> by <strong>scope</strong><ul>
<li>for example to see which of your users are using which version of a library</li>
<li>what the performance of that library version is</li>
<li>to pin point a problem to a specific module of your application.</li>
</ul>
</li>
<li>The following diagram illustrates a <strong>trace</strong> with <strong>multiple instrumentation scopes</strong>. The <strong>different scopes</strong> are represented by <strong>different colors</strong><ul>
<li>At the top the <strong>&#x2F;api&#x2F;placeOrder</strong> span is generated by the used <strong>HTTP framework</strong>.</li>
<li>The spans in green (CheckoutService::placeOrder, prepareOrderItems and checkout) are <strong>application code</strong>, grouped by the <strong>CheckoutService</strong> class.</li>
<li>The spans for CartService::getCart and ProductService::getProduct are also <strong>application code</strong><ul>
<li>grouped by the <strong>CartService</strong> and <strong>ProductService</strong> classes.</li>
</ul>
</li>
<li>The spans in orange (Cache::find) and light blue (DB::query) are <strong>library code</strong>, grouped by the <strong>library name and version</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/spans-with-instrumentation-scope.svg" alt="spans-with-instrumentation-scope"></p>
<h2 id="Sampling"><a href="#Sampling" class="headerlink" title="Sampling"></a>Sampling</h2><blockquote>
<p>Learn about <strong>sampling</strong> and the <strong>different sampling options</strong> available in OpenTelemetry.</p>
</blockquote>
<ol>
<li>With <strong>traces</strong>, you can <strong>observe requests</strong> as they <strong>move from one service to another</strong> in a <strong>distributed system</strong>.</li>
<li><strong>Tracing</strong> is <strong>highly practical</strong> for both <strong>high-level and in-depth analysis</strong> of systems.</li>
<li>However, if the <strong>large majority</strong> of your <strong>requests</strong> are <strong>successful</strong> and finish with <strong>acceptable latency</strong> and <strong>no errors</strong><ul>
<li>you do not need <strong>100%</strong> of your <strong>traces</strong> to meaningfully observe your applications and systems. You just need the <strong>right sampling</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/traces-venn-diagram.svg" alt="traces-venn-diagram"></p>
<h3 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h3><ol>
<li>It’s important to use <strong>consistent terminology</strong> when discussing sampling.</li>
<li>A <strong>trace</strong> or <strong>span</strong> is considered “<strong>sampled</strong>” or “<strong>not sampled</strong>”<ul>
<li><strong>Sampled</strong><ul>
<li>A <strong>trace</strong> or <strong>span</strong> is <strong>processed</strong> and <strong>exported</strong>.</li>
<li>Because it is <strong>chosen</strong> by the <strong>sampler</strong> as a <strong>representative</strong> of the population, it is considered “sampled”.</li>
</ul>
</li>
<li><strong>Not sampled</strong><ul>
<li>A trace or span is <strong>not processed or exported</strong>.</li>
<li>Because it is <strong>not chosen</strong> by the <strong>sampler</strong>, it is considered “not sampled”.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Why-sampling"><a href="#Why-sampling" class="headerlink" title="Why sampling?"></a>Why sampling?</h3><ol>
<li><strong>Sampling</strong> is one of the <strong>most effective ways</strong> to <strong>reduce the costs of observability without losing visibility</strong>.<ul>
<li>Although there are other ways to <strong>lower costs</strong>, such as <strong>filtering</strong> or <strong>aggregating</strong> data</li>
<li>these other methods <strong>do not adhere</strong> to the <strong>concept</strong> of <strong>representativeness</strong><ul>
<li>which is <strong>crucial</strong> when performing <strong>in-depth analysis</strong> of application or system behavior.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Representativeness</strong> is the <strong>principle</strong> that a <strong>smaller group</strong> can <strong>accurately represent</strong> a <strong>larger group</strong>.<ul>
<li>Additionally, <strong>representativeness</strong> can be <strong>mathematically verified</strong></li>
<li>meaning that you can have <strong>high confidence</strong> that a smaller sample of data <strong>accurately represents</strong> the larger group.</li>
</ul>
</li>
<li>Additionally, the <strong>more data</strong> you <strong>generate</strong>, the <strong>less data</strong> you <strong>actually need</strong> to have a <strong>representative sample</strong>.<ul>
<li>For <strong>high-volume systems</strong>, is quite common for a sampling rate of <strong>1% or lower</strong> to very <strong>accurately represent</strong> the other <strong>99%</strong> of data.</li>
</ul>
</li>
</ol>
<h4 id="When-to-sample"><a href="#When-to-sample" class="headerlink" title="When to sample"></a>When to sample</h4><ol>
<li>Consider <strong>sampling</strong> if you meet <strong>any</strong> of the following criteria:<ul>
<li>You generate <strong>1000 or more traces per second</strong>.</li>
<li><strong>Most</strong> of your <strong>trace data</strong> represents <strong>healthy traffic</strong> with <strong>little variation</strong> in data.</li>
<li>You have some <strong>common criteria</strong>, like <strong>errors</strong> or <strong>high latency</strong>, that usually means <strong>something is wrong</strong>.</li>
<li>You have <strong>domain-specific criteria</strong> you can use to <strong>determine</strong> relevant data <strong>beyond errors and latency</strong>.</li>
<li>You can describe some <strong>common rules</strong> that determine if data should be <strong>sampled</strong> or <strong>dropped</strong>.</li>
<li>You have a way to <strong>tell your services apart</strong>, so that <strong>high- and low-volume services</strong> are <strong>sampled differently</strong>.</li>
<li>You have the ability to route <strong>unsampled data</strong> (for “just in case” scenarios) to <strong>low-cost storage systems</strong>.</li>
</ul>
</li>
<li>Finally, consider your <strong>overall budget</strong>.<ul>
<li>If you have <strong>limited budget</strong> for <strong>observability</strong>, but can <strong>afford</strong> to <strong>spend time</strong> to <strong>effectively sample</strong>, then <strong>sampling</strong> can generally be worth it.</li>
</ul>
</li>
</ol>
<h4 id="When-not-to-sample"><a href="#When-not-to-sample" class="headerlink" title="When not to sample"></a>When not to sample</h4><ol>
<li><strong>Sampling</strong> might <strong>not</strong> be <strong>appropriate</strong> for you. You might want to <strong>avoid sampling</strong> if you meet <strong>any</strong> of the following criteria:<ul>
<li>You generate <strong>very little data</strong> (tens of small traces per second or lower).</li>
<li>You <strong>only</strong> use <strong>observability data</strong> in <strong>aggregate</strong>, and can thus <strong>pre-aggregate</strong> data.</li>
<li>You are <strong>bound</strong> by circumstances such as <strong>regulation that prohibit dropping data</strong> (and <strong>cannot route unsampled data to low-cost storage</strong>).</li>
</ul>
</li>
<li>Finally, consider the following three <strong>costs</strong> associated with <strong>sampling</strong>:<ul>
<li>The <strong>direct cost</strong> of <strong>compute to effectively sample data</strong>, such as a <strong>tail sampling proxy</strong>.</li>
<li>The <strong>indirect engineering cost</strong> of <strong>maintaining effective sampling methodologies</strong> as <strong>more application, systems, and data</strong> are involved.</li>
<li>The <strong>indirect opportunity cost</strong> of <strong>missing critical information</strong> with <strong>ineffective sampling techniques</strong>.</li>
</ul>
</li>
<li><strong>Sampling</strong>, while <strong>effective</strong> at <strong>reducing observability costs</strong>, might <strong>introduce other unexpected costs</strong> if <strong>not performed well</strong>.<ul>
<li>It could be <strong>cheaper</strong> to <strong>allocate more resources</strong> for <strong>observability</strong> instead, either with a <strong>vendor</strong> or <strong>compute when self-hosting</strong></li>
<li>depending on your <strong>observability backend</strong>, the <strong>nature of your data</strong>, and your attempts to <strong>sample effectively</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Head-Sampling"><a href="#Head-Sampling" class="headerlink" title="Head Sampling"></a>Head Sampling</h3><ol>
<li>Head sampling is a sampling technique used to make a sampling decision <strong>as early as possible</strong>.<ul>
<li>A decision to <strong>sample</strong> or <strong>drop</strong> a span or trace is <strong>not</strong> made by <strong>inspecting</strong> the <strong>trace</strong> as a <strong>whole</strong>.</li>
</ul>
</li>
<li>For example, the <strong>most common form</strong> of head sampling is <strong>Consistent Probability Sampling</strong>. <ul>
<li>This is also be referred to as <strong>Deterministic Sampling</strong>.</li>
<li>In this case, a sampling decision is made based on the <strong>trace ID</strong> and the <strong>desired percentage</strong> of <strong>traces</strong> to <strong>sample</strong>.</li>
<li>This ensures that <strong>whole traces</strong> are sampled - <strong>no missing spans</strong> - at a <strong>consistent rate</strong>, such as <strong>5% of all traces</strong></li>
</ul>
</li>
<li>The <strong>upsides</strong> to <strong>head sampling</strong> are:<ul>
<li>Easy to <strong>understand</strong></li>
<li>Easy to <strong>configure</strong></li>
<li><strong>Efficient</strong></li>
<li>Can be done at <strong>any point</strong> in the <strong>trace collection pipeline</strong></li>
</ul>
</li>
<li>The <strong>primary downside</strong> to <strong>head sampling</strong> is that it is <strong>not possible</strong> to <strong>make a sampling decision</strong> based on data in the <strong>entire trace</strong>.<ul>
<li>For example, you <strong>cannot ensure</strong> that <strong>all traces with an error</strong> within them are <strong>sampled</strong> with head sampling <strong>alone</strong>.</li>
<li>For this situation and many others, you need <strong>tail sampling</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Tail-Sampling"><a href="#Tail-Sampling" class="headerlink" title="Tail Sampling"></a>Tail Sampling</h3><ol>
<li>Tail sampling is where the decision to sample a trace takes place by considering <strong>all or most</strong> of the <strong>spans</strong> within the trace.</li>
<li><strong>Tail Sampling</strong> gives you the <strong>option</strong> to sample your traces based on <strong>specific criteria</strong> derived from <strong>different parts of a trace</strong><ul>
<li>which <strong>isn’t an option</strong> with <strong>Head Sampling</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/tail-sampling-process.svg" alt="tail-sampling-process"></p>
<ol>
<li>Some examples of how you can use Tail Sampling include:<ul>
<li>Always sampling traces that contain an <strong>error</strong></li>
<li>Sampling traces based on <strong>overall latency</strong></li>
<li>Sampling traces based on the <strong>presence</strong> or <strong>value</strong> of <strong>specific attributes</strong> on <strong>one or more spans</strong> in a <strong>trace</strong><ul>
<li>for example, sampling more traces originating from a newly deployed service</li>
</ul>
</li>
<li>Applying <strong>different sampling rates</strong> to traces based on <strong>certain criteria</strong><ul>
<li>such as when traces <strong>only</strong> come from <strong>low-volume services</strong> versus traces with <strong>high-volume services</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>As you can see, tail sampling allows for a much <strong>higher degree of sophistication</strong> in how you sample data.</li>
<li>For <strong>larger systems</strong> that <strong>must sample telemetry</strong><ul>
<li>it is almost always necessary to use <strong>Tail Sampling</strong> to balance <strong>data volume</strong> with the <strong>usefulness of that data</strong>.</li>
</ul>
</li>
<li>There are three <strong>primary downsides</strong> to <strong>tail sampling</strong> today:<ul>
<li>Tail sampling can be <strong>difficult</strong> to <strong>implement</strong>.<ul>
<li>Depending on the kind of <strong>sampling techniques</strong> available to you, it is not always a “<strong>set and forget</strong>” kind of thing.</li>
<li>As your <strong>systems change</strong>, so too will your <strong>sampling strategies</strong>.</li>
<li>For a <strong>large and sophisticated distributed system</strong>, rules that implement <strong>sampling strategies</strong> can also be <strong>large and sophisticated</strong>.</li>
</ul>
</li>
<li>Tail sampling can be <strong>difficult</strong> to <strong>operate</strong>.<ul>
<li>The component(s) that implement tail sampling must be <strong>stateful systems</strong> that can accept and store <strong>a large amount of data</strong>.</li>
<li>Depending on <strong>traffic patterns</strong>, this can require <strong>dozens</strong> or even <strong>hundreds</strong> of <strong>compute nodes</strong> that all <strong>utilize resources differently</strong>.</li>
<li>Furthermore, a <strong>tail sampler</strong> might need to “<strong>fall back</strong>” to <strong>less computationally intensive sampling techniques</strong><ul>
<li>if it is unable to <strong>keep up</strong> with the <strong>volume of data</strong> it is <strong>receiving</strong>.</li>
</ul>
</li>
<li>it is <strong>critical</strong> to <strong>monitor tail-sampling components</strong> to <strong>ensure</strong> that they have the <strong>resources</strong> they need to <strong>make</strong> the correct sampling <strong>decisions</strong>.</li>
</ul>
</li>
<li><strong>Tail samplers</strong> often <strong>end up</strong> as <strong>vendor-specific technology</strong> today.<ul>
<li>If you’re using a <strong>paid vendor</strong> for <strong>Observability</strong></li>
<li>the <strong>most effective tail sampling options</strong> available to you might be <strong>limited</strong> to what the <strong>vendor</strong> offers.</li>
</ul>
</li>
</ul>
</li>
<li>Finally, for some systems, <strong>tail sampling</strong> might be used in <strong>conjunction</strong> with <strong>Head Sampling</strong>.<ul>
<li>a set of services that <strong>produce an extremely high volume of trace data</strong> might first use <strong>head sampling</strong> to sample only a <strong>small percentage</strong> of traces</li>
<li>and then later in the <strong>telemetry pipeline</strong> use <strong>tail sampling</strong> to make <strong>more sophisticated sampling decisions</strong> before <strong>exporting</strong> to a <strong>backend</strong>.</li>
<li>This is often done in the interest of <strong>protecting</strong> the <strong>telemetry pipeline</strong> from being <strong>overloaded</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Support"><a href="#Support" class="headerlink" title="Support"></a>Support</h3><h4 id="Collector-1"><a href="#Collector-1" class="headerlink" title="Collector"></a>Collector</h4><blockquote>
<p>The <strong>OpenTelemetry Collector</strong> includes the following <strong>sampling processors</strong>:</p>
</blockquote>
<ol>
<li><strong>Probabilistic Sampling Processor</strong></li>
<li><strong>Tail Sampling Processor</strong></li>
</ol>
<h4 id="Language-SDKs"><a href="#Language-SDKs" class="headerlink" title="Language SDKs"></a>Language SDKs</h4><ol>
<li><a target="_blank" rel="noopener" href="https://opentelemetry.io/zh/docs/languages/go/sampling/">https://opentelemetry.io/zh/docs/languages/go/sampling/</a></li>
<li><a target="_blank" rel="noopener" href="https://opentelemetry.io/zh/docs/languages/js/sampling/">https://opentelemetry.io/zh/docs/languages/js/sampling/</a></li>
</ol>
<h4 id="Vendors"><a href="#Vendors" class="headerlink" title="Vendors"></a>Vendors</h4><ol>
<li>Many <strong>vendors</strong> offer <strong>comprehensive sampling solutions</strong><ul>
<li>that incorporate <strong>head sampling</strong>, <strong>tail sampling</strong>, and other features that can support <strong>sophisticated sampling needs</strong>.</li>
</ul>
</li>
<li>These solutions may also be <strong>optimized specifically</strong> for the <strong>vendor’s backend</strong>.</li>
<li>If you are sending <strong>telemetry</strong> to a <strong>vendor</strong>, consider using <strong>their sampling solutions</strong>.</li>
</ol>
<h2 id="Distributions"><a href="#Distributions" class="headerlink" title="Distributions"></a>Distributions</h2><blockquote>
<p>A distribution, not to be confused with a <strong>fork</strong>, is <strong>customized version</strong> of <strong>an OpenTelemetry component</strong>.</p>
</blockquote>
<ol>
<li>The OpenTelemetry projects consists of <strong>multiple components</strong> that support <strong>multiple signals</strong>.</li>
<li>Any <strong>reference implementation</strong> can be <strong>customized</strong> as a <strong>distribution</strong>.</li>
</ol>
<h3 id="What-is-a-distribution"><a href="#What-is-a-distribution" class="headerlink" title="What is a distribution?"></a>What is a distribution?</h3><ol>
<li>A distribution is a <strong>customized version</strong> of <strong>an OpenTelemetry component</strong>.</li>
<li>A distribution is a <strong>wrapper</strong> around an <strong>upstream OpenTelemetry repository</strong> with <strong>some customizations</strong>.<ul>
<li>Distributions are not to be confused with <strong>forks</strong>.</li>
</ul>
</li>
<li><strong>Customizations</strong> in a <strong>distribution</strong> may include:<ul>
<li><strong>Scripts</strong> to <strong>ease use</strong> or <strong>customize use</strong> for a <strong>specific backend</strong> or <strong>vendor</strong></li>
<li>Changes to <strong>default settings</strong> required for a backend, vendor, or end-user</li>
<li><strong>Additional packaging options</strong> that may be vendor or end-user specific</li>
<li><strong>Test</strong>, <strong>performance</strong>, and <strong>security coverage</strong> beyond what OpenTelemetry provides</li>
<li><strong>Additional capabilities</strong> beyond what OpenTelemetry provides</li>
<li><strong>Less capabilities</strong> from what OpenTelemetry provides</li>
</ul>
</li>
<li>Distributions broadly fall into the following <strong>categories</strong>:<ul>
<li><strong>Pure</strong><ul>
<li>These distributions provide the <strong>same functionality</strong> as <strong>upstream</strong> and are <strong>100% compatible</strong>.</li>
<li><strong>Customizations</strong> typically <strong>enhance</strong> the <strong>ease of use</strong> or <strong>packaging</strong>.</li>
<li>These customizations may be <strong>backend</strong>, <strong>vendor</strong>, or <strong>end-user</strong> specific.</li>
</ul>
</li>
<li><strong>Plus</strong><ul>
<li>These distributions provide <strong>added functionalities</strong> on top of upstream through <strong>additional components</strong>. </li>
<li>Examples include <em>instrumentation libraries</em> or <em>vendor exporters</em> <strong>not upstreamed</strong> to the OpenTelemetry project.</li>
</ul>
</li>
<li><strong>Minus</strong><ul>
<li>These distributions provide <strong>a subset of functionality</strong> from <strong>upstream</strong>.</li>
<li>Examples of this include the <strong>removal</strong> of<ul>
<li><strong>instrumentation libraries</strong></li>
<li><strong>receivers</strong>, <strong>processors</strong>, <strong>exporters</strong>, or <strong>extensions</strong> found in the <strong>OpenTelemetry Collector</strong> project.</li>
</ul>
</li>
<li>These distributions may be provided to increase <strong>supportability</strong> and <strong>security</strong> considerations.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Who-can-create-a-distribution"><a href="#Who-can-create-a-distribution" class="headerlink" title="Who can create a distribution?"></a>Who can create a distribution?</h3><ol>
<li><strong>Anyone</strong> can create a distribution. Today, several <strong>vendors</strong> offer <strong>distributions</strong>.</li>
<li><strong>end-users</strong> can consider <strong>creating a distribution</strong><ul>
<li>if they want to <strong>use components in the Registry</strong> that are <strong>not upstreamed</strong> to the <strong>OpenTelemetry project</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Contribution-or-distribution"><a href="#Contribution-or-distribution" class="headerlink" title="Contribution or distribution?"></a>Contribution or distribution?</h3><ol>
<li>Before you read on and learn how you can create your own distribution<ul>
<li>ask yourself if your additions on top of an OpenTelemetry component would be <strong>beneficial for everyone</strong></li>
<li>and therefore <strong>should be included</strong> in the <strong>reference implementations</strong>:</li>
</ul>
</li>
<li>Can your scripts for “ease of use” be <strong>generalized</strong>?</li>
<li>Can your changes to <strong>default settings</strong> be the <strong>better option</strong> for <strong>everyone</strong>?</li>
<li>Are your additional packaging options <strong>really specific</strong>?</li>
<li>Might your test, performance and security coverage work <strong>with the reference implementation as well</strong>?</li>
<li>Have you checked with the community if your additional capabilities could be <strong>part</strong> of the <strong>standard</strong>?</li>
</ol>
<h2 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h2><blockquote>
<p><strong>Definitions</strong> and <strong>conventions</strong> for <strong>telemetry terms</strong> as used in OpenTelemetry.</p>
</blockquote>
<ol>
<li>This glossary defines <strong>terms</strong> and <strong>concepts</strong> that are new to the OpenTelemetry project</li>
<li>and clarifies <strong>OpenTelemetry-specific uses of terms</strong> common in the observability field.</li>
</ol>
<h3 id="Aggregation-1"><a href="#Aggregation-1" class="headerlink" title="Aggregation"></a>Aggregation</h3><ol>
<li>The process of <strong>combining multiple measurements</strong> into <strong>exact or estimated statistics</strong> about the measurements<ul>
<li>that took place during an <strong>interval of time</strong>, during <strong>program execution</strong>.</li>
</ul>
</li>
<li>Used by the <strong>Metric Data source</strong>.</li>
</ol>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ol>
<li><strong>Application Programming Interface</strong>.</li>
<li>In the OpenTelemetry project, used to <strong>define</strong> how <strong>telemetry data</strong> is <strong>generated</strong> per <strong>Data source</strong>.</li>
</ol>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><ol>
<li>One or more <strong>Services</strong> designed for <strong>end users</strong> or <strong>other applications</strong>.</li>
</ol>
<h3 id="APM"><a href="#APM" class="headerlink" title="APM"></a>APM</h3><ol>
<li><strong>Application Performance Monitoring</strong> is about <strong>monitoring</strong> software applications</li>
<li>their <strong>performance</strong> (speed, reliability, availability, and so on) to <strong>detect issues</strong>, <strong>alerting</strong> and tooling for <strong>finding the root cause</strong>.</li>
</ol>
<h3 id="Attribute"><a href="#Attribute" class="headerlink" title="Attribute"></a>Attribute</h3><ol>
<li>OpenTelemetry term for <strong>Metadata</strong>.</li>
<li>Adds <strong>key-value information</strong> to the <strong>entity</strong> producing <strong>telemetry</strong>.</li>
<li>Used across <strong>Signals</strong> and <strong>Resources</strong></li>
</ol>
<h3 id="Automatic-instrumentation"><a href="#Automatic-instrumentation" class="headerlink" title="Automatic instrumentation"></a>Automatic instrumentation</h3><ol>
<li>Refers to <strong>telemetry collection methods</strong> that <strong>do not require the end-user to modify application’s source code</strong>.</li>
<li>Methods <strong>vary</strong> by programming language, and examples include <strong>bytecode injection</strong> or <strong>monkey patching</strong>.</li>
</ol>
<h3 id="Baggage-1"><a href="#Baggage-1" class="headerlink" title="Baggage"></a>Baggage</h3><ol>
<li>A mechanism for <strong>propagating Metadata</strong> to help <strong>establish</strong> a <strong>causal relationship</strong> between <strong>events</strong> and <strong>services</strong>.</li>
</ol>
<h3 id="Client-library"><a href="#Client-library" class="headerlink" title="Client library"></a>Client library</h3><ol>
<li>See <strong>Instrumented library</strong>.</li>
</ol>
<h3 id="Client-side-app"><a href="#Client-side-app" class="headerlink" title="Client-side app"></a>Client-side app</h3><ol>
<li>A component of an <strong>Application</strong> that is <strong>not running inside a private infrastructure</strong> and is typically <strong>used directly by end-users</strong>.</li>
<li>Examples of client-side apps are <strong>browser apps</strong>, <strong>mobile apps</strong>, and apps running on <strong>IoT devices</strong>.</li>
</ol>
<h3 id="Collector-2"><a href="#Collector-2" class="headerlink" title="Collector"></a>Collector</h3><ol>
<li>The OpenTelemetry Collector, or Collector for short, is a <strong>vendor-agnostic implementation</strong> on how to <strong>receive</strong>, <strong>process</strong>, and <strong>export</strong> telemetry data.</li>
<li>A <strong>single binary</strong> that can be deployed as an <strong>agent</strong> or <strong>gateway</strong>.</li>
<li><strong>Spelling</strong>: When referring to the OpenTelemetry Collector, <strong>always capitalize Collector</strong>. <ul>
<li>Use <strong>just “Collector”</strong> if you are using Collector as an <strong>adjective</strong> — for example, “<strong>Collector configuration</strong>”.</li>
</ul>
</li>
</ol>
<h3 id="Contrib"><a href="#Contrib" class="headerlink" title="Contrib"></a>Contrib</h3><blockquote>
<p>core - Instrumentation Libraries + Collector<br>non-core - vendor Exporter</p>
</blockquote>
<ol>
<li>Several <strong>Instrumentation Libraries</strong> and the <strong>Collector</strong> offer a set of <strong>core capabilities</strong></li>
<li>as well as a <strong>dedicated contrib repository</strong> for <strong>non-core capabilities</strong> including <strong>vendor Exporters</strong>.</li>
</ol>
<h3 id="Context-propagation-1"><a href="#Context-propagation-1" class="headerlink" title="Context propagation"></a>Context propagation</h3><ol>
<li>Allows all <strong>Data sources</strong> to <strong>share</strong> an <strong>underlying context mechanism</strong> for <strong>storing state</strong> and <strong>accessing data</strong> across the <strong>lifespan</strong> of a <strong>Transaction</strong>.</li>
</ol>
<h3 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h3><ol>
<li>Directed acyclic graph</li>
</ol>
<h3 id="Data-source"><a href="#Data-source" class="headerlink" title="Data source"></a>Data source</h3><ol>
<li>See <strong>Signal</strong></li>
</ol>
<h3 id="Dimension"><a href="#Dimension" class="headerlink" title="Dimension"></a>Dimension</h3><ol>
<li>A term used specifically by <strong>Metrics</strong>. See <strong>Attribute</strong>.</li>
</ol>
<h3 id="Distributed-tracing"><a href="#Distributed-tracing" class="headerlink" title="Distributed tracing"></a>Distributed tracing</h3><ol>
<li><strong>Tracks</strong> the <strong>progression</strong> of a <strong>single Request</strong>, called a <strong>Trace</strong>, as it is <strong>handled by Services</strong> that make up an <strong>Application</strong>.</li>
<li>A Distributed trace transverses <strong>process</strong>, <strong>network</strong> and <strong>security boundaries</strong>.</li>
</ol>
<h3 id="Distribution"><a href="#Distribution" class="headerlink" title="Distribution"></a>Distribution</h3><ol>
<li>A distribution is a <strong>wrapper</strong> around an <strong>upstream OpenTelemetry repository</strong> with some <strong>customizations</strong>.</li>
</ol>
<h3 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h3><ol>
<li><strong>Something that happened</strong> where <strong>representation</strong> depends on the <strong>Data source</strong>. For example, <strong>Spans</strong>.</li>
</ol>
<h3 id="Exporter"><a href="#Exporter" class="headerlink" title="Exporter"></a>Exporter</h3><ol>
<li>Provides functionality to <strong>emit telemetry</strong> to <strong>consumers</strong>. Exporters can be <strong>push- or pull-based</strong>.</li>
</ol>
<h3 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h3><blockquote>
<p>Log Records</p>
</blockquote>
<ol>
<li>A term used specifically by <strong>Log Records</strong>.</li>
<li><strong>Metadata</strong> can be added through <strong>defined fields</strong>, including <strong>Attributes</strong> and <strong>Resource</strong>.</li>
<li>Other fields may also be considered Metadata, including <strong>severity</strong> and <strong>trace information</strong>. See the field spec.</li>
</ol>
<h3 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h3><ol>
<li>A <strong>high-performance</strong>, open source <strong>universal RPC framework</strong>.</li>
</ol>
<h3 id="Instrumented-library"><a href="#Instrumented-library" class="headerlink" title="Instrumented library"></a>Instrumented library</h3><ol>
<li>Denotes the <strong>Library</strong> for which the <strong>telemetry signals</strong> (Traces, Metrics, Logs) are <strong>gathered</strong>.</li>
</ol>
<h3 id="Instrumentation-library"><a href="#Instrumentation-library" class="headerlink" title="Instrumentation library"></a>Instrumentation library</h3><ol>
<li>Denotes the <strong>Library</strong> that <strong>provides the instrumentation</strong> for a given <strong>Instrumented library</strong>.</li>
<li><strong>Instrumented library</strong> and <strong>Instrumentation library</strong> can be the <strong>same Library</strong> if it has <strong>built-in OpenTelemetry instrumentation</strong>.</li>
</ol>
<h3 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h3><ol>
<li>A term used specifically by <strong>Metrics</strong>. See <strong>Metadata</strong>.</li>
</ol>
<h3 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h3><ol>
<li>A <strong>language-specific collection of behavior</strong> invoked by an <strong>interface</strong>.</li>
</ol>
<h3 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h3><ol>
<li>Sometimes used to refer to a <strong>collection</strong> of <strong>Log records</strong>.</li>
<li>Can be <strong>ambiguous</strong> since people also sometimes use Log to refer to <strong>a single Log record</strong>.</li>
<li>Where ambiguity is possible, use <strong>additional qualifiers</strong>, for example, <strong>Log record</strong>.</li>
</ol>
<h3 id="Log-record"><a href="#Log-record" class="headerlink" title="Log record"></a>Log record</h3><ol>
<li>A <strong>recording</strong> of an <strong>Event</strong>.</li>
<li>record includes a <strong>timestamp</strong> indicating <strong>when</strong> the Event happened as well as other data that describes <strong>what</strong> happened, <strong>where</strong> it happened, and so on.</li>
</ol>
<h3 id="Metadata"><a href="#Metadata" class="headerlink" title="Metadata"></a>Metadata</h3><blockquote>
<p>Metrics - Labels<br>Logs - Fields</p>
</blockquote>
<ol>
<li>A <strong>key-value pair</strong>, for example foo&#x3D;”bar”, added to an <strong>entity</strong> producing <strong>telemetry</strong>.</li>
<li>OpenTelemetry calls these pairs <strong>Attributes</strong>.</li>
<li>In addition, <strong>Metrics</strong> have <strong>Dimensions</strong> an <strong>Labels</strong>, while <strong>Logs</strong> have <strong>Fields</strong>.</li>
</ol>
<h3 id="Metric"><a href="#Metric" class="headerlink" title="Metric"></a>Metric</h3><blockquote>
<p>time series</p>
</blockquote>
<ol>
<li>Records a <strong>data point</strong>, either <strong>raw measurements</strong> or <strong>predefined aggregation</strong>, as <strong>time series</strong> with <strong>Metadata</strong>.</li>
</ol>
<h3 id="OC"><a href="#OC" class="headerlink" title="OC"></a>OC</h3><ol>
<li>Short form for <strong>OpenCensus</strong>.</li>
</ol>
<h3 id="OT"><a href="#OT" class="headerlink" title="OT"></a>OT</h3><ol>
<li>Short form for <strong>OpenTracing</strong>.</li>
</ol>
<h3 id="OTel"><a href="#OTel" class="headerlink" title="OTel"></a>OTel</h3><ol>
<li>Short form for <strong>OpenTelemetry</strong>.</li>
<li><strong>Spelling</strong>: Write <strong>OTel</strong>, not OTEL.</li>
</ol>
<h3 id="OpAMP"><a href="#OpAMP" class="headerlink" title="OpAMP"></a>OpAMP</h3><ol>
<li>Abbreviation for the <strong>Open Agent Management Protocol</strong>.</li>
<li><strong>Spelling</strong> - Write <strong>OpAMP</strong>, not OPAMP nor opamp in descriptions or instructions.</li>
</ol>
<h3 id="OpenCensus"><a href="#OpenCensus" class="headerlink" title="OpenCensus"></a>OpenCensus</h3><ol>
<li><strong>Precursor</strong> to OpenTelemetry.</li>
</ol>
<h3 id="OpenTracing"><a href="#OpenTracing" class="headerlink" title="OpenTracing"></a>OpenTracing</h3><ol>
<li><strong>Precursor</strong> to OpenTelemetry.</li>
</ol>
<h3 id="OpenTelemetry-1"><a href="#OpenTelemetry-1" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h3><ol>
<li>Formed through a <strong>merger</strong> of the <strong>OpenTracing</strong> and <strong>OpenCensus</strong> projects</li>
<li>a <strong>collection</strong> of <strong>APIs</strong>, <strong>SDKs</strong>, and <strong>tools</strong> that you can use to <strong>instrument</strong>, <strong>generate</strong>, <strong>collect</strong>, and <strong>export</strong> telemetry data such as <strong>metrics</strong>, <strong>logs</strong>, and <strong>traces</strong>.</li>
<li><strong>Spelling</strong>: OpenTelemetry should <strong>always</strong> be a <strong>single unhyphenated word</strong> and <strong>capitalized</strong> as shown.</li>
</ol>
<h3 id="OTelCol"><a href="#OTelCol" class="headerlink" title="OTelCol"></a>OTelCol</h3><ol>
<li>Short form for <strong>OpenTelemetry Collector</strong>.</li>
</ol>
<h3 id="OTEP"><a href="#OTEP" class="headerlink" title="OTEP"></a>OTEP</h3><ol>
<li>An <strong>acronym</strong> for <strong>OpenTelemetry Enhancement Proposal</strong></li>
<li><strong>Spelling</strong>: Write “<strong>OTEPs</strong>” as <strong>plural form</strong>. Don’t write OTep or otep in descriptions.</li>
</ol>
<h3 id="OTLP"><a href="#OTLP" class="headerlink" title="OTLP"></a>OTLP</h3><ol>
<li>Short for <strong>OpenTelemetry Protocol</strong>.</li>
</ol>
<h3 id="Propagators"><a href="#Propagators" class="headerlink" title="Propagators"></a>Propagators</h3><ol>
<li>Used to <strong>serialize</strong> and <strong>deserialize</strong> specific <strong>parts</strong> of <strong>telemetry data</strong> such as <strong>span context</strong> and <strong>Baggage</strong> in <strong>Spans</strong>.</li>
</ol>
<h3 id="Proto"><a href="#Proto" class="headerlink" title="Proto"></a>Proto</h3><blockquote>
<p>OpenTelemetry protocol (OTLP) <strong>specification</strong> and <strong>Protobuf definitions</strong></p>
</blockquote>
<ol>
<li>Language <strong>independent</strong> interface types.</li>
</ol>
<h3 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h3><ol>
<li>The term used by the <strong>Collector</strong> to define <strong>how telemetry data is received</strong>. Receivers can be <strong>push- or pull-based</strong>.</li>
</ol>
<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h3><ol>
<li>Captures <strong>information</strong> about <strong>the entity producing telemetry</strong> as <strong>Attributes</strong>.</li>
<li>a <strong>process</strong> producing telemetry that is running in a <strong>container</strong> on <strong>Kubernetes</strong><ul>
<li>has a <strong>process name</strong>, a <strong>pod name</strong>, a <strong>namespace</strong>, and possibly a <strong>deployment</strong> name.</li>
<li>All these <strong>attributes</strong> can be included in the <strong>Resource</strong>.</li>
</ul>
</li>
</ol>
<h3 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h3><ol>
<li>Short for <strong>Representational State Transfer</strong></li>
</ol>
<h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><ol>
<li>Short for <strong>Remote Procedure Call</strong></li>
</ol>
<h3 id="Sampling-1"><a href="#Sampling-1" class="headerlink" title="Sampling"></a>Sampling</h3><ol>
<li>A mechanism to <strong>control</strong> the <strong>amount</strong> of data <strong>exported</strong>.</li>
<li>Most commonly used with the <strong>Tracing Data Source</strong>.</li>
</ol>
<h3 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h3><ol>
<li>Short for <strong>Software Development Kit</strong>.</li>
<li>Refers to a telemetry SDK that denotes a <strong>Library</strong> that <strong>implement</strong> the <strong>OpenTelemetry API</strong>.</li>
</ol>
<h3 id="Semantic-conventions-1"><a href="#Semantic-conventions-1" class="headerlink" title="Semantic conventions"></a>Semantic conventions</h3><ol>
<li>Defines <strong>standard names and values</strong> of <strong>Metadata</strong> in order to provide <strong>vendor-agnostic</strong> telemetry data.</li>
</ol>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><ol>
<li>A <strong>component</strong> of an <strong>Application</strong>.</li>
<li><strong>Multiple instances of a Service</strong> are typically deployed for <strong>high availability</strong> and <strong>scalability</strong>.</li>
<li>A <strong>Service</strong> can be deployed in <strong>multiple locations</strong>.</li>
</ol>
<h3 id="Signal"><a href="#Signal" class="headerlink" title="Signal"></a>Signal</h3><ol>
<li>One of <strong>Traces</strong>, <strong>Metrics</strong> or <strong>Logs</strong>.</li>
</ol>
<h3 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h3><ol>
<li>Represents a <strong>single operation</strong> within a <strong>Trace</strong>.</li>
</ol>
<h3 id="Span-link"><a href="#Span-link" class="headerlink" title="Span link"></a>Span link</h3><ol>
<li>A span link is a <strong>link</strong> between <strong>causally-related spans</strong>.</li>
</ol>
<h3 id="Specification"><a href="#Specification" class="headerlink" title="Specification"></a>Specification</h3><ol>
<li>Describes the <strong>cross-language requirements and expectations</strong> for <strong>all implementations</strong>.</li>
</ol>
<h3 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h3><ol>
<li>The <strong>result</strong> of the <strong>operation</strong>.</li>
<li>Typically used to <strong>indicate whether an error occurred</strong>.</li>
</ol>
<h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><ol>
<li>See <strong>Metadata</strong></li>
</ol>
<h3 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h3><ol>
<li>A <strong>DAG of Spans</strong>, where the <strong>edges between Spans</strong> are defined as <strong>parent-child relationship</strong>.</li>
</ol>
<h3 id="Tracer-1"><a href="#Tracer-1" class="headerlink" title="Tracer"></a>Tracer</h3><ol>
<li>Responsible for <strong>creating Spans</strong>.</li>
</ol>
<h3 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h3><ol>
<li>See <strong>Distributed Tracing</strong>.</li>
</ol>
<h3 id="zPages"><a href="#zPages" class="headerlink" title="zPages"></a>zPages</h3><blockquote>
<p>development + debug</p>
</blockquote>
<ol>
<li>An <strong>in-process alternative</strong> to <strong>external exporters</strong>.</li>
<li>When included, they <strong>collect and aggregate tracing and metrics information in the background</strong><ul>
<li>this data is <strong>served on web pages</strong> when requested.</li>
</ul>
</li>
</ol>
<h1 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h1><blockquote>
<p>TBD</p>
</blockquote>
<h1 id="Language-APIs-SDKs"><a href="#Language-APIs-SDKs" class="headerlink" title="Language APIs &amp; SDKs"></a>Language APIs &amp; SDKs</h1><blockquote>
<p><strong>zero-code</strong> solutions - <strong>Go</strong>, .NET, PHP, <strong>Python</strong>, <strong>Java</strong> and <strong>JavaScript</strong></p>
</blockquote>
<ol>
<li>OpenTelemetry <strong>code instrumentation</strong> is <strong>supported</strong> for the languages listed in the <strong>Statuses</strong> and <strong>Releases</strong> table below.</li>
<li><strong>Unofficial implementations</strong> for <strong>other languages</strong> are <strong>available</strong> as well. You can find them in the registry.<ul>
<li><a target="_blank" rel="noopener" href="https://opentelemetry.io/ecosystem/registry/">https://opentelemetry.io/ecosystem/registry/</a></li>
</ul>
</li>
<li>For <strong>Go</strong>, <strong>.NET</strong>, <strong>PHP</strong>, <strong>Python</strong>, <strong>Java</strong> and <strong>JavaScript</strong> you can use <strong>zero-code solutions</strong> to add instrumentation to your application without code changes.</li>
<li>If you are using <strong>Kubernetes</strong>, you can use the <strong>OpenTelemetry Operator</strong> for Kubernetes to <strong>inject</strong> these <strong>zero-code solutions</strong> into your application.</li>
</ol>
<blockquote>
<p>Status and Releases - The current status of the <strong>major functional components</strong> for OpenTelemetry is as follows:</p>
</blockquote>
<blockquote>
<p>Regardless of an <strong>API&#x2F;SDK’s status</strong>, if your <strong>instrumentation</strong> relies on <strong>semantic conventions</strong> that are marked as <strong>Experimental</strong> in the <strong>semantic conventions specification</strong>, your <strong>data flow</strong> might be subject to <strong>breaking changes</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Language</th>
<th>Traces</th>
<th>Metrics</th>
<th>Logs</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>C++</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
<td></td>
</tr>
<tr>
<td>C#&#x2F;.NET</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
<td></td>
</tr>
<tr>
<td><strong>Go</strong></td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Beta</strong></td>
<td></td>
</tr>
<tr>
<td>Java</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
<td></td>
</tr>
<tr>
<td><strong>JavaScript</strong></td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Development</strong></td>
<td>Node.js &amp; Browser</td>
</tr>
<tr>
<td>PHP</td>
<td>Stable</td>
<td>Stable</td>
<td>Stable</td>
<td></td>
</tr>
<tr>
<td><strong>Python</strong></td>
<td>Stable</td>
<td>Stable</td>
<td><strong>Development</strong></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>API references</p>
</blockquote>
<ol>
<li>Special Interest Groups (SIGs) <strong>implementing</strong> the <strong>OpenTelemetry API and SDK</strong> in a <strong>specific language</strong> also <strong>publish API references</strong> for developers.</li>
</ol>
<h2 id="SDK-Configuration"><a href="#SDK-Configuration" class="headerlink" title="SDK Configuration"></a>SDK Configuration</h2><ol>
<li>OpenTelemetry SDKs support configuration in each language and with <strong>environment variables</strong>.</li>
<li>Values set with <strong>environment</strong> variables <strong>override</strong> equivalent configuration in <strong>code</strong> using SDK APIs.</li>
</ol>
<h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><blockquote>
<p>Support for environment variables is <strong>optional</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Go</th>
<th>Java</th>
<th>JS</th>
<th>Python</th>
<th>Ruby</th>
<th>Erlang</th>
<th>PHP</th>
<th>Rust</th>
<th>C++</th>
<th>.NET</th>
<th>Swift</th>
</tr>
</thead>
<tbody><tr>
<td>OTEL_SDK_DISABLED</td>
<td>-</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_RESOURCE_ATTRIBUTES</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_SERVICE_NAME</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_LOG_LEVEL</td>
<td>-</td>
<td>-</td>
<td>+</td>
<td>[-][py1059]</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_PROPAGATORS</td>
<td>-</td>
<td>+</td>
<td></td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_BSP_*</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_BLRP_*</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_EXPORTER_OTLP_*</td>
<td>+</td>
<td>+</td>
<td></td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_EXPORTER_ZIPKIN_*</td>
<td>-</td>
<td>+</td>
<td></td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>+</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_TRACES_EXPORTER</td>
<td>-</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>OTEL_METRICS_EXPORTER</td>
<td>-</td>
<td>+</td>
<td></td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>OTEL_LOGS_EXPORTER</td>
<td>-</td>
<td>+</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_SPAN_EVENT_COUNT_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_SPAN_LINK_COUNT_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_EVENT_ATTRIBUTE_COUNT_LIMIT</td>
<td>+</td>
<td>-</td>
<td></td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_LINK_ATTRIBUTE_COUNT_LIMIT</td>
<td>+</td>
<td>-</td>
<td></td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OTEL_TRACES_SAMPLER</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>OTEL_TRACES_SAMPLER_ARG</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_ATTRIBUTE_COUNT_LIMIT</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>-</td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_METRIC_EXPORT_INTERVAL</td>
<td>-</td>
<td>+</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_METRIC_EXPORT_TIMEOUT</td>
<td>-</td>
<td>-</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_METRICS_EXEMPLAR_FILTER</td>
<td>-</td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td>+</td>
<td></td>
<td></td>
<td>+</td>
<td></td>
<td>-</td>
<td>+</td>
<td></td>
</tr>
<tr>
<td>OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION</td>
<td></td>
<td>+</td>
<td></td>
<td>+</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>-</td>
<td></td>
<td></td>
</tr>
<tr>
<td>OTEL_EXPERIMENTAL_CONFIG_FILE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>-</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="OTEL-SERVICE-NAME"><a href="#OTEL-SERVICE-NAME" class="headerlink" title="OTEL_SERVICE_NAME"></a>OTEL_SERVICE_NAME</h4><ol>
<li>Sets the value of the <strong>service.name</strong> resource attribute.</li>
<li>Default value - <strong>unknown_service</strong><ul>
<li>If <strong>service.name</strong> is also provided in <strong>OTEL_RESOURCE_ATTRIBUTES</strong>, then <strong>OTEL_SERVICE_NAME</strong> takes <strong>precedence</strong>.</li>
</ul>
</li>
<li>export OTEL_SERVICE_NAME&#x3D;”your-service-name”</li>
</ol>
<h4 id="OTEL-RESOURCE-ATTRIBUTES"><a href="#OTEL-RESOURCE-ATTRIBUTES" class="headerlink" title="OTEL_RESOURCE_ATTRIBUTES"></a>OTEL_RESOURCE_ATTRIBUTES</h4><ol>
<li><strong>Key-value pairs</strong> to be used as <strong>resource attributes</strong>.</li>
<li>Default value - <strong>Empty</strong><ul>
<li>See <strong>Resource semantic conventions</strong> for semantic conventions to follow for <strong>common resource types</strong>.</li>
</ul>
</li>
<li>export OTEL_RESOURCE_ATTRIBUTES&#x3D;”<strong>key1&#x3D;value1,key2&#x3D;value2</strong>“</li>
</ol>
<h4 id="OTEL-TRACES-SAMPLER"><a href="#OTEL-TRACES-SAMPLER" class="headerlink" title="OTEL_TRACES_SAMPLER"></a>OTEL_TRACES_SAMPLER</h4><ol>
<li>Specifies the <strong>Sampler</strong> used to <strong>sample traces</strong> by the SDK.</li>
<li>Default value - <strong>parentbased_always_on</strong></li>
<li>export OTEL_TRACES_SAMPLER&#x3D;”traceidratio”</li>
</ol>
<blockquote>
<p>Accepted values for OTEL_TRACES_SAMPLER are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Options</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>always_on</td>
<td>AlwaysOnSampler</td>
</tr>
<tr>
<td>always_off</td>
<td>AlwaysOffSampler</td>
</tr>
<tr>
<td><strong>traceidratio</strong></td>
<td>TraceIdRatioBased</td>
</tr>
<tr>
<td>parentbased_always_on</td>
<td>ParentBased(root&#x3D;AlwaysOnSampler)</td>
</tr>
<tr>
<td>parentbased_always_off</td>
<td>ParentBased(root&#x3D;AlwaysOffSampler)</td>
</tr>
<tr>
<td><strong>parentbased_traceidratio</strong></td>
<td>ParentBased(root&#x3D;TraceIdRatioBased)</td>
</tr>
<tr>
<td>parentbased_jaeger_remote</td>
<td>ParentBased(root&#x3D;JaegerRemoteSampler)</td>
</tr>
<tr>
<td>jaeger_remote</td>
<td>JaegerRemoteSampler</td>
</tr>
<tr>
<td>xray</td>
<td>AWS X-Ray Centralized Sampling - third party</td>
</tr>
</tbody></table>
<h4 id="OTEL-TRACES-SAMPLER-ARG"><a href="#OTEL-TRACES-SAMPLER-ARG" class="headerlink" title="OTEL_TRACES_SAMPLER_ARG"></a>OTEL_TRACES_SAMPLER_ARG</h4><ol>
<li><strong>Specifies arguments</strong>, if applicable, to the sampler defined in by <strong>OTEL_TRACES_SAMPLER</strong>.</li>
<li>The <strong>specified value</strong> will <strong>only be used</strong> if <strong>OTEL_TRACES_SAMPLER</strong> is set.<ul>
<li>Each <strong>Sampler</strong> type defines <strong>its own expected input</strong>, if any.</li>
<li><strong>Invalid</strong> or <strong>unrecognized</strong> input is logged as an <strong>error</strong>.</li>
</ul>
</li>
<li>Default value: <strong>Empty</strong>.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_TRACES_SAMPLER=&quot;traceidratio&quot;</span><br><span class="line">export OTEL_TRACES_SAMPLER_ARG=&quot;0.5&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Depending on the value of <strong>OTEL_TRACES_SAMPLER</strong>, <strong>OTEL_TRACES_SAMPLER_ARG</strong> may be set as follows:</p>
</blockquote>
<ol>
<li>For <strong>traceidratio</strong> and <strong>parentbased_traceidratio</strong> samplers: <strong>Sampling probability</strong>, a number in the <strong>[0..1]</strong> range, e.g. “0.25”. <strong>Default</strong> is <strong>1.0</strong> if unset.</li>
<li>For <strong>jaeger_remote</strong> and <strong>parentbased_jaeger_remote</strong>: The value is a comma separated list<ul>
<li>Example: “endpoint&#x3D;<a href="http://localhost:14250,pollingIntervalMs=5000,initialSamplingRate=0.25">http://localhost:14250,pollingIntervalMs=5000,initialSamplingRate=0.25</a>“</li>
</ul>
</li>
</ol>
<h4 id="OTEL-PROPAGATORS"><a href="#OTEL-PROPAGATORS" class="headerlink" title="OTEL_PROPAGATORS"></a>OTEL_PROPAGATORS</h4><ol>
<li>Specifies <strong>Propagators</strong> to be used in a <strong>comma-separated list</strong>.</li>
<li>Default value: “<strong>tracecontext,baggage</strong>“</li>
<li>export OTEL_PROPAGATORS&#x3D;”b3”</li>
</ol>
<blockquote>
<p>Accepted values for OTEL_PROPAGATORS are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Propagator</th>
<th>Desc</th>
<th>Uri</th>
</tr>
</thead>
<tbody><tr>
<td>tracecontext</td>
<td>W3C Trace Context</td>
<td><a target="_blank" rel="noopener" href="https://www.w3.org/TR/trace-context/">https://www.w3.org/TR/trace-context/</a></td>
</tr>
<tr>
<td>baggage</td>
<td>W3C Baggage</td>
<td><a target="_blank" rel="noopener" href="https://www.w3.org/TR/baggage/">https://www.w3.org/TR/baggage/</a></td>
</tr>
<tr>
<td>b3</td>
<td>B3 Single</td>
<td><a target="_blank" rel="noopener" href="https://github.com/openzipkin/b3-propagation#single-header">https://github.com/openzipkin/b3-propagation#single-header</a></td>
</tr>
<tr>
<td>b3multi</td>
<td>B3 Multi</td>
<td><a target="_blank" rel="noopener" href="https://github.com/openzipkin/b3-propagation#multiple-headers">https://github.com/openzipkin/b3-propagation#multiple-headers</a></td>
</tr>
<tr>
<td>jaeger</td>
<td>Jaeger</td>
<td></td>
</tr>
<tr>
<td>xray</td>
<td>AWS X-Ray</td>
<td></td>
</tr>
<tr>
<td>ottrace</td>
<td>OT Trace</td>
<td><a target="_blank" rel="noopener" href="https://github.com/opentracing">https://github.com/opentracing</a></td>
</tr>
<tr>
<td>none</td>
<td>No automatically configured propagator</td>
<td></td>
</tr>
</tbody></table>
<h4 id="OTEL-TRACES-EXPORTER"><a href="#OTEL-TRACES-EXPORTER" class="headerlink" title="OTEL_TRACES_EXPORTER"></a>OTEL_TRACES_EXPORTER</h4><ol>
<li>Specifies which <strong>exporter</strong> is used for <strong>traces</strong>. Depending on the implementation it may be a <strong>comma-separated list</strong>.</li>
<li>Default value - <strong>otlp</strong></li>
<li>export OTEL_TRACES_EXPORTER&#x3D;”<strong>jaeger</strong>“</li>
</ol>
<blockquote>
<p>Accepted values for are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Exporter</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>otlp</td>
<td>OTLP</td>
</tr>
<tr>
<td>jaeger</td>
<td>export in Jaeger data model</td>
</tr>
<tr>
<td>zipkin</td>
<td>Zipkin</td>
</tr>
<tr>
<td>console</td>
<td>Standard output</td>
</tr>
<tr>
<td>none</td>
<td>No automatically configured exporter for traces.</td>
</tr>
</tbody></table>
<h4 id="OTEL-METRICS-EXPORTER"><a href="#OTEL-METRICS-EXPORTER" class="headerlink" title="OTEL_METRICS_EXPORTER"></a>OTEL_METRICS_EXPORTER</h4><ol>
<li>Specifies which <strong>exporter</strong> is used for <strong>metrics</strong>. Depending on the implementation it may be a <strong>comma-separated list</strong>.</li>
<li>Default value - <strong>otlp</strong></li>
<li>export OTEL_METRICS_EXPORTER&#x3D;”<strong>prometheus</strong>“</li>
</ol>
<blockquote>
<p>Accepted values for OTEL_METRICS_EXPORTER are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Exporter</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>otlp</td>
<td>OTLP</td>
</tr>
<tr>
<td>prometheus</td>
<td>Prometheus</td>
</tr>
<tr>
<td>console</td>
<td>Standard Output</td>
</tr>
<tr>
<td>none</td>
<td>No automatically configured exporter for metrics.</td>
</tr>
</tbody></table>
<h4 id="OTEL-LOGS-EXPORTER"><a href="#OTEL-LOGS-EXPORTER" class="headerlink" title="OTEL_LOGS_EXPORTER"></a>OTEL_LOGS_EXPORTER</h4><ol>
<li>Specifies which <strong>exporter</strong> is used for <strong>logs</strong>. Depending on the implementation it may be a <strong>comma-separated list</strong>.</li>
<li>Default value - <strong>otlp</strong></li>
<li>export OTEL_LOGS_EXPORTER&#x3D;”otlp”</li>
</ol>
<blockquote>
<p>Accepted values for OTEL_LOGS_EXPORTER are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Exporter</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>otlp</td>
<td>OTLP</td>
</tr>
<tr>
<td>console</td>
<td>Standard Output</td>
</tr>
<tr>
<td>none</td>
<td>No automatically configured exporter for logs.</td>
</tr>
</tbody></table>
<h3 id="OTLP-Exporter"><a href="#OTLP-Exporter" class="headerlink" title="OTLP Exporter"></a>OTLP Exporter</h3><h4 id="Endpoint-Configuration"><a href="#Endpoint-Configuration" class="headerlink" title="Endpoint Configuration"></a>Endpoint Configuration</h4><blockquote>
<p>The following <strong>environment variables</strong> let you configure an <strong>OTLP&#x2F;gRPC</strong> or <strong>OTLP&#x2F;HTTP</strong> endpoint for your <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>.</p>
</blockquote>
<h5 id="OTEL-EXPORTER-OTLP-ENDPOINT"><a href="#OTEL-EXPORTER-OTLP-ENDPOINT" class="headerlink" title="OTEL_EXPORTER_OTLP_ENDPOINT"></a>OTEL_EXPORTER_OTLP_ENDPOINT</h5><ol>
<li>A <strong>base endpoint URL</strong> for <strong>any signal type</strong>, with an <strong>optionally-specified port number</strong>.</li>
<li>Helpful for when you’re sending <strong>more than one signal</strong> to the <strong>same endpoint</strong> and want one environment variable to control the endpoint.</li>
<li>Default value<ul>
<li><strong>gRPC</strong> - <a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a><ul>
<li>export OTEL_EXPORTER_OTLP_ENDPOINT&#x3D;”<strong>https</strong>:&#x2F;&#x2F;my-api-endpoint:443”</li>
</ul>
</li>
<li>HTTP - <a target="_blank" rel="noopener" href="http://localhost:4318/">http://localhost:4318</a><ul>
<li>export OTEL_EXPORTER_OTLP_ENDPOINT&#x3D;”<a target="_blank" rel="noopener" href="http://my-api-endpoint/">http://my-api-endpoint/</a>“</li>
</ul>
</li>
</ul>
</li>
<li>For <strong>OTLP&#x2F;HTTP</strong>, exporters in the SDK construct <strong>signal-specific URLs</strong> when this environment variable is set.<ul>
<li>This means that if you’re sending <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>, the following URLs are constructed from the example above:</li>
<li>Traces - “<a target="_blank" rel="noopener" href="http://my-api-endpoint**/v1/traces">http://my-api-endpoint**/v1/traces</a>**”</li>
<li>Metrics - “<a target="_blank" rel="noopener" href="http://my-api-endpoint**/v1/metrics">http://my-api-endpoint**/v1/metrics</a>**”</li>
<li>Logs - “<a target="_blank" rel="noopener" href="http://my-api-endpoint**/v1/logs">http://my-api-endpoint**/v1/logs</a>**”</li>
</ul>
</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-TRACES-ENDPOINT"><a href="#OTEL-EXPORTER-OTLP-TRACES-ENDPOINT" class="headerlink" title="OTEL_EXPORTER_OTLP_TRACES_ENDPOINT"></a>OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</h5><ol>
<li>Endpoint URL for <strong>trace data only</strong>, with an <strong>optionally-specified port number</strong>. Typically ends with <strong>v1&#x2F;traces</strong> when using <strong>OTLP&#x2F;HTTP</strong>.</li>
<li>Default value<ul>
<li><strong>gRPC</strong> - <a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a><ul>
<li>export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT&#x3D;”<strong>https</strong>:&#x2F;&#x2F;my-api-endpoint:443”</li>
</ul>
</li>
<li><strong>HTTP</strong> - <a target="_blank" rel="noopener" href="http://localhost:4318/**v1/traces">http://localhost:4318/**v1/traces</a>**<ul>
<li>export OTEL_EXPORTER_OTLP_TRACES_ENDPOINT&#x3D;”<a target="_blank" rel="noopener" href="http://my-api-endpoint/**v1/traces">http://my-api-endpoint/**v1/traces</a>**”</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-METRICS-ENDPOINT"><a href="#OTEL-EXPORTER-OTLP-METRICS-ENDPOINT" class="headerlink" title="OTEL_EXPORTER_OTLP_METRICS_ENDPOINT"></a>OTEL_EXPORTER_OTLP_METRICS_ENDPOINT</h5><ol>
<li>Endpoint URL for <strong>metric data only</strong>, with an <strong>optionally-specified port number</strong>. Typically ends with <strong>v1&#x2F;metrics</strong> when using <strong>OTLP&#x2F;HTTP</strong>.</li>
<li>Default value<ul>
<li><strong>gRPC</strong> - <a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a><ul>
<li>export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT&#x3D;”<strong>https</strong>:&#x2F;&#x2F;my-api-endpoint:443”</li>
</ul>
</li>
<li><strong>HTTP</strong> - <a target="_blank" rel="noopener" href="http://localhost:4318/**v1/metrics">http://localhost:4318/**v1/metrics</a>**<ul>
<li>export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT&#x3D;”<a target="_blank" rel="noopener" href="http://my-api-endpoint/**v1/metrics">http://my-api-endpoint/**v1/metrics</a>**”</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-LOGS-ENDPOINT"><a href="#OTEL-EXPORTER-OTLP-LOGS-ENDPOINT" class="headerlink" title="OTEL_EXPORTER_OTLP_LOGS_ENDPOINT"></a>OTEL_EXPORTER_OTLP_LOGS_ENDPOINT</h5><ol>
<li>Endpoint URL for <strong>log data only</strong>, with an <strong>optionally-specified port number</strong>. Typically ends with <strong>v1&#x2F;logs</strong> when using <strong>OTLP&#x2F;HTTP</strong>.</li>
<li>Default value<ul>
<li><strong>gRPC</strong> - <a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a><ul>
<li>export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT&#x3D;”<strong>https</strong>:&#x2F;&#x2F;my-api-endpoint:443”</li>
</ul>
</li>
<li><strong>HTTP</strong> - <a target="_blank" rel="noopener" href="http://localhost:4318/**v1/logs">http://localhost:4318/**v1/logs</a>**<ul>
<li>export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT&#x3D;”<a target="_blank" rel="noopener" href="http://my-api-endpoint/**v1/logs">http://my-api-endpoint/**v1/logs</a>**”</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="Header-configuration"><a href="#Header-configuration" class="headerlink" title="Header configuration"></a>Header configuration</h4><blockquote>
<p>The following <strong>environment variables</strong> let you configure <strong>additional headers</strong> as a list of <strong>key-value pairs</strong> to add in <strong>outgoing gRPC or HTTP requests</strong>.</p>
</blockquote>
<h5 id="OTEL-EXPORTER-OTLP-HEADERS"><a href="#OTEL-EXPORTER-OTLP-HEADERS" class="headerlink" title="OTEL_EXPORTER_OTLP_HEADERS"></a>OTEL_EXPORTER_OTLP_HEADERS</h5><ol>
<li>A list of headers to apply to <strong>all outgoing data</strong> (<strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>).</li>
<li>Default value - <strong>N&#x2F;A</strong></li>
<li>export OTEL_EXPORTER_OTLP_HEADERS&#x3D;”<strong>api-key&#x3D;key,other-config-value&#x3D;value</strong>“</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-TRACES-HEADERS"><a href="#OTEL-EXPORTER-OTLP-TRACES-HEADERS" class="headerlink" title="OTEL_EXPORTER_OTLP_TRACES_HEADERS"></a>OTEL_EXPORTER_OTLP_TRACES_HEADERS</h5><ol>
<li>A list of headers to apply to <strong>all outgoing traces</strong>.</li>
<li>Default value - <strong>N&#x2F;A</strong></li>
<li>export OTEL_EXPORTER_OTLP_TRACES_HEADERS&#x3D;”<strong>api-key&#x3D;key,other-config-value&#x3D;value</strong>“</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-METRICS-HEADERS"><a href="#OTEL-EXPORTER-OTLP-METRICS-HEADERS" class="headerlink" title="OTEL_EXPORTER_OTLP_METRICS_HEADERS"></a>OTEL_EXPORTER_OTLP_METRICS_HEADERS</h5><ol>
<li>A list of headers to apply to <strong>all outgoing metrics</strong>.</li>
<li>Default value - <strong>N&#x2F;A</strong></li>
<li>export OTEL_EXPORTER_OTLP_METRICS_HEADERS&#x3D;”<strong>api-key&#x3D;key,other-config-value&#x3D;value</strong>“</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-LOGS-HEADERS"><a href="#OTEL-EXPORTER-OTLP-LOGS-HEADERS" class="headerlink" title="OTEL_EXPORTER_OTLP_LOGS_HEADERS"></a>OTEL_EXPORTER_OTLP_LOGS_HEADERS</h5><ol>
<li>A list of headers to apply to <strong>all outgoing logs</strong>.</li>
<li>Default value - <strong>N&#x2F;A</strong></li>
<li>export OTEL_EXPORTER_OTLP_LOGS_HEADERS&#x3D;”<strong>api-key&#x3D;key,other-config-value&#x3D;value</strong>“</li>
</ol>
<h4 id="Timeout-Configuration"><a href="#Timeout-Configuration" class="headerlink" title="Timeout Configuration"></a>Timeout Configuration</h4><blockquote>
<p>The following <strong>environment variables</strong> configure the <strong>maximum time (in milliseconds)</strong> an <strong>OTLP Exporter</strong> will wait before <strong>transmitting</strong> the <strong>net batch</strong> of data.</p>
</blockquote>
<h5 id="OTEL-EXPORTER-OTLP-TIMEOUT"><a href="#OTEL-EXPORTER-OTLP-TIMEOUT" class="headerlink" title="OTEL_EXPORTER_OTLP_TIMEOUT"></a>OTEL_EXPORTER_OTLP_TIMEOUT</h5><ol>
<li>The <strong>timeout</strong> value for <strong>all outgoing data</strong> (<strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>) in <strong>milliseconds</strong>.</li>
<li>Default value - <strong>10000</strong> (<strong>10s</strong>)</li>
<li>export OTEL_EXPORTER_OTLP_TIMEOUT&#x3D;500</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-TRACES-TIMEOUT"><a href="#OTEL-EXPORTER-OTLP-TRACES-TIMEOUT" class="headerlink" title="OTEL_EXPORTER_OTLP_TRACES_TIMEOUT"></a>OTEL_EXPORTER_OTLP_TRACES_TIMEOUT</h5><ol>
<li>The <strong>timeout</strong> value for <strong>all outgoing traces</strong> in <strong>milliseconds</strong>.</li>
<li>Default value - <strong>10000</strong> (<strong>10s</strong>)</li>
<li>export OTEL_EXPORTER_OTLP_TRACES_TIMEOUT&#x3D;500</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-METRICS-TIMEOUT"><a href="#OTEL-EXPORTER-OTLP-METRICS-TIMEOUT" class="headerlink" title="OTEL_EXPORTER_OTLP_METRICS_TIMEOUT"></a>OTEL_EXPORTER_OTLP_METRICS_TIMEOUT</h5><ol>
<li>The <strong>timeout</strong> value for <strong>all outgoing metrics</strong> in <strong>milliseconds</strong>.</li>
<li>Default value - <strong>10000</strong> (<strong>10s</strong>)</li>
<li>export OTEL_EXPORTER_OTLP_METRICS_TIMEOUT&#x3D;500</li>
</ol>
<h5 id="OTEL-EXPORTER-OTLP-LOGS-TIMEOUT"><a href="#OTEL-EXPORTER-OTLP-LOGS-TIMEOUT" class="headerlink" title="OTEL_EXPORTER_OTLP_LOGS_TIMEOUT"></a>OTEL_EXPORTER_OTLP_LOGS_TIMEOUT</h5><ol>
<li>The <strong>timeout</strong> value for <strong>all outgoing logs</strong> in <strong>milliseconds</strong>.</li>
<li>Default value - <strong>10000</strong> (<strong>10s</strong>)</li>
<li>export OTEL_EXPORTER_OTLP_LOGS_TIMEOUT&#x3D;500</li>
</ol>
<h4 id="Protocol-configuration"><a href="#Protocol-configuration" class="headerlink" title="Protocol configuration"></a>Protocol configuration</h4><blockquote>
<p>The following <strong>environment variables</strong> configure the <strong>OTLP transport protocol</strong> an <strong>OTLP exporter</strong> uses.</p>
</blockquote>
<h5 id="OTEL-EXPORTER-OTLP-PROTOCOL"><a href="#OTEL-EXPORTER-OTLP-PROTOCOL" class="headerlink" title="OTEL_EXPORTER_OTLP_PROTOCOL"></a>OTEL_EXPORTER_OTLP_PROTOCOL</h5><ol>
<li>Specifies the <strong>OTLP transport protocol</strong> to be used for <strong>all telemetry data</strong>.</li>
<li>Default value - <strong>SDK-dependent</strong>, but will typically be either <strong>http&#x2F;protobuf</strong> or <strong>grpc</strong>.</li>
<li>export OTEL_EXPORTER_OTLP_PROTOCOL&#x3D;grpc</li>
</ol>
<blockquote>
<p>Valid values are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>grpc</strong></td>
<td>OTLP&#x2F;gRPC</td>
</tr>
<tr>
<td><strong>http&#x2F;protobuf</strong></td>
<td>OTLP&#x2F;HTTP + protobuf</td>
</tr>
<tr>
<td><strong>http&#x2F;json</strong></td>
<td>OTLP&#x2F;HTTP + JSON</td>
</tr>
</tbody></table>
<h5 id="OTEL-EXPORTER-OTLP-TRACES-PROTOCOL"><a href="#OTEL-EXPORTER-OTLP-TRACES-PROTOCOL" class="headerlink" title="OTEL_EXPORTER_OTLP_TRACES_PROTOCOL"></a>OTEL_EXPORTER_OTLP_TRACES_PROTOCOL</h5><ol>
<li>Specifies the <strong>OTLP transport protocol</strong> to be used for <strong>trace data</strong>.</li>
<li>Default value - <strong>SDK-dependent</strong>, but will typically be either <strong>http&#x2F;protobuf</strong> or <strong>grpc</strong>.</li>
<li>export OTEL_EXPORTER_OTLP_TRACES_PROTOCOL&#x3D;grpc</li>
</ol>
<blockquote>
<p>Valid values are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>grpc</strong></td>
<td>OTLP&#x2F;gRPC</td>
</tr>
<tr>
<td><strong>http&#x2F;protobuf</strong></td>
<td>OTLP&#x2F;HTTP + protobuf</td>
</tr>
<tr>
<td><strong>http&#x2F;json</strong></td>
<td>OTLP&#x2F;HTTP + JSON</td>
</tr>
</tbody></table>
<h5 id="OTEL-EXPORTER-OTLP-METRICS-PROTOCOL"><a href="#OTEL-EXPORTER-OTLP-METRICS-PROTOCOL" class="headerlink" title="OTEL_EXPORTER_OTLP_METRICS_PROTOCOL"></a>OTEL_EXPORTER_OTLP_METRICS_PROTOCOL</h5><ol>
<li>Specifies the <strong>OTLP transport protocol</strong> to be used for <strong>metrics data</strong>.</li>
<li>Default value - <strong>SDK-dependent</strong>, but will typically be either <strong>http&#x2F;protobuf</strong> or <strong>grpc</strong>.</li>
<li>export OTEL_EXPORTER_OTLP_METRICS_PROTOCOL&#x3D;grpc</li>
</ol>
<blockquote>
<p>Valid values are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>grpc</strong></td>
<td>OTLP&#x2F;gRPC</td>
</tr>
<tr>
<td><strong>http&#x2F;protobuf</strong></td>
<td>OTLP&#x2F;HTTP + protobuf</td>
</tr>
<tr>
<td><strong>http&#x2F;json</strong></td>
<td>OTLP&#x2F;HTTP + JSON</td>
</tr>
</tbody></table>
<h5 id="OTEL-EXPORTER-OTLP-LOGS-PROTOCOL"><a href="#OTEL-EXPORTER-OTLP-LOGS-PROTOCOL" class="headerlink" title="OTEL_EXPORTER_OTLP_LOGS_PROTOCOL"></a>OTEL_EXPORTER_OTLP_LOGS_PROTOCOL</h5><ol>
<li>Specifies the <strong>OTLP transport protocol</strong> to be used for <strong>log data</strong>.</li>
<li>Default value - <strong>SDK-dependent</strong>, but will typically be either <strong>http&#x2F;protobuf</strong> or <strong>grpc</strong>.</li>
<li>export OTEL_EXPORTER_OTLP_LOGS_PROTOCOL&#x3D;grpc</li>
</ol>
<blockquote>
<p>Valid values are:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>grpc</strong></td>
<td>OTLP&#x2F;gRPC</td>
</tr>
<tr>
<td><strong>http&#x2F;protobuf</strong></td>
<td>OTLP&#x2F;HTTP + protobuf</td>
</tr>
<tr>
<td><strong>http&#x2F;json</strong></td>
<td>OTLP&#x2F;HTTP + JSON</td>
</tr>
</tbody></table>
<h2 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h2><blockquote>
<p>TBD</p>
</blockquote>
<h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><blockquote>
<p>TBD</p>
</blockquote>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><blockquote>
<p>TBD</p>
</blockquote>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><ol>
<li>This is the OpenTelemetry Java documentation.</li>
<li>OpenTelemetry is an <strong>observability framework</strong><ul>
<li>an API, SDK, and tools that are designed to aid in the generation and collection of application telemetry data such as metrics, logs, and traces.</li>
</ul>
</li>
</ol>
<blockquote>
<p>TBD</p>
</blockquote>
<h1 id="Platforms-and-environments"><a href="#Platforms-and-environments" class="headerlink" title="Platforms and environments"></a>Platforms and environments</h1><blockquote>
<p>TBD</p>
</blockquote>
<h1 id="Zero-code-Instrumentation"><a href="#Zero-code-Instrumentation" class="headerlink" title="Zero-code Instrumentation"></a>Zero-code Instrumentation</h1><blockquote>
<p>TBD</p>
</blockquote>
<h1 id="Collector-3"><a href="#Collector-3" class="headerlink" title="Collector"></a>Collector</h1><blockquote>
<p><strong>Vendor-agnostic</strong> way to <strong>receive</strong>, <strong>process</strong> and <strong>export</strong> telemetry data.</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-collector-9288229.svg" alt="otel-collector"></p>
<blockquote>
<p>Introduction</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector offers a <strong>vendor-agnostic</strong> implementation of how to <strong>receive</strong>, <strong>process</strong> and <strong>export</strong> telemetry data.<ul>
<li>It <strong>removes the need</strong> to run, operate, and maintain <strong>multiple agents&#x2F;collectors</strong>.</li>
</ul>
</li>
<li>This works with <strong>improved scalability</strong> and supports open source observability data formats (e.g. <strong>Jaeger</strong>, <strong>Prometheus</strong>, <strong>Fluent Bit</strong>, etc.)<ul>
<li>sending to one or more <strong>open source</strong> or <strong>commercial</strong> backends.</li>
</ul>
</li>
<li>The <strong>local Collector agent</strong> is the <strong>default location</strong> to which <strong>instrumentation libraries</strong> export their <strong>telemetry data</strong>.</li>
</ol>
<blockquote>
<p>Objectives</p>
</blockquote>
<table>
<thead>
<tr>
<th>Objectives</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><em>Usability</em></td>
<td><strong>Reasonable default configuration</strong>, supports <strong>popular protocols</strong>, runs and collects <strong>out of the box</strong>.</td>
</tr>
<tr>
<td><em>Performance</em></td>
<td>Highly <strong>stable</strong> and <strong>performant</strong> under varying loads and configurations.</td>
</tr>
<tr>
<td><em>Observability</em></td>
<td>An <strong>exemplar</strong> of an observable service.</td>
</tr>
<tr>
<td><em>Extensibility</em></td>
<td><strong>Customizable</strong> without touching the core code.</td>
</tr>
<tr>
<td><em>Unification</em></td>
<td><strong>Single codebase</strong>, deployable as an <strong>agent</strong> or <strong>collector</strong> with support for <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>When to use a collector</p>
</blockquote>
<ol>
<li>For most <strong>language specific instrumentation libraries</strong> you have <strong>exporters</strong> for <strong>popular backends</strong> and <strong>OTLP</strong>. You might wonder,<ul>
<li>under what <strong>circumstances</strong> does one use a <strong>collector</strong> to send data, as opposed to having each service send <strong>directly</strong> to the backend?</li>
</ul>
</li>
<li>For trying out and <strong>getting started</strong> with OpenTelemetry, sending your data <strong>directly</strong> to a backend is a great way to get value <strong>quickly</strong>.<ul>
<li>Also, in a <strong>development</strong> or <strong>small-scale environment</strong> you can get decent results without a collector.</li>
</ul>
</li>
<li>However, in general we recommend <strong>using a collector alongside your service</strong><ul>
<li>since it allows your service to <strong>offload data quickly</strong></li>
<li>and the collector can take care of <strong>additional handling</strong> like <strong>retries</strong>, <strong>batching</strong>, <strong>encryption</strong> or even <strong>sensitive data filtering</strong>.</li>
</ul>
</li>
<li>It is also easier to setup a collector than you might think<ul>
<li>the <strong>default OTLP exporters</strong> in each language assume a <strong>local collector endpoint</strong></li>
<li>so if you launch a collector it will <strong>automatically start receiving telemetry</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Status and releases</p>
</blockquote>
<ol>
<li>The Collector status is: <strong>mixed</strong>, since <strong>core Collector components</strong> currently have <strong>mixed stability levels</strong>.</li>
<li><strong>Collector components</strong> differ in their <strong>maturity levels</strong>. Each component has its <strong>stability</strong> documented in its <strong>README.md</strong>.</li>
</ol>
<h2 id="Quick-start"><a href="#Quick-start" class="headerlink" title="Quick start"></a>Quick start</h2><blockquote>
<p>Setup and collect telemetry in <strong>minutes</strong>!</p>
</blockquote>
<ol>
<li>The <strong>OpenTelemetry Collector</strong> receives <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong><ul>
<li><strong>processes</strong> the telemetry, and <strong>exports</strong> it to a wide variety of <strong>observability backends</strong> using its components.</li>
</ul>
</li>
<li>You are going to learn to do the following in <strong>less than five minutes</strong>:<ul>
<li>Set up and run the OpenTelemetry Collector.</li>
<li>Send telemetry and see it processed by the Collector.</li>
</ul>
</li>
</ol>
<h3 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h3><ol>
<li>Make sure that your <strong>developer environment</strong> has the following.</li>
<li>This page assumes that you’re using <strong>bash</strong>. Adapt configuration and commands as necessary for your preferred shell.<ul>
<li><strong>Docker</strong> or any <strong>compatible containers’ runtime</strong>.</li>
<li><strong>Go 1.20</strong> or higher</li>
<li><strong>GOBIN environment variable</strong> is set; if unset, initialize it appropriately</li>
</ul>
</li>
</ol>
<h3 id="Set-up-the-environment"><a href="#Set-up-the-environment" class="headerlink" title="Set up the environment"></a>Set up the environment</h3><blockquote>
<p>Pull in the OpenTelemetry Collector <strong>Contrib</strong> Docker image:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull otel/opentelemetry-collector-contrib:0.119.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Install the <strong>telemetrygen</strong> utility - This utility can <strong>simulate</strong> a client generating <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/open-telemetry/opentelemetry-collector-contrib/cmd/telemetrygen@latest</span><br></pre></td></tr></table></figure>

<h3 id="Generate-and-collect-telemetry"><a href="#Generate-and-collect-telemetry" class="headerlink" title="Generate and collect telemetry"></a>Generate and collect telemetry</h3><blockquote>
<p>Launch the Collector, listening on ports <strong>4317</strong> (for <strong>OTLP gRPC</strong>), <strong>4318</strong> (for <strong>OTLP HTTP</strong>) and <strong>55679</strong> (for <strong>ZPages</strong>):</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  -p 0.0.0.0:4317:4317 \</span><br><span class="line">  -p 0.0.0.0:4318:4318 \</span><br><span class="line">  -p 0.0.0.0:55679:55679 \</span><br><span class="line">  otel/opentelemetry-collector-contrib:0.119.0 \</span><br><span class="line">  2&gt;&amp;1 | tee collector-output.txt # Optionally tee output for easier search later</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In a separate terminal window, <strong>generate</strong> a few sample <strong>traces</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$GOBIN/telemetrygen traces --otlp-insecure --traces 3</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Among the output generated by the utility, you should see a confirmation that traces were generated:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2025-02-12T11:15:47.253+0800    INFO	traces/worker.go:112	traces generated	&#123;&quot;worker&quot;: 0, &quot;traces&quot;: 3&#125;</span><br><span class="line">2025-02-12T11:15:47.253+0800    INFO	traces/traces.go:74	stop the batch span processor</span><br></pre></td></tr></table></figure>

<blockquote>
<p>For an easier time seeing <strong>relevant output</strong> you can filter it:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212112012376.png" alt="image-20250212112012376"></p>
<blockquote>
<p>In the terminal window running the <strong>Collector container</strong>, you should see trace <strong>ingest activity</strong> similar to what is shown in the following example:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212112244537.png" alt="image-20250212112244537"></p>
<blockquote>
<p>Open <a target="_blank" rel="noopener" href="http://localhost:55679/debug/tracez">http://localhost:55679/debug/tracez</a> and select one of the samples in the table to see the traces you’ve just generated.</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212112619889.png" alt="image-20250212112619889"></p>
<h3 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h3><blockquote>
<p>In this tutorial you’ve started the OpenTelemetry Collector and sent telemetry to it. As next steps, consider doing the following:</p>
</blockquote>
<ol>
<li>Explore different ways to <strong>install the Collector</strong>.</li>
<li>Learn about the different modes of the Collector in <strong>Deployment Methods</strong>.</li>
<li>Familiarize yourself with the Collector <strong>configuration</strong> files and structure.</li>
<li>Explore available components in the registry.</li>
<li>Learn how to <strong>build a custom Collector</strong> with the <strong>OpenTelemetry Collector Builder</strong> (<strong>OCB</strong>).</li>
</ol>
<h2 id="Install-the-Collector"><a href="#Install-the-Collector" class="headerlink" title="Install the Collector"></a>Install the Collector</h2><ol>
<li>You can deploy the OpenTelemetry Collector on a wide variety of <strong>operating systems</strong> and <strong>architectures</strong>.</li>
<li>The following instructions show how to download and install the latest <strong>stable</strong> version of the Collector.</li>
</ol>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><blockquote>
<p>The following commands pull a Docker image and run the Collector in a container.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull otel/opentelemetry-collector-contrib:0.119.0</span><br><span class="line">docker run otel/opentelemetry-collector-contrib:0.119.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To load a <strong>custom configuration file</strong> from your working directory, <strong>mount</strong> that file as a <strong>volume</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v $(pwd)/config.yaml:/etc/otelcol-contrib/config.yaml otel/opentelemetry-collector-contrib:0.119.0</span><br></pre></td></tr></table></figure>

<h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><blockquote>
<p>You can add OpenTelemetry Collector to your existing docker-compose.yaml file as in the following example:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">otel-collector:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">otel/opentelemetry-collector-contrib</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./otel-collector-config.yaml:/etc/otelcol-contrib/config.yaml</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1888</span><span class="string">:1888</span> <span class="comment"># pprof extension</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8888</span><span class="string">:8888</span> <span class="comment"># Prometheus metrics exposed by the Collector</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8889</span><span class="string">:8889</span> <span class="comment"># Prometheus exporter metrics</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">13133</span><span class="string">:13133</span> <span class="comment"># health_check extension</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">4317</span><span class="string">:4317</span> <span class="comment"># OTLP gRPC receiver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">4318</span><span class="string">:4318</span> <span class="comment"># OTLP http receiver</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">55679</span><span class="string">:55679</span> <span class="comment"># zpages extension</span></span><br></pre></td></tr></table></figure>

<h3 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h3><blockquote>
<p>The following command deploys an agent as a daemonset and a single gateway instance:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/open-telemetry/opentelemetry-collector/v0.119.0/examples/k8s/otel-config.yaml</span><br></pre></td></tr></table></figure>

<ol>
<li>The previous example is meant to serve as a <strong>starting point</strong>, to be <strong>extended</strong> and <strong>customized</strong> before actual <strong>production</strong> usage.</li>
<li>For production-ready customization and installation, see <strong>OpenTelemetry Helm Charts</strong>.</li>
<li>You can also use the <strong>OpenTelemetry Operator</strong> to <strong>provision</strong> and <strong>maintain</strong> an <strong>OpenTelemetry Collector instance</strong>, with features such as<ul>
<li><strong>automatic upgrade</strong> handling</li>
<li><strong>Service configuration</strong> based on the <strong>OpenTelemetry configuration</strong></li>
<li><strong>automatic sidecar injection</strong> into <strong>deployments</strong>, and more.</li>
</ul>
</li>
</ol>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><blockquote>
<p><strong>Patterns</strong> you can apply to <strong>deploy</strong> the <strong>OpenTelemetry collector</strong></p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector consists of <strong>a single binary</strong> which you can use in different ways, for different use cases.</li>
<li>This section describes <strong>deployment patterns</strong><ul>
<li>their <strong>use cases</strong> along with <strong>pros and cons</strong> and <strong>best practices</strong> for <strong>collector configurations</strong> for cross-environment and multi-backend deployments.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Patterns</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><em>No Collector</em></td>
<td>send signals <strong>directly</strong> from <strong>app</strong> to <strong>backends</strong></td>
</tr>
<tr>
<td><em>Agent</em></td>
<td>send signals to <strong>collectors</strong> and from there to <strong>backends</strong></td>
</tr>
<tr>
<td><em>Gateway</em></td>
<td>send signals to <strong>a single OTLP end-point</strong> and from there to <strong>backends</strong></td>
</tr>
</tbody></table>
<h3 id="No-Collector"><a href="#No-Collector" class="headerlink" title="No Collector"></a>No Collector</h3><blockquote>
<p>Why and how to send signals <strong>directly</strong> from <strong>app</strong> to <strong>backends</strong></p>
</blockquote>
<ol>
<li>The <strong>simplest pattern</strong> is <strong>not to use</strong> a <strong>collector</strong> at all.</li>
<li>This pattern consists of <strong>applications instrumented</strong> with an <strong>OpenTelemetry SDK</strong> that <strong>export</strong> telemetry signals <strong>directly</strong> into a <strong>backend</strong></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-sdk.svg" alt="otel-sdk"></p>
<h4 id="Tradeoffs"><a href="#Tradeoffs" class="headerlink" title="Tradeoffs"></a>Tradeoffs</h4><ol>
<li>Pros<ul>
<li><strong>Simple to use</strong> (especially in a dev&#x2F;test environment)</li>
<li><strong>No additional moving parts</strong> to operate (in production environments)</li>
</ul>
</li>
<li>Cons<ul>
<li>Requires <strong>code changes</strong> if <strong>collection</strong>, <strong>processing</strong>, or <strong>ingestion</strong> changes</li>
<li><strong>Strong coupling</strong> between the <strong>application code</strong> and the <strong>backend</strong></li>
<li>There are <strong>limited number of exporters</strong> per <strong>language</strong> implementation</li>
</ul>
</li>
</ol>
<h3 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h3><blockquote>
<p>Why and how to send signals to <strong>collectors</strong> and from there to <strong>backends</strong> - such as a <strong>sidecar</strong> or a <strong>daemonset</strong></p>
</blockquote>
<ol>
<li><p>The agent collector deployment pattern consists of</p>
<ul>
<li><p>applications – <strong>instrumented</strong> with an <strong>OpenTelemetry SDK</strong> using OpenTelemetry protocol (<strong>OTLP</strong>)</p>
</li>
<li><p>or <strong>other collectors</strong> (using the <strong>OTLP exporter</strong>)</p>
<ul>
<li>that send <strong>telemetry signals</strong> to a <strong>collector instance</strong> running with the <strong>application</strong></li>
<li>or on the <strong>same host</strong> as the application (such as a <strong>sidecar</strong> or a <strong>daemonset</strong>).</li>
</ul>
</li>
</ul>
</li>
<li><p>Each <strong>client-side SDK</strong> or <strong>downstream collector</strong> is configured with a <strong>collector location</strong>:</p>
<ul>
<li>In the <strong>app</strong>, the <strong>SDK</strong> is configured to <strong>send OTLP data</strong> to a <strong>collector</strong>.</li>
<li>The <strong>collector</strong> is configured to <strong>send telemetry data</strong> to <strong>one or more backends</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-agent-sdk.svg" alt="otel-agent-sdk"></p>
<h4 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h4><ol>
<li>A concrete example of the agent collector deployment pattern could look as follows:</li>
<li>You manually instrument, say, a <strong>Java application</strong> to <strong>export metrics</strong> using the <strong>OpenTelemetry Java SDK</strong>.</li>
<li>In the context of the app, you would set the <strong>OTEL_METRICS_EXPORTER</strong> to <strong>otlp</strong> (which is the <strong>default value</strong>)<ul>
<li>and configure the <strong>OTLP exporter</strong> with the address of your collector, for example (in Bash or zsh shell)</li>
</ul>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OTEL_EXPORTER_OTLP_ENDPOINT=http://collector.example.com:4318</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <strong>collector</strong> serving at collector.example.com:4318 would then be <strong>configured</strong> like so:</p>
</blockquote>
<h5 id="Traces-1"><a href="#Traces-1" class="headerlink" title="Traces"></a>Traces</h5><blockquote>
<p>Jaeger</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span> <span class="comment"># the OTLP receiver the app is sending traces to</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp/jaeger:</span> <span class="comment"># Jaeger supports OTLP directly</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">https://jaeger.example.com:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces/dev:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp/jaeger</span>]</span><br></pre></td></tr></table></figure>

<h5 id="Metrics-1"><a href="#Metrics-1" class="headerlink" title="Metrics"></a>Metrics</h5><blockquote>
<p>Prometheus</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span> <span class="comment"># the OTLP receiver the app is sending metrics to</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">prometheusremotewrite:</span> <span class="comment"># the PRW exporter, to ingest metrics to backend</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">https://prw.example.com/v1/api/remote_write</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">metrics/prod:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">prometheusremotewrite</span>]</span><br></pre></td></tr></table></figure>

<h5 id="Logs-1"><a href="#Logs-1" class="headerlink" title="Logs"></a>Logs</h5><blockquote>
<p>Elasticsearch</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span> <span class="comment"># the OTLP receiver the app is sending logs to</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">file:</span> <span class="comment"># the File Exporter, to ingest logs to local file</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./app42_example.log</span></span><br><span class="line">    <span class="attr">rotation:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">logs/dev:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">file</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Tradeoffs-1"><a href="#Tradeoffs-1" class="headerlink" title="Tradeoffs"></a>Tradeoffs</h4><ol>
<li>Pros<ul>
<li><strong>Simple</strong> to <strong>get started</strong></li>
<li>Clear <strong>1:1</strong> mapping between <strong>application</strong> and <strong>collector</strong></li>
</ul>
</li>
<li>Cons<ul>
<li><strong>Scalability</strong> - human and load-wise</li>
<li><strong>Inflexible</strong></li>
</ul>
</li>
</ol>
<h3 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h3><blockquote>
<p>Why and how to send signals to <strong>a single OTLP end-point</strong> and from there to <strong>backends</strong></p>
</blockquote>
<ol>
<li>The gateway collector deployment pattern consists of <strong>applications</strong> (or <strong>other collectors</strong>) sending <strong>telemetry signals</strong><ul>
<li>to <strong>a single OTLP endpoint</strong> provided by <strong>one or more collector instances</strong> running as a <strong>standalone service</strong><ul>
<li>for example, a <strong>deployment</strong> in <strong>Kubernetes</strong></li>
</ul>
</li>
<li>typically per <strong>cluster</strong>, per <strong>data center</strong> or per <strong>region</strong>.</li>
</ul>
</li>
<li>In the <strong>general case</strong> you can use an <strong>out-of-the-box load balancer</strong> to <strong>distribute</strong> the <strong>load</strong> amongst the collectors:</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-gateway-sdk.svg" alt="otel-gateway-sdk"></p>
<ol>
<li>For use cases where the processing of the <strong>telemetry data processing</strong> has to happen in a <strong>specific collector</strong><ul>
<li>you would use a <strong>two-tiered</strong> setup with a collector</li>
<li>that has a <strong>pipeline</strong> configured with the <strong>Trace ID&#x2F;Service-name aware load-balancing exporter</strong> in the <strong>first tier</strong></li>
<li>and the collectors <strong>handling the scale out</strong> in the <strong>second tier</strong>.</li>
</ul>
</li>
<li>For example, you will need to use the <strong>load-balancing exporter</strong> when using the <strong>Tail Sampling processor</strong><ul>
<li>so that <strong>all spans</strong> for a <strong>given trace</strong> reach the <strong>same collector instance</strong> where the tail sampling policy is applied.</li>
</ul>
</li>
<li>Let’s have a look at such a case where we are using the <strong>load-balancing exporter</strong>:<ul>
<li>In the <strong>app</strong>, the <strong>SDK</strong> is configured to send <strong>OTLP data</strong> to a <strong>central location</strong>.</li>
<li>A <strong>collector</strong> configured using the <strong>load-balancing exporter</strong> that <strong>distributes signals</strong> to a group of <strong>collectors</strong>.</li>
<li>The <strong>collectors</strong> are configured to send <strong>telemetry data</strong> to <strong>one or more backends</strong>.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-gateway-lb-sdk.svg" alt="otel-gateway-lb-sdk"></p>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><h5 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h5><blockquote>
<p>NGINX as an “<strong>out-of-the-box</strong>” load balancer</p>
</blockquote>
<ol>
<li>Assuming you have three collectors configured - collector1 + collector2 + collector3</li>
<li>and you want to <strong>load balance traffic</strong> across them using NGINX, you can use the following configuration</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">4317</span> http2;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">grpc_pass</span>      grpc://collector4317;</span><br><span class="line">            <span class="attribute">grpc_next_upstream</span>     <span class="literal">error</span> timeout invalid_header http_500;</span><br><span class="line">            <span class="attribute">grpc_connect_timeout</span>   <span class="number">2</span>;</span><br><span class="line">            <span class="attribute">grpc_set_header</span>        Host            <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">grpc_set_header</span>        X-Real-IP       <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">grpc_set_header</span>        X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">4318</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span>      http://collector4318;</span><br><span class="line">            <span class="attribute">proxy_redirect</span>  <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">proxy_next_upstream</span>     <span class="literal">error</span> timeout invalid_header http_500;</span><br><span class="line">            <span class="attribute">proxy_connect_timeout</span>   <span class="number">2</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        Host            <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        X-Real-IP       <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span>        X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">upstream</span> collector4317 &#123;</span><br><span class="line">    <span class="attribute">server</span> collector1:<span class="number">4317</span>;</span><br><span class="line">    <span class="attribute">server</span> collector2:<span class="number">4317</span>;</span><br><span class="line">    <span class="attribute">server</span> collector3:<span class="number">4317</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">upstream</span> collector4318 &#123;</span><br><span class="line">    <span class="attribute">server</span> collector1:<span class="number">4318</span>;</span><br><span class="line">    <span class="attribute">server</span> collector2:<span class="number">4318</span>;</span><br><span class="line">    <span class="attribute">server</span> collector3:<span class="number">4318</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="load-balancing-exporter"><a href="#load-balancing-exporter" class="headerlink" title="load-balancing exporter"></a>load-balancing exporter</h5><ol>
<li>For a concrete example of the <strong>centralized collector</strong> deployment pattern we first need to have a closer look at the <strong>load-balancing exporter</strong>.</li>
<li>The <strong>resolver</strong>, which determines <strong>where to find</strong> the <strong>downstream collectors</strong> (or: <strong>backends</strong>).<ul>
<li>If you use the <strong>static</strong> sub-key here, you will have to <strong>manually enumerate</strong> the <strong>collector URLs</strong>.</li>
<li>The other supported resolver is the <strong>DNS resolver</strong> which will <strong>periodically</strong> check for updates and resolve IP addresses.<ul>
<li>For this resolver type, the <strong>hostname</strong> sub-key specifies the <strong>hostname</strong> to query in order to obtain the <strong>list of IP addresses</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>With the <strong>routing_key</strong> field you tell the <strong>load-balancing exporter</strong> to <strong>route spans</strong> to <strong>specific downstream collectors</strong>.<ul>
<li>If you set this field to <strong>traceID</strong> (<strong>default</strong>) then the Load-balancing exporter exports spans based on their traceID. </li>
<li>Otherwise, if you use <strong>service</strong> as the value for routing_key<ul>
<li>it exports spans based on their <strong>service name</strong> which is useful when using <strong>connectors</strong> like the <strong>Span Metrics connector</strong></li>
<li>so <strong>all spans</strong> of a <strong>service</strong> will be send to the <strong>same downstream collector</strong> for <strong>metric collection</strong>, guaranteeing <strong>accurate aggregations</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>load-balancing exporter</strong> emits <strong>metrics</strong> including <strong>otelcol_loadbalancer_num_backends</strong> and <strong>otelcol_loadbalancer_backend_latency</strong><ul>
<li>that you can use for <strong>health and performance monitoring</strong> of the <strong>OTLP endpoint collector</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The <strong>first-tier collector</strong> servicing the <strong>OTLP endpoint</strong> would be configured as shown below:</p>
</blockquote>
<h6 id="Static"><a href="#Static" class="headerlink" title="Static"></a>Static</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">loadbalancing:</span></span><br><span class="line">    <span class="attr">protocol:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">          <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">resolver:</span></span><br><span class="line">      <span class="attr">static:</span></span><br><span class="line">        <span class="attr">hostnames:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">collector-1.example.com:4317</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">collector-2.example.com:5317</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">collector-3.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">loadbalancing</span>]</span><br></pre></td></tr></table></figure>

<h6 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">loadbalancing:</span></span><br><span class="line">    <span class="attr">protocol:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">          <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">resolver:</span></span><br><span class="line">      <span class="attr">dns:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">collectors.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">loadbalancing</span>]</span><br></pre></td></tr></table></figure>

<h6 id="DNS-with-service"><a href="#DNS-with-service" class="headerlink" title="DNS with service"></a>DNS with service</h6><blockquote>
<p>routing_key: service</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">loadbalancing:</span></span><br><span class="line">    <span class="attr">routing_key:</span> <span class="string">service</span></span><br><span class="line">    <span class="attr">protocol:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">          <span class="attr">insecure:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">resolver:</span></span><br><span class="line">      <span class="attr">dns:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">collectors.example.com</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">loadbalancing</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Combined-deployment"><a href="#Combined-deployment" class="headerlink" title="Combined deployment"></a>Combined deployment</h4><blockquote>
<p>Combined deployment of Collectors as <strong>agents</strong> and <strong>gateways</strong></p>
</blockquote>
<ol>
<li>Often a deployment of <strong>multiple OpenTelemetry collectors</strong> involves running <strong>both</strong> Collector as <strong>gateways</strong> and as <strong>agents</strong>.</li>
<li>The following diagram shows an architecture for such a <strong>combined deployment</strong>:<ul>
<li>We use the <strong>Collectors</strong> running in the <strong>agent</strong> deployment pattern (running on <strong>each host</strong>, similar to <strong>Kubernetes daemonsets</strong>)<ul>
<li>to collect <strong>telemetry from services running on the host</strong> and <strong>host telemetry</strong>, such as <strong>host metrics</strong> and <strong>scrap logs</strong>.</li>
</ul>
</li>
<li>We use <strong>Collectors</strong> running in the <strong>gateway</strong> deployment pattern to <strong>process data</strong>, such as <strong>filtering</strong>, <strong>sampling</strong>, and <strong>exporting to backends</strong> etc.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-gateway-arch.svg" alt="otel-gateway-arch"></p>
<ol>
<li>This <strong>combined</strong> deployment pattern is <strong>necessary</strong><ul>
<li>when you use components in your Collector that either need to <strong>be unique per host</strong></li>
<li>or that consume information that is <strong>only available on the same host</strong> as the application is running:</li>
</ul>
</li>
<li><strong>Receivers</strong> like the <strong>hostmetricsreceiver</strong> or <strong>filelogreceiver</strong> need to <strong>be unique per host instance</strong>.<ul>
<li>Running <strong>multiple instances</strong> of these receivers will result in <strong>duplicated data</strong>.</li>
</ul>
</li>
<li><strong>Processors</strong> like the <strong>resourcedetectionprocessor</strong> are used to <strong>add information about the host</strong>, the <strong>collector</strong> and the <strong>application</strong> are running on.<ul>
<li>Running them within a Collector on a <strong>remote machine</strong> will result in <strong>incorrect data</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Tradeoffs-2"><a href="#Tradeoffs-2" class="headerlink" title="Tradeoffs"></a>Tradeoffs</h4><ol>
<li>Pros<ul>
<li><strong>Separation of concerns</strong> such as centrally managed credentials</li>
<li><strong>Centralized policy management</strong> (for example, <strong>filtering certain logs</strong> or <strong>sampling</strong>)</li>
</ul>
</li>
<li>Cons<ul>
<li>It’s one more thing to maintain and that can fail (<strong>complexity</strong>)</li>
<li><strong>Added latency</strong> in case of <strong>cascaded collectors</strong></li>
<li>Higher overall resource usage (<strong>costs</strong>)</li>
</ul>
</li>
</ol>
<h4 id="Single-writer-principle"><a href="#Single-writer-principle" class="headerlink" title="Single-writer principle"></a>Single-writer principle</h4><blockquote>
<p><strong>Multiple collectors</strong> and the <strong>single-writer principle</strong></p>
</blockquote>
<ol>
<li><strong>All metric data streams</strong> within <strong>OTLP</strong> must have <strong>a single writer</strong>.</li>
<li>When deploying <strong>multiple collectors</strong> in a <strong>gateway configuration</strong><ul>
<li>it’s important to ensure that <strong>all metric data streams</strong> have <strong>a single writer</strong> and <strong>a globally unique identity</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Potential-problems"><a href="#Potential-problems" class="headerlink" title="Potential problems"></a>Potential problems</h5><ol>
<li><strong>Concurrent access</strong> from <strong>multiple applications</strong> that <strong>modify or report</strong> on the <strong>same data</strong> can lead to <strong>data loss</strong> or <strong>degraded data quality</strong>.</li>
<li>For example, you might see <strong>inconsistent data</strong> from <strong>multiple sources</strong> on the <strong>same resource</strong><ul>
<li>where the <strong>different sources</strong> can <strong>overwrite each other</strong> because the <strong>resource</strong> is <strong>not uniquely identified</strong>.</li>
</ul>
</li>
<li>There are <strong>patterns in the data</strong> that may <strong>provide some insight</strong> into <strong>whether</strong> this is <strong>happening</strong> or <strong>not</strong>.<ul>
<li>a series with <strong>unexplained gaps or jumps</strong> in the same series may be a <strong>clue</strong> that <strong>multiple collectors</strong> are sending the <strong>same samples</strong>. </li>
<li>You might also see <strong>errors</strong> in your <strong>backend</strong>.<ul>
<li>For example, with a <strong>Prometheus</strong> backend: Error on ingesting <strong>out-of-order</strong> samples</li>
<li>This error could indicate that <strong>identical targets</strong> exist in <strong>two jobs</strong>, and the <strong>order of the timestamps</strong> is <strong>incorrect</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Metric M1 received at T1 with a timestamp 13:56:04 with value 100</span><br><span class="line">Metric M1 received at T2 with a timestamp 13:56:24 with value 120</span><br><span class="line">Metric M1 received at T3 with a timestamp 13:56:04 with value 110</span><br><span class="line">Metric M1 received at time 13:56:24 with value 120</span><br><span class="line">Metric M1 received at time 13:56:04 with value 110</span><br></pre></td></tr></table></figure>

<h5 id="Best-practices"><a href="#Best-practices" class="headerlink" title="Best practices"></a>Best practices</h5><ol>
<li>Use the <strong>Kubernetes attributes processor</strong> to add <strong>labels</strong> to <strong>different Kubernetes resources</strong>.</li>
<li>Use the <strong>resource detector processor</strong> to <strong>detect resource information from the host</strong> and <strong>collect resource metadata</strong>.</li>
</ol>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><blockquote>
<p>You can <strong>configure</strong> the OpenTelemetry Collector to suit your <strong>observability needs</strong>.</p>
</blockquote>
<h3 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h3><ol>
<li>By default, the Collector configuration is located in <code>/etc/&lt;otel-directory&gt;/config.yaml</code></li>
<li>where <code>&lt;otel-directory&gt;</code> can be <strong>otelcol</strong>, <strong>otelcol-contrib</strong>, or <strong>another value</strong></li>
<li>depending on the <strong>Collector version</strong> or the <strong>Collector distribution</strong> you’re using.</li>
</ol>
<blockquote>
<p>You can provide one or more configurations using the <strong>–config</strong> option. For example:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otelcol --config=customconfig.yaml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can also provide configurations using <strong>environment variables</strong>, <strong>HTTP URIs</strong>, or <strong>YAML paths</strong>. For example:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">otelcol --config=env:MY_CONFIG_IN_AN_ENVVAR --config=https://server/config.yaml</span><br><span class="line">otelcol --config=&quot;yaml:exporters::debug::verbosity: normal&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>When referring to <strong>nested keys</strong> in <strong>YAML paths</strong>, make sure to use double colons (<strong>::</strong>) to avoid confusion with namespaces that contain <strong>dots</strong>.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">receivers::docker_stats::metrics::container.cpu.utilization::enabled: false</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To validate a configuration file, use the <strong>validate</strong> command. For example:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otelcol validate --config=customconfig.yaml</span><br></pre></td></tr></table></figure>

<h3 id="Configuration-structure"><a href="#Configuration-structure" class="headerlink" title="Configuration structure"></a>Configuration structure</h3><ol>
<li>The structure of any <strong>Collector configuration file</strong> consists of <strong>four classes</strong> of <strong>pipeline components</strong> that <strong>access telemetry data</strong>:<ul>
<li><strong>Receivers</strong> + <strong>Processors</strong> + <strong>Exporters</strong> + <strong>Connectors</strong></li>
</ul>
</li>
<li>After <strong>each pipeline component</strong> is <strong>configured</strong> you must <strong>enable</strong> it using the pipelines within the <strong>service</strong> section of the configuration file.</li>
<li>Besides pipeline components you can also configure <strong>extensions</strong><ul>
<li>which provide capabilities that can be added to the Collector, such as <strong>diagnostic tools</strong>.</li>
<li>Extensions <strong>don’t require direct access to telemetry data</strong> and are <strong>enabled</strong> through the <strong>service</strong> section.</li>
</ul>
</li>
<li>The following is an example of <strong>Collector configuration</strong> with a <strong>receiver</strong>, a <strong>processor</strong>, an <strong>exporter</strong>, and three <strong>extensions</strong>.<ul>
<li>While it is <strong>generally preferable</strong> to bind endpoints to <strong>localhost</strong> when all clients are <strong>local</strong><ul>
<li>our example configurations use the “<strong>unspecified</strong>” address <strong>0.0.0.0</strong> as a <strong>convenience</strong>.</li>
</ul>
</li>
<li>The Collector <strong>currently defaults</strong> to <strong>0.0.0.0</strong>, but the default will be <strong>changed to localhost</strong> in the <strong>near future</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">health_check:</span></span><br><span class="line">  <span class="attr">pprof:</span></span><br><span class="line">  <span class="attr">zpages:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> [<span class="string">health_check</span>, <span class="string">pprof</span>, <span class="string">zpages</span>]</span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<ol>
<li>Note that <strong>receivers</strong>, <strong>processors</strong>, <strong>exporters</strong> and <strong>pipelines</strong> are defined through <strong>component identifiers</strong> following the <strong>type[&#x2F;name]</strong> format<ul>
<li>for example <strong>otlp</strong> or <strong>otlp&#x2F;2</strong>.</li>
</ul>
</li>
<li>You can define components of a given type <strong>more than once</strong> as long as the <strong>identifiers</strong> are <strong>unique</strong>. For example:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line">  <span class="attr">otlp/2:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:55690</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line">  <span class="attr">batch/test:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol:4317</span></span><br><span class="line">  <span class="attr">otlp/2:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol2:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">health_check:</span></span><br><span class="line">  <span class="attr">pprof:</span></span><br><span class="line">  <span class="attr">zpages:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> [<span class="string">health_check</span>, <span class="string">pprof</span>, <span class="string">zpages</span>]</span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">traces/2:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp/2</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch/test</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp/2</span>]</span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The configuration can also <strong>include other files</strong>, causing the Collector to <strong>merge</strong> them in a single <strong>in-memory representation</strong> of the YAML configuration:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span> <span class="string">$&#123;file:exporters.yaml&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> []</span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">---</span> <span class="string">exporters.yaml</span></span><br><span class="line"><span class="attr">otlp:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">otelcol.observability.svc.cluster.local:443</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The <strong>final result in memory</strong> will be:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol.observability.svc.cluster.local:443</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> []</span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Receivers"><a href="#Receivers" class="headerlink" title="Receivers"></a>Receivers</h3><ol>
<li>Receivers <strong>collect telemetry</strong> from <strong>one or more sources</strong>. They can be <strong>pull</strong> or <strong>push</strong> based, and may support <strong>one or more data sources</strong> (signals).</li>
<li>Receivers are configured in the <strong>receivers section</strong>.<ul>
<li>Many receivers come with <strong>default settings</strong>, so that specifying the <strong>name of the receiver</strong> is <strong>enough</strong> to configure it. </li>
<li>If you need to <strong>configure a receiver</strong> or want to <strong>change the default configuration</strong>, you can do so in this section.<ul>
<li>Any setting you specify <strong>overrides</strong> the default values, <strong>if present</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Configuring</strong> a receiver <strong>does not enable</strong> it.<ul>
<li>Receivers are enabled by adding them to the appropriate <strong>pipelines</strong> within the <strong>service</strong> section.</li>
</ul>
</li>
<li>The Collector requires <strong>one or more receivers</strong>. The following example shows various receivers in the same configuration file:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="comment"># Data sources: logs</span></span><br><span class="line">  <span class="attr">fluentforward:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8006</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: metrics</span></span><br><span class="line">  <span class="attr">hostmetrics:</span></span><br><span class="line">    <span class="attr">scrapers:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">      <span class="attr">disk:</span></span><br><span class="line">      <span class="attr">filesystem:</span></span><br><span class="line">      <span class="attr">load:</span></span><br><span class="line">      <span class="attr">memory:</span></span><br><span class="line">      <span class="attr">network:</span></span><br><span class="line">      <span class="attr">process:</span></span><br><span class="line">      <span class="attr">processes:</span></span><br><span class="line">      <span class="attr">paging:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">jaeger:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">      <span class="attr">thrift_binary:</span></span><br><span class="line">      <span class="attr">thrift_compact:</span></span><br><span class="line">      <span class="attr">thrift_http:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">protocol_version:</span> <span class="number">2.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics</span></span><br><span class="line">  <span class="attr">opencensus:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">        <span class="attr">tls:</span></span><br><span class="line">          <span class="attr">cert_file:</span> <span class="string">cert.pem</span></span><br><span class="line">          <span class="attr">key_file:</span> <span class="string">cert-key.pem</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4318</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: metrics</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">scrape_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">otel-collector</span></span><br><span class="line">          <span class="attr">scrape_interval:</span> <span class="string">5s</span></span><br><span class="line">          <span class="attr">static_configs:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">localhost:8888</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br></pre></td></tr></table></figure>

<h3 id="Processors"><a href="#Processors" class="headerlink" title="Processors"></a>Processors</h3><ol>
<li>Processors take the data <strong>collected by receivers</strong> and <strong>modify</strong> or <strong>transform</strong> it before <strong>sending</strong> it to the <strong>exporters</strong>.</li>
<li><strong>Data processing</strong> happens according to <strong>rules or settings</strong> defined for each <strong>processor</strong><ul>
<li>which might include <strong>filtering</strong>, <strong>dropping</strong>, <strong>renaming</strong>, or <strong>recalculating</strong> telemetry, among other operations.</li>
</ul>
</li>
<li>The <strong>order of the processors in a pipeline</strong> determines the <strong>order of the processing operations</strong> that the Collector <strong>applies to the signal</strong>.</li>
<li>Processors are <strong>optional</strong>, although some are <strong>recommended</strong></li>
<li>You can configure processors using the <strong>processors section</strong> of the Collector configuration file.<ul>
<li>Any setting you specify <strong>overrides</strong> the default values, <strong>if present</strong>.</li>
</ul>
</li>
<li><strong>Configuring</strong> a processor <strong>does not enable</strong> it.<ul>
<li>Processors are enabled by adding them to the appropriate <strong>pipelines</strong> within the <strong>service</strong> section.</li>
</ul>
</li>
<li>The following example shows several default processors in the same configuration file.<ul>
<li>You can find the <strong>full list of processors</strong> by combining the list from <strong>opentelemetry-collector-contrib</strong> and the list from <strong>opentelemetry-collector</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">attributes:</span></span><br><span class="line">    <span class="attr">actions:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">production</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">insert</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">db.statement</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">delete</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">email</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">hash</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: metrics, metrics, logs</span></span><br><span class="line">  <span class="attr">filter:</span></span><br><span class="line">    <span class="attr">error_mode:</span> <span class="string">ignore</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">span:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;attributes[&quot;container.name&quot;] == &quot;app_container_1&quot;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;resource.attributes[&quot;host.name&quot;] == &quot;localhost&quot;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;name == &quot;app_3&quot;&#x27;</span></span><br><span class="line">      <span class="attr">spanevent:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;attributes[&quot;grpc&quot;] == true&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;IsMatch(name, &quot;.*grpc.*&quot;)&#x27;</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">metric:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;name == &quot;my.metric&quot; and resource.attributes[&quot;my_label&quot;] == &quot;abc123&quot;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;type == METRIC_DATA_TYPE_HISTOGRAM&#x27;</span></span><br><span class="line">      <span class="attr">datapoint:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;metric.type == METRIC_DATA_TYPE_SUMMARY&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;resource.attributes[&quot;service.name&quot;] == &quot;my_service_name&quot;&#x27;</span></span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">log_record:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;IsMatch(body, &quot;.*password.*&quot;)&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;severity_number &lt; SEVERITY_NUMBER_WARN&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">memory_limiter:</span></span><br><span class="line">    <span class="attr">check_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">limit_mib:</span> <span class="number">4000</span></span><br><span class="line">    <span class="attr">spike_limit_mib:</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">resource:</span></span><br><span class="line">    <span class="attr">attributes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">cloud.zone</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">zone-1</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">upsert</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">k8s.cluster.name</span></span><br><span class="line">        <span class="attr">from_attribute:</span> <span class="string">k8s-cluster</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">insert</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">redundant-attribute</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">delete</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">probabilistic_sampler:</span></span><br><span class="line">    <span class="attr">hash_seed:</span> <span class="number">22</span></span><br><span class="line">    <span class="attr">sampling_percentage:</span> <span class="number">15</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">span:</span></span><br><span class="line">    <span class="attr">name:</span></span><br><span class="line">      <span class="attr">to_attributes:</span></span><br><span class="line">        <span class="attr">rules:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">^\/api\/v1\/document\/(?P&lt;documentId&gt;.*)\/update$</span></span><br><span class="line">      <span class="attr">from_attributes:</span> [<span class="string">db.svc</span>, <span class="string">operation</span>]</span><br><span class="line">      <span class="attr">separator:</span> <span class="string">&#x27;::&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="Exporters"><a href="#Exporters" class="headerlink" title="Exporters"></a>Exporters</h3><ol>
<li>Exporters send data to <strong>one or more backends or destinations</strong>.</li>
<li>Exporters can be <strong>pull</strong> or <strong>push</strong> based, and may support <strong>one or more data sources - signals</strong>.</li>
<li>Each <strong>key</strong> within the <strong>exporters section</strong> defines an <strong>exporter instance</strong>，The key follows the <strong>type&#x2F;name</strong> format<ul>
<li>where <strong>type</strong> specifies the <strong>exporter type</strong> (e.g., <strong>otlp</strong>, <strong>kafka</strong>, <strong>prometheus</strong>)</li>
<li>and <strong>name</strong> (<strong>optional</strong>) can be <strong>appended</strong> to provide a <strong>unique name</strong> for <strong>multiple instance</strong> of the <strong>same type</strong>.</li>
</ul>
</li>
<li><strong>Most exporters</strong> require configuration to specify at least the <strong>destination</strong>, as well as <strong>security settings</strong>，like <strong>authentication tokens</strong> or <strong>TLS certificates</strong>.<ul>
<li>Any setting you specify <strong>overrides</strong> the default values, <strong>if present</strong>.</li>
</ul>
</li>
<li><strong>Configuring</strong> an exporter <strong>does not enable</strong> it.<ul>
<li>Exporters are enabled by adding them to the appropriate <strong>pipelines</strong> within the <strong>service</strong> section.</li>
</ul>
</li>
<li>Notice that some exporters require <strong>x.509 certificates</strong> in order to <strong>establish secure connections</strong>, as described in setting up certificates.</li>
<li>The Collector requires <strong>one or more exporters</strong>. The following example shows various exporters in the same configuration file:</li>
</ol>
<blockquote>
<p>otlphttp</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./filename.json</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">otlp/jaeger:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">jaeger-server:4317</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">      <span class="attr">cert_file:</span> <span class="string">cert.pem</span></span><br><span class="line">      <span class="attr">key_file:</span> <span class="string">cert-key.pem</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">protocol_version:</span> <span class="number">2.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics</span></span><br><span class="line">  <span class="attr">opencensus:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol2:55678</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics, logs</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">otelcol2:4317</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">      <span class="attr">cert_file:</span> <span class="string">cert.pem</span></span><br><span class="line">      <span class="attr">key_file:</span> <span class="string">cert-key.pem</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces, metrics</span></span><br><span class="line">  <span class="attr">otlphttp:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">https://otlp.example.com:4318</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: metrics</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8889</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: metrics</span></span><br><span class="line">  <span class="attr">prometheusremotewrite:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">http://prometheus.example.com:9411/api/prom/push</span></span><br><span class="line">    <span class="comment"># When using the official Prometheus (running via Docker)</span></span><br><span class="line">    <span class="comment"># endpoint: &#x27;http://prometheus:9090/api/v1/write&#x27;, add:</span></span><br><span class="line">    <span class="comment"># tls:</span></span><br><span class="line">    <span class="comment">#   insecure: true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Data sources: traces</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">http://zipkin.example.com:9411/api/v2/spans</span></span><br></pre></td></tr></table></figure>

<h3 id="Connectors"><a href="#Connectors" class="headerlink" title="Connectors"></a>Connectors</h3><ol>
<li>Connectors <strong>join two pipelines</strong>, acting as <strong>both exporter and receiver</strong>.</li>
<li>A connector consumes data as an <strong>exporter</strong> at the <strong>end</strong> of one pipeline and emits data as a <strong>receiver</strong> at the <strong>beginning</strong> of another pipeline.</li>
<li>The data <strong>consumed</strong> and <strong>emitted</strong> may be of the <strong>same type</strong> or of <strong>different data types</strong>.</li>
<li>You can use connectors to <strong>summarize</strong> consumed data, <strong>replicate</strong> it, or <strong>route</strong> it.</li>
<li>You can configure <strong>one or more connectors</strong> using the <strong>connectors section</strong> of the Collector configuration file.<ul>
<li>By default, <strong>no connectors</strong> are configured.</li>
<li>Each <strong>type of connector</strong> is designed to work with <strong>one or more pairs of data types</strong> and may only be used to <strong>connect pipelines accordingly</strong>.</li>
</ul>
</li>
<li><strong>Configuring</strong> a connector <strong>doesn’t enable</strong> it.<ul>
<li>Connectors are enabled through <strong>pipelines</strong> within the <strong>service</strong> section.</li>
</ul>
</li>
<li>The following example shows the <strong>count connector</strong> and how it’s configured in the <strong>pipelines section</strong>.<ul>
<li>Notice that the <strong>connector</strong> acts as an <strong>exporter for traces</strong> and as a <strong>receiver for metrics</strong>, connecting both pipelines:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">foo:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">bar:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">connectors:</span></span><br><span class="line">  <span class="attr">count:</span></span><br><span class="line">    <span class="attr">spanevents:</span></span><br><span class="line">      <span class="attr">my.prod.event.count:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">The</span> <span class="string">number</span> <span class="string">of</span> <span class="string">span</span> <span class="string">events</span> <span class="string">from</span> <span class="string">my</span> <span class="string">prod</span> <span class="string">environment.</span></span><br><span class="line">        <span class="attr">conditions:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;attributes[&quot;env&quot;] == &quot;prod&quot;&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;name == &quot;prodevent&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">foo</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">count</span>]</span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">count</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">bar</span>]</span><br></pre></td></tr></table></figure>

<h3 id="Extensions"><a href="#Extensions" class="headerlink" title="Extensions"></a>Extensions</h3><ol>
<li>Extensions are <strong>optional components</strong><ul>
<li>that <strong>expand the capabilities</strong> of the Collector to accomplish tasks <strong>not directly involved</strong> with <strong>processing telemetry data</strong>.</li>
<li>For example, you can add extensions for Collector <strong>health monitoring</strong>, <strong>service discovery</strong>, or <strong>data forwarding</strong>, among others.</li>
</ul>
</li>
<li>You can configure extensions through the <strong>extensions section</strong> of the Collector configuration file.<ul>
<li>Most extensions come with <strong>default settings</strong>, so you can configure them just by specifying the <strong>name</strong> of the extension.</li>
<li>Any setting you specify <strong>overrides</strong> the default values, <strong>if present</strong>.</li>
</ul>
</li>
<li><strong>Configuring</strong> an extension <strong>doesn’t enable</strong> it. Extensions are enabled within the <strong>service</strong> section.</li>
<li>By default, <strong>no extensions</strong> are configured. The following example shows several extensions configured in the same file:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">health_check:</span></span><br><span class="line">  <span class="attr">pprof:</span></span><br><span class="line">  <span class="attr">zpages:</span></span><br></pre></td></tr></table></figure>

<h3 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h3><ol>
<li>The <strong>service section</strong> is used to configure <strong>what components are enabled</strong> in the Collector based on<ul>
<li>the configuration found in the <strong>receivers</strong>, <strong>processors</strong>, <strong>exporters</strong>, and <strong>extensions</strong> sections.</li>
</ul>
</li>
<li>If a <strong>component</strong> is <strong>configured</strong>, but <strong>not defined within the service section</strong>, then it’s <strong>not enabled</strong>.</li>
<li>The service section consists of three subsections - <strong>Extensions</strong> + <strong>Pipelines</strong> + <strong>Telemetry</strong></li>
</ol>
<h4 id="Extensions-1"><a href="#Extensions-1" class="headerlink" title="Extensions"></a>Extensions</h4><blockquote>
<p>The extensions subsection consists of a list of desired extensions to be enabled. For example:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> [<span class="string">health_check</span>, <span class="string">pprof</span>, <span class="string">zpages</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Pipelines"><a href="#Pipelines" class="headerlink" title="Pipelines"></a>Pipelines</h4><ol>
<li>The pipelines subsection is where the pipelines are configured, which can be of the following types:<ul>
<li><strong>traces</strong> - collect and processes trace data.</li>
<li><strong>metrics</strong> - collect and processes metric data.</li>
<li><strong>logs</strong> - collect and processes log data.</li>
</ul>
</li>
<li>A <strong>pipeline</strong> consists of a <strong>set</strong> of <strong>receivers</strong>, <strong>processors</strong> and <strong>exporters</strong>.<ul>
<li><strong>Before including</strong> a receiver, processor, or exporter in a pipeline, make sure to <strong>define</strong> its configuration in the appropriate section.</li>
</ul>
</li>
<li>You can use the <strong>same receiver, processor, or exporter</strong> in <strong>more than one pipeline</strong>.<ul>
<li>When a <strong>processor</strong> is <strong>referenced in multiple pipelines</strong>, each <strong>pipeline</strong> gets a <strong>separate instance of the processor</strong>.</li>
</ul>
</li>
<li>The following is an example of pipeline configuration. Note that the <strong>order of processors</strong> dictates the <strong>order</strong> in which <strong>data</strong> is <strong>processed</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">opencensus</span>, <span class="string">prometheus</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">opencensus</span>, <span class="string">prometheus</span>]</span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">opencensus</span>, <span class="string">jaeger</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>, <span class="string">memory_limiter</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">opencensus</span>, <span class="string">zipkin</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Telemetry"><a href="#Telemetry" class="headerlink" title="Telemetry"></a>Telemetry</h4><ol>
<li>The telemetry config section is where you can set up <strong>observability</strong> for the <strong>Collector itself</strong>.</li>
<li>It consists of two subsections: <strong>logs</strong> and <strong>metrics</strong>.</li>
</ol>
<h3 id="Other-Information"><a href="#Other-Information" class="headerlink" title="Other Information"></a>Other Information</h3><h4 id="Environment-variables"><a href="#Environment-variables" class="headerlink" title="Environment variables"></a>Environment variables</h4><ol>
<li>The use and expansion of environment variables is supported in the Collector configuration.</li>
<li>For example to use the values stored on the <strong>DB_KEY</strong> and <strong>OPERATION</strong> environment variables you can write the following:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">attributes/example:</span></span><br><span class="line">    <span class="attr">actions:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">$&#123;env:DB_KEY&#125;</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">$&#123;env:OPERATION&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Use <strong>$$</strong> to indicate a literal <strong>$</strong>. - For example, representing <strong>$DataVisualization</strong> would look like the following</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">prometheus:8889</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">$$DataVisualization</span></span><br></pre></td></tr></table></figure>

<h4 id="Proxy-support"><a href="#Proxy-support" class="headerlink" title="Proxy support"></a>Proxy support</h4><ol>
<li>Exporters that use the <strong>net&#x2F;http</strong> package respect the following <strong>proxy</strong> environment variables<ul>
<li><strong>HTTP_PROXY</strong> - Address of the HTTP proxy</li>
<li><strong>HTTPS_PROXY</strong> - Address of the HTTPS proxy</li>
<li><strong>NO_PROXY</strong> - Addresses that must not use the proxy</li>
</ul>
</li>
<li>If set at Collector <strong>start time</strong>, exporters, <strong>regardless of the protocol</strong>, proxy traffic or bypass proxy traffic as defined by these environment variables.</li>
</ol>
<h4 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h4><ol>
<li>Most <strong>receivers</strong> exposing an <strong>HTTP</strong> or <strong>gRPC</strong> port can be <strong>protected</strong> using the Collector’s <strong>authentication mechanism</strong>.<ul>
<li>Similarly, most <strong>exporters</strong> using <strong>HTTP</strong> or <strong>gRPC</strong> clients can add <strong>authentication</strong> to <strong>outgoing requests</strong>.</li>
</ul>
</li>
<li>The <strong>authentication mechanism</strong> in the Collector uses the <strong>extensions</strong> mechanism<ul>
<li>allowing for <strong>custom authenticators</strong> to be <strong>plugged</strong> into <strong>Collector distributions</strong>.</li>
</ul>
</li>
<li>Each <strong>authentication extension</strong> has two possible <strong>usages</strong><ul>
<li>As <strong>client authenticator</strong> for <strong>exporters</strong>, adding <strong>auth data</strong> to <strong>outgoing requests</strong></li>
<li>As <strong>server authenticator</strong> for <strong>receivers</strong>, authenticating <strong>incoming connections</strong>.</li>
</ul>
</li>
<li>To add a <strong>server authenticator</strong> to a <strong>receiver</strong> in the Collector, follow these steps:<ul>
<li>Add the <strong>authenticator extension and its configuration</strong> under <strong>.extensions</strong>.</li>
<li>Add a <strong>reference</strong> to the <strong>authenticator</strong> to <strong>.services.extensions</strong>, so that it’s <strong>loaded</strong> by the Collector.</li>
<li>Add a <strong>reference</strong> to the <strong>authenticator</strong> under <code>.receivers.&lt;your-receiver&gt;.&lt;http-or-grpc-config&gt;.auth</code></li>
</ul>
</li>
<li>The following example uses the <strong>OIDC authenticator</strong> on the <strong>receiver side</strong><ul>
<li>making this suitable for a <strong>remote Collector</strong> that <strong>receives data</strong> from an <strong>OpenTelemetry Collector</strong> acting as <strong>agent</strong>:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">oidc:</span></span><br><span class="line">    <span class="attr">issuer_url:</span> <span class="string">http://localhost:8080/auth/realms/opentelemetry</span></span><br><span class="line">    <span class="attr">audience:</span> <span class="string">collector</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp/auth:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line">        <span class="attr">auth:</span></span><br><span class="line">          <span class="attr">authenticator:</span> <span class="string">oidc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`.</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">oidc</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp/auth</span></span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>On the <strong>agent side</strong>, this is an example that makes the <strong>OTLP exporter</strong> obtain <strong>OIDC tokens</strong>, adding them to every <strong>RPC</strong> made to a remote Collector:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">oauth2client:</span></span><br><span class="line">    <span class="attr">client_id:</span> <span class="string">agent</span></span><br><span class="line">    <span class="attr">client_secret:</span> <span class="string">some-secret</span></span><br><span class="line">    <span class="attr">token_url:</span> <span class="string">http://localhost:8080/auth/realms/opentelemetry/protocol/openid-connect/token</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp/auth:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">remote-collector:4317</span></span><br><span class="line">    <span class="attr">auth:</span></span><br><span class="line">      <span class="attr">authenticator:</span> <span class="string">oauth2client</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">oauth2client</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp/auth</span></span><br></pre></td></tr></table></figure>

<h4 id="Configuring-certificates"><a href="#Configuring-certificates" class="headerlink" title="Configuring certificates"></a>Configuring certificates</h4><ol>
<li>In a <strong>production</strong> environment, use <strong>TLS certificates</strong> for <strong>secure communication</strong> or <strong>mTLS</strong> for <strong>mutual authentication</strong>.</li>
<li>Follow these steps to generate <strong>self-signed certificates</strong> as in this example.<ul>
<li>You might want to use your current <strong>cert provisioning procedures</strong> to <strong>procure a certificate</strong> for <strong>production</strong> usage.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Install <strong>cfssl</strong> and create the following <strong>csr.json</strong> file:</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;algo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rsa&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">2048</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;O&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OpenTelemetry Example&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Then run the following commands:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfssl genkey -initca csr.json | cfssljson -bare ca</span><br><span class="line">cfssl gencert -ca ca.pem -ca-key ca-key.pem csr.json | cfssljson -bare cert</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212201223645.png" alt="image-20250212201223645"></p>
<blockquote>
<p>This creates two <strong>certificates</strong>:</p>
</blockquote>
<ol>
<li>An “OpenTelemetry Example” <strong>Certificate Authority</strong> (CA) in <strong>ca.pem</strong>, with the associated key in <strong>ca-key.pem</strong></li>
<li>A <strong>client certificate</strong> in <strong>cert.pem</strong>, signed by the OpenTelemetry Example <strong>CA</strong>, with the associated key in <strong>cert-key.pem</strong>.</li>
</ol>
<h4 id="Override-settings"><a href="#Override-settings" class="headerlink" title="Override settings"></a>Override settings</h4><blockquote>
<p>The <strong>–set</strong> option doesn’t support setting a <strong>key</strong> that <strong>contains</strong> a <strong>dot</strong> or an <strong>equal</strong> sign.</p>
</blockquote>
<ol>
<li>You can <strong>override</strong> Collector settings using the <strong>–set</strong> option.</li>
<li>The settings you define with this method are <strong>merged</strong> into the <strong>final configuration</strong> after all <strong>–config</strong> sources are resolved and merged.</li>
<li>The following examples show how to <strong>override</strong> settings inside <strong>nested</strong> sections:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">otelcol --set &quot;exporters::debug::verbosity=detailed&quot;</span><br><span class="line">otelcol --set &quot;receivers::otlp::protocols::grpc=&#123;endpoint:localhost:4317, compression: gzip&#125;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Management"><a href="#Management" class="headerlink" title="Management"></a>Management</h2><blockquote>
<p>How to manage your OpenTelemetry collector deployment <strong>at scale</strong></p>
</blockquote>
<h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><blockquote>
<p><strong>Telemetry collection at scale</strong> requires a <strong>structured approach</strong> to manage agents. Typical <strong>agent management tasks</strong> include:</p>
</blockquote>
<ol>
<li><strong>Querying</strong> the agent <strong>information</strong> and <strong>configuration</strong>. <ul>
<li>The agent <strong>information</strong> can include its <strong>version</strong>, <strong>operating system related information</strong>, or <strong>capabilities</strong>.</li>
<li>The <strong>configuration</strong> of the agent refers to its <strong>telemetry collection setup</strong>, for example, the OpenTelemetry Collector configuration.</li>
</ul>
</li>
<li><strong>Upgrading&#x2F;downgrading agents</strong> and <strong>management of agent-specific packages</strong>, including the base agent <strong>functionality</strong> and <strong>plugins</strong>.</li>
<li><strong>Applying new configurations</strong> to agents. This might be required because of <strong>changes in the environment</strong> or due to <strong>policy changes</strong>.</li>
<li><strong>Health and performance monitoring</strong> of the agents<ul>
<li>typically <strong>CPU and memory usage</strong> and also <strong>agent-specific metrics</strong>, for example, the <strong>rate of processing</strong> or <strong>backpressure-related</strong> information.</li>
</ul>
</li>
<li><strong>Connection management</strong> between a <strong>control plane</strong> and the <strong>agent</strong> such as handling of <strong>TLS certificates</strong> (<strong>revocation</strong> and <strong>rotation</strong>).</li>
</ol>
<blockquote>
<p><strong>Not every use case</strong> requires support for <strong>all</strong> of the above agent management tasks.<br>In the context of OpenTelemetry task 4. <strong>Health and performance monitoring</strong> is ideally done using <strong>OpenTelemetry</strong>.</p>
</blockquote>
<h3 id="OpAMP-1"><a href="#OpAMP-1" class="headerlink" title="OpAMP"></a>OpAMP</h3><ol>
<li><strong>Observability vendors</strong> and <strong>cloud providers</strong> offer <strong>proprietary solutions</strong> for <strong>agent management</strong>.<ul>
<li>In the <strong>open source observability space</strong>, there is an <strong>emerging standard</strong> that you can use for <strong>agent management</strong></li>
<li><strong>Open Agent Management Protocol</strong> (<strong>OpAMP</strong>).</li>
</ul>
</li>
<li>The <strong>OpAMP specification</strong> defines how to <strong>manage</strong> a fleet of <strong>telemetry data agents</strong>.<ul>
<li>These agents can be <strong>OpenTelemetry Collectors</strong>, <strong>Fluent Bit</strong> or other agents in any arbitrary combination.</li>
</ul>
</li>
<li>The term “<strong>agent</strong>” is used here as a <strong>catch-all term</strong> for <strong>OpenTelemetry components</strong> that respond to <strong>OpAMP</strong><ul>
<li>this could be the <strong>collector</strong> but also <strong>SDK</strong> components.</li>
</ul>
</li>
<li>OpAMP is a <strong>client&#x2F;server protocol</strong> that supports <strong>communication</strong> over <strong>HTTP</strong> and over <strong>WebSockets</strong>:<ul>
<li>The <strong>OpAMP server</strong> is part of the <strong>control plane</strong> and acts as the <strong>orchestrator</strong>, managing a fleet of telemetry agents.</li>
<li>The <strong>OpAMP client</strong> is part of the <strong>data plane</strong>.<ul>
<li>The client side of OpAMP can be implemented <strong>in-process</strong>, for example, as the case in <strong>OpAMP support</strong> in the <strong>OpenTelemetry Collector</strong>.</li>
<li>For this latter option, you can use a <strong>supervisor</strong> that takes care of the <strong>OpAMP specific communication</strong> with the <strong>OpAMP server</strong></li>
<li>and at the same time <strong>controls the telemetry agent</strong>, for example to <strong>apply a configuration</strong> or to <strong>upgrade</strong> it.</li>
<li>Note that the <strong>supervisor&#x2F;telemetry communication</strong> is <strong>not part of OpAMP</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>Let’s have a look at a concrete setup:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opamp.svg" alt="opamp"></p>
<ol>
<li>The <strong>OpenTelemetry Collector</strong>, configured with <strong>pipeline(s)</strong> to<ul>
<li>(A) <strong>receive signals</strong> from <strong>downstream sources</strong></li>
<li>(B) <strong>export signals</strong> to <strong>upstream destinations</strong><ul>
<li>potentially including <strong>telemetry</strong> about the <strong>collector itself</strong></li>
<li>represented by the OpAMP <strong>own_xxx</strong> connection settings</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>bi-directional OpAMP control flow</strong> between the <strong>control plane</strong> implementing the <strong>server-side OpAMP part</strong><ul>
<li>and the <strong>collector</strong> (or a <strong>supervisor</strong> controlling the collector) implementing <strong>OpAMP client-side</strong>.</li>
</ul>
</li>
<li>You can try out a simple OpAMP setup yourself by using the <strong>OpAMP protocol implementation in Go</strong>.<ul>
<li>For the following walkthrough you will need to have Go in version <strong>1.19</strong> or above available.</li>
</ul>
</li>
<li>We will set up a simple <strong>OpAMP control plane</strong> consisting of an example <strong>OpAMP server</strong><ul>
<li>and let an <strong>OpenTelemetry Collector</strong> connect to it via an example <strong>OpAMP supervisor</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>First, clone the <strong>open-telemetry&#x2F;opamp-go</strong> repository:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/open-telemetry/opamp-go.git</span><br></pre></td></tr></table></figure>

<ol>
<li>Next, we need an <strong>OpenTelemetry Collector binary</strong> that the <strong>OpAMP supervisor</strong> can <strong>manage</strong>. </li>
<li>For that, install the <strong>OpenTelemetry Collector Contrib</strong> distro.</li>
<li>The path to the collector binary (where you installed it into) is referred to as $<strong>OTEL_COLLECTOR_BINARY</strong> in the following.</li>
<li>In the <strong>.&#x2F;opamp-go&#x2F;internal&#x2F;examples&#x2F;server</strong> directory, launch the <strong>OpAMP server</strong>:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run .</span><br><span class="line">2025/02/12 23:13:06.739165 [MAIN] OpAMP Server starting...</span><br><span class="line">2025/02/12 23:13:06.740425 [MAIN] OpAMP Server running...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>In the <strong>.&#x2F;opamp-go&#x2F;internal&#x2F;examples&#x2F;supervisor</strong> directory create a file named <strong>supervisor.yaml</strong> with the following content<br>telling the <strong>supervisor</strong> where to find the <strong>server</strong> and what <strong>OpenTelemetry Collector binary</strong> to manage</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">ws://127.0.0.1:4320/v1/opamp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">agent:</span></span><br><span class="line">  <span class="attr">executable:</span> <span class="string">$OTEL_COLLECTOR_BINARY</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Next, create a <strong>collector configuration</strong> as follows<br>save it in a file called <strong>effective.yaml</strong> in the <strong>.&#x2F;opamp-go&#x2F;internal&#x2F;examples&#x2F;supervisor</strong> directory)</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">prometheus/own_metrics:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">scrape_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">otel-collector</span></span><br><span class="line">          <span class="attr">scrape_interval:</span> <span class="string">10s</span></span><br><span class="line">          <span class="attr">static_configs:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8888</span>]</span><br><span class="line">  <span class="attr">hostmetrics:</span></span><br><span class="line">    <span class="attr">collection_interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">scrapers:</span></span><br><span class="line">      <span class="attr">load:</span></span><br><span class="line">      <span class="attr">filesystem:</span></span><br><span class="line">      <span class="attr">memory:</span></span><br><span class="line">      <span class="attr">network:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`.</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">hostmetrics</span>, <span class="string">prometheus/own_metrics</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now it’s time to <strong>launch the supervisor</strong> (which in turn will <strong>launch</strong> your <strong>OpenTelemetry Collector</strong>):</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ go run .</span><br><span class="line">2025/02/12 23:19:11 Supervisor starting, id=0194fabe-1e46-71bd-8107-d2578525ebfa, type=io.opentelemetry.collector, version=1.0.0.</span><br><span class="line">2025/02/12 23:19:11 Starting OpAMP client...</span><br><span class="line">2025/02/12 23:19:11 OpAMP Client started.</span><br><span class="line">2025/02/12 23:19:11 Starting agent /Users/zhongmingmao/Downloads/opentelemetry/otelcol-contrib/otelcol-contrib</span><br><span class="line">2025/02/12 23:19:11 Connected to the server.</span><br><span class="line">2025/02/12 23:19:11 Received remote config from server, hash=e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.</span><br><span class="line">2025/02/12 23:19:11 Agent process started, PID=5107</span><br><span class="line">2025/02/12 23:19:11 Effective config changed.</span><br><span class="line">2025/02/12 23:19:11 Enabling own metrics pipeline in the config</span><br><span class="line">2025/02/12 23:19:11 Effective config changed.</span><br><span class="line">2025/02/12 23:19:11 Config is changed. Signal to restart the agent.</span><br><span class="line">2025/02/12 23:19:11 Agent is not healthy: Get &quot;http://localhost:13133&quot;: dial tcp [::1]:13133: connect: connection refused</span><br><span class="line">2025/02/12 23:19:11 Stopping the agent to apply new config.</span><br><span class="line">2025/02/12 23:19:11 Stopping agent process, PID=5107</span><br><span class="line">2025/02/12 23:19:11 Agent process PID=5107 successfully stopped.</span><br><span class="line">2025/02/12 23:19:11 Starting agent /Users/zhongmingmao/Downloads/opentelemetry/otelcol-contrib/otelcol-contrib</span><br><span class="line">2025/02/12 23:19:11 Agent process started, PID=5108</span><br><span class="line">2025/02/12 23:19:11 Agent is not healthy: Get &quot;http://localhost:13133&quot;: dial tcp [::1]:13133: connect: connection refused</span><br><span class="line">2025/02/12 23:19:11 Agent is healthy.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>If everything worked out you should now be able to go to <a target="_blank" rel="noopener" href="http://localhost:4321/">http://localhost:4321/</a><br>and access the <strong>OpAMP server UI</strong> where you should see your <strong>collector</strong> listed, <strong>managed</strong> by the <strong>supervisor</strong>:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212232221097.png" alt="image-20250212232221097"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250212232352750.png" alt="image-20250212232352750"></p>
<blockquote>
<p>You can also query the <strong>collector</strong> for the <strong>metrics exported</strong> (note the <strong>label</strong> values):</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:8888/metrics</span><br><span class="line"># HELP otelcol_exporter_queue_capacity Fixed capacity of the retry queue (in batches) [alpha]</span><br><span class="line"># TYPE otelcol_exporter_queue_capacity gauge</span><br><span class="line">otelcol_exporter_queue_capacity&#123;data_type=&quot;metrics&quot;,exporter=&quot;otlphttp/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 1000</span><br><span class="line"># HELP otelcol_exporter_queue_size Current size of the retry queue (in batches) [alpha]</span><br><span class="line"># TYPE otelcol_exporter_queue_size gauge</span><br><span class="line">otelcol_exporter_queue_size&#123;data_type=&quot;metrics&quot;,exporter=&quot;otlphttp/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 19</span><br><span class="line"># HELP otelcol_exporter_send_failed_metric_points Number of metric points in failed attempts to send to destination. [alpha]</span><br><span class="line"># TYPE otelcol_exporter_send_failed_metric_points counter</span><br><span class="line">otelcol_exporter_send_failed_metric_points&#123;exporter=&quot;otlphttp/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 117</span><br><span class="line"># HELP otelcol_exporter_sent_metric_points Number of metric points successfully sent to destination. [alpha]</span><br><span class="line"># TYPE otelcol_exporter_sent_metric_points counter</span><br><span class="line">otelcol_exporter_sent_metric_points&#123;exporter=&quot;otlphttp/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 0</span><br><span class="line"># HELP otelcol_process_cpu_seconds Total CPU user and system time in seconds [alpha]</span><br><span class="line"># TYPE otelcol_process_cpu_seconds counter</span><br><span class="line">otelcol_process_cpu_seconds&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 1.0423074583333332</span><br><span class="line"># HELP otelcol_process_memory_rss Total physical memory (resident set size) [alpha]</span><br><span class="line"># TYPE otelcol_process_memory_rss gauge</span><br><span class="line">otelcol_process_memory_rss&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 1.4934016e+08</span><br><span class="line"># HELP otelcol_process_runtime_heap_alloc_bytes Bytes of allocated heap objects (see &#x27;go doc runtime.MemStats.HeapAlloc&#x27;) [alpha]</span><br><span class="line"># TYPE otelcol_process_runtime_heap_alloc_bytes gauge</span><br><span class="line">otelcol_process_runtime_heap_alloc_bytes&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 2.4591584e+07</span><br><span class="line"># HELP otelcol_process_runtime_total_alloc_bytes Cumulative bytes allocated for heap objects (see &#x27;go doc runtime.MemStats.TotalAlloc&#x27;) [alpha]</span><br><span class="line"># TYPE otelcol_process_runtime_total_alloc_bytes counter</span><br><span class="line">otelcol_process_runtime_total_alloc_bytes&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 5.7424472e+07</span><br><span class="line"># HELP otelcol_process_runtime_total_sys_memory_bytes Total bytes of memory obtained from the OS (see &#x27;go doc runtime.MemStats.Sys&#x27;) [alpha]</span><br><span class="line"># TYPE otelcol_process_runtime_total_sys_memory_bytes gauge</span><br><span class="line">otelcol_process_runtime_total_sys_memory_bytes&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 4.5237512e+07</span><br><span class="line"># HELP otelcol_process_uptime Uptime of the process [alpha]</span><br><span class="line"># TYPE otelcol_process_uptime counter</span><br><span class="line">otelcol_process_uptime&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 362.725288</span><br><span class="line"># HELP otelcol_receiver_accepted_metric_points Number of metric points successfully pushed into the pipeline. [alpha]</span><br><span class="line"># TYPE otelcol_receiver_accepted_metric_points counter</span><br><span class="line">otelcol_receiver_accepted_metric_points&#123;receiver=&quot;prometheus/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;,transport=&quot;http&quot;&#125; 628</span><br><span class="line"># HELP otelcol_receiver_refused_metric_points Number of metric points that could not be pushed into the pipeline. [alpha]</span><br><span class="line"># TYPE otelcol_receiver_refused_metric_points counter</span><br><span class="line">otelcol_receiver_refused_metric_points&#123;receiver=&quot;prometheus/own_metrics&quot;,service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;,transport=&quot;http&quot;&#125; 0</span><br><span class="line"># HELP promhttp_metric_handler_errors_total Total number of internal errors encountered by the promhttp metric handler.</span><br><span class="line"># TYPE promhttp_metric_handler_errors_total counter</span><br><span class="line">promhttp_metric_handler_errors_total&#123;cause=&quot;encoding&quot;&#125; 0</span><br><span class="line">promhttp_metric_handler_errors_total&#123;cause=&quot;gathering&quot;&#125; 0</span><br><span class="line"># HELP target_info Target metadata</span><br><span class="line"># TYPE target_info gauge</span><br><span class="line">target_info&#123;service_instance_id=&quot;0194fabe-1e46-71bd-8107-d2578525ebfa&quot;,service_name=&quot;io.opentelemetry.collector&quot;,service_version=&quot;1.0.0&quot;&#125; 1</span><br></pre></td></tr></table></figure>

<h2 id="Distributions-1"><a href="#Distributions-1" class="headerlink" title="Distributions"></a>Distributions</h2><ol>
<li>The OpenTelemetry project currently offers <strong>pre-built distributions</strong> of the collector.</li>
<li>The <strong>components</strong> included in the <strong>distributions</strong> can be found by in the <strong>manifest.yaml</strong> of each distribution.</li>
</ol>
<blockquote>
<p>Distributions</p>
</blockquote>
<ol>
<li>otelcol<ul>
<li>This distribution contains <strong>all the components</strong> from the <strong>OpenTelemetry Collector</strong> repository</li>
<li>and a <strong>small selection of components</strong> tied to open source projects from the <strong>OpenTelemetry Collector Contrib</strong> repository.</li>
<li>This distribution is considered “<strong>classic</strong>“ and is <strong>no longer accepting new components</strong> outside of components from the <strong>Core repo</strong>.</li>
</ul>
</li>
<li><strong>otelcol-contrib</strong><ul>
<li>This distribution contains <strong>all the components</strong> from<ul>
<li><strong>both</strong> the <strong>OpenTelemetry Collector</strong> repository and the <strong>OpenTelemetry Collector Contrib</strong> repository.</li>
</ul>
</li>
<li>This distribution includes <strong>open source</strong> and <strong>vendor</strong> supported components.</li>
</ul>
</li>
<li>otelcol-k8s<ul>
<li>This distribution is made specifically to be used in a <strong>Kubernetes cluster</strong> to <strong>monitor Kubernetes and services running in Kubernetes</strong>.</li>
<li>It contains a <strong>subset of components</strong> from <strong>OpenTelemetry Collector Core</strong> and <strong>OpenTelemetry Collector Contrib</strong>.</li>
</ul>
</li>
<li>otelcol-otlp<ul>
<li>This distribution <strong>only</strong> contains the <strong>receiver</strong> and <strong>exporters</strong> for the <strong>OpenTelemetry Protocol (OTLP)</strong>, including both <strong>gRPC</strong> and <strong>HTTP</strong> transport.</li>
</ul>
</li>
</ol>
<h3 id="Custom-Distributions"><a href="#Custom-Distributions" class="headerlink" title="Custom Distributions"></a>Custom Distributions</h3><ol>
<li>For various reasons the <strong>existing distributions</strong> provided by the OpenTelemetry project may <strong>not meet</strong> your <strong>needs</strong>.</li>
<li>Whether you want a <strong>smaller version</strong></li>
<li>or have the need to <strong>implement custom functionality</strong> like <strong>authenticator extensions</strong>, <strong>receivers</strong>, <strong>processors</strong>, <strong>exporters</strong> or <strong>connectors</strong>.</li>
<li>The tool used to <strong>build distributions</strong> ocb (<strong>OpenTelemetry Collector Builder</strong>) is available to build your own distributions.</li>
</ol>
<h2 id="Internal-telemetry"><a href="#Internal-telemetry" class="headerlink" title="Internal telemetry"></a>Internal telemetry</h2><ol>
<li>You can <strong>inspect</strong> the <strong>health</strong> of any <strong>OpenTelemetry Collector</strong> instance by checking its own <strong>internal telemetry</strong>.</li>
<li>Read on to learn about this telemetry and how to configure it to help you <strong>monitor</strong> and <strong>troubleshoot</strong> the <strong>Collector</strong>.</li>
<li>The <strong>Collector</strong> uses the <strong>OpenTelemetry SDK declarative configuration schema</strong> for configuring how to <strong>export</strong> its <strong>internal telemetry</strong>.<ul>
<li>This schema is still <strong>under development</strong> and may <strong>undergo breaking changes</strong> in <strong>future releases</strong>.</li>
<li>We intend to <strong>keep supporting older schemas</strong> until a <strong>1.0 schema release</strong> is available<ul>
<li>and offer a <strong>transition period</strong> for users to <strong>update</strong> their <strong>configurations</strong> before dropping pre-1.0 schemas.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Activate-internal-telemetry-in-the-Collector"><a href="#Activate-internal-telemetry-in-the-Collector" class="headerlink" title="Activate internal telemetry in the Collector"></a>Activate internal telemetry in the Collector</h3><blockquote>
<p>By default, the Collector exposes its own telemetry in two ways:</p>
</blockquote>
<ol>
<li><strong>Internal metrics</strong> are exposed using a <strong>Prometheus interface</strong> which defaults to port <strong>8888</strong></li>
<li><strong>Logs</strong> are emitted to <strong>stderr</strong> by default.</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213104108474.png" alt="image-20250213104108474"></p>
<h4 id="Configure-internal-metrics"><a href="#Configure-internal-metrics" class="headerlink" title="Configure internal metrics"></a>Configure internal metrics</h4><ol>
<li>You can configure how internal metrics are <strong>generated</strong> and <strong>exposed</strong> by the Collector.</li>
<li>By default, the Collector generates <strong>basic metrics</strong> about itself and exposes them<ul>
<li>using the <strong>OpenTelemetry Go Prometheus exporter</strong> for scraping at <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/metrics">http://127.0.0.1:8888/metrics</a>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The <strong>Collector</strong> can <strong>push</strong> its <strong>internal metrics</strong> to an <strong>OTLP backend</strong> via the following configuration:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">readers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">periodic:</span></span><br><span class="line">            <span class="attr">exporter:</span></span><br><span class="line">              <span class="attr">otlp:</span></span><br><span class="line">                <span class="attr">protocol:</span> <span class="string">grpc/protobuf</span></span><br><span class="line">                <span class="attr">endpoint:</span> <span class="string">http://localhost:14317</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Alternatively, you can <strong>expose</strong> the <strong>Prometheus endpoint</strong> to <strong>one specific or all network interfaces</strong> when needed.<br>For <strong>containerized environments</strong>, you might want to expose this port on a <strong>public interface</strong>.<br>Set the Prometheus config under <strong>service::telemetry::metrics</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">readers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">pull:</span></span><br><span class="line">            <span class="attr">exporter:</span></span><br><span class="line">              <span class="attr">prometheus:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can adjust the <strong>verbosity</strong> of the <strong>Collector metrics output</strong> by setting the level field to one of the following values:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Verbosity</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>none</strong></td>
<td><strong>no</strong> telemetry is collected.</td>
</tr>
<tr>
<td><strong>basic</strong></td>
<td><strong>essential</strong> service telemetry.</td>
</tr>
<tr>
<td><strong>normal</strong></td>
<td>the <strong>default</strong> level, adds <strong>standard indicators</strong> on top of <strong>basic</strong>.</td>
</tr>
<tr>
<td><strong>detailed</strong></td>
<td>the <strong>most verbose</strong> level, includes <strong>dimensions</strong> and <strong>views</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>Each verbosity level represents a <strong>threshold</strong> at which <strong>certain metrics</strong> are emitted<br>The <strong>default level</strong> for <strong>metrics</strong> output is <strong>normal</strong>. To use another level, set <strong>service::telemetry::metrics::level</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">level:</span> <span class="string">detailed</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>OpAMP server</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213110116597.png" alt="image-20250213110116597"></p>
<blockquote>
<p>OpAMP Supervisor</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213110329017.png" alt="image-20250213110329017"></p>
<blockquote>
<p>OpenTelemetry Collector</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213110505602.png" alt="image-20250213110505602"></p>
<h4 id="Configure-internal-logs"><a href="#Configure-internal-logs" class="headerlink" title="Configure internal logs"></a>Configure internal logs</h4><blockquote>
<p><strong>Log output</strong> is found in <strong>stderr</strong>. You can configure logs in the config <strong>service::telemetry::logs</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Field name</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>level</td>
<td>INFO</td>
<td>Sets the <strong>minimum</strong> enabled logging level. Other possible values are <strong>DEBUG</strong>, <strong>WARN</strong>, and <strong>ERROR</strong>.</td>
</tr>
<tr>
<td>development</td>
<td>false</td>
<td>Puts the logger in <strong>development mode</strong>.</td>
</tr>
<tr>
<td>encoding</td>
<td>console</td>
<td>Sets the logger’s encoding. The other possible value is <strong>json</strong>.</td>
</tr>
<tr>
<td>disable_caller</td>
<td>false</td>
<td>Stops annotating logs with the <strong>calling function’s file name and line number</strong>. By default, all logs are annotated.</td>
</tr>
<tr>
<td>disable_stacktrace</td>
<td>false</td>
<td>Disables <strong>automatic stacktrace capturing</strong>.<br /><strong>Stacktraces</strong> are <strong>captured</strong> for logs<br />at <strong>WARN</strong> level and above in <strong>development</strong> and at <strong>ERROR</strong> level and above in <strong>production</strong>.</td>
</tr>
<tr>
<td>sampling::enabled</td>
<td>true</td>
<td>Sets a <strong>sampling policy</strong>.</td>
</tr>
<tr>
<td>sampling::tick</td>
<td>10s</td>
<td>The interval in <strong>seconds</strong> that the <strong>logger</strong> applies to <strong>each sampling</strong>.</td>
</tr>
<tr>
<td>sampling::initial</td>
<td>10</td>
<td>The <strong>number of messages logged</strong> at the <strong>start</strong> of each <strong>sampling::tick</strong>.</td>
</tr>
<tr>
<td>sampling::thereafter</td>
<td>100</td>
<td>Sets the <strong>sampling policy</strong> for <strong>subsequent messages</strong> after <strong>sampling::initial</strong> messages are logged.<br />When <strong>sampling::thereafter</strong> is set to <strong>N</strong>, every <strong>Nth message</strong> is <strong>logged</strong> and <strong>all others</strong> are <strong>dropped</strong>.<br />If <strong>N</strong> is <strong>zero</strong>, the logger <strong>drops all messages</strong> after <strong>sampling::initial</strong> messages are logged.</td>
</tr>
<tr>
<td>output_paths</td>
<td>[“<strong>stderr</strong>“]</td>
<td>A list of <strong>URLs</strong> or <strong>file paths</strong> to write <strong>logging output</strong> to.</td>
</tr>
<tr>
<td>error_output_paths</td>
<td>[“<strong>stderr</strong>“]</td>
<td>A list of <strong>URLs</strong> or <strong>file paths</strong> to write <strong>logger errors</strong> to.</td>
</tr>
<tr>
<td>initial_fields</td>
<td></td>
<td>A collection of <strong>static key-value pairs</strong> added to <strong>all log entries</strong> to <strong>enrich logging context</strong>.<br />By default, there is <strong>no initial field</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following configuration can be used to <strong>emit internal logs</strong> from the <strong>Collector</strong> to an <strong>OTLP&#x2F;HTTP backend</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">processors:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">batch:</span></span><br><span class="line">            <span class="attr">exporter:</span></span><br><span class="line">              <span class="attr">otlp:</span></span><br><span class="line">                <span class="attr">protocol:</span> <span class="string">http/protobuf</span></span><br><span class="line">                <span class="attr">endpoint:</span> <span class="string">https://backend:4317</span></span><br></pre></td></tr></table></figure>

<h4 id="Configure-internal-traces"><a href="#Configure-internal-traces" class="headerlink" title="Configure internal traces"></a>Configure internal traces</h4><ol>
<li>The Collector <strong>does not expose traces by default</strong>, but it can be configured to.</li>
<li><strong>Internal tracing</strong> is an <strong>experimental feature</strong>, and <strong>no guarantees</strong> are made as to the <strong>stability</strong> of the <strong>emitted span names and attributes</strong>.</li>
</ol>
<blockquote>
<p>The following configuration can be used to <strong>emit internal traces</strong> from the <strong>Collector</strong> to an <strong>OTLP&#x2F;gRPC backend</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">processors:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">batch:</span></span><br><span class="line">            <span class="attr">exporter:</span></span><br><span class="line">              <span class="attr">otlp:</span></span><br><span class="line">                <span class="attr">protocol:</span> <span class="string">grpc/protobuf</span></span><br><span class="line">                <span class="attr">endpoint:</span> <span class="string">https://backend:4317</span></span><br></pre></td></tr></table></figure>

<h3 id="Types-of-internal-telemetry"><a href="#Types-of-internal-telemetry" class="headerlink" title="Types of internal telemetry"></a>Types of internal telemetry</h3><ol>
<li>The OpenTelemetry Collector aims to be a <strong>model</strong> of <strong>observable service</strong> by <strong>clearly exposing</strong> its own <strong>operational metrics</strong>.</li>
<li>Additionally, it collects <strong>host resource metrics</strong> that can help you understand if <strong>problems</strong> are <strong>caused by a different process</strong> on the <strong>same host</strong>.</li>
<li><strong>Specific components</strong> of the <strong>Collector</strong> can also emit <strong>their own custom telemetry</strong>.</li>
<li>In this section, you will learn about the <strong>different types of observability</strong> emitted by the <strong>Collector itself</strong>.</li>
</ol>
<h4 id="Summary-of-values-observable-with-internal-metrics"><a href="#Summary-of-values-observable-with-internal-metrics" class="headerlink" title="Summary of values observable with internal metrics"></a>Summary of values observable with internal metrics</h4><blockquote>
<p>The Collector emits internal metrics for <strong>at least</strong> the following values:</p>
</blockquote>
<ol>
<li><strong>Process uptime</strong> and <strong>CPU time</strong> since <strong>start</strong>.</li>
<li><strong>Process memory</strong> and <strong>heap usage</strong>.</li>
<li>For <strong>receivers</strong>: Items <strong>accepted</strong> and <strong>refused</strong>, per <strong>data type</strong>.</li>
<li>For <strong>processors</strong>: <strong>Incoming</strong> and <strong>outgoing</strong> items.</li>
<li>For <strong>exporters</strong>: Items the exporter <strong>sent</strong>, <strong>failed to enqueue</strong>, and <strong>failed to send</strong>, per <strong>data type</strong>.</li>
<li>For <strong>exporters</strong>: <strong>Queue size</strong> and <strong>capacity</strong>.</li>
<li><strong>Count</strong>, <strong>duration</strong>, and <strong>size</strong> of <strong>HTTP&#x2F;gRPC</strong> <strong>requests</strong> and <strong>responses</strong>.</li>
</ol>
<h4 id="Lists-of-internal-metrics"><a href="#Lists-of-internal-metrics" class="headerlink" title="Lists of internal metrics"></a>Lists of internal metrics</h4><ol>
<li>The following tables group each internal metric by <strong>level</strong> of verbosity: <strong>basic</strong>, <strong>normal</strong>, and <strong>detailed</strong>.</li>
<li>Each <strong>metric</strong> is <strong>identified by name and description</strong> and <strong>categorized by instrumentation type</strong>.</li>
<li>As of <strong>Collector v0.106.1</strong>, internal metric <strong>names</strong> are <strong>handled differently</strong> based on their <strong>source</strong>:<ul>
<li>Metrics <strong>generated</strong> from <strong>Collector components</strong> are prefixed with <strong>otelcol_</strong>.</li>
<li>Metrics <strong>generated</strong> from <strong>instrumentation libraries</strong> do <strong>not</strong> use the <strong>otelcol_</strong> prefix by default, unless their metric names are <strong>explicitly prefixed</strong>.</li>
</ul>
</li>
<li>For Collector versions <strong>prior</strong> to <strong>v0.106.1</strong><ul>
<li><strong>all internal metrics</strong> emitted using the <strong>Prometheus exporter</strong>, regardless of their <strong>origin</strong>, are prefixed with <strong>otelcol_</strong>. </li>
<li>This includes metrics from both <strong>Collector components</strong> and <strong>instrumentation libraries</strong>.</li>
</ul>
</li>
</ol>
<h5 id="basic-level-metrics"><a href="#basic-level-metrics" class="headerlink" title="basic-level metrics"></a>basic-level metrics</h5><table>
<thead>
<tr>
<th>Metric name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>otelcol_exporter_enqueue_failed_log_records</td>
<td>Number of <strong>logs</strong> that exporter(s) <strong>failed to enqueue</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_enqueue_failed_metric_points</td>
<td>Number of <strong>metric points</strong> that exporter(s) <strong>failed to enqueue</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_enqueue_failed_spans</td>
<td>Number of <strong>spans</strong> that exporter(s) <strong>failed to enqueue</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_queue_capacity</td>
<td><strong>Fixed capacity</strong> of the <strong>sending queue</strong>, in <strong>batches</strong>.</td>
<td>Gauge</td>
</tr>
<tr>
<td>otelcol_exporter_queue_size</td>
<td><strong>Current size</strong> of the <strong>sending queue</strong>, in <strong>batches</strong>.</td>
<td>Gauge</td>
</tr>
<tr>
<td>otelcol_exporter_send_failed_log_records</td>
<td>Number of <strong>logs</strong> that exporter(s) <strong>failed to send to destination</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_send_failed_metric_points</td>
<td>Number of <strong>metric points</strong> that exporter(s) <strong>failed to send to destination</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_send_failed_spans</td>
<td>Number of <strong>spans</strong> that exporter(s) <strong>failed to send to destination</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_sent_log_records</td>
<td>Number of <strong>logs</strong> successfully sent to destination.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_sent_metric_points</td>
<td>Number of <strong>metric points</strong> successfully sent to destination.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_exporter_sent_spans</td>
<td>Number of <strong>spans</strong> successfully sent to destination.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_process_cpu_seconds</td>
<td>Total <strong>CPU user and system time</strong> in <strong>seconds</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_process_memory_rss</td>
<td>Total <strong>physical memory</strong> (resident set size) in <strong>bytes</strong>.</td>
<td>Gauge</td>
</tr>
<tr>
<td>otelcol_process_runtime_heap_alloc_bytes</td>
<td><strong>Bytes</strong> of <strong>allocated heap objects</strong><br />see ‘go doc <strong>runtime.MemStats.HeapAlloc</strong>’</td>
<td>Gauge</td>
</tr>
<tr>
<td>otelcol_process_runtime_total_alloc_bytes</td>
<td><strong>Cumulative bytes allocated</strong> for <strong>heap objects</strong><br />see ‘go doc <strong>runtime.MemStats.TotalAlloc</strong>’</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_process_runtime_total_sys_memory_bytes</td>
<td><strong>Total bytes</strong> of memory <strong>obtained from the OS</strong><br />see ‘go doc <strong>runtime.MemStats.Sys</strong>’</td>
<td>Gauge</td>
</tr>
<tr>
<td>otelcol_process_uptime</td>
<td><strong>Uptime</strong> of the <strong>process</strong> in <strong>seconds</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_batch_batch_send_size</td>
<td>Number of <strong>units in the batch</strong> that was sent.</td>
<td>Histogram</td>
</tr>
<tr>
<td>otelcol_processor_batch_batch_size_trigger_send</td>
<td>Number of <strong>times</strong> the batch was sent due to a <strong>size trigger</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_batch_metadata_cardinality</td>
<td>Number of <strong>distinct metadata value combinations</strong> being processed.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_batch_timeout_trigger_send</td>
<td>Number of <strong>times</strong> the batch was sent due to a <strong>timeout trigger</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_incoming_items</td>
<td>Number of items <strong>passed to</strong> the processor.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_outgoing_items</td>
<td>Number of items <strong>emitted from</strong> the processor.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_accepted_log_records</td>
<td>Number of <strong>logs</strong> successfully <strong>ingested</strong> and <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_accepted_metric_points</td>
<td>Number of <strong>metric points</strong> successfully <strong>ingested</strong> and <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_accepted_spans</td>
<td>Number of <strong>spans</strong> successfully <strong>ingested</strong> and <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_refused_log_records</td>
<td>Number of <strong>logs</strong> that could not be <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_refused_metric_points</td>
<td>Number of <strong>metric points</strong> that could not be <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_receiver_refused_spans</td>
<td>Number of <strong>spans</strong> that could not be <strong>pushed into</strong> the <strong>pipeline</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_scraper_errored_metric_points</td>
<td>Number of <strong>metric points</strong> the Collector <strong>failed to scrape</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_scraper_scraped_metric_points</td>
<td>Number of <strong>metric points</strong> scraped by the Collector.</td>
<td>Counter</td>
</tr>
</tbody></table>
<h5 id="Additional-normal-level-metrics"><a href="#Additional-normal-level-metrics" class="headerlink" title="Additional normal-level metrics"></a>Additional normal-level metrics</h5><blockquote>
<p>There are currently <strong>no</strong> metrics specific to <strong>normal</strong> verbosity.</p>
</blockquote>
<h5 id="Additional-detailed-level-metrics"><a href="#Additional-detailed-level-metrics" class="headerlink" title="Additional detailed-level metrics"></a>Additional detailed-level metrics</h5><table>
<thead>
<tr>
<th>Metric name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>http_client_active_requests</td>
<td>Number of active HTTP client requests.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_client_connection_duration</td>
<td>Measures the duration of the successfully established <strong>outbound</strong> HTTP connections.</td>
<td>Histogram</td>
</tr>
<tr>
<td>http_client_open_connections</td>
<td>Number of <strong>outbound</strong> HTTP connections that are <strong>active</strong> or <strong>idle</strong> on the client.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_client_request_size</td>
<td>Measures the <strong>size</strong> of HTTP <strong>client request bodies</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_client_duration</td>
<td>Measures the duration of HTTP client requests.</td>
<td>Histogram</td>
</tr>
<tr>
<td>http_client_response_size</td>
<td>Measures the <strong>size</strong> of HTTP <strong>client response bodies</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_server_active_requests</td>
<td>Number of active HTTP server requests.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_server_request_size</td>
<td>Measures the <strong>size</strong> of HTTP <strong>server request bodies</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>http_server_duration</td>
<td>Measures the duration of HTTP server requests.</td>
<td>Histogram</td>
</tr>
<tr>
<td>http_server_response_size</td>
<td>Measures the <strong>size</strong> of HTTP <strong>server response bodies</strong>.</td>
<td>Counter</td>
</tr>
<tr>
<td>otelcol_processor_batch_batch_send_size_bytes</td>
<td>Number of <strong>bytes</strong> in the batch that was <strong>sent</strong>.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_client_duration</td>
<td>Measures the duration of <strong>outbound</strong> RPC.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_client_request_size</td>
<td>Measures the <strong>size</strong> of <strong>RPC request messages</strong> (<strong>uncompressed</strong>).</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_client_requests_per_rpc</td>
<td>Measures the <strong>number of messages received per RPC.</strong><br />Should be <strong>1</strong> for all <strong>non-streaming RPCs</strong>.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_client_response_size</td>
<td>Measures the <strong>size</strong> of <strong>RPC response messages</strong> (<strong>uncompressed</strong>).</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_client_responses_per_rpc</td>
<td>Measures the <strong>number of messages sent per RPC</strong>.<br />Should be <strong>1</strong> for all <strong>non-streaming RPCs</strong>.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_server_duration</td>
<td>Measures the duration of <strong>inbound</strong> RPC.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_server_request_size</td>
<td>Measures the <strong>size</strong> of <strong>RPC request messages</strong> (<strong>uncompressed</strong>).</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_server_requests_per_rpc</td>
<td>Measures the <strong>number of messages received per RPC.</strong><br />Should be <strong>1</strong> for all <strong>non-streaming RPCs</strong>.</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_server_response_size</td>
<td>Measures the <strong>size</strong> of <strong>RPC response messages</strong> (<strong>uncompressed</strong>).</td>
<td>Histogram</td>
</tr>
<tr>
<td>rpc_server_responses_per_rpc</td>
<td>Measures the <strong>number of messages sent per RPC</strong>.<br />Should be <strong>1</strong> for all <strong>non-streaming RPCs</strong>.</td>
<td>Histogram</td>
</tr>
</tbody></table>
<ol>
<li>The <strong>http_</strong> and <strong>rpc_</strong> metrics come from <strong>instrumentation libraries</strong>. <ul>
<li>Their <strong>original names</strong> use <strong>dots (.)</strong>, but when <strong>exposing internal metrics</strong> with <strong>Prometheus</strong></li>
<li>they are <strong>translated</strong> to use <strong>underscores (_)</strong> to match <strong>Prometheus’ naming constraints</strong>.</li>
</ul>
</li>
<li>The <strong>otelcol_processor_batch_</strong> metrics are <strong>unique</strong> to the <strong>batchprocessor</strong>.</li>
<li>The <strong>otelcol_receiver_</strong>, <strong>otelcol_scraper_</strong>, <strong>otelcol_processor_</strong>, and <strong>otelcol_exporter_</strong> metrics come from their <strong>respective helper packages</strong>.<ul>
<li>As such, some components <strong>not using</strong> those packages may <strong>not emit</strong> them.</li>
</ul>
</li>
</ol>
<h4 id="Events-observable-with-internal-logs"><a href="#Events-observable-with-internal-logs" class="headerlink" title="Events observable with internal logs"></a>Events observable with internal logs</h4><blockquote>
<p>The Collector <strong>logs</strong> the following <strong>internal events</strong>:</p>
</blockquote>
<ol>
<li>A <strong>Collector</strong> instance <strong>starts</strong> or <strong>stops</strong>.</li>
<li><strong>Data dropping</strong> begins due to <strong>throttling</strong> for a <strong>specified reason</strong>, such as <strong>local saturation</strong>, <strong>downstream saturation</strong>, <strong>downstream unavailable</strong>, etc.</li>
<li><strong>Data dropping</strong> due to <strong>throttling stops</strong>.</li>
<li><strong>Data dropping</strong> begins due to <strong>invalid data</strong>. A sample of the invalid data is <strong>included</strong>.</li>
<li><strong>Data dropping</strong> due to <strong>invalid data stops</strong>.</li>
<li>A <strong>crash</strong> is <strong>detected</strong>, differentiated from a <strong>clean stop</strong>.<ul>
<li><strong>Crash data</strong> is <strong>included</strong> if available.</li>
</ul>
</li>
</ol>
<h3 id="Telemetry-maturity-levels"><a href="#Telemetry-maturity-levels" class="headerlink" title="Telemetry maturity levels"></a>Telemetry maturity levels</h3><h4 id="Traces-2"><a href="#Traces-2" class="headerlink" title="Traces"></a>Traces</h4><blockquote>
<p><strong>no guarantees</strong> of <strong>backwards compatibility</strong></p>
</blockquote>
<ol>
<li><strong>Tracing instrumentation</strong> is still <strong>under active development</strong><ul>
<li>and <strong>changes</strong> might be made to <strong>span names</strong>, <strong>attached attributes</strong>, <strong>instrumented endpoints</strong>, or other <strong>aspects</strong> of the <strong>telemetry</strong>.</li>
</ul>
</li>
<li><strong>Until</strong> this feature graduates to <strong>stable</strong>, there are <strong>no guarantees</strong> of <strong>backwards compatibility</strong> for <strong>tracing instrumentation</strong>.</li>
</ol>
<h4 id="Metrics-2"><a href="#Metrics-2" class="headerlink" title="Metrics"></a>Metrics</h4><ol>
<li>The Collector’s metrics follow a four-stage <strong>lifecycle</strong>:</li>
<li><strong>Alpha</strong> metric → <strong>Stable</strong> metric → <strong>Deprecated</strong> metric → <strong>Deleted</strong> metric</li>
</ol>
<h5 id="Alpha"><a href="#Alpha" class="headerlink" title="Alpha"></a>Alpha</h5><ol>
<li>Alpha metrics have <strong>no stability guarantees</strong>.</li>
<li>These metrics can be <strong>modified</strong> or <strong>deleted</strong> at any time.</li>
</ol>
<h5 id="Stable"><a href="#Stable" class="headerlink" title="Stable"></a>Stable</h5><blockquote>
<p>Stable metrics are <strong>guaranteed</strong> to <strong>not change</strong>. This means:</p>
</blockquote>
<ol>
<li>A stable metric <strong>without a deprecated signature</strong> will <strong>not be deleted or renamed</strong>.</li>
<li>A stable metric’s <strong>type and attributes</strong> will <strong>not be modified</strong>.</li>
</ol>
<h5 id="Deprecated"><a href="#Deprecated" class="headerlink" title="Deprecated"></a>Deprecated</h5><ol>
<li>Deprecated metrics are <strong>slated for deletion</strong> but are <strong>still available for use</strong>.</li>
<li>The <strong>description</strong> of these metrics include an <strong>annotation about the version</strong> in which they became <strong>deprecated</strong>.</li>
</ol>
<blockquote>
<p>Before deprecation:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># HELP otelcol_exporter_queue_size this counts things</span><br><span class="line"># TYPE otelcol_exporter_queue_size counter</span><br><span class="line">otelcol_exporter_queue_size 0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>After deprecation:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># HELP otelcol_exporter_queue_size (Deprecated since 1.15.0) this counts things</span><br><span class="line"># TYPE otelcol_exporter_queue_size counter</span><br><span class="line">otelcol_exporter_queue_size 0</span><br></pre></td></tr></table></figure>

<h5 id="Deleted"><a href="#Deleted" class="headerlink" title="Deleted"></a>Deleted</h5><blockquote>
<p>Deleted metrics are <strong>no longer published</strong> and <strong>cannot be used</strong>.</p>
</blockquote>
<h4 id="Logs-2"><a href="#Logs-2" class="headerlink" title="Logs"></a>Logs</h4><blockquote>
<p><strong>Individual log entries and their formatting</strong> might <strong>change</strong> from one release to the next. There are <strong>no stability guarantees</strong> at this time.</p>
</blockquote>
<h3 id="Use-internal-telemetry-to-monitor-the-Collector"><a href="#Use-internal-telemetry-to-monitor-the-Collector" class="headerlink" title="Use internal telemetry to monitor the Collector"></a>Use internal telemetry to monitor the Collector</h3><blockquote>
<p>This section recommends <strong>best practices</strong> for <strong>monitoring the Collector</strong> using <strong>its own telemetry</strong>.</p>
</blockquote>
<h4 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h4><h5 id="Queue-length"><a href="#Queue-length" class="headerlink" title="Queue length"></a>Queue length</h5><ol>
<li>Most <strong>exporters</strong> provide a <strong>queue</strong> and&#x2F;or <strong>retry mechanism</strong> that is <strong>recommended</strong> for use in any <strong>production deployment</strong> of the Collector.</li>
<li>The <strong>otelcol_exporter_queue_capacity</strong> metric indicates the <strong>capacity</strong>, in batches, of the <strong>sending queue</strong>.<ul>
<li>The <strong>otelcol_exporter_queue_size</strong> metric indicates the <strong>current size</strong> of the <strong>sending queue</strong>.</li>
<li>Use these two metrics to check if the <strong>queue capacity</strong> can support your <strong>workload</strong>.</li>
</ul>
</li>
<li>Using the following three metrics, you can identify the number of <strong>spans</strong>, <strong>metric points</strong>, and <strong>log records</strong> that <strong>failed to reach the sending queue</strong>:<ul>
<li><strong>otelcol_exporter_enqueue_failed_spans</strong></li>
<li><strong>otelcol_exporter_enqueue_failed_metric_points</strong></li>
<li><strong>otelcol_exporter_enqueue_failed_log_records</strong></li>
</ul>
</li>
<li>These failures could be caused by a queue <strong>filled</strong> with <strong>unsettled elements</strong>.<ul>
<li>You might need to <strong>decrease</strong> your <strong>sending rate</strong> or <strong>horizontally scale Collectors</strong>.</li>
</ul>
</li>
<li>The <strong>queue</strong> or <strong>retry mechanism</strong> also supports <strong>logging</strong> for <strong>monitoring</strong>.<ul>
<li>Check the <strong>logs</strong> for messages such as <strong>Dropping data</strong> because <strong>sending_queue is full</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Receive-failures"><a href="#Receive-failures" class="headerlink" title="Receive failures"></a>Receive failures</h5><ol>
<li><strong>Sustained rates</strong> of <strong>otelcol_receiver_refused_log_records</strong>, <strong>otelcol_receiver_refused_spans</strong>, and <strong>otelcol_receiver_refused_metric_points</strong><ul>
<li>indicate that too many <strong>errors</strong> were <strong>returned to clients</strong>.</li>
</ul>
</li>
<li><strong>Sustained rates</strong> of <strong>otelcol_exporter_send_failed_log_records</strong>, otelcol_exporter_send_failed_spans, and otelcol_exporter_send_failed_metric_points<ul>
<li>indicate that the Collector is <strong>not able to export data as expected</strong>.</li>
<li>These metrics do <strong>not inherently imply data loss</strong> since there could be <strong>retries</strong>.</li>
<li>But a <strong>high rate of failures</strong> could indicate issues with the <strong>network</strong> or <strong>backend receiving the data</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Data-flow"><a href="#Data-flow" class="headerlink" title="Data flow"></a>Data flow</h5><ol>
<li>You can monitor <strong>data ingress</strong><ul>
<li>with the <strong>otelcol_receiver_accepted_log_records</strong>, <strong>otelcol_receiver_accepted_spans</strong>, and <strong>otelcol_receiver_accepted_metric_points</strong> metrics</li>
</ul>
</li>
<li>and <strong>data egress</strong><ul>
<li>with the <strong>otelcol_exporter_sent_log_records</strong>, <strong>otelcol_exporter_sent_spans</strong>, and <strong>otelcol_exporter_sent_metric_points</strong> metrics.</li>
</ul>
</li>
</ol>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><blockquote>
<p>On this page, you can learn how to <strong>troubleshoot</strong> the <strong>health</strong> and <strong>performance</strong> of the OpenTelemetry Collector.</p>
</blockquote>
<h3 id="Troubleshooting-tools"><a href="#Troubleshooting-tools" class="headerlink" title="Troubleshooting tools"></a>Troubleshooting tools</h3><blockquote>
<p>The Collector provides a variety of <strong>metrics</strong>, <strong>logs</strong>, and <strong>extensions</strong> for debugging issues.</p>
</blockquote>
<h4 id="Internal-telemetry-1"><a href="#Internal-telemetry-1" class="headerlink" title="Internal telemetry"></a>Internal telemetry</h4><blockquote>
<p>You can configure and use the <strong>Collector’s own internal telemetry</strong> to <strong>monitor its performance</strong>.</p>
</blockquote>
<h4 id="Local-exporters"><a href="#Local-exporters" class="headerlink" title="Local exporters"></a>Local exporters</h4><ol>
<li>For certain types of issues, such as <strong>configuration verification</strong> and <strong>network debugging</strong><ul>
<li>you can <strong>send a small amount of test data</strong> to a Collector configured to <strong>output</strong> to <strong>local logs</strong>.</li>
</ul>
</li>
<li>Using a <strong>local exporter</strong>, you can <strong>inspect</strong> the <strong>data being processed</strong> by the <strong>Collector</strong>.</li>
</ol>
<blockquote>
<p>For <strong>live troubleshooting</strong>, consider using the <strong>debug exporter</strong>, which can confirm that the Collector is <strong>receiving</strong>, <strong>processing</strong>, and <strong>exporting</strong> data.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">&quot;0.0.0.0:9411&quot;</span></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">zipkin</span>]</span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To begin testing, generate a <strong>Zipkin payload</strong>. For example, you can create a file called <strong>trace.json</strong> that contains:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;traceId&quot;:</span> <span class="string">&quot;5982fe77008310cc80f1da5e10147519&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;parentId&quot;:</span> <span class="string">&quot;90394f6bcffb5d13&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;id&quot;:</span> <span class="string">&quot;67fae42571535f60&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;kind&quot;:</span> <span class="string">&quot;SERVER&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;/m/n/2.6.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;:</span> <span class="number">1516781775726000</span>,</span><br><span class="line">    <span class="attr">&quot;duration&quot;:</span> <span class="number">26000</span>,</span><br><span class="line">    <span class="attr">&quot;localEndpoint&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;serviceName&quot;:</span> <span class="string">&quot;api&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;remoteEndpoint&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;serviceName&quot;:</span> <span class="string">&quot;apip&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;tags&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;data.http_response_code&quot;:</span> <span class="string">&quot;201&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>With the <strong>Collector running</strong>, send this <strong>payload</strong> to the <strong>Collector</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ otelcol-contrib --config config.yaml</span><br><span class="line">2025-02-13T14:39:00.848+0800    info	service@v0.119.0/service.go:186	Setting up own telemetry...</span><br><span class="line">2025-02-13T14:39:00.849+0800    info	builders/builders.go:26	Development component. May change in the future.	&#123;&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;traces&quot;, &quot;name&quot;: &quot;debug&quot;&#125;</span><br><span class="line">2025-02-13T14:39:00.853+0800    info	service@v0.119.0/service.go:252	Starting otelcol-contrib...	&#123;&quot;Version&quot;: &quot;0.119.0&quot;, &quot;NumCPU&quot;: 10&#125;</span><br><span class="line">2025-02-13T14:39:00.853+0800    info	extensions/extensions.go:39	Starting extensions...</span><br><span class="line">2025-02-13T14:39:00.854+0800    info	service@v0.119.0/service.go:275	Everything is ready. Begin running and processing data.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v -X POST localhost:9411/api/v2/spans -H&#x27;Content-Type: application/json&#x27; -d @trace.json</span><br><span class="line"></span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.</span><br><span class="line">* Host localhost:9411 was resolved.</span><br><span class="line">* IPv6: ::1</span><br><span class="line">* IPv4: 127.0.0.1</span><br><span class="line">*   Trying [::1]:9411...</span><br><span class="line">* Connected to localhost (::1) port 9411</span><br><span class="line">&gt; POST /api/v2/spans HTTP/1.1</span><br><span class="line">&gt; Host: localhost:9411</span><br><span class="line">&gt; User-Agent: curl/8.7.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 390</span><br><span class="line">&gt;</span><br><span class="line">* upload completely sent off: 390 bytes</span><br><span class="line">&lt; HTTP/1.1 202 Accepted</span><br><span class="line">&lt; Date: Thu, 13 Feb 2025 06:40:50 GMT</span><br><span class="line">&lt; Content-Length: 0</span><br><span class="line">&lt;</span><br><span class="line">* Connection #0 to host localhost left intact</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You should see a <strong>log entry</strong> like the following:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2025-02-13T14:40:50.938+0800    info	Traces	&#123;&quot;kind&quot;: &quot;exporter&quot;, &quot;data_type&quot;: &quot;traces&quot;, &quot;name&quot;: &quot;debug&quot;, &quot;resource spans&quot;: 1, &quot;spans&quot;: 1&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can also configure the <strong>debug exporter</strong> so the <strong>entire payload</strong> is <strong>printed</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>If you re-run the previous test with the modified configuration, the log output looks like this:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213144631702.png" alt="image-20250213144631702"></p>
<h4 id="Check-Collector-components"><a href="#Check-Collector-components" class="headerlink" title="Check Collector components"></a>Check Collector components</h4><ol>
<li>Use the following sub-command to <strong>list</strong> the <strong>available components</strong> in a <strong>Collector distribution</strong>, including their <strong>stability levels</strong>. </li>
<li>Please note that the <strong>output format</strong> might <strong>change</strong> across versions.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otelcol-otlp components</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">buildinfo:</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">otelcol</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">OpenTelemetry</span> <span class="string">Collector</span></span><br><span class="line">    <span class="attr">version:</span> <span class="number">0.119</span><span class="number">.0</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hostmetrics</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jaeger</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kafka</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nop</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">opencensus</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">otlp</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zipkin</span></span><br><span class="line">      <span class="attr">stability:</span></span><br><span class="line">        <span class="attr">logs:</span> <span class="string">Undefined</span></span><br><span class="line">        <span class="attr">metrics:</span> <span class="string">Undefined</span></span><br><span class="line">        <span class="attr">traces:</span> <span class="string">Beta</span></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">attributes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">batch</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">filter</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">memory_limiter</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">probabilistic_sampler</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">resource</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">span</span></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">debug</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">file</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kafka</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nop</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">opencensus</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">otlp</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">otlphttp</span></span><br><span class="line">      <span class="attr">stability:</span></span><br><span class="line">        <span class="attr">logs:</span> <span class="string">Beta</span></span><br><span class="line">        <span class="attr">metrics:</span> <span class="string">Stable</span></span><br><span class="line">        <span class="attr">traces:</span> <span class="string">Stable</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">prometheusremotewrite</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zipkin</span></span><br><span class="line"><span class="attr">connectors:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">forward</span></span><br><span class="line"><span class="attr">extensions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">health_check</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pprof</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">zpages</span></span><br><span class="line"><span class="attr">providers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">scheme:</span> <span class="string">env</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">scheme:</span> <span class="string">file</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">scheme:</span> <span class="string">yaml</span></span><br></pre></td></tr></table></figure>

<h4 id="Extensions-2"><a href="#Extensions-2" class="headerlink" title="Extensions"></a>Extensions</h4><blockquote>
<p>Here is a list of extensions you can enable for <strong>debugging</strong> the Collector.</p>
</blockquote>
<h5 id="Performance-Profiler-pprof"><a href="#Performance-Profiler-pprof" class="headerlink" title="Performance Profiler (pprof)"></a>Performance Profiler (pprof)</h5><ol>
<li>The <strong>pprof</strong> extension, which is available <strong>locally</strong> on port <strong>1777</strong>, allows you to <strong>profile</strong> the <strong>Collector</strong> as it runs.</li>
<li>This is an <strong>advanced use-case</strong> that should not be needed in most circumstances.</li>
</ol>
<h5 id="zPages-1"><a href="#zPages-1" class="headerlink" title="zPages"></a>zPages</h5><ol>
<li>The <strong>zPages</strong> extension, which is exposed <strong>locally</strong> on port <strong>55679</strong>, can be used to <strong>inspect live data</strong> from the Collector’s <strong>receivers</strong> and <strong>exporters</strong>.</li>
<li>The <strong>TraceZ</strong> page, exposed at <strong>&#x2F;debug&#x2F;tracez</strong>, is useful for <strong>debugging trace operations</strong>, such as:<ul>
<li><strong>Latency</strong> issues. Find the <strong>slow parts</strong> of <strong>an application</strong>.</li>
<li><strong>Deadlocks</strong> and <strong>instrumentation</strong> problems. Identify <strong>running spans</strong> that <strong>don’t end</strong>.</li>
<li><strong>Errors</strong>. Determine <strong>what types of errors</strong> are occurring and <strong>where they happen</strong>.</li>
</ul>
</li>
<li>Note that <strong>zpages</strong> might contain <strong>error logs</strong> that the <strong>Collector</strong> does <strong>not emit</strong> itself.</li>
<li>For <strong>containerized environments</strong>, you might want to expose this port on a <strong>public interface</strong> instead of just locally.<ul>
<li>the <strong>endpoint</strong> can be configured using the <strong>extensions</strong> configuration section:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">&quot;0.0.0.0:9411&quot;</span></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">verbosity:</span> <span class="string">detailed</span></span><br><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">zpages:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:55679</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span> [<span class="string">zpages</span>]</span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">zipkin</span>]</span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:55679/debug/tracez">http://127.0.0.1:55679/debug/tracez</a></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250213162127382.png" alt="image-20250213162127382"></p>
<h3 id="Checklist-for-debugging-complex-pipelines"><a href="#Checklist-for-debugging-complex-pipelines" class="headerlink" title="Checklist for debugging complex pipelines"></a>Checklist for debugging complex pipelines</h3><ol>
<li>It can be <strong>difficult</strong> to <strong>isolate problems</strong> when <strong>telemetry flows</strong> through <strong>multiple Collectors and networks</strong>.</li>
<li>For <strong>each “hop” of telemetry</strong> through a <strong>Collector</strong> or <strong>other component</strong> in your <strong>pipeline</strong>, it’s important to verify the following:</li>
</ol>
<ul>
<li>Are there <strong>error messages</strong> in the <strong>logs</strong> of the <strong>Collector</strong>?</li>
<li>How is the <strong>telemetry</strong> being <strong>ingested</strong> into this <strong>component</strong>?</li>
<li>How is the <strong>telemetry</strong> being <strong>modified</strong> (for example, <strong>sampling</strong> or <strong>redacting</strong>) by this <strong>component</strong>?</li>
<li>How is the <strong>telemetry</strong> being <strong>exported</strong> from this <strong>component</strong>?</li>
<li>What <strong>format</strong> is the <strong>telemetry</strong> in?</li>
<li>How is the <strong>next hop</strong> configured?</li>
<li>Are there any <strong>network policies</strong> that <strong>prevent</strong> data from getting <strong>in</strong> or <strong>out</strong>?</li>
</ul>
<h3 id="Common-Collector-issues"><a href="#Common-Collector-issues" class="headerlink" title="Common Collector issues"></a>Common Collector issues</h3><h4 id="Data-issues"><a href="#Data-issues" class="headerlink" title="Data issues"></a>Data issues</h4><blockquote>
<p>The <strong>Collector</strong> and its <strong>components</strong> might experience <strong>data issues</strong>.</p>
</blockquote>
<h5 id="Collector-is-dropping-data"><a href="#Collector-is-dropping-data" class="headerlink" title="Collector is dropping data"></a>Collector is dropping data</h5><ol>
<li>The Collector might drop data for a variety of reasons, but the most common are<ul>
<li>The Collector is <strong>improperly sized</strong>, resulting in an <strong>inability to process and export the data as fast as it is received</strong>.</li>
<li>The <strong>exporter destination</strong> is <strong>unavailable</strong> or <strong>accepting the data too slowly</strong>.</li>
</ul>
</li>
<li>To <strong>mitigate drops</strong>, configure the <strong>batch processor</strong>. In addition, it might be necessary to configure the <strong>queued retry options</strong> on enabled exporters.</li>
</ol>
<h5 id="Collector-is-not-receiving-data"><a href="#Collector-is-not-receiving-data" class="headerlink" title="Collector is not receiving data"></a>Collector is not receiving data</h5><ol>
<li>The Collector might not receive data for the following reasons:<ul>
<li>A <strong>network</strong> configuration issue.</li>
<li>An <strong>incorrect receiver</strong> configuration.</li>
<li>An <strong>incorrect client</strong> configuration.</li>
<li>The <strong>receiver</strong> is <strong>defined</strong> in the <strong>receivers section</strong> but <strong>not enabled</strong> in any <strong>pipelines</strong>.</li>
</ul>
</li>
<li>Check the Collector’s <strong>logs</strong> as well as <strong>zPages</strong> for potential issues.</li>
</ol>
<h5 id="Collector-is-not-processing-data"><a href="#Collector-is-not-processing-data" class="headerlink" title="Collector is not processing data"></a>Collector is not processing data</h5><blockquote>
<p>Most processing issues result from of a <strong>misunderstanding of how the processor works</strong> or a <strong>misconfiguration of the processor</strong></p>
</blockquote>
<ol>
<li>The <strong>attributes processor</strong> works only for “<strong>tags</strong>” on <strong>spans</strong>. The <strong>span name</strong> is handled by the <strong>span processor</strong>.</li>
<li>Processors for <strong>trace data</strong> (except <strong>tail sampling</strong>) work <strong>only on individual spans</strong>.</li>
</ol>
<h5 id="Collector-is-not-exporting-data"><a href="#Collector-is-not-exporting-data" class="headerlink" title="Collector is not exporting data"></a>Collector is not exporting data</h5><ol>
<li>The Collector might not export data for the following reasons:<ul>
<li>A <strong>network</strong> configuration issue.</li>
<li>An <strong>incorrect exporter</strong> configuration.</li>
<li>The <strong>destination</strong> is <strong>unavailable</strong>.</li>
</ul>
</li>
<li>Check the Collector’s <strong>logs</strong> as well as <strong>zPages</strong> for potential issues.</li>
<li>Exporting data often does not work because of a <strong>network configuration</strong> issue<ul>
<li>such as a <strong>firewall</strong>, <strong>DNS</strong>, or <strong>proxy</strong> issue. Note that the Collector does have proxy support</li>
</ul>
</li>
</ol>
<h4 id="Control-issues"><a href="#Control-issues" class="headerlink" title="Control issues"></a>Control issues</h4><blockquote>
<p>The Collector might experience <strong>failed startups</strong> or <strong>unexpected exits</strong> or <strong>restarts</strong>.</p>
</blockquote>
<h5 id="Collector-exits-or-restarts"><a href="#Collector-exits-or-restarts" class="headerlink" title="Collector exits or restarts"></a>Collector exits or restarts</h5><blockquote>
<p>The Collector might <strong>exit</strong> or <strong>restart</strong> due to:</p>
</blockquote>
<ol>
<li><strong>Memory pressure</strong> from a missing or misconfigured <strong>memory_limiter</strong> processor.</li>
<li><strong>Improper sizing</strong> for <strong>load</strong>.</li>
<li><strong>Improper configuration</strong>. For example, a <strong>queue sized</strong> to be <strong>larger</strong> than <strong>available memory</strong>.</li>
<li><strong>Infrastructure resource limits</strong>. For example, <strong>Kubernetes</strong>.</li>
</ol>
<h4 id="Configuration-issues"><a href="#Configuration-issues" class="headerlink" title="Configuration issues"></a>Configuration issues</h4><blockquote>
<p>The Collector might experience problems due to configuration issues.</p>
</blockquote>
<h5 id="Null-maps"><a href="#Null-maps" class="headerlink" title="Null maps"></a>Null maps</h5><blockquote>
<p>During <strong>configuration resolution</strong> of <strong>multiple configs</strong>, values in <strong>earlier configs</strong> are <strong>removed</strong> in favor of <strong>later configs</strong>, even if the <strong>later value</strong> is <strong>null</strong>.</p>
</blockquote>
<ol>
<li>Using <strong>{}</strong> to represent an <strong>empty map</strong>, such as <strong>processors: {}</strong> instead of <strong>processors:</strong>.</li>
<li><strong>Omitting empty configurations</strong> such as <strong>processors:</strong> from the configuration.</li>
</ol>
<h2 id="Scaling-the-Collector"><a href="#Scaling-the-Collector" class="headerlink" title="Scaling the Collector"></a>Scaling the Collector</h2><ol>
<li>When planning your <strong>observability pipeline</strong> with the OpenTelemetry Collector<ul>
<li>you should consider ways to <strong>scale the pipeline</strong> as your <strong>telemetry collection increases</strong>.</li>
</ul>
</li>
<li>The following sections will guide you through the <strong>planning phase</strong> discussing <strong>which components to scale</strong><ul>
<li>how to determine <strong>when it’s time to scale up</strong></li>
<li>and how to <strong>execute the plan</strong></li>
</ul>
</li>
</ol>
<h3 id="What-to-Scale"><a href="#What-to-Scale" class="headerlink" title="What to Scale"></a>What to Scale</h3><ol>
<li>While the <strong>OpenTelemetry Collector</strong> handles <strong>all telemetry signal types</strong> in a <strong>single binary</strong><ul>
<li>the reality is that <strong>each type</strong> may have <strong>different scaling needs</strong> and might require <strong>different scaling strategies</strong>.</li>
</ul>
</li>
<li>Start by looking at your <strong>workload</strong> to determine which <strong>signal type</strong> is expected to have the <strong>biggest share of the load</strong><ul>
<li>and which <strong>formats</strong> are expected to be <strong>received</strong> by the Collector.</li>
</ul>
</li>
<li>For instance, scaling a <strong>scraping cluster</strong> differs significantly from scaling <strong>log receivers</strong>.</li>
<li>Think also about how <strong>elastic</strong> the <strong>workload</strong> is<ul>
<li>do you have <strong>peaks</strong> at <strong>specific times</strong> of the day, or is the <strong>load similar</strong> across all <strong>24 hours</strong>?</li>
</ul>
</li>
<li>For example<ul>
<li>suppose you have <strong>hundreds of Prometheus endpoints</strong> to be <strong>scraped</strong></li>
<li>a <strong>terabyte of logs</strong> coming from <strong>fluentd</strong> instances <strong>every minute</strong></li>
<li>and some <strong>application metrics and traces</strong> arriving in <strong>OTLP format</strong> from your newest <strong>microservices</strong>.</li>
</ul>
</li>
<li>In that scenario, you’ll want an <strong>architecture</strong> that can <strong>scale each signal individually</strong><ul>
<li><strong>scaling</strong> the <strong>Prometheus receivers</strong> requires <strong>coordination</strong> among the <strong>scrapers</strong> to decide which scraper goes to which <strong>endpoint</strong>.</li>
<li>In contrast, we can <strong>horizontally scale</strong> the <strong>stateless log receivers</strong> on <strong>demand</strong>.</li>
<li>Having the <strong>OTLP receiver</strong> for <strong>metrics</strong> and <strong>traces</strong> in a <strong>third cluster of Collectors</strong><ul>
<li>would allow us to <strong>isolate failures</strong> and <strong>iterate faster</strong> without fear of <strong>restarting</strong> a <strong>busy pipeline</strong>.</li>
</ul>
</li>
<li>Given that the <strong>OTLP receiver</strong> enables the <strong>ingestion</strong> of <strong>all telemetry types</strong><ul>
<li>we can keep the <strong>application metrics and traces</strong> on the <strong>same instance</strong>, scaling them <strong>horizontally</strong> when needed.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="When-to-Scale"><a href="#When-to-Scale" class="headerlink" title="When to Scale"></a>When to Scale</h3><ol>
<li>Once again, we should <strong>understand</strong> our <strong>workload</strong> to decide when it’s <strong>time</strong> to <strong>scale up or down</strong><ul>
<li>but a few <strong>metrics</strong> emitted by the <strong>Collector</strong> can give you <strong>good hints</strong> on when to take action.</li>
</ul>
</li>
<li>One helpful hint the Collector can give you when the <strong>memory_limiter</strong> processor is part of the <strong>pipeline</strong> is the metric <strong>otelcol_processor_refused_spans</strong> <ul>
<li>This processor allows you to <strong>restrict</strong> the <strong>amount of memory</strong> the Collector can use.</li>
<li>While the Collector may <strong>consume a bit more than the maximum amount</strong> configured in this processor<ul>
<li>new data will <strong>eventually</strong> be <strong>blocked</strong> from <strong>passing through the pipeline</strong> by the <strong>memory_limiter</strong>, which will <strong>record the fact</strong> in this <strong>metric</strong>.</li>
</ul>
</li>
<li>The <strong>same metric</strong> exists for <strong>all other telemetry data types</strong>.</li>
<li>If data is being <strong>refused</strong> from <strong>entering the pipeline</strong> too often, you’ll probably want to <strong>scale up</strong> your Collector cluster. </li>
<li>You can <strong>scale down</strong> once the <strong>memory consumption</strong> across the nodes is <strong>significantly lower</strong> than the <strong>limit</strong> set in this processor.</li>
</ul>
</li>
<li>Another set of metrics to <strong>keep in sight</strong> are the ones related to the <strong>queue sizes</strong> for exporters<ul>
<li><strong>otelcol_exporter_queue_capacity</strong> and <strong>otelcol_exporter_queue_size</strong>.</li>
<li>The Collector will <strong>queue data in memory</strong> while waiting for a <strong>worker</strong> to become <strong>available</strong> to <strong>send the data</strong>.</li>
<li>If there <strong>aren’t enough workers</strong> or the <strong>backend is too slow</strong>, data starts <strong>piling up</strong> in the queue.</li>
<li>Once the queue has hit its capacity (<strong>otelcol_exporter_queue_size &gt; otelcol_exporter_queue_capacity</strong>)<ul>
<li>it rejects data (<strong>otelcol_exporter_enqueue_failed_spans</strong>).</li>
</ul>
</li>
<li>Adding <strong>more workers</strong> will often make the Collector <strong>export more data</strong>, which <strong>might not necessarily</strong> be <strong>what you want</strong></li>
</ul>
</li>
<li>It’s also worth getting familiar with the components that you intend to use, as <strong>different components</strong> might <strong>produce other metrics</strong>.<ul>
<li>For instance, the <strong>load-balancing exporter</strong> will <strong>record timing information</strong> about the <strong>export operations</strong></li>
<li>exposing this as part of the histogram <strong>otelcol_loadbalancer_backend_latency</strong>.</li>
<li>You can extract this information to determine whether <strong>all backends</strong> are taking <strong>a similar amount of time</strong> to <strong>process requests</strong><ul>
<li><strong>single backends being slow</strong> might indicate problems <strong>external</strong> to the <strong>Collector</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>For <strong>receivers</strong> doing <strong>scraping</strong>, such as the <strong>Prometheus receiver</strong>, the scraping should be <strong>scaled</strong>, or <strong>sharded</strong><ul>
<li>once the time it takes to finish <strong>scraping all targets</strong> often becomes <strong>critically close</strong> to the <strong>scrape interval</strong>.</li>
<li>When that happens, it’s time to add <strong>more scrapers</strong>, usually <strong>new instances</strong> of the <strong>Collector</strong>.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Collector metrics</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>otelcol_processor_refused_spans</td>
<td><strong>memory_limiter</strong> processor</td>
</tr>
<tr>
<td>otelcol_exporter_enqueue_failed_spans</td>
<td>queue is <strong>full</strong></td>
</tr>
<tr>
<td>otelcol_loadbalancer_backend_latency</td>
<td>external</td>
</tr>
</tbody></table>
<h4 id="When-NOT-to-scale"><a href="#When-NOT-to-scale" class="headerlink" title="When NOT to scale"></a>When NOT to scale</h4><ol>
<li>Perhaps as important as knowing when to scale is to understand which signs indicate that a <strong>scaling operation</strong> won’t bring <strong>any benefits</strong>.</li>
<li>One example is when a <strong>telemetry database</strong> can’t <strong>keep up</strong> with the <strong>load</strong>: adding Collectors to the cluster won’t help without scaling up the database.</li>
<li>when the <strong>network</strong> connection between the <strong>Collector</strong> and the <strong>backend</strong> is <strong>saturated</strong>, adding more Collectors might cause a <strong>harmful side effect</strong>.</li>
<li>Again, one way to catch this situation is by looking at the metrics <strong>otelcol_exporter_queue_size</strong> and <strong>otelcol_exporter_queue_capacity</strong>.<ul>
<li>If you keep having the <strong>queue size</strong> close to the <strong>queue capacity</strong>, it’s a sign that <strong>exporting data</strong> is <strong>slower</strong> than <strong>receiving data</strong>.</li>
<li>You can try to <strong>increase the queue size</strong>, which will cause the <strong>Collector</strong> to <strong>consume more memory</strong><ul>
<li>but it will also <strong>give some room</strong> for the <strong>backend</strong> to breathe without <strong>permanently dropping telemetry data</strong>.</li>
</ul>
</li>
<li>But if you keep <strong>increasing the queue capacity</strong> and the <strong>queue size keeps rising</strong> at the <strong>same proportion</strong><ul>
<li>it’s indicative that you might want to <strong>look outside</strong> of the <strong>Collector</strong>.</li>
</ul>
</li>
<li>It’s also important to note that <strong>adding more workers</strong> here <strong>would not be helpful</strong><ul>
<li>you’ll only be <strong>putting more pressure</strong> on a system <strong>already suffering</strong> from a <strong>high load</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>Another sign that the <strong>backend</strong> might be <strong>having problems</strong> is an <strong>increase</strong> in the <strong>otelcol_exporter_send_failed_spans</strong> metric<ul>
<li>this indicates that <strong>sending data</strong> to the backend <strong>failed permanently</strong>.</li>
<li><strong>Scaling up</strong> the <strong>Collector</strong> will likely only <strong>worsen the situation</strong> when this is <strong>consistently happening</strong>.</li>
</ul>
</li>
</ol>
<h3 id="How-to-Scale"><a href="#How-to-Scale" class="headerlink" title="How to Scale"></a>How to Scale</h3><ol>
<li>At this point, we know <strong>which parts</strong> of our <strong>pipeline</strong> needs <strong>scaling</strong>.<ul>
<li>Regarding scaling, we have three types of components: <strong>stateless</strong>, <strong>scrapers</strong>, and <strong>stateful</strong>.</li>
</ul>
</li>
<li><strong>Most Collector components</strong> are <strong>stateless</strong>.<ul>
<li>Even if they <strong>hold some state in memory</strong>, it <strong>isn’t relevant</strong> for <strong>scaling purposes</strong>.</li>
</ul>
</li>
<li><strong>Scrapers</strong>, like the <strong>Prometheus receiver</strong>, are configured to <strong>obtain telemetry data</strong> from <strong>external locations</strong>.<ul>
<li>The receiver will then <strong>scrape target by target</strong>, putting data into the pipeline.</li>
</ul>
</li>
<li>Components like the <strong>tail sampling processor</strong> cannot be easily scaled, as they <strong>keep some relevant state in memory</strong> for their business.<ul>
<li>Those components require some <strong>careful consideration</strong> before being <strong>scaled up</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Scaling-Stateless-Collectors"><a href="#Scaling-Stateless-Collectors" class="headerlink" title="Scaling Stateless Collectors"></a>Scaling Stateless Collectors</h4><blockquote>
<p>mode: <strong>sidecar</strong></p>
</blockquote>
<ol>
<li>The good news is that <strong>most of the time</strong>, scaling the Collector is <strong>easy</strong><ul>
<li>as it’s just a matter of <strong>adding new replicas</strong> and using an <strong>off-the-shelf load balancer</strong>.</li>
</ul>
</li>
<li>When <strong>gRPC</strong> is used to <strong>receive the data</strong>, we recommend using a <strong>load-balancer</strong> that <strong>understands gRPC</strong>.<ul>
<li>Otherwise, <strong>clients</strong> will <strong>always hit</strong> the <strong>same backing Collector</strong>.</li>
</ul>
</li>
<li>You should still consider <strong>splitting</strong> your <strong>collection pipeline</strong> with <strong>reliability</strong> in mind.<ul>
<li>For instance, when your <strong>workloads</strong> run on <strong>Kubernetes</strong><ul>
<li>you might want to use <strong>DaemonSets</strong> to have a <strong>Collector</strong> on the <strong>same physical node</strong> as your <strong>workloads</strong></li>
<li>and a <strong>remote central Collector</strong> responsible for <strong>pre-processing the data</strong> before <strong>sending the data</strong> to the <strong>storage</strong>.</li>
</ul>
</li>
<li>When the number of <strong>nodes</strong> is <strong>low</strong> and the number of <strong>pods</strong> is <strong>high</strong>, <strong>Sidecars</strong> might make more sense<ul>
<li>as you’ll get a <strong>better load balancing</strong> for the <strong>gRPC connections</strong> among <strong>Collector</strong> layers <strong>without</strong> needing a <strong>gRPC-specific load balancer</strong>.</li>
<li>Using a <strong>Sidecar</strong> also makes sense to avoid <strong>bringing down</strong> a <strong>crucial component</strong> for <strong>all pods in a node</strong> when <strong>one DaemonSet pod fails</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>sidecar pattern</strong> consists in <strong>adding a container</strong> into the <strong>workload pod</strong>. The <strong>OpenTelemetry Operator</strong> can <strong>automatically add</strong> that for you. <ul>
<li>you’ll need an <strong>OpenTelemetry Collector</strong> CR and you’ll need to <strong>annotate your PodSpec or Pod</strong> telling the <strong>operator</strong> to <strong>inject a sidecar</strong>:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">OpenTelemetryCollector</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sidecar-for-my-workload</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">sidecar</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    receivers:</span></span><br><span class="line"><span class="string">      otlp:</span></span><br><span class="line"><span class="string">        protocols:</span></span><br><span class="line"><span class="string">          grpc:</span></span><br><span class="line"><span class="string">            endpoint: 0.0.0.0:4317</span></span><br><span class="line"><span class="string">    processors:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">exporters:</span></span><br><span class="line">      <span class="comment"># <span class="doctag">Note:</span> Prior to v0.86.0 use the `logging` instead of `debug`.</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">pipelines:</span></span><br><span class="line">        <span class="attr">traces:</span></span><br><span class="line">          <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">          <span class="attr">processors:</span> []</span><br><span class="line">          <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-microservice</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">sidecar.opentelemetry.io/inject:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-microservice</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">my-org/my-microservice:v0.0.0</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>In case you prefer to <strong>bypass the operator</strong> and <strong>add a sidecar manually</strong>, here’s an example:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-microservice</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-microservice</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">my-org/my-microservice:v0.0.0</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector:0.69.0</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8888</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">4317</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">otlp-grpc</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--config=/conf/collector.yaml</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/conf</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">sidecar-conf</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sidecar-conf</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">sidecar-for-my-workload</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">collector.yaml</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">collector.yaml</span></span><br></pre></td></tr></table></figure>

<h4 id="Scaling-the-Scrapers"><a href="#Scaling-the-Scrapers" class="headerlink" title="Scaling the Scrapers"></a>Scaling the Scrapers</h4><blockquote>
<p>mode: <strong>statefulset</strong></p>
</blockquote>
<ol>
<li>Some <strong>receivers</strong> are actively obtaining telemetry data to place in the pipeline, like the <strong>hostmetrics</strong> and <strong>prometheus receivers</strong>.<ul>
<li>While getting <strong>host metrics</strong> isn’t something we’d typically <strong>scale up</strong></li>
<li>we might need to <strong>split the job</strong> of <strong>scraping thousands of endpoints</strong> for the <strong>Prometheus receiver</strong>.</li>
<li>And we can’t <strong>simply add more instances</strong> with the <strong>same configuration</strong><ul>
<li>as <strong>each Collector</strong> would try to <strong>scrape the same endpoints</strong> as every other Collector in the cluster</li>
<li>causing even <strong>more problems</strong>, like <strong>out-of-order samples</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The solution is to <strong>shard the endpoints</strong> by <strong>Collector instances</strong> so that if we add another <strong>replica</strong> of the <strong>Collector</strong><ul>
<li><strong>each one</strong> will act on a <strong>different set of endpoints</strong>.</li>
</ul>
</li>
<li>One way of doing that is by <strong>having one configuration file</strong> for <strong>each Collector</strong><ul>
<li>so that <strong>each Collector</strong> would <strong>discover only the relevant endpoints</strong> for <strong>that Collector</strong>.</li>
<li>For instance, <strong>each Collector</strong> could be responsible for <strong>one Kubernetes namespace</strong> or <strong>specific labels on the workloads</strong>.</li>
</ul>
</li>
<li>Another way of <strong>scaling</strong> the <strong>Prometheus receiver</strong> is to use the <strong>Target Allocator</strong>:<ul>
<li>it’s an <strong>extra binary</strong> that can be <strong>deployed as part of the OpenTelemetry Operator</strong></li>
<li>and will <strong>distribute Prometheus scrape targets</strong> for a given configuration across the cluster of <strong>Collectors</strong>.</li>
</ul>
</li>
<li>You can use a <strong>Custom Resource</strong> (CR) like the following to make use of the <strong>Target Allocator</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">OpenTelemetryCollector</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">collector-with-ta</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">statefulset</span></span><br><span class="line">  <span class="attr">targetAllocator:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    receivers:</span></span><br><span class="line"><span class="string">      prometheus:</span></span><br><span class="line"><span class="string">        config:</span></span><br><span class="line"><span class="string">          scrape_configs:</span></span><br><span class="line"><span class="string">          - job_name: &#x27;otel-collector&#x27;</span></span><br><span class="line"><span class="string">            scrape_interval: 10s</span></span><br><span class="line"><span class="string">            static_configs:</span></span><br><span class="line"><span class="string">            - targets: [ &#x27;0.0.0.0:8888&#x27; ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">exporters:</span></span><br><span class="line">      <span class="comment"># <span class="doctag">Note:</span> Prior to v0.86.0 use the `logging` instead of `debug`.</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">pipelines:</span></span><br><span class="line">        <span class="attr">traces:</span></span><br><span class="line">          <span class="attr">receivers:</span> [<span class="string">prometheus</span>]</span><br><span class="line">          <span class="attr">processors:</span> []</span><br><span class="line">          <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>After the <strong>reconciliation</strong>, the <strong>OpenTelemetry Operator</strong> will <strong>convert</strong> the <strong>Collector’s configuration</strong> into the following:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">   <span class="comment"># <span class="doctag">Note:</span> Prior to v0.86.0 use the `logging` instead of `debug`.</span></span><br><span class="line">   <span class="attr">debug:</span> <span class="literal">null</span></span><br><span class="line"> <span class="attr">receivers:</span></span><br><span class="line">   <span class="attr">prometheus:</span></span><br><span class="line">     <span class="attr">config:</span></span><br><span class="line">       <span class="attr">global:</span></span><br><span class="line">         <span class="attr">scrape_interval:</span> <span class="string">1m</span></span><br><span class="line">         <span class="attr">scrape_timeout:</span> <span class="string">10s</span></span><br><span class="line">         <span class="attr">evaluation_interval:</span> <span class="string">1m</span></span><br><span class="line">       <span class="attr">scrape_configs:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">otel-collector</span></span><br><span class="line">         <span class="attr">honor_timestamps:</span> <span class="literal">true</span></span><br><span class="line">         <span class="attr">scrape_interval:</span> <span class="string">10s</span></span><br><span class="line">         <span class="attr">scrape_timeout:</span> <span class="string">10s</span></span><br><span class="line">         <span class="attr">metrics_path:</span> <span class="string">/metrics</span></span><br><span class="line">         <span class="attr">scheme:</span> <span class="string">http</span></span><br><span class="line">         <span class="attr">follow_redirects:</span> <span class="literal">true</span></span><br><span class="line">         <span class="attr">http_sd_configs:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="attr">follow_redirects:</span> <span class="literal">false</span></span><br><span class="line">           <span class="attr">url:</span> <span class="string">http://collector-with-ta-targetallocator:80/jobs/otel-collector/targets?collector_id=$POD_NAME</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">   <span class="attr">pipelines:</span></span><br><span class="line">     <span class="attr">traces:</span></span><br><span class="line">       <span class="attr">exporters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">debug</span></span><br><span class="line">       <span class="attr">processors:</span> []</span><br><span class="line">       <span class="attr">receivers:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">prometheus</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Note how the <strong>Operator</strong> added a <strong>global</strong> section and a new <strong>http_sd_configs</strong> to the <strong>otel-collector scrape config</strong><ul>
<li>pointing to a <strong>Target Allocator</strong> instance it <strong>provisioned</strong>.</li>
</ul>
</li>
<li>Now, to <strong>scale the collectors</strong>, change the “<strong>replicas</strong>” attribute of the <strong>CR</strong><ul>
<li>and the <strong>Target Allocator</strong> will <strong>distribute the load</strong> accordingly by <strong>providing</strong> a custom <strong>http_sd_config</strong> per <strong>collector instance</strong> (<strong>pod</strong>).</li>
</ul>
</li>
</ol>
<h4 id="Scaling-Stateful-Collectors"><a href="#Scaling-Stateful-Collectors" class="headerlink" title="Scaling Stateful Collectors"></a>Scaling Stateful Collectors</h4><ol>
<li>Certain components might <strong>hold data in memory</strong>, yielding <strong>different results</strong> when <strong>scaled up</strong>.</li>
<li>It is the case for the <strong>tail-sampling processor</strong><ul>
<li>which <strong>holds spans in memory</strong> for a <strong>given period</strong>, evaluating the <strong>sampling decision</strong> only when the <strong>trace</strong> is considered <strong>complete</strong>.</li>
<li><strong>Scaling a Collector cluster</strong> by adding <strong>more replicas</strong> means that <strong>different collectors</strong> will <strong>receive spans for a given trace</strong><ul>
<li>causing <strong>each collector</strong> to <strong>evaluate</strong> whether that <strong>trace</strong> should be <strong>sampled</strong>, potentially coming to <strong>different answers</strong>.</li>
</ul>
</li>
<li>This behavior results in <strong>traces missing spans</strong>, misrepresenting what happened in that <strong>transaction</strong>.</li>
</ul>
</li>
<li>A similar situation happens when using the <strong>span-to-metrics processor</strong> to generate <strong>service metrics</strong>.<ul>
<li>When <strong>different collectors</strong> receive data related to the <strong>same service</strong>, <strong>aggregations</strong> based on the <strong>service name</strong> will be <strong>inaccurate</strong>.</li>
</ul>
</li>
<li>To <strong>overcome</strong> this, you can deploy a layer of Collectors containing the <strong>load-balancing exporter</strong><ul>
<li>in <strong>front</strong> of your <strong>Collectors</strong> doing the <strong>tail-sampling</strong> or the <strong>span-to-metrics processing</strong>.</li>
<li>The <strong>load-balancing exporter</strong> will <strong>hash</strong> the trace ID or the service name <strong>consistently</strong><ul>
<li>and <strong>determine</strong> which <strong>collector backend</strong> should <strong>receive</strong> spans for that trace.</li>
</ul>
</li>
<li>You can configure the <strong>load-balancing exporter</strong> to use the <strong>list of hosts</strong> behind a given <strong>DNS A entry</strong>, such as a <strong>Kubernetes headless service</strong>.</li>
<li>When the <strong>deployment</strong> backing that <strong>service</strong> is <strong>scaled up or down</strong>, the <strong>load-balancing exporter</strong> will <strong>eventually</strong> see the <strong>updated list of hosts</strong>.</li>
<li>Alternatively, you can specify <strong>a list of static hosts</strong> to be used by the <strong>load-balancing exporter</strong>.</li>
<li>You can scale up the layer of Collectors configured with the <strong>load-balancing exporter</strong> by <strong>increasing</strong> the number of <strong>replicas</strong>.</li>
<li>Note that <strong>each Collector</strong> will potentially run the <strong>DNS query</strong> at <strong>different times</strong>, causing a <strong>difference in the cluster view</strong> for <strong>a few moments</strong>.<ul>
<li>We recommend <strong>lowering the interval value</strong> so that the <strong>cluster view</strong> is <strong>different</strong> only for a <strong>short period</strong> in <strong>highly-elastic</strong> environments.</li>
</ul>
</li>
</ul>
</li>
<li>using a <strong>DNS A record</strong> (Kubernetes <strong>service</strong> otelcol on the observability namespace) as the input for the backend information:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">loadbalancing:</span></span><br><span class="line">    <span class="attr">protocol:</span></span><br><span class="line">      <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">resolver:</span></span><br><span class="line">      <span class="attr">dns:</span></span><br><span class="line">        <span class="attr">hostname:</span> <span class="string">otelcol.observability.svc.cluster.local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">      <span class="attr">processors:</span> []</span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">loadbalancing</span></span><br></pre></td></tr></table></figure>

<h2 id="Transforming-telemetry"><a href="#Transforming-telemetry" class="headerlink" title="Transforming telemetry"></a>Transforming telemetry</h2><ol>
<li>The OpenTelemetry Collector is a <strong>convenient</strong> place to <strong>transform data</strong> before <strong>sending</strong> it to a vendor or other systems.<ul>
<li>This is frequently done for <strong>data quality</strong>, <strong>governance</strong>, <strong>cost</strong>, and <strong>security</strong> reasons.</li>
</ul>
</li>
<li><strong>Processors</strong> available from the <strong>Collector Contrib</strong> repository support dozens of different <strong>transformations</strong> on <strong>metric</strong>, <strong>span</strong> and <strong>log</strong> data.</li>
<li>The configuration of processors, particularly <strong>advanced transformations</strong>, may have a <strong>significant impact</strong> on <strong>collector performance</strong>.</li>
</ol>
<h3 id="Basic-filtering"><a href="#Basic-filtering" class="headerlink" title="Basic filtering"></a>Basic filtering</h3><blockquote>
<p>Processor: <strong>filter processor</strong></p>
</blockquote>
<ol>
<li>The filter processor allows users to <strong>filter telemetry</strong> using <strong>OTTL</strong>. - <strong>OpenTelemetry Transformation Language</strong></li>
<li>Telemetry that <strong>matches</strong> any condition is <strong>dropped</strong>.</li>
</ol>
<blockquote>
<p>For example, to only allow span data from services app1, app2, and app3 and drop data from all other services:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">filter/ottl:</span></span><br><span class="line">    <span class="attr">error_mode:</span> <span class="string">ignore</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">span:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        resource.attributes[&quot;service.name&quot;] != &quot;app1&quot; and</span></span><br><span class="line"><span class="string">        resource.attributes[&quot;service.name&quot;] != &quot;app2&quot; and</span></span><br><span class="line"><span class="string">        resource.attributes[&quot;service.name&quot;] != &quot;app3&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>To only drop spans from a service called service1 while keeping all other spans:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">filter/ottl:</span></span><br><span class="line">    <span class="attr">error_mode:</span> <span class="string">ignore</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">span:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">resource.attributes[&quot;service.name&quot;]</span> <span class="string">==</span> <span class="string">&quot;service1&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Adding-or-Deleting-Attributes"><a href="#Adding-or-Deleting-Attributes" class="headerlink" title="Adding or Deleting Attributes"></a>Adding or Deleting Attributes</h3><blockquote>
<p>Processor: <strong>attributes processor</strong> or <strong>resource processor</strong></p>
</blockquote>
<ol>
<li>The <strong>attributes processor</strong> can be used to <strong>update</strong>, <strong>insert</strong>, <strong>delete</strong>, or <strong>replace</strong> existing attributes on <strong>metrics</strong> or <strong>traces</strong>.</li>
<li>For example, here’s a configuration that adds an attribute called <strong>account_id</strong> to <strong>all spans</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">attributes/accountid:</span></span><br><span class="line">    <span class="attr">actions:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">account_id</span></span><br><span class="line">        <span class="attr">value:</span> <span class="number">2245</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">insert</span></span><br></pre></td></tr></table></figure>

<ol>
<li>The <strong>resource processor</strong> has an <strong>identical</strong> configuration, but applies <strong>only</strong> to <strong>resource attributes</strong>.</li>
<li>Use the resource processor to <strong>modify infrastructure metadata</strong> related to <strong>telemetry</strong>.</li>
<li>For example, this <strong>inserts</strong> the <strong>Kubernetes cluster name</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">resource/k8s:</span></span><br><span class="line">    <span class="attr">attributes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">k8s.cluster.name</span></span><br><span class="line">        <span class="attr">from_attribute:</span> <span class="string">k8s-cluster</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">insert</span></span><br></pre></td></tr></table></figure>

<h3 id="Renaming-Metrics-or-Metric-Labels"><a href="#Renaming-Metrics-or-Metric-Labels" class="headerlink" title="Renaming Metrics or Metric Labels"></a>Renaming Metrics or Metric Labels</h3><blockquote>
<p>Processor: <strong>metrics transform processor</strong></p>
</blockquote>
<ol>
<li>The <strong>metrics transform processor</strong> shares <strong>some functionality</strong> with the <strong>attributes processor</strong></li>
<li>but also supports <strong>renaming</strong> and other <strong>metric-specific functionality</strong>.</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">metricstransform/rename:</span></span><br><span class="line">    <span class="attr">transforms:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">include:</span> <span class="string">system.cpu.usage</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">update</span></span><br><span class="line">        <span class="attr">new_name:</span> <span class="string">system.cpu.usage_time</span></span><br></pre></td></tr></table></figure>

<ol>
<li>The metrics transform processor also supports <strong>regular expressions</strong><ul>
<li>to apply <strong>transform rules</strong> to <strong>multiple metric names or metric labels</strong> at the same time.</li>
</ul>
</li>
<li>This example renames <strong>cluster_name</strong> to <strong>cluster-name</strong> for <strong>all metrics</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">metricstransform/clustername:</span></span><br><span class="line">    <span class="attr">transforms:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">include:</span> <span class="string">^.*$</span></span><br><span class="line">        <span class="attr">match_type:</span> <span class="string">regexp</span></span><br><span class="line">        <span class="attr">action:</span> <span class="string">update</span></span><br><span class="line">        <span class="attr">operations:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">action:</span> <span class="string">update_label</span></span><br><span class="line">            <span class="attr">label:</span> <span class="string">cluster_name</span></span><br><span class="line">            <span class="attr">new_label:</span> <span class="string">cluster-name</span></span><br></pre></td></tr></table></figure>

<h3 id="Enriching-Telemetry-with-Resource-Attributes"><a href="#Enriching-Telemetry-with-Resource-Attributes" class="headerlink" title="Enriching Telemetry with Resource Attributes"></a>Enriching Telemetry with Resource Attributes</h3><blockquote>
<p>Processor: <strong>resource detection processor</strong> and <strong>k8sattributes processor</strong></p>
</blockquote>
<ol>
<li>These processors can be used for <strong>enriching telemetry</strong> with <strong>relevant infrastructure metadata</strong><ul>
<li>to help teams quickly identify when <strong>underlying infrastructure</strong> is <strong>impacting service health or performance</strong>.</li>
</ul>
</li>
<li>The <strong>resource detection processor</strong> adds <strong>relevant cloud</strong> or <strong>host-level</strong> information to <strong>telemetry</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">resourcedetection/system:</span></span><br><span class="line">    <span class="comment"># Modify the list of detectors to match the cloud environment</span></span><br><span class="line">    <span class="attr">detectors:</span> [<span class="string">env</span>, <span class="string">system</span>, <span class="string">gcp</span>, <span class="string">ec2</span>, <span class="string">azure</span>]</span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">2s</span></span><br><span class="line">    <span class="attr">override:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Similarly, the <strong>K8s</strong> processor <strong>enriches telemetry</strong> with <strong>relevant Kubernetes metadata</strong> like <strong>pod name</strong>, <strong>node name</strong>, or <strong>workload name</strong>.</li>
<li>The <strong>collector pod</strong> must be configured to have <strong>read access</strong> to certain <strong>Kubernetes RBAC APIs</strong></li>
<li>To use the <strong>default options</strong>, it can be configured with an <strong>empty block</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">k8sattributes/default:</span></span><br></pre></td></tr></table></figure>

<h3 id="Setting-a-span-status"><a href="#Setting-a-span-status" class="headerlink" title="Setting a span status"></a>Setting a span status</h3><blockquote>
<p>Processor: <strong>transform processor</strong></p>
</blockquote>
<ol>
<li>Use the <strong>transform processor</strong> to set a <strong>span’s status</strong>.</li>
<li>You can also use the <strong>transform processor</strong> to <strong>modify the span name</strong> based on its <strong>attributes</strong> or <strong>extract span attributes</strong> from the <strong>span name</strong>.</li>
<li>The following example sets the span status to <strong>Ok</strong> when the <strong>http.request.status_code</strong> attribute is <strong>400</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">transform:</span></span><br><span class="line">  <span class="attr">error_mode:</span> <span class="string">ignore</span></span><br><span class="line">  <span class="attr">trace_statements:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">context:</span> <span class="string">span</span></span><br><span class="line">      <span class="attr">statements:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">set(status.code,</span> <span class="string">STATUS_CODE_OK)</span> <span class="string">where</span> <span class="string">attributes[&quot;http.request.status_code&quot;]</span> <span class="string">==</span> <span class="number">400</span></span><br></pre></td></tr></table></figure>

<h3 id="Advanced-Transformations"><a href="#Advanced-Transformations" class="headerlink" title="Advanced Transformations"></a>Advanced Transformations</h3><ol>
<li>More <strong>advanced attribute transformations</strong> are also available in the <strong>transform processor</strong>. </li>
<li>The <strong>transform processor</strong> allows end-users<ul>
<li>to specify <strong>transformations</strong> on <strong>metrics</strong>, <strong>logs</strong>, and <strong>traces</strong> using the <strong>OpenTelemetry Transformation Language</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><ol>
<li>The OpenTelemetry Collector is an <strong>executable file</strong><ul>
<li>that can <strong>receive</strong> telemetry, <strong>process</strong> it, and <strong>export</strong> it to <strong>multiple targets</strong>, such as <strong>observability backends</strong>.</li>
</ul>
</li>
<li>The Collector supports <strong>several popular open source protocols</strong> for <strong>receiving</strong> and <strong>sending</strong> telemetry data<ul>
<li>and it offers an <strong>extensible architecture</strong> for adding more protocols.</li>
</ul>
</li>
<li>Data <strong>receiving</strong>, <strong>processing</strong>, and <strong>exporting</strong> are done using <strong>pipelines</strong>. You can configure the <strong>Collector</strong> to have <strong>one or more pipelines</strong>.</li>
<li>Each <strong>pipeline</strong> includes the following:<ul>
<li>A set of <strong>receivers</strong> that <strong>collect the data</strong>.</li>
<li>A series of <strong>optional processors</strong> that get the data from <strong>receivers</strong> and <strong>process</strong> it.</li>
<li>A set of <strong>exporters</strong> which get the data from <strong>processors</strong> and <strong>send</strong> it <strong>outside</strong> the Collector.</li>
</ul>
</li>
<li>The <strong>same receiver</strong> can be included in <strong>multiple pipelines</strong> and <strong>multiple pipelines</strong> can include the <strong>same exporter</strong>.</li>
</ol>
<h3 id="Pipelines-1"><a href="#Pipelines-1" class="headerlink" title="Pipelines"></a>Pipelines</h3><ol>
<li>A pipeline <strong>defines a path</strong> that data follows in the Collector: from <strong>reception</strong>, to <strong>processing</strong> (or modification), and finally to <strong>export</strong>.</li>
<li>Pipelines can operate on three telemetry data types: <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>.</li>
<li>The <strong>data type</strong> is a <strong>property</strong> of the <strong>pipeline</strong> defined by its configuration.<ul>
<li><strong>Receivers</strong>, <strong>processors</strong>, and <strong>exporters</strong> used in a <strong>pipeline</strong> must support the <strong>particular data type</strong></li>
<li>otherwise the <strong>pipeline.ErrSignalNotSupported</strong> exception is reported when the configuration loads.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following diagram represents a typical pipeline:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214010012909.png" alt="image-20250214010012909"></p>
<ol>
<li><strong>Pipelines</strong> can have <strong>one or more receivers</strong>. <ul>
<li><strong>Data from all receivers</strong> is <strong>pushed</strong> to the <strong>first processor</strong>, which processes the data and then <strong>pushes</strong> it to the <strong>next</strong> processor.</li>
</ul>
</li>
<li>A processor might also <strong>drop the data</strong> if it’s <strong>sampling</strong> or <strong>filtering</strong>.<ul>
<li>This <strong>continues</strong> until the <strong>last processor</strong> in the pipeline <strong>pushes</strong> the data to the <strong>exporters</strong>.</li>
<li><strong>Each exporter</strong> gets a <strong>copy</strong> of <strong>each data element</strong>.</li>
</ul>
</li>
<li>The <strong>last processor</strong> uses a <strong>fanoutconsumer</strong> to <strong>send</strong> the <strong>data</strong> to <strong>multiple exporters</strong>.</li>
<li>The <strong>pipeline</strong> is <strong>constructed</strong> during <strong>Collector startup</strong> based on <strong>pipeline definition</strong> in the <strong>configuration</strong>.</li>
</ol>
<blockquote>
<p>A pipeline configuration typically looks like this:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span> <span class="comment"># section that can contain multiple subsections, one per pipeline</span></span><br><span class="line">    <span class="attr">traces:</span> <span class="comment"># type of the pipeline</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>, <span class="string">zipkin</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">memory_limiter</span>, <span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>, <span class="string">zipkin</span>]</span><br></pre></td></tr></table></figure>

<h4 id="Receivers-1"><a href="#Receivers-1" class="headerlink" title="Receivers"></a>Receivers</h4><ol>
<li>Receivers typically <strong>listen on a network port</strong> and <strong>receive telemetry data</strong>.</li>
<li>They can also <strong>actively obtain data</strong>, like <strong>scrapers</strong>.</li>
<li>Usually <strong>one receiver</strong> is configured to <strong>send received data</strong> to <strong>one pipeline</strong>.<ul>
<li>However, it is also possible to configure the <strong>same receiver</strong> to <strong>send the same received data</strong> to <strong>multiple pipelines</strong>.</li>
<li>This can be done by listing the <strong>same receiver</strong> in the <strong>receivers</strong> key of <strong>several pipelines</strong>:</li>
</ul>
</li>
<li>The configuration uses <strong>composite key names</strong> in the form of <strong>type[&#x2F;name]</strong>.</li>
</ol>
<blockquote>
<p><strong>otlp</strong> receiver will <strong>send the same data</strong> to pipeline <strong>traces</strong> and to pipeline <strong>traces&#x2F;2</strong></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">localhost:4317</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span> <span class="comment"># a pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">memory_limiter</span>, <span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">traces/2:</span> <span class="comment"># another pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">transform</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>When the Collector loads this config, the result looks like this diagram (part of processors and exporters are omitted for brevity):</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214011333848.png" alt="image-20250214011333848"></p>
<ol>
<li>When the <strong>same receiver</strong> is <strong>referenced</strong> in <strong>more than one pipeline</strong><ul>
<li>the Collector creates <strong>only one receiver instance</strong> at runtime that sends the data to a <strong>fan-out consumer</strong>. </li>
<li>The <strong>fan-out consumer</strong> in turn sends the data to the <strong>first processor</strong> of <strong>each pipeline</strong>.</li>
</ul>
</li>
<li>The <strong>data propagation</strong> from <strong>receiver</strong> to the <strong>fan-out consumer</strong> and then to <strong>processors</strong> is <strong>completed</strong> using a <strong>synchronous function call</strong>.<ul>
<li>This means that if <strong>one processor blocks the call</strong>, the <strong>other pipelines</strong> attached to this receiver are <strong>blocked</strong> from <strong>receiving the same data</strong></li>
<li>and the <strong>receiver</strong> itself <strong>stops processing and forwarding newly received data</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Exporters-1"><a href="#Exporters-1" class="headerlink" title="Exporters"></a>Exporters</h4><ol>
<li>Exporters typically <strong>forward</strong> the <strong>data</strong> they get to a <strong>destination</strong> on a <strong>network</strong>, but they can also <strong>send</strong> the data elsewhere.<ul>
<li>For example, <strong>debug</strong> exporter writes the <strong>telemetry data</strong> to the <strong>logging destination</strong>.</li>
</ul>
</li>
<li>The configuration allows for <strong>multiple exporters</strong> of the <strong>same type</strong>, even in the <strong>same pipeline</strong>.<ul>
<li>For example, you can have <strong>two otlp exporters defined</strong>, each one sending to a <strong>different OTLP endpoint</strong>:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp/1:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">example.com:4317</span></span><br><span class="line">  <span class="attr">otlp/2:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">localhost:14317</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>An exporter usually gets the data from one pipeline. However, you can configure <strong>multiple pipelines</strong> to send data to the <strong>same exporter</strong>:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">localhost:14250</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span> <span class="comment"># a pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">zipkin</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">memory_limiter</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">traces/2:</span> <span class="comment"># another pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">transform</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<ol>
<li>In the above example, <strong>otlp exporter</strong> gets data from <strong>pipeline traces</strong> and from <strong>pipeline traces&#x2F;2</strong>.</li>
<li>When the Collector loads this config, the result looks like this diagram (part of processors and receivers are omitted for brevity):</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214100438685.png" alt="image-20250214100438685"></p>
<h4 id="Processors-1"><a href="#Processors-1" class="headerlink" title="Processors"></a>Processors</h4><ol>
<li>A pipeline can contain <strong>sequentially connected processors</strong>.</li>
<li>The <strong>first processor</strong> gets the <strong>data</strong> from <strong>one or more receivers</strong> that are configured for the pipeline<ul>
<li>and the <strong>last processor</strong> sends the <strong>data</strong> to <strong>one or more exporters</strong> that are configured for the pipeline.</li>
</ul>
</li>
<li>All processors between the first and last receive the data from <strong>only one preceding processor</strong> and send data to <strong>only one succeeding processor</strong>.</li>
<li>Processors can <strong>transform</strong> the data before <strong>forwarding</strong> it, such as <strong>adding or removing attributes</strong> from <strong>spans</strong>.<ul>
<li>They can also <strong>drop the data</strong> by deciding <strong>not to forward it</strong> (for example, the <strong>probabilisticsampler processor</strong>).</li>
<li>Or they can <strong>generate new data</strong>.</li>
</ul>
</li>
<li>The <strong>same name of the processor</strong> can be <strong>referenced</strong> in the <strong>processors key</strong> of <strong>multiple pipelines</strong>.<ul>
<li>In this case, the <strong>same configuration</strong> is used for <strong>each</strong> of these <strong>processors</strong>, but <strong>each pipeline</strong> always gets <strong>its own instance</strong> of the <strong>processor</strong>.</li>
<li><strong>Each</strong> of these <strong>processors</strong> has its <strong>own state</strong>, and the <strong>processors</strong> are <strong>never shared between pipelines</strong>.</li>
<li>For example, if <strong>batch processor</strong> is used in <strong>several pipelines</strong><ul>
<li><strong>each pipeline</strong> has <strong>its own batch processor</strong></li>
<li>but <strong>each batch processor</strong> is <strong>configured</strong> exactly the <strong>same way</strong> if they <strong>reference</strong> the <strong>same key</strong> in the configuration.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>See the following configuration:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line">    <span class="attr">send_batch_size:</span> <span class="number">10000</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">traces:</span> <span class="comment"># a pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">zipkin</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br><span class="line">    <span class="attr">traces/2:</span> <span class="comment"># another pipeline of “traces” type</span></span><br><span class="line">      <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">      <span class="attr">processors:</span> [<span class="string">batch</span>]</span><br><span class="line">      <span class="attr">exporters:</span> [<span class="string">otlp</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>When the Collector loads this config, the result looks like this diagram:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214101814217.png" alt="image-20250214101814217"></p>
<ol>
<li>Note that <strong>each batch processor</strong> is an <strong>independent instance</strong>, although they are <strong>configured</strong> the <strong>same way</strong> with a <strong>send_batch_size</strong> of <strong>10000</strong>.</li>
<li>The <strong>same name</strong> of the <strong>processor</strong> must <strong>not</strong> be <strong>referenced multiple times</strong> in the <strong>processors key</strong> of a <strong>single pipeline</strong>.</li>
</ol>
<h3 id="Running-as-an-agent"><a href="#Running-as-an-agent" class="headerlink" title="Running as an agent"></a>Running as an agent</h3><ol>
<li>On a typical <strong>VM&#x2F;container</strong>, user <strong>applications</strong> are running in some <strong>processes&#x2F;pods</strong> with an <strong>OpenTelemetry library</strong>.</li>
<li><strong>Previously</strong>, the <strong>library</strong> did <strong>all</strong> the <strong>recording</strong>, <strong>collecting</strong>, <strong>sampling</strong>, and <strong>aggregation</strong> of <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong><ul>
<li>and then either <strong>exported the data</strong> to <strong>other persistent storage backends</strong> through the <strong>library exporters</strong>, or <strong>displayed</strong> it on <strong>local zpages</strong>.</li>
</ul>
</li>
<li>This pattern has several <strong>drawbacks</strong>, for example:<ul>
<li>For each OpenTelemetry library, <strong>exporters</strong> and <strong>zpages</strong> must be <strong>re-implemented</strong> in <strong>native languages</strong>.</li>
<li>In some programming languages (for example, <strong>Ruby</strong> or <strong>PHP</strong>), it is <strong>difficult</strong> to do the <strong>stats aggregation</strong> in <strong>process</strong>.</li>
<li>To enable <strong>exporting</strong> of OpenTelemetry <strong>spans</strong>, <strong>stats</strong>, or <strong>metrics</strong><ul>
<li>application users need to <strong>manually add library exporters</strong> and <strong>redeploy</strong> their binaries.</li>
<li>This is <strong>especially difficult</strong> when an <strong>incident has occurred</strong>, and users want to <strong>use OpenTelemetry</strong> to <strong>investigate the issue right away</strong>.</li>
</ul>
</li>
<li>Application users need to take the responsibility for <strong>configuring and initializing exporters</strong>.<ul>
<li>These tasks are <strong>error-prone</strong> (for example, setting up <strong>incorrect</strong> credentials or monitored resources)</li>
<li>and users may be <strong>reluctant</strong> to “<strong>pollute</strong>” their <strong>code</strong> with <strong>OpenTelemetry</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>To resolve the issues above, you can run OpenTelemetry Collector as an <strong>agent</strong>.<ul>
<li>The agent runs as a <strong>daemon</strong> in the <strong>VM&#x2F;container</strong> and can be <strong>deployed independent of the library</strong>.</li>
<li>it should be able to <strong>retrieve traces, metrics, and logs</strong> from the <strong>library</strong>, and <strong>export</strong> them to <strong>other backends</strong>.</li>
<li>We may also give the agent the ability to <strong>push configurations</strong> (such as <strong>sampling probability</strong>) to the <strong>library</strong>.</li>
<li>For those <strong>languages</strong> that <strong>cannot do stats aggregation in process</strong>, they can <strong>send raw measurements</strong> and have the <strong>agent</strong> do the <strong>aggregation</strong>.</li>
</ul>
</li>
<li>For <strong>developers</strong> and <strong>maintainers</strong> of other libraries:<ul>
<li>By <strong>adding specific receivers</strong>, you can configure an <strong>agent</strong> to accept <strong>traces</strong>, <strong>metrics</strong>, and logs <strong>from</strong> other <strong>tracing&#x2F;monitoring libraries</strong>, such as <strong>Zipkin</strong>, <strong>Prometheus</strong>, etc.</li>
</ul>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214103512094.png" alt="image-20250214103512094"></p>
<h3 id="Running-as-a-gateway"><a href="#Running-as-a-gateway" class="headerlink" title="Running as a gateway"></a>Running as a gateway</h3><ol>
<li>The <strong>OpenTelemetry Collector</strong> can run as a <strong>gateway instance</strong><ul>
<li>and <strong>receive spans and metrics</strong> exported by <strong>one or more agents or libraries</strong> or by tasks&#x2F;agents that emit in one of the <strong>supported protocols</strong>.</li>
</ul>
</li>
<li>The Collector is configured to <strong>send data</strong> to the configured <strong>exporter</strong>(s).</li>
<li>The OpenTelemetry Collector can also be deployed in other configurations<ul>
<li>such as <strong>receiving data from other agents or clients</strong> in one of the <strong>formats supported</strong> by <strong>its receivers</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following figure summarizes the deployment architecture:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214103927118.png" alt="image-20250214103927118"></p>
<h1 id="Platforms"><a href="#Platforms" class="headerlink" title="Platforms"></a>Platforms</h1><blockquote>
<p>OpenTelemetry is available for a <strong>variety</strong> of <strong>platforms</strong> and <strong>environments</strong>, ensuring <strong>seamless observability</strong> in <strong>hybrid systems</strong>.</p>
</blockquote>
<h2 id="FaaS"><a href="#FaaS" class="headerlink" title="FaaS"></a>FaaS</h2><blockquote>
<p>OpenTelemetry supports various methods of monitoring <strong>Function-as-a-Service</strong> provided by different <strong>cloud vendors</strong></p>
</blockquote>
<ol>
<li>Functions as a Service (<strong>FaaS</strong>) is an important <strong>serverless compute platform</strong> for <strong>cloud native apps</strong>.</li>
<li>these applications have slightly different <strong>monitoring guidance and requirements</strong> than applications running on <strong>Kubernetes</strong> or <strong>Virtual Machines</strong>.</li>
<li>The <strong>initial vendor scope</strong> of the FaaS documentation is around <strong>Microsoft Azure</strong>, <strong>Google Cloud Platform (GCP)</strong>, and <strong>Amazon Web Services (AWS)</strong>.<ul>
<li><strong>AWS functions</strong> are also known as <strong>Lambda</strong>.</li>
</ul>
</li>
<li>Community Assets<ul>
<li>The OpenTelemetry community currently provides <strong>pre-built Lambda layers</strong> able to <strong>auto-instrument</strong> your application</li>
<li>as well as the option of <strong>a standalone Collector Lambda layer</strong> that can be used when <strong>instrumenting applications manually or automatically</strong>.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Key</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Lambda Auto-Instrumentation</td>
<td>Automatically instrument your Lambdas with OpenTelemetry</td>
</tr>
<tr>
<td>Lambda Collector Configuration</td>
<td>Add and configure the <strong>Collector Lambda layer</strong> to your Lambda</td>
</tr>
<tr>
<td>Lambda Manual Instrumentation</td>
<td>Manually instrument your Lambdas with OpenTelemetry</td>
</tr>
</tbody></table>
<h2 id="Kubernetes-1"><a href="#Kubernetes-1" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><ol>
<li>Kubernetes is an open source system for <strong>automated deployment</strong>, <strong>scaling</strong>, and <strong>management</strong> of <strong>containerized applications</strong>.</li>
<li>It has become a <strong>widely-adopted</strong>, <strong>industry tool</strong>, leading to an <strong>increased need</strong> for <strong>observability tooling</strong>.</li>
<li>In response, OpenTelemetry has created many different tools to help Kubernetes users <strong>observe</strong> their <strong>clusters</strong> and <strong>services</strong>.</li>
</ol>
<h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><ol>
<li>This page will walk you through the <strong>fastest way</strong> to get started <strong>monitoring</strong> your <strong>Kubernetes cluster</strong> using OpenTelemetry.</li>
<li>It will focus on <strong>collecting metrics and logs</strong> for <strong>Kubernetes clusters, nodes, pods, and containers</strong><ul>
<li>as well as enabling the cluster to support <strong>services emitting OTLP data</strong>.</li>
</ul>
</li>
<li>If you’re looking to see <strong>OpenTelemetry</strong> in action with <strong>Kubernetes</strong>, the best place to start is the <strong>OpenTelemetry Demo</strong>.<ul>
<li>The demo is intended to illustrate the <strong>implementation of OpenTelemetry</strong><ul>
<li>but it is not intended to be an example of <strong>how to monitor Kubernetes itself</strong>.</li>
</ul>
</li>
<li>Once you finish with this walkthrough, it can be a fun experiment to install the demo and see how all the monitoring responds to an active workload.</li>
</ul>
</li>
<li>If you’re looking to start migrating from <strong>Prometheus</strong> to <strong>OpenTelemetry</strong><ul>
<li>or if you’re interested in using the <strong>OpenTelemetry Collector</strong> to <strong>collect Prometheus metrics</strong>, see <strong>Prometheus Receiver</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><ol>
<li>Kubernetes <strong>exposes</strong> a lot of important <strong>telemetry</strong> in many different ways.<ul>
<li>It has <strong>logs</strong>, <strong>events</strong>, <strong>metrics</strong> for many <strong>different objects</strong>, and the data <strong>generated</strong> by its <strong>workloads</strong>.</li>
</ul>
</li>
<li>To <strong>collect</strong> all of this data we’ll use the <strong>OpenTelemetry Collector</strong>.<ul>
<li>The collector has many different tools at its disposal which allow it to <strong>efficiently collect</strong> all this data and <strong>enhance</strong> it in meaningful ways.</li>
</ul>
</li>
<li>To collect all the data, we’ll need two installations of the collector, one as a <strong>Daemonset</strong> and one as a <strong>Deployment</strong>.</li>
<li>The <strong>Daemonset</strong> installation of the collector will be used to collect <strong>telemetry</strong> emitted by <strong>services</strong>, logs, and metrics for <strong>nodes</strong>, <strong>pods</strong>, and <strong>containers</strong>.</li>
<li>The <strong>Deployment</strong> installation of the collector will be used to collect <strong>metrics</strong> for the <strong>cluster</strong> and <strong>events</strong>.</li>
<li>To install the collector, we’ll use the <strong>OpenTelemetry Collector Helm chart</strong><ul>
<li>which comes with a <strong>few configuration options</strong> that will make <strong>configure</strong> the collector <strong>easier</strong>.</li>
</ul>
</li>
<li>If you’re interested in using a Kubernetes operator, see <strong>OpenTelemetry Operator</strong>, but this guide will focus on the Helm chart.</li>
</ol>
<h4 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h4><blockquote>
<p>Assuming you already have Helm installed, add the <strong>OpenTelemetry Collector Helm chart</strong> so it can be installed later.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts</span><br></pre></td></tr></table></figure>

<h4 id="Daemonset-Collector"><a href="#Daemonset-Collector" class="headerlink" title="Daemonset Collector"></a>Daemonset Collector</h4><ol>
<li>The first step to <strong>collecting Kubernetes telemetry</strong> is to deploy a <strong>daemonset instance</strong> of the <strong>OpenTelemetry Collector</strong><ul>
<li>to <strong>gather telemetry</strong> related to <strong>nodes</strong> and <strong>workloads running on those node</strong>.</li>
</ul>
</li>
<li>A daemonset is used to guarantee that this <strong>instance of the collector</strong> is <strong>installed</strong> on <strong>all nodes</strong>.</li>
<li>Each instance of the <strong>collector</strong> in the <strong>daemonset</strong> will collect data <strong>only from the node</strong> on which it is running.</li>
</ol>
<blockquote>
<p>This instance of the collector will use the following components:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Component</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>OTLP Receiver</td>
<td>to collect <strong>application traces, metrics and logs</strong>.</td>
</tr>
<tr>
<td>Kubernetes Attributes Processor</td>
<td>to add <strong>Kubernetes metadata</strong> to <strong>incoming application telemetry</strong>.</td>
</tr>
<tr>
<td>Kubeletstats Receiver</td>
<td>to pull <strong>node, pod, and container metrics</strong> from the <strong>API server</strong> on a <strong>kubelet</strong>.</td>
</tr>
<tr>
<td>Filelog Receiver</td>
<td>to collect <strong>Kubernetes logs</strong> and <strong>application logs</strong> written to <strong>stdout&#x2F;stderr</strong>.</td>
</tr>
</tbody></table>
<h5 id="OTLP-Receiver"><a href="#OTLP-Receiver" class="headerlink" title="OTLP Receiver"></a>OTLP Receiver</h5><ol>
<li>The OTLP Receiver is the <strong>best solution</strong> for collecting <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong> in the <strong>OTLP format</strong>.</li>
<li>If you are <strong>emitting application telemetry</strong> in <strong>another format</strong>, there is a good chance that the <strong>Collector</strong> has a <strong>receiver</strong> for it<ul>
<li>but for this tutorial we’ll assume the <strong>telemetry</strong> is <strong>formatted</strong> in <strong>OTLP</strong>.</li>
</ul>
</li>
<li>Although <strong>not a requirement</strong><ul>
<li>it is a <strong>common practice</strong> for <strong>applications</strong> running on a node to <strong>emit</strong> their <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong> to a <strong>collector</strong> running on the <strong>same node</strong>.</li>
<li>This <strong>keeps network interactions simple</strong> and allows <strong>easy correlation</strong> of <strong>Kubernetes metadata</strong> using the <strong>k8sattributes processor</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Kubernetes-Attributes-Processor"><a href="#Kubernetes-Attributes-Processor" class="headerlink" title="Kubernetes Attributes Processor"></a>Kubernetes Attributes Processor</h5><ol>
<li>The <strong>Kubernetes Attributes Processor</strong> is a <strong>highly recommended component</strong> in any collector receive <strong>telemetry</strong> from <strong>Kubernetes pods</strong>.</li>
<li>This processor <strong>automatically discovers Kubernetes pods</strong><ul>
<li><strong>extracts</strong> their <strong>metadata</strong> such as <strong>pod name</strong> or <strong>node name</strong>, and adds the extracted metadata to <strong>spans</strong>, <strong>metrics</strong>, and <strong>logs</strong> as <strong>resource attributes</strong>.</li>
</ul>
</li>
<li>Because it adds <strong>Kubernetes context</strong> to your <strong>telemetry</strong><ul>
<li>the Kubernetes Attributes Processor lets you <strong>correlate</strong> your application’s <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong> signals with your <strong>Kubernetes telemetry</strong></li>
<li>such as <strong>pod metrics and traces</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Kubeletstats-Receiver"><a href="#Kubeletstats-Receiver" class="headerlink" title="Kubeletstats Receiver"></a>Kubeletstats Receiver</h5><ol>
<li>The Kubeletstats Receiver is the receiver that <strong>gathers metrics</strong> about the <strong>node</strong>.</li>
<li>It will gather metrics like <strong>container memory usage</strong>, <strong>pod cpu usage</strong>, and <strong>node network errors</strong>.</li>
<li>All of the <strong>telemetry</strong> includes <strong>Kubernetes metadata</strong> like <strong>pod name</strong> or <strong>node name</strong>.</li>
<li>Since we’re using the <strong>Kubernetes Attributes Processor</strong><ul>
<li>we’ll be able to <strong>correlate</strong> our <strong>application traces, metrics, and logs</strong> with the <strong>metrics produced by the Kubeletstats Receiver</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Filelog-Receiver"><a href="#Filelog-Receiver" class="headerlink" title="Filelog Receiver"></a>Filelog Receiver</h5><ol>
<li>The Filelog Receiver will collect <strong>logs</strong> written to <strong>stdout&#x2F;stderr</strong> by <strong>tailing</strong> the logs Kubernetes writes to <code>/var/log/pods/*/*/*.log</code>.</li>
<li>Like most <strong>log tailers</strong>, the filelog receiver provides <strong>a robust set of actions</strong> that allow you to <strong>parse the file</strong> however you need.</li>
<li>Someday you may need to configure a Filelog Receiver on your own<ul>
<li>but for this walkthrough the OpenTelemetry Helm Chart will <strong>handle all the complex configuration</strong> for you.</li>
<li>In addition, it will <strong>extract useful Kubernetes metadata</strong> based on the <strong>file name</strong>.</li>
<li>Since we’re using the <strong>Kubernetes Attributes Processor</strong><ul>
<li>we’ll be able to correlate the <strong>application traces, metrics, and logs</strong> with the <strong>logs produced by the Filelog Receiver</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>OpenTelemetry Collector Helm chart</strong> makes configuring all of these <strong>components</strong> in a <strong>daemonset</strong> installation of the collector easy.<ul>
<li>It will also take care of all of the <strong>Kubernetes-specific details</strong>, such as <strong>RBAC</strong>, <strong>mounts</strong> and <strong>host ports</strong>.</li>
</ul>
</li>
<li>One caveat - the chart <strong>doesn’t send the data</strong> to <strong>any backend</strong> by default.<ul>
<li>If you want to actually use your data in your favorite backend you’ll need to configure an <strong>exporter</strong> yourself.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following <strong>values.yaml</strong> is what we’ll use - mode: <strong>daemonset</strong></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"></span><br><span class="line"><span class="attr">image:</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">otel/opentelemetry-collector-k8s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="comment"># enables the k8sattributesprocessor and adds it to the traces, metrics, and logs pipelines</span></span><br><span class="line">  <span class="attr">kubernetesAttributes:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># enables the kubeletstatsreceiver and adds it to the metrics pipelines</span></span><br><span class="line">  <span class="attr">kubeletMetrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Enables the filelogreceiver and adds it to the logs pipelines</span></span><br><span class="line">  <span class="attr">logsCollection:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">## The chart only includes the loggingexporter by default</span></span><br><span class="line"><span class="comment">## If you want to send your data somewhere you need to</span></span><br><span class="line"><span class="comment">## configure an exporter, such as the otlpexporter</span></span><br><span class="line"><span class="comment"># config:</span></span><br><span class="line"><span class="comment">#   exporters:</span></span><br><span class="line"><span class="comment">#     otlp:</span></span><br><span class="line"><span class="comment">#       endpoint: &quot;&lt;SOME BACKEND&gt;&quot;</span></span><br><span class="line"><span class="comment">#   service:</span></span><br><span class="line"><span class="comment">#     pipelines:</span></span><br><span class="line"><span class="comment">#       traces:</span></span><br><span class="line"><span class="comment">#         exporters: [ otlp ]</span></span><br><span class="line"><span class="comment">#       metrics:</span></span><br><span class="line"><span class="comment">#         exporters: [ otlp ]</span></span><br><span class="line"><span class="comment">#       logs:</span></span><br><span class="line"><span class="comment">#         exporters: [ otlp ]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>To use this <strong>values.yaml</strong> with the chart, save it to your preferred file location and then run the following command to <strong>install</strong> the <strong>chart</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install otel-collector open-telemetry/opentelemetry-collector --values &lt;path where you saved the chart&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You should now have a <strong>daemonset</strong> installation of the <strong>OpenTelemetry Collector</strong> running in your cluster <strong>collecting telemetry</strong> from <strong>each node</strong>!</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214135449598.png" alt="image-20250214135449598"></p>
<h4 id="Deployment-Collector"><a href="#Deployment-Collector" class="headerlink" title="Deployment Collector"></a>Deployment Collector</h4><ol>
<li>The next step to collecting <strong>Kubernetes telemetry</strong><ul>
<li>is to deploy a <strong>deployment instance</strong> of the <strong>Collector</strong> to <strong>gather telemetry</strong> related to the <strong>cluster</strong> as a whole.</li>
</ul>
</li>
<li>A deployment with <strong>exactly one replica</strong> ensures that we <strong>don’t produce duplicate data</strong>.</li>
</ol>
<blockquote>
<p>This instance of the Collector will use the following components:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Kubernetes <strong>Cluster</strong> Receiver</td>
<td>to collect <strong>cluster-level</strong> metrics and entity events.</td>
</tr>
<tr>
<td>Kubernetes <strong>Objects</strong> Receiver</td>
<td>to collect <strong>objects</strong>, such as <strong>events</strong>, from the <strong>Kubernetes API server</strong>.</td>
</tr>
</tbody></table>
<h5 id="Kubernetes-Cluster-Receiver"><a href="#Kubernetes-Cluster-Receiver" class="headerlink" title="Kubernetes Cluster Receiver"></a>Kubernetes Cluster Receiver</h5><ol>
<li>The Kubernetes Cluster Receiver is the Collector’s solution for collecting <strong>metrics</strong> about the <strong>state of the cluster</strong> as a <strong>whole</strong>.</li>
<li>This receiver can gather metrics about <strong>node conditions</strong>, <strong>pod phases</strong>, <strong>container restarts</strong>, <strong>available and desired deployments</strong>, and more.</li>
</ol>
<h5 id="Kubernetes-Objects-Receiver"><a href="#Kubernetes-Objects-Receiver" class="headerlink" title="Kubernetes Objects Receiver"></a>Kubernetes Objects Receiver</h5><ol>
<li>The Kubernetes Objects Receiver is the Collector’s solution for collecting <strong>Kubernetes objects</strong> as <strong>logs</strong>.</li>
<li>Although <strong>any object</strong> can be collected, a <strong>common and important</strong> use case is to collect <strong>Kubernetes events</strong>.</li>
<li>The OpenTelemetry Collector Helm chart <strong>streamlines the configuration</strong> for all of these components in a <strong>deployment</strong> installation of the Collector.<ul>
<li>It will also take care of all of the <strong>Kubernetes-specific</strong> details, such as <strong>RBAC</strong> and <strong>mounts</strong>.</li>
</ul>
</li>
<li>One caveat - the chart <strong>doesn’t send the data</strong> to <strong>any backend</strong> by default. <ul>
<li>If you want to actually use your data in your preferred backend, you’ll need to configure an <strong>exporter</strong> yourself.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following <strong>values.yaml</strong> is what we’ll use:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">deployment</span></span><br><span class="line"></span><br><span class="line"><span class="attr">image:</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">otel/opentelemetry-collector-k8s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># We only want one of these collectors - any more and we&#x27;d produce duplicate data</span></span><br><span class="line"><span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="comment"># enables the k8sclusterreceiver and adds it to the metrics pipelines</span></span><br><span class="line">  <span class="attr">clusterMetrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># enables the k8sobjectsreceiver to collect events only and adds it to the logs pipelines</span></span><br><span class="line">  <span class="attr">kubernetesEvents:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">## The chart only includes the loggingexporter by default</span></span><br><span class="line"><span class="comment">## If you want to send your data somewhere you need to</span></span><br><span class="line"><span class="comment">## configure an exporter, such as the otlpexporter</span></span><br><span class="line"><span class="comment"># config:</span></span><br><span class="line"><span class="comment"># exporters:</span></span><br><span class="line"><span class="comment">#   otlp:</span></span><br><span class="line"><span class="comment">#     endpoint: &quot;&lt;SOME BACKEND&gt;&quot;</span></span><br><span class="line"><span class="comment"># service:</span></span><br><span class="line"><span class="comment">#   pipelines:</span></span><br><span class="line"><span class="comment">#     traces:</span></span><br><span class="line"><span class="comment">#       exporters: [ otlp ]</span></span><br><span class="line"><span class="comment">#     metrics:</span></span><br><span class="line"><span class="comment">#       exporters: [ otlp ]</span></span><br><span class="line"><span class="comment">#     logs:</span></span><br><span class="line"><span class="comment">#       exporters: [ otlp ]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>To use this <strong>values.yaml</strong> with the chart, save it to your preferred file location and then run the following command to <strong>install</strong> the <strong>chart</strong>:</p>
</blockquote>
<blockquote>
<p>You should now have a <strong>deployment</strong> installation of the collector running in your cluster that <strong>collects cluster metrics and events</strong>!</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20250214142703656.png" alt="image-20250214142703656"></p>
<h3 id="Collector-4"><a href="#Collector-4" class="headerlink" title="Collector"></a>Collector</h3><ol>
<li>The <strong>OpenTelemetry Collector</strong> is a <strong>vendor-agnostic</strong> way to <strong>receive</strong>, <strong>process</strong> and <strong>export</strong> telemetry data. </li>
<li>Although the Collector can be used many places<ul>
<li>this documentation will focus on how to use the Collector to <strong>monitor Kubernetes and the services running on Kubernetes</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h4><ol>
<li>The OpenTelemetry Collector supports many different <strong>receivers</strong> and <strong>processors</strong> to facilitate <strong>monitoring Kubernetes</strong>.</li>
<li>This section covers the components that are <strong>most important</strong> for <strong>collecting</strong> Kubernetes data and <strong>enhancing</strong> it.</li>
<li>For <strong>application traces, metrics, or logs</strong>, we recommend the <strong>OTLP receiver</strong>, but any receiver that fits your data is appropriate.</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Pattern</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Kubernetes Attributes Processor</td>
<td>DaemonSet &#x2F; Deployment</td>
<td>adds <strong>Kubernetes metadata</strong> to <strong>incoming application telemetry</strong>.</td>
</tr>
<tr>
<td>Kubeletstats Receiver</td>
<td><strong>DaemonSet</strong> &#x2F; Deployment</td>
<td>pulls <strong>node, pod, and container metrics</strong> from the <strong>API server</strong> on a <strong>kubelet</strong>.</td>
</tr>
<tr>
<td>Filelog Receiver</td>
<td><strong>DaemonSet</strong> &#x2F; Deployment &#x2F; Sidecar</td>
<td>collects <strong>Kubernetes logs</strong> and <strong>application logs</strong> written to <strong>stdout&#x2F;stderr</strong>.</td>
</tr>
<tr>
<td>Kubernetes Cluster Receiver</td>
<td>DaemonSet &#x2F; Deployment</td>
<td>collects <strong>cluster-level</strong> metrics and entity events.</td>
</tr>
<tr>
<td>Kubernetes Objects Receiver</td>
<td>DaemonSet &#x2F; Deployment</td>
<td>collects <strong>objects</strong>, such as <strong>events</strong>, from the <strong>Kubernetes API server</strong>.</td>
</tr>
<tr>
<td>Prometheus Receiver</td>
<td>DaemonSet &#x2F; Deployment</td>
<td>receives metrics in <strong>Prometheus</strong> format.</td>
</tr>
<tr>
<td>Host Metrics Receiver</td>
<td><strong>DaemonSet</strong> &#x2F; Deployment</td>
<td>scrapes <strong>host metrics</strong> from <strong>Kubernetes nodes</strong>.</td>
</tr>
</tbody></table>
<h5 id="Kubernetes-Attributes-Processor-1"><a href="#Kubernetes-Attributes-Processor-1" class="headerlink" title="Kubernetes Attributes Processor"></a>Kubernetes Attributes Processor</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td><strong>DaemonSet</strong> (agent)</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Deployment</strong> (gateway)</td>
<td>Yes</td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>The Kubernetes Attributes Processor <strong>automatically discovers Kubernetes pods</strong><ul>
<li><strong>extracts</strong> their <strong>metadata</strong>, and adds the extracted metadata to <strong>spans</strong>, <strong>metrics</strong>, and <strong>logs</strong> as <strong>resource attributes</strong>.</li>
</ul>
</li>
<li>The Kubernetes Attributes Processor is one of the <strong>most important components</strong> for a collector running in <strong>Kubernetes</strong>.<ul>
<li>Any collector <strong>receiving application data</strong> should use it.</li>
</ul>
</li>
<li>Because it adds <strong>Kubernetes context</strong> to your telemetry<ul>
<li>the Kubernetes Attributes Processor lets you <strong>correlate</strong> your <strong>application’s traces, metrics, and logs signals</strong> with your <strong>Kubernetes telemetry</strong></li>
<li>such as <strong>pod metrics and traces</strong>.</li>
</ul>
</li>
<li>The Kubernetes Attributes Processor uses the <strong>Kubernetes API</strong> to <strong>discover all pods</strong> running in a cluster<ul>
<li>and keeps a <strong>record</strong> of their <strong>IP addresses</strong>, <strong>pod UIDs</strong>, and <strong>interesting metadata</strong>.</li>
</ul>
</li>
<li>By default, <strong>data</strong> passing through the <strong>processor</strong> is <strong>associated to a pod</strong> via the <strong>incoming request’s IP address</strong>, but different rules can be configured.</li>
<li>Since the processor uses the <strong>Kubernetes API</strong>, it requires <strong>special permissions</strong> (see example below).</li>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> you can use the kubernetesAttributes <strong>preset</strong> to get started.</li>
<li>The following <strong>attributes</strong> are added <strong>by default</strong>:<ul>
<li><strong>k8s.namespace.name</strong></li>
<li><strong>k8s.pod.name</strong></li>
<li><strong>k8s.pod.uid</strong></li>
<li><strong>k8s.pod.start_time</strong></li>
<li><strong>k8s.deployment.name</strong></li>
<li><strong>k8s.node.name</strong></li>
</ul>
</li>
<li>The Kubernetes Attributes Processor can also set <strong>custom resource attributes</strong> for <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong><ul>
<li>using the <strong>Kubernetes labels</strong> and <strong>Kubernetes annotations</strong> you’ve added to your <strong>pods</strong> and <strong>namespaces</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k8sattributes:</span></span><br><span class="line">  <span class="attr">auth_type:</span> <span class="string">&#x27;serviceAccount&#x27;</span></span><br><span class="line">  <span class="attr">extract:</span></span><br><span class="line">    <span class="attr">metadata:</span> <span class="comment"># extracted from the pod</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.namespace.name</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.pod.name</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.pod.start_time</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.pod.uid</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.deployment.name</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">k8s.node.name</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="comment"># Extracts the value of a pod annotation with key `annotation-one` and inserts it as a resource attribute with key `a1`</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">tag_name:</span> <span class="string">a1</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">annotation-one</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">pod</span></span><br><span class="line">      <span class="comment"># Extracts the value of a namespaces annotation with key `annotation-two` with regexp and inserts it as a resource  with key `a2`</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">tag_name:</span> <span class="string">a2</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">annotation-two</span></span><br><span class="line">        <span class="attr">regex:</span> <span class="string">field=(?P&lt;value&gt;.+)</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">namespace</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="comment"># Extracts the value of a namespaces label with key `label1` and inserts it as a resource attribute with key `l1`</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">tag_name:</span> <span class="string">l1</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">label1</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">namespace</span></span><br><span class="line">      <span class="comment"># Extracts the value of a pod label with key `label2` with regexp and inserts it as a resource attribute with key `l2`</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">tag_name:</span> <span class="string">l2</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">label2</span></span><br><span class="line">        <span class="attr">regex:</span> <span class="string">field=(?P&lt;value&gt;.+)</span></span><br><span class="line">        <span class="attr">from:</span> <span class="string">pod</span></span><br><span class="line">  <span class="attr">pod_association:</span> <span class="comment"># How to associate the data to a pod (order matters)</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">sources:</span> <span class="comment"># First try to use the value of the resource attribute k8s.pod.ip</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">from:</span> <span class="string">resource_attribute</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">k8s.pod.ip</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">sources:</span> <span class="comment"># Then try to use the value of the resource attribute k8s.pod.uid</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">from:</span> <span class="string">resource_attribute</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">k8s.pod.uid</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">sources:</span> <span class="comment"># If neither of those work, use the request&#x27;s connection to get the pod IP.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">from:</span> <span class="string">connection</span></span><br></pre></td></tr></table></figure>

<ol>
<li>There are also <strong>special configuration options</strong> for when the collector is deployed<ul>
<li>as a Kubernetes <strong>DaemonSet (agent)</strong> or as a Kubernetes <strong>Deployment (gateway)</strong>.</li>
</ul>
</li>
<li>Since the <strong>processor</strong> uses the <strong>Kubernetes API</strong>, it needs the <strong>correct permission</strong> to work correctly.<ul>
<li>For most use cases, you should give the <strong>service account</strong> running the collector the following <strong>permissions</strong> via a <strong>ClusterRole</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">collector</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&lt;OTEL_COL_NAMESPACE&gt;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;pods&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;namespaces&#x27;</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;watch&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;list&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;apps&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;replicasets&#x27;</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;list&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;watch&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;extensions&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;replicasets&#x27;</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;get&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;list&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;watch&#x27;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">collector</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">&lt;OTEL_COL_NAMESPACE&gt;</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>

<h5 id="Kubeletstats-Receiver-1"><a href="#Kubeletstats-Receiver-1" class="headerlink" title="Kubeletstats Receiver"></a>Kubeletstats Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td><strong>DaemonSet</strong> (agent)</td>
<td><strong>Preferred</strong></td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes, but will only collect metrics from the node it is deployed on</td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>Each <strong>Kubernetes node</strong> runs a <strong>kubelet</strong> that includes an <strong>API server</strong>.<ul>
<li>The <strong>Kubernetes Receiver</strong> connects to that <strong>kubelet</strong> via the <strong>API server</strong></li>
<li>to <strong>collect metrics</strong> about the <strong>node</strong> and the <strong>workloads running on the node</strong>.</li>
</ul>
</li>
<li>There are different methods for authentication, but typically a <strong>service account</strong> is used.<ul>
<li>The <strong>service account</strong> will also need <strong>proper permissions</strong> to <strong>pull data</strong> from the <strong>Kubelet</strong> (see below).</li>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> you can use the kubeletMetrics <strong>preset</strong> to get started.</li>
</ul>
</li>
<li><strong>By default</strong>, metrics will be collected for <strong>pods and nodes</strong>, but you can configure the receiver to collect <strong>container and volume</strong> metrics as well.<ul>
<li>The receiver also allows configuring <strong>how often</strong> the metrics are collected:</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">kubeletstats:</span></span><br><span class="line">    <span class="attr">collection_interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">auth_type:</span> <span class="string">&#x27;serviceAccount&#x27;</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">&#x27;$&#123;env:K8S_NODE_NAME&#125;:10250&#x27;</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">metric_groups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pod</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">container</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Since the <strong>processor</strong> uses the <strong>Kubernetes API</strong>, it needs the <strong>correct permission</strong> to work correctly.</li>
<li>For most use cases, you should give the <strong>service account</strong> running the Collector the following permissions via a <strong>ClusterRole</strong>.</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&#x27;nodes/stats&#x27;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;watch&#x27;</span>, <span class="string">&#x27;list&#x27;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">otel-collector</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure>

<h5 id="Filelog-Receiver-1"><a href="#Filelog-Receiver-1" class="headerlink" title="Filelog Receiver"></a>Filelog Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td><strong>DaemonSet</strong> (agent)</td>
<td><strong>Preferred</strong></td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes, but will only collect logs from the node it is deployed on</td>
</tr>
<tr>
<td><strong>Sidecar</strong></td>
<td>Yes, but this would be considered <strong>advanced configuration</strong></td>
</tr>
</tbody></table>
<ol>
<li>The Filelog Receiver <strong>tails</strong> and <strong>parses</strong> logs from files.<ul>
<li>Although it’s <strong>not</strong> a <strong>Kubernetes-specific</strong> receiver, it is still the <strong>de facto solution</strong> for <strong>collecting any logs</strong> from <strong>Kubernetes</strong>.</li>
</ul>
</li>
<li>The Filelog Receiver is <strong>composed of Operators</strong> that are <strong>chained together</strong> to process a log.<ul>
<li>Each <strong>Operator</strong> performs a <strong>simple responsibility</strong>, such as parsing a timestamp or JSON.</li>
<li>Configuring a Filelog Receiver is <strong>not trivial</strong>.</li>
</ul>
</li>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> you can use the logsCollection <strong>preset</strong> to get started.</li>
</ol>
<blockquote>
<p>Since <strong>Kubernetes logs</strong> normally fit a set of <strong>standard formats</strong>, a typical Filelog Receiver configuration for Kubernetes looks like:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filelog:</span></span><br><span class="line">  <span class="attr">include:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/pods/*/*/*.log</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="comment"># Exclude logs from all containers named otel-collector</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/pods/*/otel-collector/*.log</span></span><br><span class="line">  <span class="attr">start_at:</span> <span class="string">end</span></span><br><span class="line">  <span class="attr">include_file_path:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">include_file_name:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">operators:</span></span><br><span class="line">    <span class="comment"># parse container logs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">container</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">container-parser</span></span><br></pre></td></tr></table></figure>

<ol>
<li>In addition to the Filelog Receiver configuration, your OpenTelemetry Collector installation in Kubernetes will need <strong>access</strong> to the logs it wants to collect.</li>
<li>Typically this means adding some <strong>volumes</strong> and <strong>volumeMounts</strong> to your collector manifest:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="string">...</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">opentelemetry-collector</span></span><br><span class="line">          <span class="string">...</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="string">...</span></span><br><span class="line">            <span class="comment"># Mount the volumes to the collector container</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlogpods</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/log/pods</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="string">...</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="comment"># Typically the collector will want access to pod logs and container logs</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlogpods</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/log/pods</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">        <span class="string">...</span></span><br></pre></td></tr></table></figure>

<h5 id="Kubernetes-Cluster-Receiver-1"><a href="#Kubernetes-Cluster-Receiver-1" class="headerlink" title="Kubernetes Cluster Receiver"></a>Kubernetes Cluster Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td>DaemonSet (agent)</td>
<td>Yes, but will result in <strong>duplicate data</strong></td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes, but <strong>more than one replica results</strong> in <strong>duplicate data</strong></td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>The Kubernetes Cluster Receiver collects <strong>metrics</strong> and <strong>entity events</strong> about the cluster as a <strong>whole</strong> using the <strong>Kubernetes API server</strong>.</li>
<li>Use this receiver to answer questions about <strong>pod phases</strong>, <strong>node conditions</strong>, and other <strong>cluster-wide questions</strong>.</li>
<li>Since the receiver gathers <strong>telemetry</strong> for the <strong>cluster</strong> as a whole<ul>
<li><strong>only one instance</strong> of the <strong>receiver</strong> is needed across the cluster in order to <strong>collect all the data</strong>.</li>
</ul>
</li>
<li>There are different methods for <strong>authentication</strong>, but typically a <strong>service account</strong> is used.<ul>
<li>The service account also needs <strong>proper permissions</strong> to <strong>pull data</strong> from the <strong>Kubernetes API server</strong> (see below).</li>
</ul>
</li>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> you can use the clusterMetrics <strong>preset</strong> to get started.</li>
<li>For <strong>node conditions</strong>, the receiver <strong>only</strong> collects <strong>Ready</strong> by default, but it can be configured to collect more.</li>
<li>The receiver can also be configured to report a set of <strong>allocatable resources</strong>, such as <strong>cpu</strong> and <strong>memory</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">k8s_cluster:</span></span><br><span class="line">  <span class="attr">auth_type:</span> <span class="string">serviceAccount</span></span><br><span class="line">  <span class="attr">node_conditions_to_report:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Ready</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">MemoryPressure</span></span><br><span class="line">  <span class="attr">allocatable_types_to_report:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cpu</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">memory</span></span><br></pre></td></tr></table></figure>

<ol>
<li>Since the processor uses the <strong>Kubernetes API</strong>, it needs the <strong>correct permission</strong> to work correctly.</li>
<li>For most use cases, you should give the <strong>service account</strong> running the Collector the following <strong>permissions</strong> via a <strong>ClusterRole</strong>.</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces/status</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes/spec</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods/status</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">replicationcontrollers</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">replicationcontrollers/status</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">resourcequotas</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">apps</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">daemonsets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">deployments</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">replicasets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">statefulsets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">daemonsets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">deployments</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">replicasets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">batch</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">jobs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cronjobs</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">autoscaling</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">horizontalpodautoscalers</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure>

<h5 id="Kubernetes-Objects-Receiver-1"><a href="#Kubernetes-Objects-Receiver-1" class="headerlink" title="Kubernetes Objects Receiver"></a>Kubernetes Objects Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td>DaemonSet (agent)</td>
<td>Yes, but will result in <strong>duplicate data</strong></td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes, but <strong>more than one replica</strong> results in <strong>duplicate data</strong></td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>The Kubernetes Objects receiver collects, either by <strong>pulling</strong> or <strong>watching</strong>, objects from the <strong>Kubernetes API server</strong>.</li>
<li>The <strong>most common use case</strong> for this receiver is <strong>watching Kubernetes events</strong>, but it can be used to <strong>collect any type</strong> of <strong>Kubernetes object</strong>.</li>
<li>Since the receiver <strong>gathers telemetry</strong> for the <strong>cluster</strong> as a <strong>whole</strong><ul>
<li><strong>only one instance</strong> of the <strong>receiver</strong> is needed across the cluster in order to <strong>collect all the data</strong>.</li>
</ul>
</li>
<li>Currently <strong>only a service account</strong> can be used for <strong>authentication</strong>.<ul>
<li>The <strong>service account</strong> also needs <strong>proper permissions</strong> to <strong>pull data</strong> from the <strong>Kubernetes API server</strong> (see below).</li>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> and you want to <strong>ingest events</strong>, you can use the kubernetesEvents <strong>preset</strong> to get started.</li>
</ul>
</li>
<li>For <strong>objects</strong> configuring for <strong>pulling</strong>, the receiver will use the <strong>Kubernetes API</strong> to <strong>periodically list all the objects</strong> in the Cluster.<ul>
<li><strong>Each object</strong> will be <strong>converted</strong> to its <strong>own log</strong>.</li>
<li>For <strong>objects</strong> configured for <strong>watching</strong>, the receiver creates a <strong>stream</strong> with the <strong>Kubernetes API</strong> and which receives <strong>updates</strong> as the objects <strong>change</strong>.</li>
</ul>
</li>
<li>To see which objects are available for collection run in your cluster run <strong>kubectl api-resources</strong></li>
<li>Since the <strong>processor</strong> uses the <strong>Kubernetes API</strong>, it needs the <strong>correct permission</strong> to <strong>work correctly</strong>.<ul>
<li>Since <strong>service accounts</strong> are the <strong>only authentication option</strong> you must give the <strong>service account</strong> the <strong>proper access</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">otel-collector-opentelemetry-collector</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br></pre></td></tr></table></figure>

<h5 id="Prometheus-Receiver"><a href="#Prometheus-Receiver" class="headerlink" title="Prometheus Receiver"></a>Prometheus Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td>DaemonSet (agent)</td>
<td>Yes</td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes</td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>Prometheus is a <strong>common metrics format</strong> for both <strong>Kubernetes</strong> and <strong>services running on Kubernetes</strong>.<ul>
<li>The Prometheus receiver is a <strong>minimal drop-in replacement</strong> for the <strong>collection</strong> of those metrics.</li>
<li>It supports the <strong>full set</strong> of Prometheus <strong>scrape_config</strong> options.</li>
</ul>
</li>
<li>There are a <strong>few advanced Prometheus features</strong> that the receiver does <strong>not support</strong>.<ul>
<li>The receiver <strong>returns an error</strong> if the configuration <strong>YAML&#x2F;code</strong> contains any of the following:</li>
<li><strong>alert_config.alertmanagers</strong></li>
<li><strong>alert_config.relabel_configs</strong></li>
<li><strong>remote_read</strong></li>
<li><strong>remote_write</strong></li>
<li><strong>rule_files</strong></li>
</ul>
</li>
<li>The Prometheus receiver is <strong>Stateful</strong>, which means there are important details to consider when using it:<ul>
<li>The collector <strong>cannot auto-scale</strong> the <strong>scraping process</strong> when <strong>multiple replicas</strong> of the <strong>collector</strong> are run.</li>
<li>When running <strong>multiple replicas</strong> of the collector with the <strong>same config</strong>, it will <strong>scrape the targets multiple times</strong>.</li>
<li>Users need to configure <strong>each replica</strong> with a <strong>different scraping configuration</strong> if they want to <strong>manually shard the scraping process</strong>.</li>
</ul>
</li>
<li>To make configuring the Prometheus receiver easier, the <strong>OpenTelemetry Operator</strong> includes an <strong>optional component</strong> called the <strong>Target Allocator</strong>.<ul>
<li>This component can be used to <strong>tell a collector</strong> which <strong>Prometheus endpoints</strong> it should <strong>scrape</strong>.</li>
</ul>
</li>
</ol>
<h5 id="Host-Metrics-Receiver"><a href="#Host-Metrics-Receiver" class="headerlink" title="Host Metrics Receiver"></a>Host Metrics Receiver</h5><table>
<thead>
<tr>
<th>Deployment Pattern</th>
<th>Usable</th>
</tr>
</thead>
<tbody><tr>
<td>DaemonSet (agent)</td>
<td><strong>Preferred</strong></td>
</tr>
<tr>
<td>Deployment (gateway)</td>
<td>Yes, but only collects metrics from the node it is deployed on</td>
</tr>
<tr>
<td>Sidecar</td>
<td>No</td>
</tr>
</tbody></table>
<ol>
<li>The Host Metrics Receiver collects <strong>metrics</strong> from a <strong>host</strong> using a <strong>variety</strong> of <strong>scrapers</strong>. <ul>
<li>There is some <strong>overlap</strong> with the <strong>Kubeletstats Receiver</strong> so if you decide to use <strong>both</strong>, it may be worth it to <strong>disable</strong> these <strong>duplicate metrics</strong>.</li>
</ul>
</li>
<li>In <strong>Kubernetes</strong>, the receiver needs access to the <strong>hostfs</strong> volume to work properly.<ul>
<li>If you’re using the <strong>OpenTelemetry Collector Helm chart</strong> you can use the hostMetrics <strong>preset</strong> to get started.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The <strong>available scrapers</strong> are:<br>Not supported on <strong>macOS</strong> when <strong>compiled without cgo</strong>, which is the <strong>default</strong> for the images released by the <strong>Collector SIG</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Scraper</th>
<th>Supported OSs</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>cpu</td>
<td>All except macOS</td>
<td>CPU utilization metrics</td>
</tr>
<tr>
<td>disk</td>
<td>All except macOS</td>
<td>Disk I&#x2F;O metrics</td>
</tr>
<tr>
<td>load</td>
<td>All</td>
<td>CPU load metrics</td>
</tr>
<tr>
<td>filesystem</td>
<td>All</td>
<td>File System utilization metrics</td>
</tr>
<tr>
<td>memory</td>
<td>All</td>
<td>Memory utilization metrics</td>
</tr>
<tr>
<td>network</td>
<td>All</td>
<td>Network interface I&#x2F;O metrics &amp; TCP connection metrics</td>
</tr>
<tr>
<td>paging</td>
<td>All</td>
<td>Paging&#x2F;Swap space utilization and I&#x2F;O metrics</td>
</tr>
<tr>
<td>processes</td>
<td>Linux, macOS</td>
<td>Process count metrics</td>
</tr>
<tr>
<td>process</td>
<td>Linux, macOS, Windows</td>
<td>Per process CPU, Memory, and Disk I&#x2F;O metrics</td>
</tr>
</tbody></table>
<blockquote>
<p>make sure to mount the <strong>hostfs</strong> volume if you want to collect the <strong>node’s metrics</strong> and not the container’s.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="string">...</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">opentelemetry-collector</span></span><br><span class="line">          <span class="string">...</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="string">...</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hostfs</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/hostfs</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">mountPropagation:</span> <span class="string">HostToContainer</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hostfs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">      <span class="string">...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>and then configure the Host Metrics Receiver to use the volumeMount:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">hostmetrics:</span></span><br><span class="line">    <span class="attr">root_path:</span> <span class="string">/hostfs</span></span><br><span class="line">    <span class="attr">collection_interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">scrapers:</span></span><br><span class="line">      <span class="attr">cpu:</span></span><br><span class="line">      <span class="attr">load:</span></span><br><span class="line">      <span class="attr">memory:</span></span><br><span class="line">      <span class="attr">disk:</span></span><br><span class="line">      <span class="attr">filesystem:</span></span><br><span class="line">      <span class="attr">network:</span></span><br></pre></td></tr></table></figure>

<h4 id="Helm-Charts"><a href="#Helm-Charts" class="headerlink" title="Helm Charts"></a>Helm Charts</h4><ol>
<li>You can use <strong>OpenTelemetry Helm Charts</strong> to manage installs of the OpenTelemetry <strong>Collector</strong>, OpenTelemetry <strong>Operator</strong>, and OpenTelemetry <strong>Demo</strong>.</li>
<li>Add the OpenTelemetry Helm repository with:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">helm</span> <span class="string">repo</span> <span class="string">add</span> <span class="string">open-telemetry</span> <span class="string">https://open-telemetry.github.io/opentelemetry-helm-charts</span></span><br></pre></td></tr></table></figure>

<h5 id="Collector-Chart"><a href="#Collector-Chart" class="headerlink" title="Collector Chart"></a>Collector Chart</h5><ol>
<li>The OpenTelemetry Collector is an important tool for <strong>monitoring</strong> a <strong>Kubernetes cluster</strong> and all the <strong>services</strong> that in within.</li>
<li>To facilitate <strong>installation</strong> and <strong>management</strong> of a <strong>collector deployment</strong> in a <strong>Kubernetes</strong><ul>
<li>the OpenTelemetry community created the <strong>OpenTelemetry Collector Helm Chart</strong>.</li>
</ul>
</li>
<li>This helm chart can be used to install a collector as a <strong>Deployment</strong>, <strong>Daemonset</strong>, or <strong>Statefulset</strong>.</li>
</ol>
<blockquote>
<p>To install the chart with the release name <strong>my-opentelemetry-collector</strong>, run the following commands:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts</span><br><span class="line">helm install my-opentelemetry-collector open-telemetry/opentelemetry-collector \</span><br><span class="line">   --set image.repository=&quot;otel/opentelemetry-collector-k8s&quot; \</span><br><span class="line">   --set mode=&lt;daemonset|deployment|statefulset&gt; \</span><br></pre></td></tr></table></figure>

<ol>
<li>The OpenTelemetry Collector Chart requires that <strong>mode</strong> is set.<ul>
<li>mode can be either <strong>daemonset</strong>, <strong>deployment</strong>, or <strong>statefulset</strong> depending on which kind of Kubernetes deployment your use case requires.</li>
</ul>
</li>
<li>When installed, the chart provides a few <strong>default collector components</strong> to get you started. By default, the collector’s config will look like:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">exporters:</span></span><br><span class="line">  <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`.</span></span><br><span class="line">  <span class="attr">debug:</span> &#123;&#125;</span><br><span class="line"><span class="attr">extensions:</span></span><br><span class="line">  <span class="attr">health_check:</span> &#123;&#125;</span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line">  <span class="attr">batch:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">memory_limiter:</span></span><br><span class="line">    <span class="attr">check_interval:</span> <span class="string">5s</span></span><br><span class="line">    <span class="attr">limit_percentage:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">spike_limit_percentage:</span> <span class="number">25</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line">  <span class="attr">jaeger:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:14250</span></span><br><span class="line">      <span class="attr">thrift_compact:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:6831</span></span><br><span class="line">      <span class="attr">thrift_http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:14268</span></span><br><span class="line">  <span class="attr">otlp:</span></span><br><span class="line">    <span class="attr">protocols:</span></span><br><span class="line">      <span class="attr">grpc:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:4317</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:4318</span></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">scrape_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">opentelemetry-collector</span></span><br><span class="line">          <span class="attr">scrape_interval:</span> <span class="string">10s</span></span><br><span class="line">          <span class="attr">static_configs:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">$&#123;env:MY_POD_IP&#125;:8888</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:9411</span></span><br><span class="line"><span class="attr">service:</span></span><br><span class="line">  <span class="attr">extensions:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">health_check</span></span><br><span class="line">  <span class="attr">pipelines:</span></span><br><span class="line">    <span class="attr">logs:</span></span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">debug</span></span><br><span class="line">      <span class="attr">processors:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">memory_limiter</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">batch</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">debug</span></span><br><span class="line">      <span class="attr">processors:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">memory_limiter</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">batch</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">prometheus</span></span><br><span class="line">    <span class="attr">traces:</span></span><br><span class="line">      <span class="attr">exporters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">debug</span></span><br><span class="line">      <span class="attr">processors:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">memory_limiter</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">batch</span></span><br><span class="line">      <span class="attr">receivers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">jaeger</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">zipkin</span></span><br><span class="line">  <span class="attr">telemetry:</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">$&#123;env:MY_POD_IP&#125;:8888</span></span><br></pre></td></tr></table></figure>

<ol>
<li>The chart will also enable <strong>ports</strong> based on the <strong>default receivers</strong>.</li>
<li><strong>Default configuration</strong> can be <strong>removed</strong> by setting the value to <strong>null</strong> in your <strong>values.yaml</strong>.</li>
<li><strong>Ports</strong> can be <strong>disabled</strong> in the <strong>values.yaml</strong> as well.</li>
<li>You can <strong>add&#x2F;modify</strong> any part of the configuration using the config section in your values.yaml.</li>
<li>When <strong>changing a pipeline</strong>, you must <strong>explicitly list all the components</strong> that are in the <strong>pipeline</strong>, including any <strong>default components</strong>.</li>
<li>For example, to disable <strong>metrics</strong> and <strong>logging pipelines</strong> and <strong>non-otlp receivers</strong>:</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">receivers:</span></span><br><span class="line">    <span class="attr">jaeger:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">prometheus:</span> <span class="literal">null</span></span><br><span class="line">    <span class="attr">zipkin:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">pipelines:</span></span><br><span class="line">      <span class="attr">traces:</span></span><br><span class="line">        <span class="attr">receivers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">otlp</span></span><br><span class="line">      <span class="attr">metrics:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">logs:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">ports:</span></span><br><span class="line">  <span class="attr">jaeger-compact:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">jaeger-thrift:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">jaeger-grpc:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">zipkin:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/values.yaml">https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/values.yaml</a></p>
</blockquote>
<ol>
<li>Many of the <strong>important components</strong> the OpenTelemetry Collector uses<ul>
<li>to <strong>monitor Kubernetes</strong> require <strong>special setup</strong> in the Collector’s own Kubernetes deployment.</li>
</ul>
</li>
<li>In order to make using these components easier, the OpenTelemetry Collector Chart comes with some <strong>presets</strong> that<ul>
<li>when <strong>enabled</strong>, handle the <strong>complex setup</strong> for these important components.</li>
</ul>
</li>
<li>Presets should be used as a <strong>starting point</strong>.<ul>
<li>They configure <strong>basic</strong>, but <strong>rich</strong>, <strong>functionality</strong> for their <strong>related components</strong>.</li>
<li>If your use case requires <strong>extra configuration</strong> of these components<ul>
<li>it is recommend to <strong>NOT</strong> use the <strong>preset</strong> and instead <strong>manually configure</strong> the <strong>component</strong> and anything it requires (<strong>volumes</strong>, <strong>RBAC</strong>, etc.).</li>
</ul>
</li>
</ul>
</li>
</ol>
<h6 id="Logs-Collection-Preset"><a href="#Logs-Collection-Preset" class="headerlink" title="Logs Collection Preset"></a>Logs Collection Preset</h6><blockquote>
<p>logs</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be used to collect logs sent to <strong>standard output</strong> by <strong>Kubernetes containers</strong>.</li>
<li>This feature is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements in order to be <strong>safely enabled</strong>:<ul>
<li>It requires the <strong>Filelog receiver</strong> be <strong>included</strong> in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector</li>
<li>Although <strong>not a strict requirement</strong>, it is <strong>recommended</strong> this preset be used with <strong>mode&#x3D;daemonset</strong>.<ul>
<li>The <strong>filelogreceiver</strong> will <strong>only</strong> be able to collect <strong>logs</strong> on the <strong>node</strong> the Collector is running</li>
<li>and <strong>multiple configured Collectors</strong> on the <strong>same node</strong> will produce <strong>duplicate data</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>To <strong>enable</strong> this feature, set the <strong>presets.logsCollection.enabled</strong> property to <strong>true</strong>.<ul>
<li>When enabled, the <strong>chart</strong> will <strong>add</strong> a <strong>filelogreceiver</strong> to the <strong>logs pipeline</strong>.</li>
<li>This receiver is configured to read the files where <strong>Kubernetes container runtime</strong> writes all <strong>containers’ console output</strong>.<ul>
<li><code>/var/log/pods/*/*/*.log</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">logsCollection:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol>
<li>The chart’s <strong>default logs pipeline</strong> uses the <strong>debugexporter</strong>.<ul>
<li>Paired with the <strong>logsCollection</strong> preset’s <strong>filelogreceiver</strong></li>
<li>it is easy to accidentally <strong>feed the exported logs back into the collector</strong>, which can cause a “<strong>log explosion</strong>”.</li>
</ul>
</li>
<li>To prevent the <strong>looping</strong>, the default configuration of the receiver <strong>excludes the collector’s own logs</strong>.<ul>
<li>If you want to include the collector’s logs</li>
<li>make sure to <strong>replace the debug exporter</strong> with an exporter that does <strong>not send logs</strong> to <strong>collector’s standard output</strong>.</li>
</ul>
</li>
<li>Here’s an example <strong>values.yaml</strong> that <strong>replaces</strong> the <strong>default debug exporter</strong> on the <strong>logs pipeline</strong> with an <strong>otlphttp exporter</strong><ul>
<li>that <strong>sends</strong> the <strong>container logs</strong> to <a target="_blank" rel="noopener" href="https://example.com:55681/">https://example.com:55681</a> endpoint.</li>
</ul>
</li>
<li>It also uses <strong>presets.logsCollection.includeCollectorLogs</strong> to tell the <strong>preset</strong> to <strong>enable collection</strong> of the <strong>collector’s logs</strong>.</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">logsCollection:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">includeCollectorLogs:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">exporters:</span></span><br><span class="line">    <span class="attr">otlphttp:</span></span><br><span class="line">      <span class="attr">endpoint:</span> <span class="string">https://example.com:55681</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">pipelines:</span></span><br><span class="line">      <span class="attr">logs:</span></span><br><span class="line">        <span class="attr">exporters:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">otlphttp</span></span><br></pre></td></tr></table></figure>

<h6 id="Kubernetes-Attributes-Preset"><a href="#Kubernetes-Attributes-Preset" class="headerlink" title="Kubernetes Attributes Preset"></a>Kubernetes Attributes Preset</h6><blockquote>
<p>all</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be configured to add <strong>Kubernetes metadata</strong><ul>
<li>such as <strong>k8s.pod.name</strong>, <strong>k8s.namespace.name</strong>, and <strong>k8s.node.name</strong>, to <strong>logs</strong>, <strong>metrics</strong> and <strong>traces</strong>.</li>
</ul>
</li>
<li>It is highly recommended to use the preset, or <strong>enable</strong> the k8sattributesprocessor <strong>manually</strong>.</li>
<li>Due to <strong>RBAC considerations</strong>, this feature is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements:<ul>
<li>It requires the <strong>Kubernetes Attributes processor</strong> be <strong>included</strong> in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector.</li>
</ul>
</li>
<li>To <strong>enable</strong> this feature, set the <strong>presets.kubernetesAttributes.enabled</strong> property to <strong>true</strong>.<ul>
<li>When <strong>enabled</strong>, the <strong>chart</strong> will add the <strong>necessary RBAC roles</strong> to the <strong>ClusterRole</strong> and will add a k8sattributesprocessor to each enabled <strong>pipeline</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">kubernetesAttributes:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h6 id="Kubelet-Metrics-Preset"><a href="#Kubelet-Metrics-Preset" class="headerlink" title="Kubelet Metrics Preset"></a>Kubelet Metrics Preset</h6><blockquote>
<p>metrics</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be configured to collect <strong>node</strong>, <strong>pod</strong>, and <strong>container metrics</strong> from the <strong>API server</strong> on a <strong>kubelet</strong>.</li>
<li>This feature is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements:<ul>
<li>It requires the <strong>Kubeletstats receiver</strong> be included in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector.</li>
</ul>
</li>
<li>Although <strong>not a strict requirement</strong>, it is recommended this <strong>preset</strong> be used with <strong>mode&#x3D;daemonset</strong>.<ul>
<li>The kubeletstatsreceiver will <strong>only</strong> be able to <strong>collect metrics</strong> on the <strong>node</strong> the Collector is running</li>
<li>and <strong>multiple configured Collectors</strong> on the <strong>same node</strong> will produce <strong>duplicate data</strong>.</li>
</ul>
</li>
<li>To <strong>enable</strong> this feature, set the <strong>presets.kubeletMetrics.enabled</strong> property to <strong>true</strong>.<ul>
<li>When <strong>enabled</strong>, the chart will add the <strong>necessary RBAC roles</strong> to the <strong>ClusterRole</strong> and will add a <strong>kubeletstatsreceiver</strong> to the <strong>metrics pipeline</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">kubeletMetrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h6 id="Cluster-Metrics-Preset"><a href="#Cluster-Metrics-Preset" class="headerlink" title="Cluster Metrics Preset"></a>Cluster Metrics Preset</h6><blockquote>
<p>metrics</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be configured to collect <strong>cluster-level metrics</strong> from the <strong>Kubernetes API server</strong>.</li>
<li>These metrics include many of the metrics collected by <strong>Kube State Metrics</strong>.</li>
<li>This feature is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements:<ul>
<li>It requires the <strong>Kubernetes Cluster receiver</strong> be included in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector.</li>
<li>Although <strong>not a strict requirement</strong>, it is recommended this preset be used with <strong>mode&#x3D;deployment</strong> or <strong>mode&#x3D;statefulset</strong> with a <strong>single replica</strong>.</li>
<li>Running k8sclusterreceiver on <strong>multiple Collectors</strong> will produce <strong>duplicate data</strong>.</li>
</ul>
</li>
<li>To <strong>enable</strong> this feature, set the <strong>presets.clusterMetrics.enabled</strong> property to <strong>true</strong>.<ul>
<li>When <strong>enabled</strong>, the <strong>chart</strong> will add the <strong>necessary RBAC roles</strong> to the <strong>ClusterRole</strong> and will add a k8sclusterreceiver to the <strong>metrics pipeline</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">deployment</span></span><br><span class="line"><span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">clusterMetrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h6 id="Kubernetes-Events-Preset"><a href="#Kubernetes-Events-Preset" class="headerlink" title="Kubernetes Events Preset"></a>Kubernetes Events Preset</h6><blockquote>
<p>logs</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be configured to <strong>collect Kubernetes events</strong>.</li>
<li>This feature is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements:<ul>
<li>It requires the <strong>Kubernetes Objects receiver</strong> be included in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector.</li>
<li>Although <strong>not a strict requirement</strong>, it is recommended this <strong>preset</strong> be used with <strong>mode&#x3D;deployment</strong> or <strong>mode&#x3D;statefulset</strong> with a <strong>single replica</strong>.</li>
<li>Running k8sclusterreceiver on <strong>multiple Collectors</strong> will produce <strong>duplicate data</strong>.</li>
</ul>
</li>
<li>To <strong>enable</strong> this feature, set the <strong>presets.kubernetesEvents.enabled</strong> property to <strong>true</strong>.<ul>
<li>When <strong>enabled</strong>, the chart will add the <strong>necessary RBAC roles</strong> to the <strong>ClusterRole</strong></li>
<li>and will add a k8sobjectsreceiver to the <strong>logs pipeline</strong> configure to only <strong>collector events</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">deployment</span></span><br><span class="line"><span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">kubernetesEvents:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h6 id="Host-Metrics-Preset"><a href="#Host-Metrics-Preset" class="headerlink" title="Host Metrics Preset"></a>Host Metrics Preset</h6><blockquote>
<p>metrics</p>
</blockquote>
<ol>
<li>The OpenTelemetry Collector can be configured to <strong>collect host metrics</strong> from <strong>Kubernetes nodes</strong>.</li>
<li>This <strong>feature</strong> is <strong>disabled</strong> by <strong>default</strong>. It has the following requirements:<ul>
<li>It requires the <strong>Host Metrics receiver</strong> be included in the <strong>Collector image</strong>, such as the <strong>Contrib distribution</strong> of the Collector.</li>
<li>Although <strong>not a strict requirement</strong>, it is recommended this <strong>preset</strong> be used with <strong>mode&#x3D;daemonset</strong>.<ul>
<li>The hostmetricsreceiver will <strong>only</strong> be able to <strong>collect metrics</strong> on the <strong>node</strong> the Collector is running</li>
<li>and <strong>multiple configured Collectors</strong> on the <strong>same node</strong> will produce <strong>duplicate data</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>To enable this feature, set the <strong>presets.hostMetrics.enabled</strong> property to true.<ul>
<li>When <strong>enabled</strong>, the chart will add the <strong>necessary volumes and volumeMounts</strong> and will add a hostmetricsreceiver to the <strong>metrics pipeline</strong>.</li>
<li>By default metrics will be scrapped <strong>every 10 seconds</strong> and the following scrappers are enabled:</li>
<li>cpu + load + memory + disk + <code>filesystem[^1]</code> + network</li>
<li><code>[^1]</code> due to some <strong>overlap</strong> with the <strong>kubeletMetrics</strong> preset some <strong>filesystem types</strong> and <strong>mount points</strong> are <strong>excluded</strong> by default.</li>
</ul>
</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mode:</span> <span class="string">daemonset</span></span><br><span class="line"><span class="attr">presets:</span></span><br><span class="line">  <span class="attr">hostMetrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h5 id="Demo-Chart"><a href="#Demo-Chart" class="headerlink" title="Demo Chart"></a>Demo Chart</h5><blockquote>
<p>TBD</p>
</blockquote>
<h5 id="Operator-Chart"><a href="#Operator-Chart" class="headerlink" title="Operator Chart"></a>Operator Chart</h5><ol>
<li>The <strong>OpenTelemetry Operator</strong> is a <strong>Kubernetes operator</strong> that manages <strong>OpenTelemetry Collectors</strong> and <strong>auto-instrumentation of workloads</strong>.</li>
<li>One of the ways to install the <strong>OpenTelemetry Operator</strong> is via the <strong>OpenTelemetry Operator Helm Chart.</strong></li>
</ol>
<h6 id="Installing-the-Chart"><a href="#Installing-the-Chart" class="headerlink" title="Installing the Chart"></a>Installing the Chart</h6><blockquote>
<p>This will install an <strong>OpenTelemetry Operator</strong> with a <strong>self-signed certificate</strong> and <strong>secret</strong>.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">helm</span> <span class="string">repo</span> <span class="string">add</span> <span class="string">open-telemetry</span> <span class="string">https://open-telemetry.github.io/opentelemetry-helm-charts</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">my-opentelemetry-operator</span> <span class="string">open-telemetry/opentelemetry-operator</span> <span class="string">\</span></span><br><span class="line">  <span class="string">--set</span> <span class="string">&quot;manager.collectorImage.repository=otel/opentelemetry-collector-k8s&quot;</span> <span class="string">\</span></span><br><span class="line">  <span class="string">--set</span> <span class="string">admissionWebhooks.certManager.enabled=false</span> <span class="string">\</span></span><br><span class="line">  <span class="string">--set</span> <span class="string">admissionWebhooks.autoGenerateCert.enabled=true</span></span><br></pre></td></tr></table></figure>

<h6 id="Configuration-1"><a href="#Configuration-1" class="headerlink" title="Configuration"></a>Configuration</h6><ol>
<li>The Operator helm chart’s default <strong>values.yaml</strong> is ready to be installed, but it expects that <strong>Cert Manager</strong> is already present on the Cluster.</li>
<li>In Kubernetes, in order for the <strong>API server</strong> to <strong>communicate</strong> with the <strong>webhook component</strong><ul>
<li>the <strong>webhook</strong> requires a <strong>TLS certificate</strong> that the <strong>API server</strong> is configured to <strong>trust</strong>.</li>
</ul>
</li>
<li>The <strong>easiest</strong> and <strong>default</strong> method is to <strong>install</strong> the <strong>cert-manager</strong> and set <strong>admissionWebhooks.certManager.enabled</strong> to <strong>true</strong>. <ul>
<li>In this way, <strong>cert-manager</strong> will <strong>generate a self-signed certificate</strong>.</li>
</ul>
</li>
<li>You can <strong>provide</strong> your <strong>own Issuer</strong> by configuring the <strong>admissionWebhooks.certManager.issuerRef</strong> value.<ul>
<li>You will need to <strong>specify</strong> the <strong>kind</strong> (<strong>Issuer</strong> or <strong>ClusterIssuer</strong>) and the <strong>name</strong>.</li>
<li>Note that this method also requires the <strong>installation</strong> of <strong>cert-manager</strong>.</li>
</ul>
</li>
<li>You can use an <strong>automatically generated self-signed certificate</strong><ul>
<li>by setting <strong>admissionWebhooks.certManager.enabled</strong> to <strong>false</strong> and <strong>admissionWebhooks.autoGenerateCert.enabled</strong> to <strong>true</strong>.</li>
<li><strong>Helm</strong> will <strong>create a self-signed cert and a secret</strong> for you.</li>
</ul>
</li>
<li>You can <strong>use</strong> your <strong>own generated self-signed certificate</strong><ul>
<li>by setting both <strong>admissionWebhooks.certManager.enabled</strong> and <strong>admissionWebhooks.autoGenerateCert.enabled</strong> to <strong>false</strong>.</li>
<li>You should <strong>provide</strong> the <strong>necessary values</strong> to <strong>admissionWebhooks.cert_file</strong>, <strong>admissionWebhooks.key_file</strong>, and <strong>admissionWebhooks.ca_file</strong>.</li>
</ul>
</li>
<li>You can <strong>side-load custom webhooks and certificate</strong><ul>
<li>by disabling <strong>.Values.admissionWebhooks.create</strong> and <strong>admissionWebhooks.certManager.enabled</strong></li>
<li>while setting your <strong>custom cert secret name</strong> in <strong>admissionWebhooks.secretName</strong></li>
</ul>
</li>
<li>You can <strong>disable webhooks all together</strong><ul>
<li>by disabling <strong>.Values.admissionWebhooks.create</strong> and setting env var <strong>.Values.manager.env.ENABLE_WEBHOOKS</strong> to <strong>false</strong></li>
</ul>
</li>
</ol>
<h4 id="Kubernetes-Operator"><a href="#Kubernetes-Operator" class="headerlink" title="Kubernetes Operator"></a>Kubernetes Operator</h4><blockquote>
<p>that manages <strong>collectors</strong> and <strong>auto-instrumentation of the workload</strong> using <strong>OpenTelemetry instrumentation libraries</strong>.</p>
</blockquote>
<ol>
<li>The <strong>OpenTelemetry Operator</strong> is an <strong>implementation</strong> of a <strong>Kubernetes Operator</strong>.</li>
<li>The operator manages:<ul>
<li>OpenTelemetry <strong>Collector</strong></li>
<li><strong>auto-instrumentation</strong> of the <strong>workloads</strong> using <strong>OpenTelemetry instrumentation libraries</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>To install the operator in an existing cluster, make sure you have <strong>cert-manager</strong> installed and run:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">https://github.com/open-telemetry/opentelemetry-operator/releases/latest/download/opentelemetry-operator.yaml</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Once the <strong>opentelemetry-operator deployment</strong> is ready, create an <strong>OpenTelemetry Collector (otelcol) instance</strong>, like:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="bullet">-</span> <span class="string">&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">opentelemetry.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">OpenTelemetryCollector</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">simplest</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    receivers:</span></span><br><span class="line"><span class="string">      otlp:</span></span><br><span class="line"><span class="string">        protocols:</span></span><br><span class="line"><span class="string">          grpc:</span></span><br><span class="line"><span class="string">            endpoint: 0.0.0.0:4317</span></span><br><span class="line"><span class="string">          http:</span></span><br><span class="line"><span class="string">            endpoint: 0.0.0.0:4318</span></span><br><span class="line"><span class="string">    processors:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="attr">exporters:</span></span><br><span class="line">      <span class="comment"># <span class="doctag">NOTE:</span> Prior to v0.86.0 use `logging` instead of `debug`.</span></span><br><span class="line">      <span class="attr">debug:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">pipelines:</span></span><br><span class="line">        <span class="attr">traces:</span></span><br><span class="line">          <span class="attr">receivers:</span> [<span class="string">otlp</span>]</span><br><span class="line">          <span class="attr">processors:</span> []</span><br><span class="line">          <span class="attr">exporters:</span> [<span class="string">debug</span>]</span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h5 id="Injecting-Auto-instrumentation"><a href="#Injecting-Auto-instrumentation" class="headerlink" title="Injecting Auto-instrumentation"></a>Injecting Auto-instrumentation</h5><blockquote>
<p>TBD</p>
</blockquote>
<h5 id="Target-Allocator"><a href="#Target-Allocator" class="headerlink" title="Target Allocator"></a>Target Allocator</h5><blockquote>
<p>TBD</p>
</blockquote>
<h5 id="Troubleshooting-1"><a href="#Troubleshooting-1" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h5><blockquote>
<p>TBD</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/">https://blog.zhongmingmao.top/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/opentelemetry/">OpenTelemetry</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Observability - OpenTelemetry Doc V2</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/18/ebpf-principle/" title="eBPF - Principle"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">eBPF - Principle</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="title">Observability - OpenTelemetry Go</div></div></a></div><div><a href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="title">Observability - OpenTelemetry Node.js</div></div></a></div><div><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="title">Observability - OpenTelemetry Doc V2</div></div></a></div><div><a href="/2024/10/14/cloud-native-observability-opentelemetry/" title="Observability - OpenTelemetry"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-14</div><div class="title">Observability - OpenTelemetry</div></div></a></div><div><a href="/2024/10/13/cloud-native-observability-concept/" title="Observability - Concept"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/cloud-native-observability-concept.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-13</div><div class="title">Observability - Concept</div></div></a></div><div><a href="/2023/05/11/cloud-native-foundation-k8s-helm-doc/" title="Kubernetes - Helm Doc"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/helm.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-11</div><div class="title">Kubernetes - Helm Doc</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">622</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">189</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">80</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">1.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%82%E6%B5%8B%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">可观测性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenTelemetry"><span class="toc-number">2.2.</span> <span class="toc-text">OpenTelemetry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">主要组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7"><span class="toc-number">2.2.2.</span> <span class="toc-text">可扩展性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">3.1.</span> <span class="toc-text">入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Observability"><span class="toc-number">3.1.1.</span> <span class="toc-text">Observability</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E6%80%A7-%E6%8C%87%E6%A0%87"><span class="toc-number">3.1.2.</span> <span class="toc-text">可靠性 + 指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF"><span class="toc-number">3.1.3.</span> <span class="toc-text">分布式链路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spans"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">Spans</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%93%BE%E8%B7%AF-1"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">分布式链路</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BC%A0%E6%92%AD"><span class="toc-number">3.2.</span> <span class="toc-text">上下文传播</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">3.2.1.</span> <span class="toc-text">上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%92%AD"><span class="toc-number">3.2.2.</span> <span class="toc-text">传播</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7"><span class="toc-number">3.3.</span> <span class="toc-text">信号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Traces"><span class="toc-number">3.3.1.</span> <span class="toc-text">Traces</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tracer-Provider"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">Tracer Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tracer"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">Tracer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trace-Exporters"><span class="toc-number">3.3.1.3.</span> <span class="toc-text">Trace Exporters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Context-Propagation"><span class="toc-number">3.3.1.4.</span> <span class="toc-text">Context Propagation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spans-1"><span class="toc-number">3.3.1.5.</span> <span class="toc-text">Spans</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Span-Context"><span class="toc-number">3.3.1.5.1.</span> <span class="toc-text">Span Context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Attributes"><span class="toc-number">3.3.1.5.2.</span> <span class="toc-text">Attributes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Span-Events"><span class="toc-number">3.3.1.5.3.</span> <span class="toc-text">Span Events</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Span-Links"><span class="toc-number">3.3.1.5.4.</span> <span class="toc-text">Span Links</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Span-Status"><span class="toc-number">3.3.1.5.5.</span> <span class="toc-text">Span Status</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Span-Kind"><span class="toc-number">3.3.1.5.6.</span> <span class="toc-text">Span Kind</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metrics"><span class="toc-number">3.3.2.</span> <span class="toc-text">Metrics</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Meter-Provider"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">Meter Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Meter"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">Meter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metric-Exporter"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">Metric Exporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metric-Instruments"><span class="toc-number">3.3.2.4.</span> <span class="toc-text">Metric Instruments</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Aggregation"><span class="toc-number">3.3.2.5.</span> <span class="toc-text">Aggregation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Views"><span class="toc-number">3.3.2.6.</span> <span class="toc-text">Views</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Language-Support"><span class="toc-number">3.3.2.7.</span> <span class="toc-text">Language Support</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logs"><span class="toc-number">3.3.3.</span> <span class="toc-text">Logs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenTelemetry-logs"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">OpenTelemetry logs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Structured-Unstructured-Semistructured"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">Structured + Unstructured + Semistructured</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Structured-logs"><span class="toc-number">3.3.3.2.1.</span> <span class="toc-text">Structured logs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Unstructured-logs"><span class="toc-number">3.3.3.2.2.</span> <span class="toc-text">Unstructured logs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Semistructured-logs"><span class="toc-number">3.3.3.2.3.</span> <span class="toc-text">Semistructured logs</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenTelemetry-logging-components"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">OpenTelemetry logging components</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Log-Appender-Bridge"><span class="toc-number">3.3.3.3.1.</span> <span class="toc-text">Log Appender &#x2F; Bridge</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Logger-Provider"><span class="toc-number">3.3.3.3.2.</span> <span class="toc-text">Logger Provider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Logger"><span class="toc-number">3.3.3.3.3.</span> <span class="toc-text">Logger</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Log-Record-Exporter"><span class="toc-number">3.3.3.3.4.</span> <span class="toc-text">Log Record Exporter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Log-Record"><span class="toc-number">3.3.3.3.5.</span> <span class="toc-text">Log Record</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Baggage"><span class="toc-number">3.3.4.</span> <span class="toc-text">Baggage</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Example"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#What-should-OTel-Baggage-be-used-for"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">What should OTel Baggage be used for?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Baggage-security-considerations"><span class="toc-number">3.3.4.3.</span> <span class="toc-text">Baggage security considerations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Baggage-is-not-the-same-as-attributes"><span class="toc-number">3.3.4.4.</span> <span class="toc-text">Baggage is not the same as attributes</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation"><span class="toc-number">3.4.</span> <span class="toc-text">Instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zero-code"><span class="toc-number">3.4.1.</span> <span class="toc-text">Zero-code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-based"><span class="toc-number">3.4.2.</span> <span class="toc-text">Code-based</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Import-the-OpenTelemetry-API-and-SDK"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">Import the OpenTelemetry API and SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-the-OpenTelemetry-API"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">Configure the OpenTelemetry API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-the-OpenTelemetry-SDK"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">Configure the OpenTelemetry SDK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-Telemetry-Data"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">Create Telemetry Data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Export-Data"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">Export Data</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Libraries"><span class="toc-number">3.4.3.</span> <span class="toc-text">Libraries</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Semantic-conventions"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">Semantic conventions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Defining-spans"><span class="toc-number">3.4.3.1.1.</span> <span class="toc-text">Defining spans</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#When-not-to-instrument"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">When not to instrument</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenTelemetry-API"><span class="toc-number">3.4.3.3.</span> <span class="toc-text">OpenTelemetry API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#What-to-instrument"><span class="toc-number">3.4.3.4.</span> <span class="toc-text">What to instrument</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Public-APIs"><span class="toc-number">3.4.3.4.1.</span> <span class="toc-text">Public APIs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Nested-network-and-other-spans"><span class="toc-number">3.4.3.4.2.</span> <span class="toc-text">Nested network and other spans</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Events"><span class="toc-number">3.4.3.4.3.</span> <span class="toc-text">Events</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Context-propagation"><span class="toc-number">3.4.3.5.</span> <span class="toc-text">Context propagation</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Extracting-context"><span class="toc-number">3.4.3.5.1.</span> <span class="toc-text">Extracting context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Injecting-context"><span class="toc-number">3.4.3.5.2.</span> <span class="toc-text">Injecting context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#In-process"><span class="toc-number">3.4.3.5.3.</span> <span class="toc-text">In-process</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Additional-considerations"><span class="toc-number">3.4.3.5.4.</span> <span class="toc-text">Additional considerations</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">3.5.</span> <span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%84%E8%8C%83"><span class="toc-number">3.5.1.</span> <span class="toc-text">规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector"><span class="toc-number">3.5.2.</span> <span class="toc-text">Collector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API-SDK"><span class="toc-number">3.5.3.</span> <span class="toc-text">API + SDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E6%A1%A9%E5%BA%93"><span class="toc-number">3.5.4.</span> <span class="toc-text">插桩库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%99%A8"><span class="toc-number">3.5.5.</span> <span class="toc-text">导出器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6%E4%BB%A3%E7%A0%81%E6%8F%92%E6%A1%A9"><span class="toc-number">3.5.6.</span> <span class="toc-text">零代码插桩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%A3%80%E6%B5%8B%E5%99%A8"><span class="toc-number">3.5.7.</span> <span class="toc-text">资源检测器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E6%9C%8D%E5%8A%A1%E4%BC%A0%E6%92%AD%E5%99%A8"><span class="toc-number">3.5.8.</span> <span class="toc-text">跨服务传播器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E6%A0%B7%E5%99%A8"><span class="toc-number">3.5.9.</span> <span class="toc-text">采样器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#K8s-Operator"><span class="toc-number">3.5.10.</span> <span class="toc-text">K8s Operator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%8D%B3%E6%9C%8D%E5%8A%A1%E8%B5%84%E4%BA%A7"><span class="toc-number">3.5.11.</span> <span class="toc-text">函数即服务资产</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E4%B9%89%E7%BA%A6%E5%AE%9A"><span class="toc-number">3.6.</span> <span class="toc-text">语义约定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Resources"><span class="toc-number">3.7.</span> <span class="toc-text">Resources</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-number">3.7.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semantic-Attributes-with-SDK-provided-Default-Value"><span class="toc-number">3.7.2.</span> <span class="toc-text">Semantic Attributes with SDK-provided Default Value</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource-Detectors"><span class="toc-number">3.7.3.</span> <span class="toc-text">Resource Detectors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-resources"><span class="toc-number">3.7.4.</span> <span class="toc-text">Custom resources</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation-scope"><span class="toc-number">3.8.</span> <span class="toc-text">Instrumentation scope</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sampling"><span class="toc-number">3.9.</span> <span class="toc-text">Sampling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Terminology"><span class="toc-number">3.9.1.</span> <span class="toc-text">Terminology</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-sampling"><span class="toc-number">3.9.2.</span> <span class="toc-text">Why sampling?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#When-to-sample"><span class="toc-number">3.9.2.1.</span> <span class="toc-text">When to sample</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#When-not-to-sample"><span class="toc-number">3.9.2.2.</span> <span class="toc-text">When not to sample</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Head-Sampling"><span class="toc-number">3.9.3.</span> <span class="toc-text">Head Sampling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tail-Sampling"><span class="toc-number">3.9.4.</span> <span class="toc-text">Tail Sampling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Support"><span class="toc-number">3.9.5.</span> <span class="toc-text">Support</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Collector-1"><span class="toc-number">3.9.5.1.</span> <span class="toc-text">Collector</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Language-SDKs"><span class="toc-number">3.9.5.2.</span> <span class="toc-text">Language SDKs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Vendors"><span class="toc-number">3.9.5.3.</span> <span class="toc-text">Vendors</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Distributions"><span class="toc-number">3.10.</span> <span class="toc-text">Distributions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-a-distribution"><span class="toc-number">3.10.1.</span> <span class="toc-text">What is a distribution?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Who-can-create-a-distribution"><span class="toc-number">3.10.2.</span> <span class="toc-text">Who can create a distribution?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Contribution-or-distribution"><span class="toc-number">3.10.3.</span> <span class="toc-text">Contribution or distribution?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glossary"><span class="toc-number">3.11.</span> <span class="toc-text">Glossary</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Aggregation-1"><span class="toc-number">3.11.1.</span> <span class="toc-text">Aggregation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API"><span class="toc-number">3.11.2.</span> <span class="toc-text">API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Application"><span class="toc-number">3.11.3.</span> <span class="toc-text">Application</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#APM"><span class="toc-number">3.11.4.</span> <span class="toc-text">APM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Attribute"><span class="toc-number">3.11.5.</span> <span class="toc-text">Attribute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Automatic-instrumentation"><span class="toc-number">3.11.6.</span> <span class="toc-text">Automatic instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Baggage-1"><span class="toc-number">3.11.7.</span> <span class="toc-text">Baggage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-library"><span class="toc-number">3.11.8.</span> <span class="toc-text">Client library</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-side-app"><span class="toc-number">3.11.9.</span> <span class="toc-text">Client-side app</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector-2"><span class="toc-number">3.11.10.</span> <span class="toc-text">Collector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Contrib"><span class="toc-number">3.11.11.</span> <span class="toc-text">Contrib</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Context-propagation-1"><span class="toc-number">3.11.12.</span> <span class="toc-text">Context propagation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DAG"><span class="toc-number">3.11.13.</span> <span class="toc-text">DAG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-source"><span class="toc-number">3.11.14.</span> <span class="toc-text">Data source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dimension"><span class="toc-number">3.11.15.</span> <span class="toc-text">Dimension</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Distributed-tracing"><span class="toc-number">3.11.16.</span> <span class="toc-text">Distributed tracing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Distribution"><span class="toc-number">3.11.17.</span> <span class="toc-text">Distribution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event"><span class="toc-number">3.11.18.</span> <span class="toc-text">Event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exporter"><span class="toc-number">3.11.19.</span> <span class="toc-text">Exporter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field"><span class="toc-number">3.11.20.</span> <span class="toc-text">Field</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gRPC"><span class="toc-number">3.11.21.</span> <span class="toc-text">gRPC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instrumented-library"><span class="toc-number">3.11.22.</span> <span class="toc-text">Instrumented library</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instrumentation-library"><span class="toc-number">3.11.23.</span> <span class="toc-text">Instrumentation library</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Label"><span class="toc-number">3.11.24.</span> <span class="toc-text">Label</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Library"><span class="toc-number">3.11.25.</span> <span class="toc-text">Library</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log"><span class="toc-number">3.11.26.</span> <span class="toc-text">Log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log-record"><span class="toc-number">3.11.27.</span> <span class="toc-text">Log record</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metadata"><span class="toc-number">3.11.28.</span> <span class="toc-text">Metadata</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metric"><span class="toc-number">3.11.29.</span> <span class="toc-text">Metric</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OC"><span class="toc-number">3.11.30.</span> <span class="toc-text">OC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OT"><span class="toc-number">3.11.31.</span> <span class="toc-text">OT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTel"><span class="toc-number">3.11.32.</span> <span class="toc-text">OTel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpAMP"><span class="toc-number">3.11.33.</span> <span class="toc-text">OpAMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenCensus"><span class="toc-number">3.11.34.</span> <span class="toc-text">OpenCensus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTracing"><span class="toc-number">3.11.35.</span> <span class="toc-text">OpenTracing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetry-1"><span class="toc-number">3.11.36.</span> <span class="toc-text">OpenTelemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTelCol"><span class="toc-number">3.11.37.</span> <span class="toc-text">OTelCol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTEP"><span class="toc-number">3.11.38.</span> <span class="toc-text">OTEP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTLP"><span class="toc-number">3.11.39.</span> <span class="toc-text">OTLP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Propagators"><span class="toc-number">3.11.40.</span> <span class="toc-text">Propagators</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proto"><span class="toc-number">3.11.41.</span> <span class="toc-text">Proto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receiver"><span class="toc-number">3.11.42.</span> <span class="toc-text">Receiver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource"><span class="toc-number">3.11.43.</span> <span class="toc-text">Resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#REST"><span class="toc-number">3.11.44.</span> <span class="toc-text">REST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RPC"><span class="toc-number">3.11.45.</span> <span class="toc-text">RPC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sampling-1"><span class="toc-number">3.11.46.</span> <span class="toc-text">Sampling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDK"><span class="toc-number">3.11.47.</span> <span class="toc-text">SDK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semantic-conventions-1"><span class="toc-number">3.11.48.</span> <span class="toc-text">Semantic conventions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-number">3.11.49.</span> <span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Signal"><span class="toc-number">3.11.50.</span> <span class="toc-text">Signal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Span"><span class="toc-number">3.11.51.</span> <span class="toc-text">Span</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Span-link"><span class="toc-number">3.11.52.</span> <span class="toc-text">Span link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Specification"><span class="toc-number">3.11.53.</span> <span class="toc-text">Specification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Status"><span class="toc-number">3.11.54.</span> <span class="toc-text">Status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tag"><span class="toc-number">3.11.55.</span> <span class="toc-text">Tag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trace"><span class="toc-number">3.11.56.</span> <span class="toc-text">Trace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tracer-1"><span class="toc-number">3.11.57.</span> <span class="toc-text">Tracer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transaction"><span class="toc-number">3.11.58.</span> <span class="toc-text">Transaction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zPages"><span class="toc-number">3.11.59.</span> <span class="toc-text">zPages</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text">演示</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Language-APIs-SDKs"><span class="toc-number">5.</span> <span class="toc-text">Language APIs &amp; SDKs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SDK-Configuration"><span class="toc-number">5.1.</span> <span class="toc-text">SDK Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#General"><span class="toc-number">5.1.1.</span> <span class="toc-text">General</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-SERVICE-NAME"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">OTEL_SERVICE_NAME</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-RESOURCE-ATTRIBUTES"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">OTEL_RESOURCE_ATTRIBUTES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-TRACES-SAMPLER"><span class="toc-number">5.1.1.3.</span> <span class="toc-text">OTEL_TRACES_SAMPLER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-TRACES-SAMPLER-ARG"><span class="toc-number">5.1.1.4.</span> <span class="toc-text">OTEL_TRACES_SAMPLER_ARG</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-PROPAGATORS"><span class="toc-number">5.1.1.5.</span> <span class="toc-text">OTEL_PROPAGATORS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-TRACES-EXPORTER"><span class="toc-number">5.1.1.6.</span> <span class="toc-text">OTEL_TRACES_EXPORTER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-METRICS-EXPORTER"><span class="toc-number">5.1.1.7.</span> <span class="toc-text">OTEL_METRICS_EXPORTER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OTEL-LOGS-EXPORTER"><span class="toc-number">5.1.1.8.</span> <span class="toc-text">OTEL_LOGS_EXPORTER</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTLP-Exporter"><span class="toc-number">5.1.2.</span> <span class="toc-text">OTLP Exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Endpoint-Configuration"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">Endpoint Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-ENDPOINT"><span class="toc-number">5.1.2.1.1.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_ENDPOINT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-TRACES-ENDPOINT"><span class="toc-number">5.1.2.1.2.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_TRACES_ENDPOINT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-METRICS-ENDPOINT"><span class="toc-number">5.1.2.1.3.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_METRICS_ENDPOINT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-LOGS-ENDPOINT"><span class="toc-number">5.1.2.1.4.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_LOGS_ENDPOINT</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Header-configuration"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">Header configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-HEADERS"><span class="toc-number">5.1.2.2.1.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_HEADERS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-TRACES-HEADERS"><span class="toc-number">5.1.2.2.2.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_TRACES_HEADERS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-METRICS-HEADERS"><span class="toc-number">5.1.2.2.3.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_METRICS_HEADERS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-LOGS-HEADERS"><span class="toc-number">5.1.2.2.4.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_LOGS_HEADERS</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Timeout-Configuration"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">Timeout Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-TIMEOUT"><span class="toc-number">5.1.2.3.1.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_TIMEOUT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-TRACES-TIMEOUT"><span class="toc-number">5.1.2.3.2.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_TRACES_TIMEOUT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-METRICS-TIMEOUT"><span class="toc-number">5.1.2.3.3.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_METRICS_TIMEOUT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-LOGS-TIMEOUT"><span class="toc-number">5.1.2.3.4.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_LOGS_TIMEOUT</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Protocol-configuration"><span class="toc-number">5.1.2.4.</span> <span class="toc-text">Protocol configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-PROTOCOL"><span class="toc-number">5.1.2.4.1.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_PROTOCOL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-TRACES-PROTOCOL"><span class="toc-number">5.1.2.4.2.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_TRACES_PROTOCOL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-METRICS-PROTOCOL"><span class="toc-number">5.1.2.4.3.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_METRICS_PROTOCOL</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#OTEL-EXPORTER-OTLP-LOGS-PROTOCOL"><span class="toc-number">5.1.2.4.4.</span> <span class="toc-text">OTEL_EXPORTER_OTLP_LOGS_PROTOCOL</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go"><span class="toc-number">5.2.</span> <span class="toc-text">Go</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript"><span class="toc-number">5.3.</span> <span class="toc-text">JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Python"><span class="toc-number">5.4.</span> <span class="toc-text">Python</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java"><span class="toc-number">5.5.</span> <span class="toc-text">Java</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Platforms-and-environments"><span class="toc-number">6.</span> <span class="toc-text">Platforms and environments</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Zero-code-Instrumentation"><span class="toc-number">7.</span> <span class="toc-text">Zero-code Instrumentation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Collector-3"><span class="toc-number">8.</span> <span class="toc-text">Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-start"><span class="toc-number">8.1.</span> <span class="toc-text">Quick start</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Prerequisites"><span class="toc-number">8.1.1.</span> <span class="toc-text">Prerequisites</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-up-the-environment"><span class="toc-number">8.1.2.</span> <span class="toc-text">Set up the environment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Generate-and-collect-telemetry"><span class="toc-number">8.1.3.</span> <span class="toc-text">Generate and collect telemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Next-steps"><span class="toc-number">8.1.4.</span> <span class="toc-text">Next steps</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-the-Collector"><span class="toc-number">8.2.</span> <span class="toc-text">Install the Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker"><span class="toc-number">8.2.1.</span> <span class="toc-text">Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Compose"><span class="toc-number">8.2.2.</span> <span class="toc-text">Docker Compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes"><span class="toc-number">8.2.3.</span> <span class="toc-text">Kubernetes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deployment"><span class="toc-number">8.3.</span> <span class="toc-text">Deployment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#No-Collector"><span class="toc-number">8.3.1.</span> <span class="toc-text">No Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tradeoffs"><span class="toc-number">8.3.1.1.</span> <span class="toc-text">Tradeoffs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Agent"><span class="toc-number">8.3.2.</span> <span class="toc-text">Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Example-1"><span class="toc-number">8.3.2.1.</span> <span class="toc-text">Example</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Traces-1"><span class="toc-number">8.3.2.1.1.</span> <span class="toc-text">Traces</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Metrics-1"><span class="toc-number">8.3.2.1.2.</span> <span class="toc-text">Metrics</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Logs-1"><span class="toc-number">8.3.2.1.3.</span> <span class="toc-text">Logs</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tradeoffs-1"><span class="toc-number">8.3.2.2.</span> <span class="toc-text">Tradeoffs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gateway"><span class="toc-number">8.3.3.</span> <span class="toc-text">Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Examples"><span class="toc-number">8.3.3.1.</span> <span class="toc-text">Examples</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Nginx"><span class="toc-number">8.3.3.1.1.</span> <span class="toc-text">Nginx</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#load-balancing-exporter"><span class="toc-number">8.3.3.1.2.</span> <span class="toc-text">load-balancing exporter</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Static"><span class="toc-number">8.3.3.1.2.1.</span> <span class="toc-text">Static</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#DNS"><span class="toc-number">8.3.3.1.2.2.</span> <span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#DNS-with-service"><span class="toc-number">8.3.3.1.2.3.</span> <span class="toc-text">DNS with service</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combined-deployment"><span class="toc-number">8.3.3.2.</span> <span class="toc-text">Combined deployment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tradeoffs-2"><span class="toc-number">8.3.3.3.</span> <span class="toc-text">Tradeoffs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Single-writer-principle"><span class="toc-number">8.3.3.4.</span> <span class="toc-text">Single-writer principle</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Potential-problems"><span class="toc-number">8.3.3.4.1.</span> <span class="toc-text">Potential problems</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Best-practices"><span class="toc-number">8.3.3.4.2.</span> <span class="toc-text">Best practices</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration"><span class="toc-number">8.4.</span> <span class="toc-text">Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Location"><span class="toc-number">8.4.1.</span> <span class="toc-text">Location</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration-structure"><span class="toc-number">8.4.2.</span> <span class="toc-text">Configuration structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Receivers"><span class="toc-number">8.4.3.</span> <span class="toc-text">Receivers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Processors"><span class="toc-number">8.4.4.</span> <span class="toc-text">Processors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exporters"><span class="toc-number">8.4.5.</span> <span class="toc-text">Exporters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Connectors"><span class="toc-number">8.4.6.</span> <span class="toc-text">Connectors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extensions"><span class="toc-number">8.4.7.</span> <span class="toc-text">Extensions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service-1"><span class="toc-number">8.4.8.</span> <span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Extensions-1"><span class="toc-number">8.4.8.1.</span> <span class="toc-text">Extensions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pipelines"><span class="toc-number">8.4.8.2.</span> <span class="toc-text">Pipelines</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Telemetry"><span class="toc-number">8.4.8.3.</span> <span class="toc-text">Telemetry</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other-Information"><span class="toc-number">8.4.9.</span> <span class="toc-text">Other Information</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Environment-variables"><span class="toc-number">8.4.9.1.</span> <span class="toc-text">Environment variables</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Proxy-support"><span class="toc-number">8.4.9.2.</span> <span class="toc-text">Proxy support</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication"><span class="toc-number">8.4.9.3.</span> <span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configuring-certificates"><span class="toc-number">8.4.9.4.</span> <span class="toc-text">Configuring certificates</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Override-settings"><span class="toc-number">8.4.9.5.</span> <span class="toc-text">Override settings</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Management"><span class="toc-number">8.5.</span> <span class="toc-text">Management</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basics"><span class="toc-number">8.5.1.</span> <span class="toc-text">Basics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpAMP-1"><span class="toc-number">8.5.2.</span> <span class="toc-text">OpAMP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Distributions-1"><span class="toc-number">8.6.</span> <span class="toc-text">Distributions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Distributions"><span class="toc-number">8.6.1.</span> <span class="toc-text">Custom Distributions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Internal-telemetry"><span class="toc-number">8.7.</span> <span class="toc-text">Internal telemetry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activate-internal-telemetry-in-the-Collector"><span class="toc-number">8.7.1.</span> <span class="toc-text">Activate internal telemetry in the Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-internal-metrics"><span class="toc-number">8.7.1.1.</span> <span class="toc-text">Configure internal metrics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-internal-logs"><span class="toc-number">8.7.1.2.</span> <span class="toc-text">Configure internal logs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-internal-traces"><span class="toc-number">8.7.1.3.</span> <span class="toc-text">Configure internal traces</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Types-of-internal-telemetry"><span class="toc-number">8.7.2.</span> <span class="toc-text">Types of internal telemetry</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Summary-of-values-observable-with-internal-metrics"><span class="toc-number">8.7.2.1.</span> <span class="toc-text">Summary of values observable with internal metrics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Lists-of-internal-metrics"><span class="toc-number">8.7.2.2.</span> <span class="toc-text">Lists of internal metrics</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#basic-level-metrics"><span class="toc-number">8.7.2.2.1.</span> <span class="toc-text">basic-level metrics</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Additional-normal-level-metrics"><span class="toc-number">8.7.2.2.2.</span> <span class="toc-text">Additional normal-level metrics</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Additional-detailed-level-metrics"><span class="toc-number">8.7.2.2.3.</span> <span class="toc-text">Additional detailed-level metrics</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Events-observable-with-internal-logs"><span class="toc-number">8.7.2.3.</span> <span class="toc-text">Events observable with internal logs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Telemetry-maturity-levels"><span class="toc-number">8.7.3.</span> <span class="toc-text">Telemetry maturity levels</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Traces-2"><span class="toc-number">8.7.3.1.</span> <span class="toc-text">Traces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metrics-2"><span class="toc-number">8.7.3.2.</span> <span class="toc-text">Metrics</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Alpha"><span class="toc-number">8.7.3.2.1.</span> <span class="toc-text">Alpha</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Stable"><span class="toc-number">8.7.3.2.2.</span> <span class="toc-text">Stable</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Deprecated"><span class="toc-number">8.7.3.2.3.</span> <span class="toc-text">Deprecated</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Deleted"><span class="toc-number">8.7.3.2.4.</span> <span class="toc-text">Deleted</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logs-2"><span class="toc-number">8.7.3.3.</span> <span class="toc-text">Logs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Use-internal-telemetry-to-monitor-the-Collector"><span class="toc-number">8.7.4.</span> <span class="toc-text">Use internal telemetry to monitor the Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Monitoring"><span class="toc-number">8.7.4.1.</span> <span class="toc-text">Monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Queue-length"><span class="toc-number">8.7.4.1.1.</span> <span class="toc-text">Queue length</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Receive-failures"><span class="toc-number">8.7.4.1.2.</span> <span class="toc-text">Receive failures</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Data-flow"><span class="toc-number">8.7.4.1.3.</span> <span class="toc-text">Data flow</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Troubleshooting"><span class="toc-number">8.8.</span> <span class="toc-text">Troubleshooting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Troubleshooting-tools"><span class="toc-number">8.8.1.</span> <span class="toc-text">Troubleshooting tools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Internal-telemetry-1"><span class="toc-number">8.8.1.1.</span> <span class="toc-text">Internal telemetry</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Local-exporters"><span class="toc-number">8.8.1.2.</span> <span class="toc-text">Local exporters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Check-Collector-components"><span class="toc-number">8.8.1.3.</span> <span class="toc-text">Check Collector components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Extensions-2"><span class="toc-number">8.8.1.4.</span> <span class="toc-text">Extensions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Performance-Profiler-pprof"><span class="toc-number">8.8.1.4.1.</span> <span class="toc-text">Performance Profiler (pprof)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#zPages-1"><span class="toc-number">8.8.1.4.2.</span> <span class="toc-text">zPages</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checklist-for-debugging-complex-pipelines"><span class="toc-number">8.8.2.</span> <span class="toc-text">Checklist for debugging complex pipelines</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Common-Collector-issues"><span class="toc-number">8.8.3.</span> <span class="toc-text">Common Collector issues</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Data-issues"><span class="toc-number">8.8.3.1.</span> <span class="toc-text">Data issues</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-is-dropping-data"><span class="toc-number">8.8.3.1.1.</span> <span class="toc-text">Collector is dropping data</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-is-not-receiving-data"><span class="toc-number">8.8.3.1.2.</span> <span class="toc-text">Collector is not receiving data</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-is-not-processing-data"><span class="toc-number">8.8.3.1.3.</span> <span class="toc-text">Collector is not processing data</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-is-not-exporting-data"><span class="toc-number">8.8.3.1.4.</span> <span class="toc-text">Collector is not exporting data</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Control-issues"><span class="toc-number">8.8.3.2.</span> <span class="toc-text">Control issues</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-exits-or-restarts"><span class="toc-number">8.8.3.2.1.</span> <span class="toc-text">Collector exits or restarts</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configuration-issues"><span class="toc-number">8.8.3.3.</span> <span class="toc-text">Configuration issues</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Null-maps"><span class="toc-number">8.8.3.3.1.</span> <span class="toc-text">Null maps</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scaling-the-Collector"><span class="toc-number">8.9.</span> <span class="toc-text">Scaling the Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-to-Scale"><span class="toc-number">8.9.1.</span> <span class="toc-text">What to Scale</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#When-to-Scale"><span class="toc-number">8.9.2.</span> <span class="toc-text">When to Scale</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#When-NOT-to-scale"><span class="toc-number">8.9.2.1.</span> <span class="toc-text">When NOT to scale</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-Scale"><span class="toc-number">8.9.3.</span> <span class="toc-text">How to Scale</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scaling-Stateless-Collectors"><span class="toc-number">8.9.3.1.</span> <span class="toc-text">Scaling Stateless Collectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scaling-the-Scrapers"><span class="toc-number">8.9.3.2.</span> <span class="toc-text">Scaling the Scrapers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scaling-Stateful-Collectors"><span class="toc-number">8.9.3.3.</span> <span class="toc-text">Scaling Stateful Collectors</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transforming-telemetry"><span class="toc-number">8.10.</span> <span class="toc-text">Transforming telemetry</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-filtering"><span class="toc-number">8.10.1.</span> <span class="toc-text">Basic filtering</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adding-or-Deleting-Attributes"><span class="toc-number">8.10.2.</span> <span class="toc-text">Adding or Deleting Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Renaming-Metrics-or-Metric-Labels"><span class="toc-number">8.10.3.</span> <span class="toc-text">Renaming Metrics or Metric Labels</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enriching-Telemetry-with-Resource-Attributes"><span class="toc-number">8.10.4.</span> <span class="toc-text">Enriching Telemetry with Resource Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setting-a-span-status"><span class="toc-number">8.10.5.</span> <span class="toc-text">Setting a span status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Transformations"><span class="toc-number">8.10.6.</span> <span class="toc-text">Advanced Transformations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Architecture"><span class="toc-number">8.11.</span> <span class="toc-text">Architecture</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pipelines-1"><span class="toc-number">8.11.1.</span> <span class="toc-text">Pipelines</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Receivers-1"><span class="toc-number">8.11.1.1.</span> <span class="toc-text">Receivers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exporters-1"><span class="toc-number">8.11.1.2.</span> <span class="toc-text">Exporters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Processors-1"><span class="toc-number">8.11.1.3.</span> <span class="toc-text">Processors</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Running-as-an-agent"><span class="toc-number">8.11.2.</span> <span class="toc-text">Running as an agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Running-as-a-gateway"><span class="toc-number">8.11.3.</span> <span class="toc-text">Running as a gateway</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Platforms"><span class="toc-number">9.</span> <span class="toc-text">Platforms</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FaaS"><span class="toc-number">9.1.</span> <span class="toc-text">FaaS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-1"><span class="toc-number">9.2.</span> <span class="toc-text">Kubernetes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-Started"><span class="toc-number">9.2.1.</span> <span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Overview"><span class="toc-number">9.2.1.1.</span> <span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Preparation"><span class="toc-number">9.2.1.2.</span> <span class="toc-text">Preparation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Daemonset-Collector"><span class="toc-number">9.2.1.3.</span> <span class="toc-text">Daemonset Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#OTLP-Receiver"><span class="toc-number">9.2.1.3.1.</span> <span class="toc-text">OTLP Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Attributes-Processor"><span class="toc-number">9.2.1.3.2.</span> <span class="toc-text">Kubernetes Attributes Processor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubeletstats-Receiver"><span class="toc-number">9.2.1.3.3.</span> <span class="toc-text">Kubeletstats Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Filelog-Receiver"><span class="toc-number">9.2.1.3.4.</span> <span class="toc-text">Filelog Receiver</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Deployment-Collector"><span class="toc-number">9.2.1.4.</span> <span class="toc-text">Deployment Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Cluster-Receiver"><span class="toc-number">9.2.1.4.1.</span> <span class="toc-text">Kubernetes Cluster Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Objects-Receiver"><span class="toc-number">9.2.1.4.2.</span> <span class="toc-text">Kubernetes Objects Receiver</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector-4"><span class="toc-number">9.2.2.</span> <span class="toc-text">Collector</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Components"><span class="toc-number">9.2.2.1.</span> <span class="toc-text">Components</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Attributes-Processor-1"><span class="toc-number">9.2.2.1.1.</span> <span class="toc-text">Kubernetes Attributes Processor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubeletstats-Receiver-1"><span class="toc-number">9.2.2.1.2.</span> <span class="toc-text">Kubeletstats Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Filelog-Receiver-1"><span class="toc-number">9.2.2.1.3.</span> <span class="toc-text">Filelog Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Cluster-Receiver-1"><span class="toc-number">9.2.2.1.4.</span> <span class="toc-text">Kubernetes Cluster Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Kubernetes-Objects-Receiver-1"><span class="toc-number">9.2.2.1.5.</span> <span class="toc-text">Kubernetes Objects Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Prometheus-Receiver"><span class="toc-number">9.2.2.1.6.</span> <span class="toc-text">Prometheus Receiver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Host-Metrics-Receiver"><span class="toc-number">9.2.2.1.7.</span> <span class="toc-text">Host Metrics Receiver</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Helm-Charts"><span class="toc-number">9.2.2.2.</span> <span class="toc-text">Helm Charts</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Collector-Chart"><span class="toc-number">9.2.2.2.1.</span> <span class="toc-text">Collector Chart</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Logs-Collection-Preset"><span class="toc-number">9.2.2.2.1.1.</span> <span class="toc-text">Logs Collection Preset</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Kubernetes-Attributes-Preset"><span class="toc-number">9.2.2.2.1.2.</span> <span class="toc-text">Kubernetes Attributes Preset</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Kubelet-Metrics-Preset"><span class="toc-number">9.2.2.2.1.3.</span> <span class="toc-text">Kubelet Metrics Preset</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Cluster-Metrics-Preset"><span class="toc-number">9.2.2.2.1.4.</span> <span class="toc-text">Cluster Metrics Preset</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Kubernetes-Events-Preset"><span class="toc-number">9.2.2.2.1.5.</span> <span class="toc-text">Kubernetes Events Preset</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Host-Metrics-Preset"><span class="toc-number">9.2.2.2.1.6.</span> <span class="toc-text">Host Metrics Preset</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Demo-Chart"><span class="toc-number">9.2.2.2.2.</span> <span class="toc-text">Demo Chart</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Operator-Chart"><span class="toc-number">9.2.2.2.3.</span> <span class="toc-text">Operator Chart</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Installing-the-Chart"><span class="toc-number">9.2.2.2.3.1.</span> <span class="toc-text">Installing the Chart</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Configuration-1"><span class="toc-number">9.2.2.2.3.2.</span> <span class="toc-text">Configuration</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes-Operator"><span class="toc-number">9.2.2.3.</span> <span class="toc-text">Kubernetes Operator</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Injecting-Auto-instrumentation"><span class="toc-number">9.2.2.3.1.</span> <span class="toc-text">Injecting Auto-instrumentation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Target-Allocator"><span class="toc-number">9.2.2.3.2.</span> <span class="toc-text">Target Allocator</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Troubleshooting-1"><span class="toc-number">9.2.2.3.3.</span> <span class="toc-text">Troubleshooting</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Go"/></a><div class="content"><a class="title" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go">Observability - OpenTelemetry Go</a><time datetime="2025-01-03T16:06:25.000Z" title="Created 2025-01-04 00:06:25">2025-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Node.js"/></a><div class="content"><a class="title" href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js">Observability - OpenTelemetry Node.js</a><time datetime="2025-01-02T16:06:25.000Z" title="Created 2025-01-03 00:06:25">2025-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Doc V2"/></a><div class="content"><a class="title" href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2">Observability - OpenTelemetry Doc V2</a><time datetime="2025-01-01T16:06:25.000Z" title="Created 2025-01-02 00:06:25">2025-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Doc V1"/></a><div class="content"><a class="title" href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1">Observability - OpenTelemetry Doc V1</a><time datetime="2024-12-31T16:06:25.000Z" title="Created 2025-01-01 00:06:25">2025-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/18/ebpf-principle/" title="eBPF - Principle"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ebpf-1253868755.cos.ap-guangzhou.myqcloud.com/ebpf-principle.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="eBPF - Principle"/></a><div class="content"><a class="title" href="/2024/10/18/ebpf-principle/" title="eBPF - Principle">eBPF - Principle</a><time datetime="2024-10-17T16:06:25.000Z" title="Created 2024-10-18 00:06:25">2024-10-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2025 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>