<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Observability - OpenTelemetry Java | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - OpenTelemetry Java">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/20/cloud-native-observability-opentelemetry-java/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png">
<meta property="article:published_time" content="2025-01-19T16:06:25.000Z">
<meta property="article:modified_time" content="2025-10-13T01:54:59.039Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="OpenTelemetry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/20/cloud-native-observability-opentelemetry-java/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - OpenTelemetry Java',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-13 09:54:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Observability - OpenTelemetry Java</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">20.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>126min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Intro-to-OpenTelemetry-Java"><a href="#Intro-to-OpenTelemetry-Java" class="headerlink" title="Intro to OpenTelemetry Java"></a>Intro to OpenTelemetry Java</h1><ol>
<li>OpenTelemetry Java is the set of <strong>OpenTelemetry observability tools</strong> for the Java ecosystem.</li>
<li>At a <strong>high level</strong>, it consists of the <strong>API</strong>, the <strong>SDK</strong>, and <strong>instrumentation</strong>.</li>
</ol>
<span id="more"></span>

<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ol>
<li><p>The <strong>API</strong> is a set of <strong>classes</strong> and <strong>interfaces</strong> for <strong>recording telemetry</strong> across key observability <strong>signals</strong>.</p>
<ul>
<li><p>It supports <strong>multiple implementations</strong>, with a <strong>low-overhead minimalist Noop</strong> and SDK reference implementation provided <strong>out of the box</strong>.</p>
</li>
<li><p>It is designed to be taken as a <strong>direct dependency</strong> by libraries, frameworks, and application owners looking to <strong>add instrumentation</strong>.</p>
</li>
<li><p>It comes with strong <strong>backwards compatibility</strong> guarantees, <strong>zero transitive dependencies</strong>, and supports <strong>Java 8+</strong>.</p>
</li>
</ul>
</li>
<li><p>The <strong>SDK</strong> is the <strong>built-in reference implementation</strong> of the <strong>API</strong>, processing and exporting telemetry produced by instrumentation API calls.</p>
<ul>
<li><p>Configuring the <strong>SDK</strong> to <strong>process</strong> and <strong>export</strong> appropriately is an <strong>essential step</strong> to <strong>integrating</strong> OpenTelemetry into an application.</p>
</li>
<li><p>The <strong>SDK</strong> has <strong>autoconfiguration</strong> and <strong>programmatic</strong> configuration options.</p>
</li>
</ul>
</li>
<li><p>Instrumentation <strong>records telemetry</strong> using the <strong>API</strong>.</p>
<ul>
<li>There are a variety of categories of instrumentation</li>
<li>including: <strong>zero-code Java agent</strong>, <strong>zero-code Spring Boot starter</strong>, <strong>library</strong>, <strong>native</strong>, <strong>manual</strong>, and <strong>shims</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Navigating-the-docs"><a href="#Navigating-the-docs" class="headerlink" title="Navigating the docs"></a>Navigating the docs</h2><blockquote>
<p>The OpenTelemetry Java documentation is organized as follows</p>
</blockquote>
<ol>
<li>Getting Started by Example<ul>
<li>A quick example to <strong>get off the ground</strong> running with OpenTelemetry Java</li>
<li>demonstrating integration of the <strong>OpenTelemetry Java agent</strong> into a simple web application.</li>
</ul>
</li>
<li><strong>Instrumentation</strong> ecosystem<ul>
<li>A guide to the OpenTelemetry Java instrumentation ecosystem.</li>
<li>This is a key resource for application authors looking to <strong>integrate</strong> OpenTelemetry Java into applications.</li>
<li>Learn about the different <strong>categories</strong> of instrumentation, and decide which is right for you.<ul>
<li>zero-code <strong>Java agent</strong>, zero-code <strong>Spring Boot starter</strong>, <strong>library</strong>, <strong>native</strong>, <strong>manual</strong>, and <strong>shims</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Record Telemetry</strong> with <strong>API</strong><ul>
<li>A technical reference for the <strong>OpenTelemetry API</strong>, exploring all <strong>key aspects</strong> of the API with working code examples.</li>
<li>Most users will use this page like an <strong>encyclopedia</strong>, consulting the <strong>index</strong> of sections as needed, rather than reading front to back.</li>
</ul>
</li>
<li><strong>Manage Telemetry</strong> with <strong>SDK</strong><ul>
<li>A technical reference for the <strong>OpenTelemetry SDK</strong><ul>
<li>exploring all SDK <strong>plugin extension points</strong> and the <strong>programmatic configuration API</strong> with working code examples.</li>
</ul>
</li>
<li>Most users will use this page like an <strong>encyclopedia</strong>, consulting the <strong>index</strong> of sections as needed, rather than reading front to back.</li>
</ul>
</li>
<li><strong>Configure</strong> the <strong>SDK</strong><ul>
<li>A technical reference for configuring the SDK, focussing on <strong>zero-code autoconfiguration</strong>.</li>
<li>Includes a reference of all supported <strong>environment variables</strong> and <strong>system properties</strong> for configuring the SDK.</li>
<li>Explores all <strong>programmatic customization points</strong> with working code examples. </li>
<li>Most users will use this page like an <strong>encyclopedia</strong>, consulting the <strong>index</strong> of sections as needed, rather than reading front to back.</li>
</ul>
</li>
</ol>
<h2 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h2><table>
<thead>
<tr>
<th>Repository</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>opentelemetry-java</td>
<td>Core <strong>API</strong> and <strong>SDK</strong> components</td>
</tr>
<tr>
<td>opentelemetry-java-instrumentation</td>
<td><strong>Instrumentation</strong> maintained by OpenTelemetry, including <strong>OpenTelemetry Java agent</strong></td>
</tr>
<tr>
<td>opentelemetry-java-contrib</td>
<td><strong>Community</strong> maintained components that don’t fit the <strong>express scope</strong> of other repositories</td>
</tr>
<tr>
<td>semantic-conventions-java</td>
<td>Generated code for <strong>semantic conventions</strong></td>
</tr>
<tr>
<td>opentelemetry-proto-java</td>
<td>Generated bindings for <strong>OTLP</strong></td>
</tr>
<tr>
<td>opentelemetry-java-examples</td>
<td>End-to-end code examples demonstrating a variety of <strong>patterns</strong> using the <strong>API</strong>, <strong>SDK</strong>, and <strong>instrumentation</strong></td>
</tr>
</tbody></table>
<ol>
<li><strong>opentelemetry-java</strong>, <strong>opentelemetry-java-instrumentation</strong>, and <strong>opentelemetry-java-contrib</strong> each publish large <strong>catalogs</strong> of artifacts.<ul>
<li>Please consult repositories for details</li>
<li>or see the “<strong>Managed Dependencies</strong>” column in the <strong>Bill of Materials</strong> table to see a <strong>full list</strong> of managed dependencies.</li>
</ul>
</li>
<li>As a general rule, <strong>artifacts</strong> published from the <strong>same repository</strong> have the <strong>same version</strong>.<ul>
<li>The exception to this is <strong>opentelemetry-java-contrib</strong><ul>
<li>which can be thought of as a <strong>group</strong> of <strong>independent projects</strong> that are <strong>co-located</strong> in the <strong>same repository</strong> to take advantage of <strong>shared tooling</strong>.</li>
</ul>
</li>
<li>For now, the <strong>artifacts</strong> of <strong>opentelemetry-java-contrib</strong> are <strong>aligned</strong> but this is a <strong>coincidence</strong> and will change in the future.</li>
</ul>
</li>
<li>The repositories have a <strong>release cadence</strong> which mirrors their <strong>high level dependency structure</strong><ul>
<li><strong>opentelemetry-java</strong> is the <strong>core</strong> and releases <strong>first</strong> each <strong>month</strong>.</li>
<li><strong>opentelemetry-java-instrumentation</strong> depends on <strong>opentelemetry-java</strong> and is <strong>next</strong> to publish.</li>
<li><strong>opentelemetry-java-contrib</strong> depends on <strong>opentelemetry-java-instrumentation</strong> and <strong>opentelemetry-java</strong> and is <strong>last</strong> to publish.</li>
<li>Although <strong>semantic-conventions-java</strong> is a dependency of <strong>opentelemetry-java-instrumentation</strong><ul>
<li>it is an <strong>independent artifact</strong> with an <strong>independent release schedule</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Dependencies-and-BOMs"><a href="#Dependencies-and-BOMs" class="headerlink" title="Dependencies and BOMs"></a>Dependencies and BOMs</h2><ol>
<li><strong>A bill of materials</strong>, or <strong>BOM</strong> for short, is an artifact that helps keep the <strong>versions</strong> of <strong>related dependencies</strong> aligned.</li>
<li>OpenTelemetry Java publishes several BOMs catering to <strong>different use cases</strong>, listed below in order of increasing <strong>scope</strong>.</li>
<li>We <strong>highly recommend</strong> using a <strong>BOM</strong>.</li>
</ol>
<blockquote>
<p>Because the BOMs are <strong>hierarchical</strong>, adding dependencies on <strong>multiple BOMs</strong> is <strong>not recommended</strong><br>as it is <strong>redundant</strong> and can lead <strong>unintuitive dependency version resolution</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Description</th>
<th>Repository</th>
<th>Group ID&#x2F;Artifact ID</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Stable</strong> core <strong>API</strong> and <strong>SDK</strong> artifacts</td>
<td>opentelemetry-java</td>
<td>io.opentelemetry<br />opentelemetry-bom</td>
</tr>
<tr>
<td><strong>Experimental</strong> core <strong>API</strong> and <strong>SDK</strong> artifacts<br />including all of <strong>opentelemetry-bom</strong></td>
<td>opentelemetry-java</td>
<td>io.opentelemetry<br />opentelemetry-bom-alpha</td>
</tr>
<tr>
<td><strong>Stable instrumentation</strong> artifacts<br />including all of <strong>opentelemetry-bom</strong></td>
<td>opentelemetry-java-instrumentation</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-instrumentation-bom</td>
</tr>
<tr>
<td><strong>Experimental instrumentation</strong> artifacts<br />including all of <strong>opentelemetry-instrumentation-bom</strong></td>
<td>opentelemetry-java-instrumentation</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-instrumentation-bom-alpha</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates adding a <strong>BOM dependency</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>&#123;&#123;bomGroupId&#125;&#125;<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>&#123;&#123;bomArtifactId&#125;&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>&#123;&#123;bomVersion&#125;&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Add a dependency on an artifact whose version is managed by the bom --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Getting-Started-by-Example"><a href="#Getting-Started-by-Example" class="headerlink" title="Getting Started by Example"></a>Getting Started by Example</h1><h2 id="Example-Application"><a href="#Example-Application" class="headerlink" title="Example Application"></a>Example Application</h2><h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><ol>
<li>To begin, set up an environment in a new directory called java-simple.</li>
<li>Within that directory, create a file called <strong>build.gradle.kts</strong> with the following content:</li>
</ol>
<h3 id="Create-and-launch-an-HTTP-Server"><a href="#Create-and-launch-an-HTTP-Server" class="headerlink" title="Create and launch an HTTP Server"></a>Create and launch an HTTP Server</h3><blockquote>
<p>In that same folder, create a file called <strong>DiceApplication.java</strong> and add the following code to the file:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.Banner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiceApplication</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">SpringApplication</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(DiceApplication.class);</span><br><span class="line">    app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">    app.run(args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Create another file called <strong>RollController.java</strong> and add the following code to the file:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadLocalRandom;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RollController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(RollController.class);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/rolldice&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(&quot;player&quot;)</span> Optional&lt;String&gt; player)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="built_in">this</span>.getRandomNumber(<span class="number">1</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">if</span> (player.isPresent()) &#123;</span><br><span class="line">      logger.info(<span class="string">&quot;&#123;&#125; is rolling the dice: &#123;&#125;&quot;</span>, player.get(), result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logger.info(<span class="string">&quot;Anonymous player is rolling the dice: &#123;&#125;&quot;</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Integer.toString(result);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getRandomNumber</span><span class="params">(<span class="type">int</span> min, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ThreadLocalRandom.current().nextInt(min, max + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Build and run the application with the following command, then open <a target="_blank" rel="noopener" href="http://localhost:8080/rolldice">http://localhost:8080/rolldice</a> in your web browser to ensure it is working.</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20251004221305802.png" alt="image-20251004221305802"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v &#x27;http://localhost:8080/rolldice&#x27;</span><br><span class="line">* Host localhost:8080 was resolved.</span><br><span class="line">* IPv6: ::1</span><br><span class="line">* IPv4: 127.0.0.1</span><br><span class="line">*   Trying [::1]:8080...</span><br><span class="line">* Connected to localhost (::1) port 8080</span><br><span class="line">&gt; GET /rolldice HTTP/1.1</span><br><span class="line">&gt; Host: localhost:8080</span><br><span class="line">&gt; User-Agent: curl/8.7.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Request completely sent off</span><br><span class="line">&lt; HTTP/1.1 200 </span><br><span class="line">&lt; Content-Type: text/plain;charset=UTF-8</span><br><span class="line">&lt; Content-Length: 1</span><br><span class="line">&lt; Date: Sat, 04 Oct 2025 14:14:37 GMT</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host localhost left intact</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<h2 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h2><blockquote>
<p>Next, you’ll use a <strong>Java agent</strong> to <strong>automatically</strong> instrument the application at <strong>launch time</strong>.<br>While you can configure the Java agent in a number of ways, the steps below use <strong>environment variables</strong>.</p>
</blockquote>
<ol>
<li>Download <strong>opentelemetry-javaagent.jar</strong> from Releases of the <strong>opentelemetry-java-instrumentation</strong> repository. </li>
<li>The <strong>JAR file</strong> contains the <strong>agent</strong> and all <strong>automatic instrumentation</strong> packages.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L -O https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/latest/download/opentelemetry-javaagent.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Set and export variables that specify the Java agent JAR and a <strong>console exporter</strong>, using a notation suitable for your shell&#x2F;terminal environment</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> JAVA_TOOL_OPTIONS=<span class="string">&quot;-javaagent:PATH/TO/opentelemetry-javaagent.jar&quot;</span> \</span><br><span class="line">  OTEL_TRACES_EXPORTER=logging \</span><br><span class="line">  OTEL_METRICS_EXPORTER=logging \</span><br><span class="line">  OTEL_LOGS_EXPORTER=logging \</span><br><span class="line">  OTEL_METRIC_EXPORT_INTERVAL=15000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Run your application once again</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/image-20251004223141480.png" alt="image-20251004223141480"></p>
<blockquote>
<p>From another terminal, send a request using curl:<br>You should have seen <strong>trace</strong> &amp; <strong>log</strong> output from the server</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl localhost:8080/rolldice</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Stop the server process.<br>When <strong>stopping</strong> the server, you should see an output of <strong>all</strong> the <strong>metrics</strong> collected</p>
</blockquote>
<h1 id="Instrumentation-ecosystem"><a href="#Instrumentation-ecosystem" class="headerlink" title="Instrumentation ecosystem"></a>Instrumentation ecosystem</h1><ol>
<li>Instrumentation <strong>records telemetry</strong> using the <strong>API</strong>.</li>
<li>The <strong>SDK</strong> is the <strong>built-in reference implementation</strong> of the <strong>API</strong><ul>
<li>and is configured to <strong>process</strong> and <strong>export</strong> the <strong>telemetry</strong> produced by <strong>instrumentation API calls</strong>.</li>
</ul>
</li>
<li>This page discusses the OpenTelemetry ecosystem in OpenTelemetry Java, including <strong>resources</strong> for end users and <strong>cross-cutting</strong> instrumentation topics:</li>
</ol>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Instrumentation categories</td>
<td>addressing different <strong>use cases</strong> and <strong>installation patterns</strong></td>
</tr>
<tr>
<td>Context propagation</td>
<td>provides <strong>correlation</strong> between <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>, allowing the signals to complement each other.</td>
</tr>
<tr>
<td>Semantic conventions</td>
<td>define how to <strong>produce telemetry</strong> for <strong>standard operations</strong></td>
</tr>
<tr>
<td>Log instrumentation</td>
<td>which is used to <strong>get logs</strong> from an <strong>existing Java logging framework</strong> into <strong>OpenTelemetry</strong></td>
</tr>
</tbody></table>
<h2 id="Instrumentation-categories"><a href="#Instrumentation-categories" class="headerlink" title="Instrumentation categories"></a>Instrumentation categories</h2><blockquote>
<p>There are several categories of instrumentation</p>
</blockquote>
<table>
<thead>
<tr>
<th>Instrumentation</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Zero-code: <strong>Java agent</strong></td>
<td>is a form of <strong>zero-code</strong> instrumentation that <strong>dynamically manipulates application bytecode</strong>.</td>
</tr>
<tr>
<td>Zero-code: <strong>Spring Boot starter</strong></td>
<td>is a form of <strong>zero-code</strong> instrumentation that leverages <strong>spring autoconfigure</strong> to <strong>install library instrumentation</strong>.</td>
</tr>
<tr>
<td><strong>Library</strong> instrumentation</td>
<td>wraps or uses <strong>extension points</strong> to <strong>instrument a library</strong>, requiring users to install and&#x2F;or adapt <strong>library usage</strong>.</td>
</tr>
<tr>
<td><strong>Native</strong> instrumentation</td>
<td>is <strong>built directly</strong> into libraries and frameworks.</td>
</tr>
<tr>
<td><strong>Manual</strong> instrumentation</td>
<td>is written by <strong>application authors</strong>, and typically specific to the <strong>application domain</strong>.</td>
</tr>
<tr>
<td><strong>Shims</strong></td>
<td>bridge data from one <strong>observability library</strong> to another, typically from some library into OpenTelemetry.</td>
</tr>
</tbody></table>
<ol>
<li>Zero-code instrumentation is <strong>installed automatically</strong> based on <strong>detected libraries &#x2F; frameworks</strong>.</li>
<li>The <strong>opentelemetry-java-instrumentation</strong> project contains the source code for <strong>Java agent</strong>, <strong>Spring Boot starter</strong>, and <strong>Library instrumentation</strong>.</li>
</ol>
<h3 id="Zero-code-Java-agent"><a href="#Zero-code-Java-agent" class="headerlink" title="Zero-code: Java agent"></a>Zero-code: Java agent</h3><ol>
<li>The Java agent is a form of <strong>zero-code</strong> automatic instrumentation that <strong>dynamically manipulates application bytecode</strong>.</li>
<li>For a list of libraries instrumented by the Java agent, see the “Auto-instrumented versions” column on supported libraries.<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/supported-libraries.md">https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/supported-libraries.md</a></li>
</ul>
</li>
</ol>
<h3 id="Zero-code-Spring-Boot-starter"><a href="#Zero-code-Spring-Boot-starter" class="headerlink" title="Zero-code: Spring Boot starter"></a>Zero-code: Spring Boot starter</h3><ol>
<li>The Spring Boot starter is a form of <strong>zero-code</strong> automatic instrumentation that leverages <strong>spring autoconfigure</strong> to <strong>install library instrumentation</strong>.</li>
</ol>
<h3 id="Library-instrumentation"><a href="#Library-instrumentation" class="headerlink" title="Library instrumentation"></a>Library instrumentation</h3><ol>
<li>Library instrumentation wraps or uses <strong>extension points</strong> to <strong>instrument a library</strong>, requiring users to install and&#x2F;or adapt <strong>library usage</strong>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/supported-libraries.md">https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/docs/supported-libraries.md</a></li>
</ol>
<h3 id="Native-instrumentation"><a href="#Native-instrumentation" class="headerlink" title="Native instrumentation"></a>Native instrumentation</h3><ol>
<li>Native instrumentation is <strong>built directly</strong> into libraries or frameworks.</li>
<li>OpenTelemetry encourages <strong>library authors</strong> to add <strong>native instrumentation</strong> using the <strong>API</strong>.</li>
<li>In the long term, we hope the <strong>native instrumentation</strong> becomes the <strong>norm</strong><ul>
<li>and view the instrumentation maintained by OpenTelemetry in <strong>opentelemetry-java-instrumentation</strong> as a <strong>temporary means</strong> of <strong>filling the gap</strong>.</li>
</ul>
</li>
<li><strong>Elasticsearch Java API Client + Quarkus</strong></li>
</ol>
<h3 id="Manual-instrumentation"><a href="#Manual-instrumentation" class="headerlink" title="Manual instrumentation"></a>Manual instrumentation</h3><ol>
<li>Manual instrumentation is written by <strong>application authors</strong>, and typically specific to the <strong>application domain</strong>.</li>
</ol>
<h3 id="Shims"><a href="#Shims" class="headerlink" title="Shims"></a>Shims</h3><ol>
<li>A shim is instrumentation that bridges data from one <strong>observability library</strong> to another, typically from some library into OpenTelemetry.</li>
<li>Shims maintained in the OpenTelemetry Java ecosystem:</li>
</ol>
<table>
<thead>
<tr>
<th>Description</th>
<th>Signal(s)</th>
<th>Artifact</th>
</tr>
</thead>
<tbody><tr>
<td>Bridge <strong>OpenTracing</strong> into <strong>OpenTelemetry</strong></td>
<td>Traces</td>
<td>io.opentelemetry<br />opentelemetry-opentracing-shim</td>
</tr>
<tr>
<td>Bridge <strong>Opencensus</strong> into <strong>OpenTelemetry</strong></td>
<td>Traces, Metrics</td>
<td>io.opentelemetry<br />opentelemetry-opencensus-shim</td>
</tr>
<tr>
<td>Bridge <strong>Micrometer</strong> into <strong>OpenTelemetry</strong></td>
<td>Metrics</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-micrometer-1.5</td>
</tr>
<tr>
<td>Bridge <strong>JMX</strong> into <strong>OpenTelemetry</strong></td>
<td>Metrics</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-jmx-metrics</td>
</tr>
<tr>
<td>Bridge <strong>OpenTelemetry</strong> into <strong>Prometheus Java client</strong></td>
<td>Metrics</td>
<td>io.opentelemetry.contrib<br />opentelemetry-prometheus-client-bridge</td>
</tr>
<tr>
<td>Bridge <strong>OpenTelemetry</strong> into <strong>Micrometer</strong></td>
<td>Metrics</td>
<td>io.opentelemetry.contrib<br />opentelemetry-micrometer-meter-provider</td>
</tr>
<tr>
<td>Bridge <strong>Log4j</strong> into <strong>OpenTelemetry</strong></td>
<td>Logs</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-log4j-appender-2.17</td>
</tr>
<tr>
<td>Bridge <strong>Logback</strong> into <strong>OpenTelemetry</strong></td>
<td>Logs</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-logback-appender-1.0</td>
</tr>
<tr>
<td>Bridge <strong>OpenTelemetry context</strong> into <strong>Log4j</strong></td>
<td>Context</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-log4j-context-data-2.17-autoconfigure</td>
</tr>
<tr>
<td>Bridge <strong>OpenTelemetry context</strong> into <strong>Logback</strong></td>
<td>Context</td>
<td>io.opentelemetry.instrumentation<br />opentelemetry-logback-mdc-1.0</td>
</tr>
</tbody></table>
<h2 id="Context-propagation"><a href="#Context-propagation" class="headerlink" title="Context propagation"></a>Context propagation</h2><ol>
<li>The <strong>OpenTelemetry APIs</strong> are designed to be <strong>complementary</strong>, with the whole greater than the sum of the parts.<ul>
<li>Each <strong>signal</strong> has its <strong>own strengths</strong>, and <strong>collectively stitch together</strong> a compelling observability story.</li>
</ul>
</li>
<li>Importantly, the data from the <strong>various signals</strong> are <strong>linked together</strong> through <strong>trace context</strong>:<ul>
<li><strong>Spans</strong> are related to other spans through <strong>span parent</strong> and <strong>links</strong>, which each record <strong>trace context</strong> of <strong>related spans</strong>.</li>
<li><strong>Metrics</strong> are related to <strong>spans</strong> through <strong>exemplars</strong>, which record <strong>trace context</strong> of <strong>a particular measurement</strong>.</li>
<li><strong>Logs</strong> are related to <strong>spans</strong> by recording <strong>trace context</strong> on <strong>log records</strong>.</li>
</ul>
</li>
<li>For this <strong>correlation</strong> to work<ul>
<li><strong>trace context</strong> must be <strong>propagated throughout an application</strong> (across <strong>function calls</strong> and <strong>threads</strong>), and <strong>across application boundaries</strong>. </li>
<li>The <strong>context API</strong> facilitates this.</li>
</ul>
</li>
<li><strong>Instrumentation</strong> needs to be written in a manner which is <strong>context aware</strong>:<ul>
<li>Libraries that represent the <strong>entry point</strong> to an application (i.e. <strong>HTTP servers</strong>, <strong>message consumers</strong>, etc.)<ul>
<li>should <strong>extract context</strong> from <strong>incoming messages</strong>.</li>
</ul>
</li>
<li>Libraries that represent an <strong>exit point</strong> from an application (i.e. <strong>HTTP clients</strong>, <strong>message producers</strong>, etc.)<ul>
<li>should <strong>inject context</strong> into <strong>outgoing messages</strong>.</li>
</ul>
</li>
<li>Libraries should <strong>implicitly</strong> or <strong>explicitly</strong> pass <strong>Context</strong> through the <strong>callstack</strong> and <strong>across any threads</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Semantic-conventions"><a href="#Semantic-conventions" class="headerlink" title="Semantic conventions"></a>Semantic conventions</h2><ol>
<li>The semantic conventions define how to <strong>produce telemetry</strong> for <strong>standard operations</strong>.</li>
<li>Semantic conventions specify span names, span kinds, metric instruments, metric units, metric types, and attribute key, value, and requirement levels.</li>
<li>When writing instrumentation, consult the <strong>semantic conventions</strong> and conform to any which are applicable to the <strong>domain</strong>.</li>
<li>OpenTelemetry Java publishes artifacts to <strong>assist</strong> in <strong>conforming</strong> to the semantic conventions<ul>
<li>including <strong>generated constants</strong> for attribute keys and values.</li>
</ul>
</li>
</ol>
<h2 id="Log-instrumentation"><a href="#Log-instrumentation" class="headerlink" title="Log instrumentation"></a>Log instrumentation</h2><ol>
<li>While the <strong>LoggerProvider</strong> &#x2F; <strong>Logger APIs</strong> are <strong>structurally similar</strong> to the equivalent <strong>trace</strong> and <strong>metric</strong> APIs, they serve a different use case.</li>
<li>As of now, <strong>LoggerProvider</strong> &#x2F; <strong>Logger</strong> and <strong>associated classes</strong> represent the <strong>Log Bridge API</strong><ul>
<li>which exists to <strong>write log appenders</strong> to bridge <strong>logs recorded</strong> through <strong>other log APIs &#x2F; frameworks</strong> into <strong>OpenTelemetry</strong>.</li>
</ul>
</li>
<li>They are <strong>not intended</strong> for end user use as a <strong>replacement</strong> for Log4j &#x2F; <strong>SLF4J</strong> &#x2F; <strong>Logback</strong> &#x2F; etc.</li>
<li>There are two typical workflows for <strong>consuming log instrumentation</strong> in OpenTelemetry catering to different application requirements:</li>
</ol>
<h3 id="Direct-to-collector"><a href="#Direct-to-collector" class="headerlink" title="Direct to collector"></a>Direct to collector</h3><ol>
<li>In the direct to collector workflow, logs are <strong>emitted directly</strong> from an <strong>application</strong> to a <strong>collector</strong> using a <strong>network protocol</strong> (e.g. <strong>OTLP</strong>).</li>
<li>This workflow is <strong>simple to set up</strong> as it doesn’t require any additional <strong>log forwarding components</strong><ul>
<li>and allows an application to easily <strong>emit structured logs</strong> that <strong>conform</strong> to the <strong>log data model</strong>.</li>
</ul>
</li>
<li>However, the <strong>overhead</strong> required for applications to <strong>queue</strong> and <strong>export</strong> logs to a network location may <strong>not be suitable</strong> for all applications.</li>
<li>To use this workflow:<ul>
<li>Install appropriate <strong>log appender</strong>.</li>
<li>Configure the OpenTelemetry <strong>Log SDK</strong> to <strong>export log records</strong> to desired target destination (the <strong>collector</strong> or other)</li>
</ul>
</li>
<li><strong>Log appenders</strong> are a type of <strong>shim</strong> which bridges logs from <strong>a log framework</strong> into the <strong>OpenTelemetry log SDK</strong>.<ul>
<li>See “Bridge <strong>Log4j</strong> into <strong>OpenTelemetry</strong>”, “Bridge <strong>Logback</strong> into <strong>OpenTelemetry</strong>” entries.</li>
</ul>
</li>
</ol>
<h3 id="Via-file-or-stdout"><a href="#Via-file-or-stdout" class="headerlink" title="Via file or stdout"></a>Via file or stdout</h3><ol>
<li>In the file or stdout workflow, logs are written to files or standout output.</li>
<li>Another component (e.g. <strong>FluentBit</strong>) is responsible for <strong>reading</strong> &#x2F; <strong>tailing</strong> the logs<ul>
<li><strong>parsing</strong> them to more <strong>structured format</strong>, and <strong>forwarding</strong> them a target, such as the <strong>collector</strong>.</li>
</ul>
</li>
<li>This workflow may be <strong>preferable</strong> in situations where application requirements do <strong>not permit additional overhead</strong> from direct to collector.</li>
<li>However, it requires that <strong>all log fields required down stream</strong> are <strong>encoded</strong> into the logs<ul>
<li>and that the component reading the logs parse the data into the <strong>log data model</strong>.</li>
</ul>
</li>
<li><strong>Log correlation with traces</strong> is available by installing a shim to bridge <strong>OpenTelemetry context</strong> into the <strong>log framework</strong>.<ul>
<li>See “Bridge <strong>OpenTelemetry context</strong> into <strong>Log4j</strong>”, “Bridge <strong>OpenTelemetry context</strong> into <strong>Logback</strong>” entries.</li>
</ul>
</li>
</ol>
<h1 id="Record-Telemetry-with-API"><a href="#Record-Telemetry-with-API" class="headerlink" title="Record Telemetry with API"></a>Record Telemetry with API</h1><ol>
<li>The <strong>API</strong> is a set of <strong>classes</strong> and <strong>interfaces</strong> for <strong>recording telemetry</strong> across <strong>key observability signals</strong>.</li>
<li>The <strong>SDK</strong> is the <strong>built-in reference implementation</strong> of the <strong>API</strong>, configured to process and export telemetry.</li>
</ol>
<blockquote>
<p>The API consists of the following <strong>top-level</strong> components</p>
</blockquote>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Context</td>
<td>A <strong>standalone API</strong> for <strong>propagating context</strong> throughout an application and across application boundaries, including <strong>trace context</strong> and <strong>baggage</strong>.</td>
</tr>
<tr>
<td>TracerProvider</td>
<td>The API <strong>entry point</strong> for traces</td>
</tr>
<tr>
<td>MeterProvider</td>
<td>The API <strong>entry point</strong> for metrics</td>
</tr>
<tr>
<td>LoggerProvider</td>
<td>The API entry point for logs</td>
</tr>
<tr>
<td>OpenTelemetry</td>
<td>A <strong>holder</strong> for top-level API components (i.e. TracerProvider, MeterProvider, LoggerProvider, ContextPropagators) which is convenient to pass to <strong>instrumentation</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The <strong>API</strong> is designed to support <strong>multiple implementations</strong>. Two implementations are <strong>provided by OpenTelemetry</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Implementations</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>SDK</strong> reference implementation</td>
<td>This is the right choice for <strong>most users</strong>.</td>
</tr>
<tr>
<td><strong>Noop</strong> implementation</td>
<td>A <strong>minimalist</strong>, <strong>zero-dependency</strong> implementation for instrumentations to use by default when the user <strong>doesn’t install an instance</strong>.</td>
</tr>
</tbody></table>
<ol>
<li>The <strong>API</strong> is designed to be taken as a <strong>direct dependency</strong> by <strong>libraries</strong>, <strong>frameworks</strong>, and application owners.</li>
<li>It comes with strong <strong>backwards compatibility</strong> guarantees, <strong>zero transitive dependencies</strong>, and supports <strong>Java 8+</strong></li>
<li><strong>Libraries</strong> and <strong>frameworks</strong> should <strong>depend only on the API</strong> and <strong>only call methods from the API</strong><ul>
<li>and instruct <strong>applications</strong> &#x2F; <strong>end users</strong> to add a dependency on the <strong>SDK</strong> and install a <strong>configured instance</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Context-API"><a href="#Context-API" class="headerlink" title="Context API"></a>Context API</h2><ol>
<li>The <strong>io.opentelemetry:opentelemetry-api-context:1.54.1</strong> artifact contains <strong>standalone APIs</strong> (i.e. <strong>packaged separately from OpenTelemetry API</strong>)<ul>
<li>for <strong>propagating context</strong> throughout an application and across application boundaries.</li>
</ul>
</li>
<li>The <strong>io.opentelemetry:opentelemetry-extension-kotlint:1.54.1</strong> is an extension with tools for propagating context into <strong>coroutines</strong>.</li>
<li>It consists of:</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Context</td>
<td>An <strong>immutable</strong> bundle of <strong>key value pairs</strong> which is <strong>implicitly</strong> or <strong>explicitly</strong> propagated through an application.</td>
</tr>
<tr>
<td>ContextStorage</td>
<td>A <strong>mechanism</strong> for <strong>storing</strong> and <strong>retrieving</strong> the current context, defaulting to <strong>thread local</strong>.</td>
</tr>
<tr>
<td>ContextPropagators</td>
<td>A <strong>container</strong> of <strong>registered propagators</strong> for <strong>propagating Context</strong> across application boundaries.</td>
</tr>
</tbody></table>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><ol>
<li>Context is an immutable bundle of <strong>key value pairs</strong>, with utilities for <strong>implicitly propagating</strong> through an application and across threads.<ul>
<li><strong>Implicit propagation</strong> means that the context can be accessed <strong>without explicitly passing</strong> it as an argument.</li>
</ul>
</li>
<li>Context is a <strong>recurring concept</strong> in the <strong>OpenTelemetry API</strong>:<ul>
<li>The <strong>current active Span</strong> is stored in context, and by default a span’s <strong>parent</strong> is assigned to whatever span is currently in context.</li>
<li>The measurements recorded to <strong>metric instruments</strong> accept a <strong>context argument</strong><ul>
<li>used to <strong>link measurements to spans</strong> via <strong>exemplars</strong> and defaulting to whatever span is currently in context.</li>
</ul>
</li>
<li>LogRecords accept a <strong>context argument</strong>, used to <strong>link log record spans</strong> and defaulting to whatever span is currently in context.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet explores Context API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.ContextKey;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Scope;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Define an example context key</span></span><br><span class="line">    ContextKey&lt;String&gt; exampleContextKey = ContextKey.named(<span class="string">&quot;example-context-key&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Context doesn&#x27;t contain the key until we add it</span></span><br><span class="line">    <span class="comment">// Context.current() accesses the current context</span></span><br><span class="line">    <span class="comment">// output =&gt; current context value: null</span></span><br><span class="line">    System.out.println(<span class="string">&quot;current context value: &quot;</span> + Context.current().get(exampleContextKey));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add entry to context</span></span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> Context.current().with(exampleContextKey, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The local context var contains the added value</span></span><br><span class="line">    <span class="comment">// output =&gt; context value: value</span></span><br><span class="line">    System.out.println(<span class="string">&quot;context value: &quot;</span> + context.get(exampleContextKey));</span><br><span class="line">    <span class="comment">// The current context still doesn&#x27;t contain the value</span></span><br><span class="line">    <span class="comment">// output =&gt; current context value: null</span></span><br><span class="line">    System.out.println(<span class="string">&quot;current context value: &quot;</span> + Context.current().get(exampleContextKey));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calling context.makeCurrent() sets Context.current() to the context until the scope is</span></span><br><span class="line">    <span class="comment">// closed, upon which Context.current() is restored to the state prior to when</span></span><br><span class="line">    <span class="comment">// context.makeCurrent() was called. The resulting Scope implements AutoCloseable and is</span></span><br><span class="line">    <span class="comment">// normally used in a try-with-resources block. Failure to call Scope.close() is an error and</span></span><br><span class="line">    <span class="comment">// may cause memory leaks or other issues.</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> context.makeCurrent()) &#123;</span><br><span class="line">      <span class="comment">// The current context now contains the added value</span></span><br><span class="line">      <span class="comment">// output =&gt; context value: value</span></span><br><span class="line">      System.out.println(<span class="string">&quot;context value: &quot;</span> + Context.current().get(exampleContextKey));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The local context var still contains the added value</span></span><br><span class="line">    <span class="comment">// output =&gt; context value: value</span></span><br><span class="line">    System.out.println(<span class="string">&quot;context value: &quot;</span> + context.get(exampleContextKey));</span><br><span class="line">    <span class="comment">// The current context no longer contains the value</span></span><br><span class="line">    <span class="comment">// output =&gt; current context value: null</span></span><br><span class="line">    System.out.println(<span class="string">&quot;current context value: &quot;</span> + Context.current().get(exampleContextKey));</span><br><span class="line"></span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">    <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Context instances can be explicitly passed around application code, but it&#x27;s more convenient</span></span><br><span class="line">    <span class="comment">// to use implicit context, calling Context.makeCurrent() and accessing via Context.current().</span></span><br><span class="line">    <span class="comment">// Context provides a number of utilities for implicit context propagation. These utilities wrap</span></span><br><span class="line">    <span class="comment">// utility classes like Scheduler, ExecutorService, ScheduledExecutorService, Runnable,</span></span><br><span class="line">    <span class="comment">// Callable, Consumer, Supplier, Function, etc and modify their behavior to call</span></span><br><span class="line">    <span class="comment">// Context.makeCurrent() before running.</span></span><br><span class="line">    context.wrap(ContextUsage::callable).call();</span><br><span class="line">    context.wrap(ContextUsage::runnable).run();</span><br><span class="line">    context.wrap(executorService).submit(ContextUsage::runnable);</span><br><span class="line">    context.wrap(scheduledExecutorService).schedule(ContextUsage::runnable, <span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">    context.wrapConsumer(ContextUsage::consumer).accept(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">    context.wrapConsumer(ContextUsage::biConsumer).accept(<span class="keyword">new</span> <span class="title class_">Object</span>(), <span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">    context.wrapFunction(ContextUsage::function).apply(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">    context.wrapSupplier(ContextUsage::supplier).get();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> java.util.concurrent.Callable&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">callable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> Runnable&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">runnable</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> java.util.function.Consumer&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">consumer</span><span class="params">(Object object)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> java.util.function.BiConsumer&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">biConsumer</span><span class="params">(Object object1, Object object2)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> java.util.function.Function&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">function</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Example &#123;<span class="doctag">@link</span> java.util.function.Supplier&#125;. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">supplier</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Context instances</strong> can be <strong>explicitly passed</strong> around application code<ul>
<li>but it’s <strong>more convenient</strong> to use <strong>implicit context</strong>, calling <strong>Context.makeCurrent()</strong> and <strong>accessing via Context.current()</strong>.</li>
</ul>
</li>
<li>Context provides a number of utilities for <strong>implicit context propagation</strong>.</li>
<li>These utilities <strong>wrap</strong> utility classes like<ul>
<li><strong>Scheduler</strong>, <strong>ExecutorService</strong>, <strong>ScheduledExecutorService</strong>, <strong>Runnable</strong>, <strong>Callable</strong>, <strong>Consumer</strong>, <strong>Supplier</strong>, <strong>Function</strong>, etc</li>
<li>and modify their behavior to <strong>call Context.makeCurrent() before running</strong>.</li>
</ul>
</li>
</ol>
<h3 id="ContextStorage"><a href="#ContextStorage" class="headerlink" title="ContextStorage"></a>ContextStorage</h3><ol>
<li>ContextStorage is a <strong>mechanism</strong> for <strong>storing</strong> and <strong>retrieving</strong> the <strong>current Context</strong>.</li>
<li>The <strong>default</strong> ContextStorage implementation stores Context in <strong>thread local</strong>.</li>
</ol>
<h3 id="ContextPropagators"><a href="#ContextPropagators" class="headerlink" title="ContextPropagators"></a>ContextPropagators</h3><ol>
<li>ContextPropagators is a <strong>container</strong> of <strong>registered propagators</strong> for <strong>propagating Context</strong> across application boundaries.</li>
<li>Context is <strong>injected</strong> into a <strong>carrier</strong> when <strong>leaving</strong> an application (i.e. an outbound HTTP request)<ul>
<li>and <strong>extracted</strong> from a <strong>carrier</strong> when <strong>entering</strong> an application (i.e. serving an HTTP request).</li>
</ul>
</li>
<li>See <strong>SDK TextMapPropagators</strong> for propagator implementations.</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>ContextPropagators API</strong> for <strong>extraction</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpExchange;</span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpHandler;</span><br><span class="line"><span class="keyword">import</span> com.sun.net.httpserver.HttpServer;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.propagation.W3CBaggagePropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.propagation.W3CTraceContextPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Scope;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.ContextPropagators;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapGetter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapSetter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtractContextUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TextMapGetter&lt;HttpExchange&gt; TEXT_MAP_GETTER = <span class="keyword">new</span> <span class="title class_">HttpRequestGetter</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Create a ContextPropagators instance which propagates w3c trace context and w3c baggage</span></span><br><span class="line">    <span class="type">ContextPropagators</span> <span class="variable">propagators</span> <span class="operator">=</span></span><br><span class="line">        ContextPropagators.create(</span><br><span class="line">            TextMapPropagator.composite(</span><br><span class="line">                W3CTraceContextPropagator.getInstance(), W3CBaggagePropagator.getInstance()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a server, which uses the propagators to extract context from requests</span></span><br><span class="line">    <span class="type">HttpServer</span> <span class="variable">server</span> <span class="operator">=</span> HttpServer.create(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8080</span>), <span class="number">0</span>);</span><br><span class="line">    server.createContext(<span class="string">&quot;/path&quot;</span>, <span class="keyword">new</span> <span class="title class_">Handler</span>(propagators));</span><br><span class="line">    server.setExecutor(<span class="literal">null</span>);</span><br><span class="line">    server.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Handler</span> <span class="keyword">implements</span> <span class="title class_">HttpHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ContextPropagators contextPropagators;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Handler</span><span class="params">(ContextPropagators contextPropagators)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.contextPropagators = contextPropagators;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpExchange exchange)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// Extract the context from the request and make the context current</span></span><br><span class="line">      <span class="type">Context</span> <span class="variable">extractedContext</span> <span class="operator">=</span></span><br><span class="line">          contextPropagators</span><br><span class="line">              .getTextMapPropagator()</span><br><span class="line">              .extract(Context.current(), exchange, TEXT_MAP_GETTER);</span><br><span class="line">      <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> extractedContext.makeCurrent()) &#123;</span><br><span class="line">        <span class="comment">// Do work with the extracted context</span></span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        exchange.sendResponseHeaders(<span class="number">200</span>, response.length());</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> exchange.getResponseBody();</span><br><span class="line">        os.write(response.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        os.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** &#123;<span class="doctag">@link</span> TextMapSetter&#125; with a &#123;<span class="doctag">@link</span> HttpExchange&#125; carrier. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HttpRequestGetter</span> <span class="keyword">implements</span> <span class="title class_">TextMapGetter</span>&lt;HttpExchange&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterable&lt;String&gt; <span class="title function_">keys</span><span class="params">(HttpExchange carrier)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> carrier.getRequestHeaders().keySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(HttpExchange carrier, String key)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (carrier == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      List&lt;String&gt; headers = carrier.getRequestHeaders().get(key);</span><br><span class="line">      <span class="keyword">if</span> (headers == <span class="literal">null</span> || headers.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> headers.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The following code snippet explores <strong>ContextPropagators API</strong> for <strong>injection</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.propagation.W3CBaggagePropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.propagation.W3CTraceContextPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.ContextPropagators;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapSetter;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpClient;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InjectContextUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TextMapSetter&lt;HttpRequest.Builder&gt; TEXT_MAP_SETTER = <span class="keyword">new</span> <span class="title class_">HttpRequestSetter</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Create a ContextPropagators instance which propagates w3c trace context and w3c baggage</span></span><br><span class="line">    <span class="type">ContextPropagators</span> <span class="variable">propagators</span> <span class="operator">=</span></span><br><span class="line">        ContextPropagators.create(</span><br><span class="line">            TextMapPropagator.composite(</span><br><span class="line">                W3CTraceContextPropagator.getInstance(), W3CBaggagePropagator.getInstance()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an HttpRequest builder</span></span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClient.newBuilder().build();</span><br><span class="line">    HttpRequest.<span class="type">Builder</span> <span class="variable">requestBuilder</span> <span class="operator">=</span></span><br><span class="line">        HttpRequest.newBuilder().uri(<span class="keyword">new</span> <span class="title class_">URI</span>(<span class="string">&quot;http://127.0.0.1:8080/path&quot;</span>)).GET();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Given a ContextPropagators instance, inject the current context into the HTTP request carrier</span></span><br><span class="line">    propagators.getTextMapPropagator().inject(Context.current(), requestBuilder, TEXT_MAP_SETTER);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Send the request with the injected context</span></span><br><span class="line">    httpClient.send(requestBuilder.build(), HttpResponse.BodyHandlers.discarding());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** &#123;<span class="doctag">@link</span> TextMapSetter&#125; with a &#123;<span class="doctag">@link</span> HttpRequest.Builder&#125; carrier. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HttpRequestSetter</span> <span class="keyword">implements</span> <span class="title class_">TextMapSetter</span>&lt;HttpRequest.Builder&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(HttpRequest.Builder carrier, String key, String value)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (carrier == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      carrier.setHeader(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="OpenTelemetry-API"><a href="#OpenTelemetry-API" class="headerlink" title="OpenTelemetry API"></a>OpenTelemetry API</h2><ol>
<li>The <strong>io.opentelemetry:opentelemetry-api:1.54.1</strong> artifact contains the OpenTelemetry API</li>
<li>including <strong>traces</strong>, <strong>metrics</strong>, <strong>logs</strong>, <strong>noop</strong> implementation, <strong>baggage</strong>, <strong>key TextMapPropagator</strong> implementations, and a <strong>dependency</strong> on the <strong>context API</strong>.</li>
</ol>
<h3 id="Providers-and-Scopes"><a href="#Providers-and-Scopes" class="headerlink" title="Providers and Scopes"></a>Providers and Scopes</h3><ol>
<li><strong>Providers</strong> and <strong>scopes</strong> are <strong>recurring concepts</strong> in the OpenTelemetry API.</li>
<li>A <strong>scope</strong> is a <strong>logical unit within the application</strong> which telemetry is associated with.</li>
<li>A provider provides <strong>components</strong> for <strong>recording telemetry</strong> relative to a particular scope:<ul>
<li><strong>TracerProvider</strong> provides scoped <strong>Tracers</strong> for recording <strong>spans</strong>.</li>
<li><strong>MeterProvider</strong> provides scoped <strong>Meters</strong> for recording <strong>metrics</strong>.</li>
<li><strong>LoggerProvider</strong> provides scoped <strong>Loggers</strong> for recording <strong>logs</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Log</p>
</blockquote>
<ol>
<li>While the <strong>LoggerProvider</strong> &#x2F; <strong>Logger</strong> APIs are <strong>structurally similar to</strong> the equivalent <strong>trace</strong> and <strong>metric</strong> APIs, they serve a <strong>different use case</strong>.</li>
<li>As of now, LoggerProvider &#x2F; Logger and associated classes represent the <strong>Log Bridge API</strong><ul>
<li>which exists to write <strong>log appenders</strong> to <strong>bridge</strong> logs recorded through <strong>other log APIs &#x2F; frameworks</strong> into <strong>OpenTelemetry</strong>.</li>
</ul>
</li>
<li>They are <strong>not intended</strong> for end user use as a <strong>replacement</strong> for Log4j &#x2F; SLF4J &#x2F; Logback &#x2F; etc.</li>
</ol>
<blockquote>
<p>scope</p>
</blockquote>
<ol>
<li>A scope is identified by the triplet (<strong>name</strong>, <strong>version</strong>, <strong>schemaUrl</strong>).</li>
<li>Care must be taken to ensure the <strong>scope identity</strong> is <strong>unique</strong>.</li>
<li>A typical approach is to set the <strong>scope name</strong> to the <strong>package name</strong> or <strong>fully qualified class name</strong>, and to set the <strong>scope version</strong> to the <strong>library version</strong>.</li>
<li>If emitting telemetry for <strong>multiple signals</strong> (i.e. metrics and traces), the <strong>same scope</strong> should be used.</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>provider</strong> and <strong>scope</strong> API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.Logger;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.LoggerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.MeterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.TracerProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProvidersAndScopes</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SCOPE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fully.qualified.name&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SCOPE_VERSION</span> <span class="operator">=</span> <span class="string">&quot;1.0.0&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SCOPE_SCHEMA_URL</span> <span class="operator">=</span> <span class="string">&quot;https://example&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">providersUsage</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">    <span class="comment">// Access providers from an OpenTelemetry instance</span></span><br><span class="line">    <span class="type">TracerProvider</span> <span class="variable">tracerProvider</span> <span class="operator">=</span> openTelemetry.getTracerProvider();</span><br><span class="line">    <span class="type">MeterProvider</span> <span class="variable">meterProvider</span> <span class="operator">=</span> openTelemetry.getMeterProvider();</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> LoggerProvider is a special case and should only be used to bridge logs from other</span></span><br><span class="line">    <span class="comment">// logging APIs / frameworks into OpenTelemetry.</span></span><br><span class="line">    <span class="type">LoggerProvider</span> <span class="variable">loggerProvider</span> <span class="operator">=</span> openTelemetry.getLogsBridge();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Access tracer, meter, logger from providers to record telemetry for a particular scope</span></span><br><span class="line">    <span class="type">Tracer</span> <span class="variable">tracer</span> <span class="operator">=</span></span><br><span class="line">        tracerProvider</span><br><span class="line">            .tracerBuilder(SCOPE_NAME)</span><br><span class="line">            .setInstrumentationVersion(SCOPE_VERSION)</span><br><span class="line">            .setSchemaUrl(SCOPE_SCHEMA_URL)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">Meter</span> <span class="variable">meter</span> <span class="operator">=</span></span><br><span class="line">        meterProvider</span><br><span class="line">            .meterBuilder(SCOPE_NAME)</span><br><span class="line">            .setInstrumentationVersion(SCOPE_VERSION)</span><br><span class="line">            .setSchemaUrl(SCOPE_SCHEMA_URL)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span></span><br><span class="line">        loggerProvider</span><br><span class="line">            .loggerBuilder(SCOPE_NAME)</span><br><span class="line">            .setInstrumentationVersion(SCOPE_VERSION)</span><br><span class="line">            .setSchemaUrl(SCOPE_SCHEMA_URL)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...optionally, shorthand versions are available if scope version and schemaUrl aren&#x27;t</span></span><br><span class="line">    <span class="comment">// available</span></span><br><span class="line">    tracer = tracerProvider.get(SCOPE_NAME);</span><br><span class="line">    meter = meterProvider.get(SCOPE_NAME);</span><br><span class="line">    logger = loggerProvider.get(SCOPE_NAME);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><ol>
<li>Attributes is a bundle of <strong>key value pairs</strong> representing the <strong>standard attribute definition</strong>.</li>
<li>Attributes are a <strong>recurring concept</strong> in the OpenTelemetry API:<ul>
<li><strong>Spans</strong>, <strong>span events</strong>, and <strong>span links</strong> have attributes.</li>
<li>The <strong>measurements</strong> recorded to <strong>metric instruments</strong> have attributes.</li>
<li><strong>LogRecords</strong> have attributes.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>Attributes</strong> API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.AttributeKey;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.AttributesBuilder;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttributesUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Establish static constant for attribute keys and reuse to avoid allocations</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AttributeKey&lt;String&gt; SHOP_ID = AttributeKey.stringKey(<span class="string">&quot;com.acme.shop.id&quot;</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AttributeKey&lt;String&gt; SHOP_NAME =</span><br><span class="line">      AttributeKey.stringKey(<span class="string">&quot;com.acme.shop.name&quot;</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AttributeKey&lt;Long&gt; CUSTOMER_ID =</span><br><span class="line">      AttributeKey.longKey(<span class="string">&quot;com.acme.customer.id&quot;</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AttributeKey&lt;String&gt; CUSTOMER_NAME =</span><br><span class="line">      AttributeKey.stringKey(<span class="string">&quot;com.acme.customer.name&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">attributesUsage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Use a varargs initializer and pre-allocated attribute keys. This is the most efficient way to</span></span><br><span class="line">    <span class="comment">// create attributes.</span></span><br><span class="line">    <span class="type">Attributes</span> <span class="variable">attributes</span> <span class="operator">=</span></span><br><span class="line">        Attributes.of(</span><br><span class="line">            SHOP_ID,</span><br><span class="line">            <span class="string">&quot;abc123&quot;</span>,</span><br><span class="line">            SHOP_NAME,</span><br><span class="line">            <span class="string">&quot;opentelemetry-demo&quot;</span>,</span><br><span class="line">            CUSTOMER_ID,</span><br><span class="line">            <span class="number">123L</span>,</span><br><span class="line">            CUSTOMER_NAME,</span><br><span class="line">            <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...or use a builder.</span></span><br><span class="line">    attributes =</span><br><span class="line">        Attributes.builder()</span><br><span class="line">            .put(SHOP_ID, <span class="string">&quot;abc123&quot;</span>)</span><br><span class="line">            .put(SHOP_NAME, <span class="string">&quot;opentelemetry-demo&quot;</span>)</span><br><span class="line">            .put(CUSTOMER_ID, <span class="number">123</span>)</span><br><span class="line">            .put(CUSTOMER_NAME, <span class="string">&quot;Jack&quot;</span>)</span><br><span class="line">            <span class="comment">// Optionally initialize attribute keys on the fly</span></span><br><span class="line">            .put(AttributeKey.stringKey(<span class="string">&quot;com.acme.string-key&quot;</span>), <span class="string">&quot;value&quot;</span>)</span><br><span class="line">            .put(AttributeKey.booleanKey(<span class="string">&quot;com.acme.bool-key&quot;</span>), <span class="literal">true</span>)</span><br><span class="line">            .put(AttributeKey.longKey(<span class="string">&quot;com.acme.long-key&quot;</span>), <span class="number">1L</span>)</span><br><span class="line">            .put(AttributeKey.doubleKey(<span class="string">&quot;com.acme.double-key&quot;</span>), <span class="number">1.1</span>)</span><br><span class="line">            .put(AttributeKey.stringArrayKey(<span class="string">&quot;com.acme.string-array-key&quot;</span>), <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>)</span><br><span class="line">            .put(AttributeKey.booleanArrayKey(<span class="string">&quot;come.acme.bool-array-key&quot;</span>), <span class="literal">true</span>, <span class="literal">false</span>)</span><br><span class="line">            .put(AttributeKey.longArrayKey(<span class="string">&quot;come.acme.long-array-key&quot;</span>), <span class="number">1L</span>, <span class="number">2L</span>)</span><br><span class="line">            .put(AttributeKey.doubleArrayKey(<span class="string">&quot;come.acme.double-array-key&quot;</span>), <span class="number">1.1</span>, <span class="number">2.2</span>)</span><br><span class="line">            <span class="comment">// Optionally omit initializing AttributeKey</span></span><br><span class="line">            .put(<span class="string">&quot;com.acme.string-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">            .put(<span class="string">&quot;com.acme.bool-key&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.long-key&quot;</span>, <span class="number">1L</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.double-key&quot;</span>, <span class="number">1.1</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.string-array-key&quot;</span>, <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.bool-array-key&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.long-array-key&quot;</span>, <span class="number">1L</span>, <span class="number">2L</span>)</span><br><span class="line">            .put(<span class="string">&quot;come.acme.double-array-key&quot;</span>, <span class="number">1.1</span>, <span class="number">2.2</span>)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attributes has a variety of methods for manipulating and reading data.</span></span><br><span class="line">    <span class="comment">// Read an attribute key:</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopIdValue</span> <span class="operator">=</span> attributes.get(SHOP_ID);</span><br><span class="line">    <span class="comment">// Inspect size:</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> attributes.size();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isEmpty</span> <span class="operator">=</span> attributes.isEmpty();</span><br><span class="line">    <span class="comment">// Convert to a map representation:</span></span><br><span class="line">    Map&lt;AttributeKey&lt;?&gt;, Object&gt; map = attributes.asMap();</span><br><span class="line">    <span class="comment">// Iterate through entries, printing each to the template: &lt;key&gt; (&lt;type&gt;): &lt;value&gt;\n</span></span><br><span class="line">    attributes.forEach(</span><br><span class="line">        (attributeKey, value) -&gt;</span><br><span class="line">            System.out.printf(</span><br><span class="line">                <span class="string">&quot;%s (%s): %s%n&quot;</span>, attributeKey.getKey(), attributeKey.getType(), value));</span><br><span class="line">    <span class="comment">// Convert to a builder, remove the com.acme.customer.id and any entry whose key starts with</span></span><br><span class="line">    <span class="comment">// com.acme.shop, and build a new instance:</span></span><br><span class="line">    <span class="type">AttributesBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> attributes.toBuilder();</span><br><span class="line">    builder.remove(CUSTOMER_ID);</span><br><span class="line">    builder.removeIf(attributeKey -&gt; attributeKey.getKey().startsWith(<span class="string">&quot;com.acme.shop&quot;</span>));</span><br><span class="line">    <span class="type">Attributes</span> <span class="variable">trimmedAttributes</span> <span class="operator">=</span> builder.build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OpenTelemetry"><a href="#OpenTelemetry" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h3><blockquote>
<p>Spring Boot Starter</p>
</blockquote>
<ol>
<li>The Spring Boot starter is a special case where <strong>OpenTelemetry</strong> is available as a <strong>Spring bean</strong>.</li>
<li>Simply <strong>inject</strong> OpenTelemetry into your <strong>Spring components</strong>.</li>
<li>Extending the <strong>Spring Boot starter</strong> with <strong>custom manual instrumentation</strong>.</li>
</ol>
<blockquote>
<p>OpenTelemetry is a <strong>holder</strong> for <strong>top-level</strong> API components which is convenient to pass to instrumentation. OpenTelemetry consists of</p>
</blockquote>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>TracerProvider</td>
<td>The API entry point for <strong>traces</strong>.</td>
</tr>
<tr>
<td>MeterProvider</td>
<td>The API entry point for <strong>metrics</strong>.</td>
</tr>
<tr>
<td>LoggerProvider</td>
<td>The API entry point for <strong>logs</strong>.</td>
</tr>
<tr>
<td>ContextPropagators</td>
<td>The API entry point for <strong>context propagation</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet explores <strong>OpenTelemetry API</strong> usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.LoggerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.MeterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.TracerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.ContextPropagators;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenTelemetryUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">openTelemetryUsage</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">    <span class="comment">// Access TracerProvider, MeterProvider, LoggerProvider, ContextPropagators</span></span><br><span class="line">    <span class="type">TracerProvider</span> <span class="variable">tracerProvider</span> <span class="operator">=</span> openTelemetry.getTracerProvider();</span><br><span class="line">    <span class="type">MeterProvider</span> <span class="variable">meterProvider</span> <span class="operator">=</span> openTelemetry.getMeterProvider();</span><br><span class="line">    <span class="type">LoggerProvider</span> <span class="variable">loggerProvider</span> <span class="operator">=</span> openTelemetry.getLogsBridge();</span><br><span class="line">    <span class="type">ContextPropagators</span> <span class="variable">propagators</span> <span class="operator">=</span> openTelemetry.getPropagators();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="GlobalOpenTelemetry"><a href="#GlobalOpenTelemetry" class="headerlink" title="GlobalOpenTelemetry"></a>GlobalOpenTelemetry</h3><blockquote>
<p>Java agent</p>
</blockquote>
<ol>
<li>The <strong>Java agent</strong> is a special case where <strong>GlobalOpenTelemetry</strong> is <strong>set by the agent</strong>.</li>
<li>Simply call <strong>GlobalOpenTelemetry.get()</strong> to access the <strong>OpenTelemetry instance</strong>.</li>
<li>Extending the <strong>Java agent</strong> with custom manual instrumentation</li>
</ol>
<blockquote>
<p>GlobalOpenTelemetry</p>
</blockquote>
<ol>
<li>GlobalOpenTelemetry holds a <strong>global singleton</strong> OpenTelemetry instance.</li>
<li><strong>Instrumentation</strong> should <strong>avoid</strong> using <strong>GlobalOpenTelemetry</strong>.<ul>
<li>Instead, accept <strong>OpenTelemetry</strong> as an <strong>initialization argument</strong> and default to the <strong>Noop implementation</strong> if <strong>not set</strong>.</li>
</ul>
</li>
<li>There is an <strong>exception</strong> to this rule: the OpenTelemetry instance <strong>installed</strong> by the <strong>Java agent</strong> is available via GlobalOpenTelemetry.<ul>
<li>Users with <strong>additional manual instrumentation</strong> are <strong>encouraged</strong> to access it via <strong>GlobalOpenTelemetry.get()</strong>.</li>
</ul>
</li>
<li><strong>GlobalOpenTelemetry.get()</strong> is <strong>guaranteed</strong> to always return the <strong>same result</strong>.<ul>
<li>If GlobalOpenTelemetry.<strong>get</strong>() is <strong>called</strong> before GlobalOpenTelemetry.<strong>set</strong>(..)<ul>
<li>GlobalOpenTelemetry is set to the <strong>noop implementation</strong> and future calls to GlobalOpenTelemetry.<strong>set</strong>(..) throw an <strong>exception</strong>.</li>
</ul>
</li>
<li>Therefore, it’s critical to call GlobalOpenTelemetry.<strong>set</strong>(..) as <strong>early</strong> in the application lifecycle as possible<ul>
<li>and <strong>before</strong> GlobalOpenTelemetry.<strong>get</strong>() is called by any instrumentation.</li>
</ul>
</li>
<li>This guarantee surfaces initialization ordering issues<ul>
<li>calling GlobalOpenTelemetry.set() <strong>too late</strong> (i.e. after instrumentation has called GlobalOpenTelemetry.get())</li>
<li><strong>triggers an exception</strong> rather than <strong>silently failing</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>If <strong>autoconfigure</strong> is present, <strong>GlobalOpenTelemetry</strong> can be <strong>automatically initialized</strong> by setting<ul>
<li>-D<strong>otel.java.global-autoconfigure.enabled</strong>&#x3D;true (or via env var export <strong>OTEL_JAVA_GLOBAL_AUTOCONFIGURE_ENABLED</strong>&#x3D;true).</li>
<li>When enabled, the <strong>first call</strong> to GlobalOpenTelemetry.<strong>get</strong>() <strong>triggers autoconfiguration</strong> and calls GlobalOpenTelemetry.<strong>set</strong>(..) with the resulting OpenTelemetry instance.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>GlobalOpenTelemetry API context propagation</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.GlobalOpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalOpenTelemetryUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">openTelemetryUsage</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">    <span class="comment">// Set the GlobalOpenTelemetry instance as early in the application lifecycle as possible</span></span><br><span class="line">    <span class="comment">// Set must only be called once. Calling multiple times raises an exception.</span></span><br><span class="line">    GlobalOpenTelemetry.set(openTelemetry);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the GlobalOpenTelemetry instance.</span></span><br><span class="line">    openTelemetry = GlobalOpenTelemetry.get();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TracerProvider"><a href="#TracerProvider" class="headerlink" title="TracerProvider"></a>TracerProvider</h3><p>TracerProvider is the <strong>API entry point</strong> for <strong>traces</strong> and <strong>provides Tracers</strong></p>
<h4 id="Tracer"><a href="#Tracer" class="headerlink" title="Tracer"></a>Tracer</h4><p>Tracer is used to <strong>record spans</strong> for an <strong>instrumentation scope</strong>.</p>
<h4 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h4><ol>
<li><strong>SpanBuilder</strong> and <strong>Span</strong> are used to <strong>construct</strong> and <strong>record</strong> data to spans.</li>
<li><strong>SpanBuilder</strong> is used to <strong>add data</strong> to a span <strong>before</strong> starting it by calling Span <strong>startSpan()</strong>.</li>
<li>Data <strong>can be added &#x2F; updated after starting</strong> by calling various Span <strong>update methods</strong>.</li>
<li>The <strong>data</strong> provided to <strong>SpanBuilder</strong> before starting is provided as an <strong>input</strong> to <strong>Samplers</strong>.</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>SpanBuilder &#x2F; Span API</strong> usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.opentelemetry.context.Context.current;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.AttributeKey;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Span;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.SpanContext;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.SpanKind;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.StatusCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpanUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">spanUsage</span><span class="params">(Tracer tracer)</span> &#123;</span><br><span class="line">    <span class="comment">// Get a span builder by providing the span name</span></span><br><span class="line">    <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span></span><br><span class="line">        tracer</span><br><span class="line">            .spanBuilder(<span class="string">&quot;span name&quot;</span>)</span><br><span class="line">            <span class="comment">// Set span kind</span></span><br><span class="line">            .setSpanKind(SpanKind.INTERNAL)</span><br><span class="line">            <span class="comment">// Set attributes</span></span><br><span class="line">            .setAttribute(AttributeKey.stringKey(<span class="string">&quot;com.acme.string-key&quot;</span>), <span class="string">&quot;value&quot;</span>)</span><br><span class="line">            .setAttribute(AttributeKey.booleanKey(<span class="string">&quot;com.acme.bool-key&quot;</span>), <span class="literal">true</span>)</span><br><span class="line">            .setAttribute(AttributeKey.longKey(<span class="string">&quot;com.acme.long-key&quot;</span>), <span class="number">1L</span>)</span><br><span class="line">            .setAttribute(AttributeKey.doubleKey(<span class="string">&quot;com.acme.double-key&quot;</span>), <span class="number">1.1</span>)</span><br><span class="line">            .setAttribute(</span><br><span class="line">                AttributeKey.stringArrayKey(<span class="string">&quot;com.acme.string-array-key&quot;</span>),</span><br><span class="line">                Arrays.asList(<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>))</span><br><span class="line">            .setAttribute(</span><br><span class="line">                AttributeKey.booleanArrayKey(<span class="string">&quot;come.acme.bool-array-key&quot;</span>),</span><br><span class="line">                Arrays.asList(<span class="literal">true</span>, <span class="literal">false</span>))</span><br><span class="line">            .setAttribute(</span><br><span class="line">                AttributeKey.longArrayKey(<span class="string">&quot;come.acme.long-array-key&quot;</span>), Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>))</span><br><span class="line">            .setAttribute(</span><br><span class="line">                AttributeKey.doubleArrayKey(<span class="string">&quot;come.acme.double-array-key&quot;</span>), Arrays.asList(<span class="number">1.1</span>, <span class="number">2.2</span>))</span><br><span class="line">            <span class="comment">// Optionally omit initializing AttributeKey</span></span><br><span class="line">            .setAttribute(<span class="string">&quot;com.acme.string-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">            .setAttribute(<span class="string">&quot;com.acme.bool-key&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            .setAttribute(<span class="string">&quot;come.acme.long-key&quot;</span>, <span class="number">1L</span>)</span><br><span class="line">            .setAttribute(<span class="string">&quot;come.acme.double-key&quot;</span>, <span class="number">1.1</span>)</span><br><span class="line">            .setAllAttributes(WIDGET_RED_CIRCLE)</span><br><span class="line">            <span class="comment">// Uncomment to optionally explicitly set the parent span context. If omitted, the</span></span><br><span class="line">            <span class="comment">// span&#x27;s parent will be set using Context.current().</span></span><br><span class="line">            <span class="comment">// .setParent(parentContext)</span></span><br><span class="line">            <span class="comment">// Uncomment to optionally add links.</span></span><br><span class="line">            <span class="comment">// .addLink(linkContext, linkAttributes)</span></span><br><span class="line">            <span class="comment">// Start the span</span></span><br><span class="line">            .startSpan();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if span is recording before computing additional data</span></span><br><span class="line">    <span class="keyword">if</span> (span.isRecording()) &#123;</span><br><span class="line">      <span class="comment">// Update the span name with information not available when starting</span></span><br><span class="line">      span.updateName(<span class="string">&quot;new span name&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add additional attributes not available when starting</span></span><br><span class="line">      span.setAttribute(<span class="string">&quot;com.acme.string-key2&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add additional span links not available when starting</span></span><br><span class="line">      span.addLink(exampleLinkContext());</span><br><span class="line">      <span class="comment">// optionally include attributes on the link</span></span><br><span class="line">      span.addLink(exampleLinkContext(), WIDGET_RED_CIRCLE);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add span events</span></span><br><span class="line">      span.addEvent(<span class="string">&quot;my-event&quot;</span>);</span><br><span class="line">      <span class="comment">// optionally include attributes on the event</span></span><br><span class="line">      span.addEvent(<span class="string">&quot;my-event&quot;</span>, WIDGET_RED_CIRCLE);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Record exception, syntactic sugar for a span event with a specific shape</span></span><br><span class="line">      span.recordException(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;error&quot;</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set the span status</span></span><br><span class="line">      span.setStatus(StatusCode.OK, <span class="string">&quot;status description&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Finally, end the span</span></span><br><span class="line">    span.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Return a dummy link context. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> SpanContext <span class="title function_">exampleLinkContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Span.fromContext(current()).getSpanContext();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Span parenting</strong> is an important <strong>aspect</strong> of <strong>tracing</strong>.</li>
<li>Each span has an <strong>optional parent</strong>.</li>
<li>By collecting all the spans in a trace and following each span’s parent, we can construct a <strong>hierarchy</strong>.</li>
<li>The <strong>span APIs</strong> are built on <strong>top</strong> of <strong>context</strong>, which allows <strong>span context</strong> to be <strong>implicitly passed</strong> around an <strong>application</strong> and across <strong>threads</strong>.</li>
<li>When a <strong>span</strong> is <strong>created</strong>, its <strong>parent</strong> is set to the whatever span is present in <strong>Context.current()</strong><ul>
<li>unless <strong>there is no span</strong> or the <strong>context is explicitly overridden</strong>.</li>
</ul>
</li>
<li>Most of the <strong>context API</strong> usage guidance <strong>applies</strong> to <strong>spans</strong>.<ul>
<li><strong>Span context</strong> is propagated across <strong>application boundaries</strong> with the <strong>W3CTraceContextPropagator</strong> and other <strong>TextMapPropagators</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>Span API context propagation</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Span;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Scope;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpanAndContextUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Tracer tracer;</span><br><span class="line"></span><br><span class="line">  SpanAndContextUsage(Tracer tracer) &#123;</span><br><span class="line">    <span class="built_in">this</span>.tracer = tracer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nestedSpanUsage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Start a span. Since we don&#x27;t call makeCurrent(), we must explicitly call setParent on</span></span><br><span class="line">    <span class="comment">// children. Wrap code in try / finally to ensure we end the span.</span></span><br><span class="line">    <span class="type">Span</span> <span class="variable">span</span> <span class="operator">=</span> tracer.spanBuilder(<span class="string">&quot;span&quot;</span>).startSpan();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Start a child span, explicitly setting the parent.</span></span><br><span class="line">      <span class="type">Span</span> <span class="variable">childSpan</span> <span class="operator">=</span></span><br><span class="line">          tracer</span><br><span class="line">              .spanBuilder(<span class="string">&quot;span child&quot;</span>)</span><br><span class="line">              <span class="comment">// Explicitly set parent.</span></span><br><span class="line">              .setParent(span.storeInContext(Context.current()))</span><br><span class="line">              .startSpan();</span><br><span class="line">      <span class="comment">// Call makeCurrent(), adding childSpan to Context.current(). Spans created inside the scope</span></span><br><span class="line">      <span class="comment">// will have their parent set to childSpan.</span></span><br><span class="line">      <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">childSpanScope</span> <span class="operator">=</span> childSpan.makeCurrent()) &#123;</span><br><span class="line">        <span class="comment">// Call another method which creates a span. The span&#x27;s parent will be childSpan since it is</span></span><br><span class="line">        <span class="comment">// started in the childSpan scope.</span></span><br><span class="line">        doWork();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        childSpan.end();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      span.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">doWork</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Span</span> <span class="variable">doWorkSpan</span> <span class="operator">=</span> tracer.spanBuilder(<span class="string">&quot;doWork&quot;</span>).startSpan();</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> doWorkSpan.makeCurrent()) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        result += i;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      doWorkSpan.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MeterProvider"><a href="#MeterProvider" class="headerlink" title="MeterProvider"></a>MeterProvider</h3><p>MeterProvider is the <strong>API entry point</strong> for <strong>metrics</strong> and <strong>provides Meters</strong>.</p>
<h4 id="Meter"><a href="#Meter" class="headerlink" title="Meter"></a>Meter</h4><ol>
<li>Meter is used to <strong>obtain instruments</strong> for a particular <strong>instrumentation scope</strong>.</li>
<li>There are a <strong>variety</strong> of <strong>instruments</strong>, each with <strong>different semantics and default behavior</strong> in the SDK.</li>
<li>It’s important to <strong>choose</strong> the <strong>right instrument</strong> for each particular <strong>use case</strong>:</li>
</ol>
<table>
<thead>
<tr>
<th>Instrument</th>
<th>Sync&#x2F;Async</th>
<th>Description</th>
<th>Example</th>
<th>Default SDK Aggregation</th>
</tr>
</thead>
<tbody><tr>
<td>Counter</td>
<td>sync</td>
<td>Record monotonic (positive) values.</td>
<td>Record user logins</td>
<td>sum (monotonic&#x3D;true)</td>
</tr>
<tr>
<td>Async Counter</td>
<td>async</td>
<td>Observe monotonic sums.</td>
<td>Observe number of classes loaded in the JVM</td>
<td>sum (monotonic&#x3D;true)</td>
</tr>
<tr>
<td>UpDownCounter</td>
<td>sync</td>
<td>Record non-monotonic (positive and negative) values.</td>
<td>Record when items are added to and removed from a queue</td>
<td>sum (monotonic&#x3D;false)</td>
</tr>
<tr>
<td>Async UpDownCounter</td>
<td>async</td>
<td>Observe non-monotonic (positive and negative) sums.</td>
<td>Observe JVM memory pool usage</td>
<td>sum (monotonic&#x3D;false)</td>
</tr>
<tr>
<td>Histogram</td>
<td>sync</td>
<td>Record monotonic (positive) values where the distribution is important.</td>
<td>Record duration of HTTP requests processed by server</td>
<td>ExplicitBucketHistogram</td>
</tr>
<tr>
<td>Gauge</td>
<td>sync</td>
<td>Record the latest value where spatial re-aggregation does not make sense</td>
<td>Record temperature</td>
<td>LastValue</td>
</tr>
<tr>
<td>Async Gauge</td>
<td>async</td>
<td>Observe the latest value where spatial re-aggregation does not make sense</td>
<td>Observe CPU utilization</td>
<td>LastValue</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>Spatial re-aggregation</strong> is the process of <strong>merging attribute streams</strong> by <strong>dropping attributes</strong> which are not needed.</p>
</blockquote>
<ol>
<li>For example, given series with attributes {“color”: “red”, “shape”: “square”}, {“color”: “blue”, “shape”: “square”}<ul>
<li>you can perform spatial re-aggregation by dropping the color attribute, and merging the series where the attributes are <strong>equal</strong> after dropping color.</li>
</ul>
</li>
<li>Most <strong>aggregations</strong> have a useful <strong>spatial aggregation merge function</strong> (i.e. <strong>sums</strong> are summed together)<ul>
<li>but <strong>gauges</strong> aggregated by the <strong>LastValue aggregation</strong> are the exception.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The <strong>instrument APIs</strong> have share a variety of features:</p>
</blockquote>
<ol>
<li>Created using the <strong>builder pattern</strong>.</li>
<li>Required <strong>instrument name</strong></li>
<li>Optional <strong>unit</strong> and <strong>description</strong>.</li>
<li>Record values which are <strong>long</strong> or <strong>double</strong>, which is <strong>configured</strong> via the <strong>builder</strong>.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[开始选择 Instrument] --&gt; B&#123;需要测量什么？&#125;</span><br><span class="line">    B --&gt; C[&quot;总量/累计值&lt;br&gt;(Counter)&quot;]</span><br><span class="line">    B --&gt; D[&quot;值的分布情况&lt;br&gt;(Histogram)&quot;]</span><br><span class="line">    B --&gt; E[&quot;最新瞬时值&lt;br&gt;(Gauge)&quot;]</span><br><span class="line">    </span><br><span class="line">    C --&gt; C1&#123;值是否单调递增？&#125;</span><br><span class="line">    C1 -- 是 --&gt; C2&#123;如何测量？&#125;</span><br><span class="line">    C1 -- 否&lt;br&gt;（可增可减） --&gt; C3&#123;如何测量？&#125;</span><br><span class="line">    </span><br><span class="line">    C2 -- 同步&lt;br&gt;（记录离散事件） --&gt; F[选择 Counter]</span><br><span class="line">    C2 -- 异步&lt;br&gt;（观察当前状态） --&gt; G[选择 Async Counter]</span><br><span class="line">    </span><br><span class="line">    C3 -- 同步&lt;br&gt;（记录离散事件） --&gt; H[选择 UpDownCounter]</span><br><span class="line">    C3 -- 异步&lt;br&gt;（观察当前状态） --&gt; I[选择 Async UpDownCounter]</span><br><span class="line">    </span><br><span class="line">    D --&gt; J[直接选择 Histogram]</span><br><span class="line">    </span><br><span class="line">    E --&gt; E1&#123;如何测量？&#125;</span><br><span class="line">    E1 -- 同步 --&gt; K[选择 Gauge]</span><br><span class="line">    E1 -- 异步 --&gt; L[选择 Async Gauge]</span><br></pre></td></tr></table></figure>

<h4 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h4><p><strong>LongCounter</strong> and <strong>DoubleCounter</strong> are used to <strong>record monotonic (positive) values</strong>.</p>
<blockquote>
<p>The following code snippet explores counter API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.customContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.LongCounter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">counterUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="comment">// Construct a counter to record measurements that are always positive (monotonically</span></span><br><span class="line">    <span class="comment">// increasing).</span></span><br><span class="line">    <span class="type">LongCounter</span> <span class="variable">counter</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .counterBuilder(<span class="string">&quot;fully.qualified.counter&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;A count of produced widgets&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;&#123;widget&#125;&quot;</span>)</span><br><span class="line">            <span class="comment">// optionally change the type to double</span></span><br><span class="line">            <span class="comment">// .ofDoubles()</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with no attributes or context.</span></span><br><span class="line">    <span class="comment">// Attributes defaults to Attributes.empty(), context to Context.current().</span></span><br><span class="line">    counter.add(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever possible.</span></span><br><span class="line">    counter.add(<span class="number">1L</span>, WIDGET_RED_CIRCLE);</span><br><span class="line">    <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">    counter.add(</span><br><span class="line">        <span class="number">1L</span>, Attributes.of(WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, and context.</span></span><br><span class="line">    <span class="comment">// Most users will opt to omit the context argument, preferring the default Context.current().</span></span><br><span class="line">    counter.add(<span class="number">1L</span>, WIDGET_RED_CIRCLE, customContext());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Async-Counter"><a href="#Async-Counter" class="headerlink" title="Async Counter"></a>Async Counter</h4><p><strong>ObservableLongCounter</strong> and <strong>ObservableDoubleCounter</strong> are used to <strong>observe monotonic (positive) sums</strong>.</p>
<blockquote>
<p>The following code snippet explores async counter API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.ObservableLongCounter;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncCounterUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Pre-allocate attributes whenever possible</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncCounterUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="type">AtomicLong</span> <span class="variable">widgetCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Construct an async counter to observe an existing counter in a callback</span></span><br><span class="line">    <span class="type">ObservableLongCounter</span> <span class="variable">asyncCounter</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .counterBuilder(<span class="string">&quot;fully.qualified.counter&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;A count of produced widgets&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;&#123;widget&#125;&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to double</span></span><br><span class="line">            <span class="comment">// .ofDoubles()</span></span><br><span class="line">            .buildWithCallback(</span><br><span class="line">                <span class="comment">// the callback is invoked when a MetricReader reads metrics</span></span><br><span class="line">                observableMeasurement -&gt; &#123;</span><br><span class="line">                  <span class="type">long</span> <span class="variable">currentWidgetCount</span> <span class="operator">=</span> widgetCount.get();</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with no attributes.</span></span><br><span class="line">                  <span class="comment">// Attributes defaults to Attributes.empty().</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount);</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever</span></span><br><span class="line">                  <span class="comment">// possible.</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount, WIDGET_RED_CIRCLE);</span><br><span class="line">                  <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">                  observableMeasurement.record(</span><br><span class="line">                      currentWidgetCount,</span><br><span class="line">                      Attributes.of(</span><br><span class="line">                          WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Optionally close the counter to unregister the callback when required</span></span><br><span class="line">    asyncCounter.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="UpDownCounter"><a href="#UpDownCounter" class="headerlink" title="UpDownCounter"></a>UpDownCounter</h4><p><strong>LongUpDownCounter</strong> and <strong>DoubleUpDownCounter</strong> are used to <strong>record non-monotonic (positive and negative) values</strong>.</p>
<blockquote>
<p>The following code snippet explores updowncounter API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.customContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.LongUpDownCounter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpDownCounterUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">usage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="comment">// Construct an updowncounter to record measurements that go up and down.</span></span><br><span class="line">    <span class="type">LongUpDownCounter</span> <span class="variable">upDownCounter</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .upDownCounterBuilder(<span class="string">&quot;fully.qualified.updowncounter&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;Current length of widget processing queue&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;&#123;widget&#125;&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to double</span></span><br><span class="line">            <span class="comment">// .ofDoubles()</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with no attributes or context.</span></span><br><span class="line">    <span class="comment">// Attributes defaults to Attributes.empty(), context to Context.current().</span></span><br><span class="line">    upDownCounter.add(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever possible.</span></span><br><span class="line">    upDownCounter.add(-<span class="number">1L</span>, WIDGET_RED_CIRCLE);</span><br><span class="line">    <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">    upDownCounter.add(</span><br><span class="line">        -<span class="number">1L</span>, Attributes.of(WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, and context.</span></span><br><span class="line">    <span class="comment">// Most users will opt to omit the context argument, preferring the default Context.current().</span></span><br><span class="line">    upDownCounter.add(<span class="number">1L</span>, WIDGET_RED_CIRCLE, customContext());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Async-UpDownCounter"><a href="#Async-UpDownCounter" class="headerlink" title="Async UpDownCounter"></a>Async UpDownCounter</h4><p><strong>ObservableLongUpDownCounter</strong> and <strong>ObservableDoubleUpDownCounter</strong> are used to <strong>observe non-monotonic (positive and negative) sums</strong>.</p>
<blockquote>
<p>The following code snippet explores async updowncounter API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.ObservableLongUpDownCounter;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncUpDownCounterUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncUpDownCounterUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="type">AtomicLong</span> <span class="variable">queueLength</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Construct an async updowncounter to observe an existing up down counter in a callback</span></span><br><span class="line">    <span class="type">ObservableLongUpDownCounter</span> <span class="variable">asyncUpDownCounter</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .upDownCounterBuilder(<span class="string">&quot;fully.qualified.updowncounter&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;Current length of widget processing queue&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;&#123;widget&#125;&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to double</span></span><br><span class="line">            <span class="comment">// .ofDoubles()</span></span><br><span class="line">            .buildWithCallback(</span><br><span class="line">                <span class="comment">// the callback is invoked when a MetricReader reads metrics</span></span><br><span class="line">                observableMeasurement -&gt; &#123;</span><br><span class="line">                  <span class="type">long</span> <span class="variable">currentWidgetCount</span> <span class="operator">=</span> queueLength.get();</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with no attributes.</span></span><br><span class="line">                  <span class="comment">// Attributes defaults to Attributes.empty().</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount);</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever</span></span><br><span class="line">                  <span class="comment">// possible.</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount, WIDGET_RED_CIRCLE);</span><br><span class="line">                  <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">                  observableMeasurement.record(</span><br><span class="line">                      currentWidgetCount,</span><br><span class="line">                      Attributes.of(</span><br><span class="line">                          WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Optionally close the counter to unregister the callback when required</span></span><br><span class="line">    asyncUpDownCounter.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Histogram"><a href="#Histogram" class="headerlink" title="Histogram"></a>Histogram</h4><p><strong>DoubleHistogram</strong> and <strong>LongHistogram</strong> are used to <strong>record monotonic (positive) values</strong> where the <strong>distribution</strong> is important.</p>
<blockquote>
<p>The following code snippet explores histogram API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.customContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.DoubleHistogram;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HistogramUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">histogramUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="comment">// Construct a histogram to record measurements where the distribution is important.</span></span><br><span class="line">    <span class="type">DoubleHistogram</span> <span class="variable">histogram</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .histogramBuilder(<span class="string">&quot;fully.qualified.histogram&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;Length of time to process a widget&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;s&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally provide advice on useful default explicit bucket boundaries</span></span><br><span class="line">            <span class="comment">// .setExplicitBucketBoundariesAdvice(Arrays.asList(1.0, 2.0, 3.0))</span></span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to long</span></span><br><span class="line">            <span class="comment">// .ofLongs()</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with no attributes or context.</span></span><br><span class="line">    <span class="comment">// Attributes defaults to Attributes.empty(), context to Context.current().</span></span><br><span class="line">    histogram.record(<span class="number">1.1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever possible.</span></span><br><span class="line">    histogram.record(<span class="number">2.2</span>, WIDGET_RED_CIRCLE);</span><br><span class="line">    <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">    histogram.record(</span><br><span class="line">        <span class="number">3.2</span>, Attributes.of(WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, and context.</span></span><br><span class="line">    <span class="comment">// Most users will opt to omit the context argument, preferring the default Context.current().</span></span><br><span class="line">    histogram.record(<span class="number">4.4</span>, WIDGET_RED_CIRCLE, customContext());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Gauge"><a href="#Gauge" class="headerlink" title="Gauge"></a>Gauge</h4><p><strong>DoubleGauge</strong> and <strong>LongGauge</strong> are used to <strong>record the latest value</strong> where <strong>spatial re-aggregation</strong> does <strong>not make sense</strong>.</p>
<blockquote>
<p>The following code snippet explores gauge API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.customContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.DoubleGauge;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GaugeUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">gaugeUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    <span class="comment">// Construct a gauge to record measurements as they occur, which cannot be spatially</span></span><br><span class="line">    <span class="comment">// re-aggregated.</span></span><br><span class="line">    <span class="type">DoubleGauge</span> <span class="variable">gauge</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .gaugeBuilder(<span class="string">&quot;fully.qualified.gauge&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;The current temperature of the widget processing line&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;K&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to long</span></span><br><span class="line">            <span class="comment">// .ofLongs()</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with no attributes or context.</span></span><br><span class="line">    <span class="comment">// Attributes defaults to Attributes.empty(), context to Context.current().</span></span><br><span class="line">    gauge.set(<span class="number">273.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever possible.</span></span><br><span class="line">    gauge.set(<span class="number">273.0</span>, WIDGET_RED_CIRCLE);</span><br><span class="line">    <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">    gauge.set(</span><br><span class="line">        <span class="number">273.0</span>,</span><br><span class="line">        Attributes.of(WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Record a measurement with attributes, and context.</span></span><br><span class="line">    <span class="comment">// Most users will opt to omit the context argument, preferring the default Context.current().</span></span><br><span class="line">    gauge.set(<span class="number">1L</span>, WIDGET_RED_CIRCLE, customContext());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Async-Gauge"><a href="#Async-Gauge" class="headerlink" title="Async Gauge"></a>Async Gauge</h4><p><strong>ObservableDoubleGauge</strong> and <strong>ObservableLongGauge</strong> are used to <strong>observe the latest value</strong> where <strong>spatial re-aggregation</strong> does not make sense.</p>
<blockquote>
<p>The following code snippet explores async gauge API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetColor;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.computeWidgetShape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.ObservableDoubleGauge;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncGaugeUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncGaugeUsage</span><span class="params">(Meter meter)</span> &#123;</span><br><span class="line">    AtomicReference&lt;Double&gt; processingLineTemp = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;(<span class="number">273.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Construct an async gauge to observe an existing gauge in a callback</span></span><br><span class="line">    <span class="type">ObservableDoubleGauge</span> <span class="variable">asyncGauge</span> <span class="operator">=</span></span><br><span class="line">        meter</span><br><span class="line">            .gaugeBuilder(<span class="string">&quot;fully.qualified.gauge&quot;</span>)</span><br><span class="line">            .setDescription(<span class="string">&quot;The current temperature of the widget processing line&quot;</span>)</span><br><span class="line">            .setUnit(<span class="string">&quot;K&quot;</span>)</span><br><span class="line">            <span class="comment">// Uncomment to optionally change the type to long</span></span><br><span class="line">            <span class="comment">// .ofLongs()</span></span><br><span class="line">            .buildWithCallback(</span><br><span class="line">                <span class="comment">// the callback is invoked when a MetricReader reads metrics</span></span><br><span class="line">                observableMeasurement -&gt; &#123;</span><br><span class="line">                  <span class="type">double</span> <span class="variable">currentWidgetCount</span> <span class="operator">=</span> processingLineTemp.get();</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with no attributes.</span></span><br><span class="line">                  <span class="comment">// Attributes defaults to Attributes.empty().</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount);</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// Record a measurement with attributes, using pre-allocated attributes whenever</span></span><br><span class="line">                  <span class="comment">// possible.</span></span><br><span class="line">                  observableMeasurement.record(currentWidgetCount, WIDGET_RED_CIRCLE);</span><br><span class="line">                  <span class="comment">// Sometimes, attributes must be computed using application context.</span></span><br><span class="line">                  observableMeasurement.record(</span><br><span class="line">                      currentWidgetCount,</span><br><span class="line">                      Attributes.of(</span><br><span class="line">                          WIDGET_SHAPE, computeWidgetShape(), WIDGET_COLOR, computeWidgetColor()));</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Optionally close the gauge to unregister the callback when required</span></span><br><span class="line">    asyncGauge.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LoggerProvider"><a href="#LoggerProvider" class="headerlink" title="LoggerProvider"></a>LoggerProvider</h3><ol>
<li><strong>LoggerProvider</strong> is the <strong>API entry point</strong> for <strong>logs</strong> and <strong>provides Loggers</strong>.</li>
<li>While the <strong>LoggerProvider</strong> &#x2F; <strong>Logger</strong> APIs are <strong>structurally similar</strong> to the equivalent <strong>trace</strong> and <strong>metric</strong> APIs, they serve a <strong>different use case</strong>.<ul>
<li>As of now, LoggerProvider &#x2F; Logger and associated classes represent the <strong>Log Bridge API</strong></li>
<li>which exists to <strong>write log appenders</strong> to bridge <strong>logs recorded</strong> through <strong>other log APIs &#x2F; frameworks</strong> into <strong>OpenTelemetry</strong>.</li>
</ul>
</li>
<li>They are not intended for <strong>end user</strong> use as a <strong>replacement</strong> for <strong>Log4j</strong> &#x2F; <strong>SLF4J</strong> &#x2F; <strong>Logback</strong> &#x2F; etc.</li>
</ol>
<h4 id="Logger"><a href="#Logger" class="headerlink" title="Logger"></a>Logger</h4><p>Logger is used to <strong>emit log records</strong> for an <strong>instrumentation scope</strong>.</p>
<h4 id="LogRecordBuilder"><a href="#LogRecordBuilder" class="headerlink" title="LogRecordBuilder"></a>LogRecordBuilder</h4><p>LogRecordBuilder is used to <strong>construct</strong> and <strong>emit log records</strong>.</p>
<blockquote>
<p>The following code snippet explores <strong>LogRecordBuilder API</strong> usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.AttributeKey;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Value;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.Logger;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.Severity;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogRecordUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logRecordUsage</span><span class="params">(Logger logger)</span> &#123;</span><br><span class="line">    logger</span><br><span class="line">        .logRecordBuilder()</span><br><span class="line">        <span class="comment">// Set body. Note, setBody(..) is called multiple times for demonstration purposes but only</span></span><br><span class="line">        <span class="comment">// the last call is used.</span></span><br><span class="line">        <span class="comment">// Set the body to a string, syntactic sugar for setBody(Value.of(&quot;log message&quot;))</span></span><br><span class="line">        .setBody(<span class="string">&quot;log message&quot;</span>)</span><br><span class="line">        <span class="comment">// Optionally set the body to a Value to record arbitrarily complex structured data</span></span><br><span class="line">        .setBody(Value.of(<span class="string">&quot;log message&quot;</span>))</span><br><span class="line">        .setBody(Value.of(<span class="number">1L</span>))</span><br><span class="line">        .setBody(Value.of(<span class="number">1.1</span>))</span><br><span class="line">        .setBody(Value.of(<span class="literal">true</span>))</span><br><span class="line">        .setBody(Value.of(<span class="keyword">new</span> <span class="title class_">byte</span>[] &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;))</span><br><span class="line">        .setBody(Value.of(Value.of(<span class="string">&quot;entry1&quot;</span>), Value.of(<span class="string">&quot;entry2&quot;</span>)))</span><br><span class="line">        .setBody(</span><br><span class="line">            Value.of(</span><br><span class="line">                Map.of(</span><br><span class="line">                    <span class="string">&quot;stringKey&quot;</span>,</span><br><span class="line">                    Value.of(<span class="string">&quot;entry1&quot;</span>),</span><br><span class="line">                    <span class="string">&quot;mapKey&quot;</span>,</span><br><span class="line">                    Value.of(Map.of(<span class="string">&quot;stringKey&quot;</span>, Value.of(<span class="string">&quot;entry2&quot;</span>))))))</span><br><span class="line">        <span class="comment">// Set severity</span></span><br><span class="line">        .setSeverity(Severity.DEBUG)</span><br><span class="line">        .setSeverityText(<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">        <span class="comment">// Set timestamp</span></span><br><span class="line">        .setTimestamp(System.currentTimeMillis(), TimeUnit.MILLISECONDS)</span><br><span class="line">        <span class="comment">// Optionally set the timestamp when the log was observed</span></span><br><span class="line">        .setObservedTimestamp(System.currentTimeMillis(), TimeUnit.MILLISECONDS)</span><br><span class="line">        <span class="comment">// Set attributes</span></span><br><span class="line">        .setAttribute(AttributeKey.stringKey(<span class="string">&quot;com.acme.string-key&quot;</span>), <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setAttribute(AttributeKey.booleanKey(<span class="string">&quot;com.acme.bool-key&quot;</span>), <span class="literal">true</span>)</span><br><span class="line">        .setAttribute(AttributeKey.longKey(<span class="string">&quot;com.acme.long-key&quot;</span>), <span class="number">1L</span>)</span><br><span class="line">        .setAttribute(AttributeKey.doubleKey(<span class="string">&quot;com.acme.double-key&quot;</span>), <span class="number">1.1</span>)</span><br><span class="line">        .setAttribute(</span><br><span class="line">            AttributeKey.stringArrayKey(<span class="string">&quot;com.acme.string-array-key&quot;</span>),</span><br><span class="line">            Arrays.asList(<span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span>))</span><br><span class="line">        .setAttribute(</span><br><span class="line">            AttributeKey.booleanArrayKey(<span class="string">&quot;come.acme.bool-array-key&quot;</span>), Arrays.asList(<span class="literal">true</span>, <span class="literal">false</span>))</span><br><span class="line">        .setAttribute(AttributeKey.longArrayKey(<span class="string">&quot;come.acme.long-array-key&quot;</span>), Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>))</span><br><span class="line">        .setAttribute(</span><br><span class="line">            AttributeKey.doubleArrayKey(<span class="string">&quot;come.acme.double-array-key&quot;</span>), Arrays.asList(<span class="number">1.1</span>, <span class="number">2.2</span>))</span><br><span class="line">        .setAllAttributes(WIDGET_RED_CIRCLE)</span><br><span class="line">        <span class="comment">// Uncomment to optionally explicitly set the context used to correlate with spans. If</span></span><br><span class="line">        <span class="comment">// omitted, Context.current() is used.</span></span><br><span class="line">        <span class="comment">// .setContext(context)</span></span><br><span class="line">        <span class="comment">// Emit the log record</span></span><br><span class="line">        .emit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Noop-implementation"><a href="#Noop-implementation" class="headerlink" title="Noop implementation"></a>Noop implementation</h3><ol>
<li>The <strong>OpenTelemetry#noop()</strong> method provides access to a <strong>noop implementation</strong> of OpenTelemetry. and <strong>all API components</strong> it provides access to.</li>
<li>As the name suggests, the noop implementation <strong>does nothing</strong> and is designed to <strong>have no impact on performance</strong>.</li>
<li><strong>Instrumentation</strong> may see <strong>impact</strong> on <strong>performance</strong> even when the <strong>noop</strong> is used<ul>
<li>if it is <strong>computing &#x2F; allocating attribute values</strong> and other data required to <strong>record</strong> the telemetry.</li>
</ul>
</li>
<li>The <strong>noop</strong> is a <strong>useful default instance</strong> of OpenTelemetry when a user <strong>has not configured and installed a concrete implementation</strong> such as the <strong>SDK</strong>.</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>OpenTelemetry#noop()</strong> API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_COLOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_RED_CIRCLE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> otel.Util.WIDGET_SHAPE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.Logger;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.logs.Severity;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.DoubleGauge;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.DoubleHistogram;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.LongCounter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.LongUpDownCounter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.StatusCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoopUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SCOPE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fully.qualified.name&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">noopUsage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Access the noop OpenTelemetry instance</span></span><br><span class="line">    <span class="type">OpenTelemetry</span> <span class="variable">noopOpenTelemetry</span> <span class="operator">=</span> OpenTelemetry.noop();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Noop tracing</span></span><br><span class="line">    <span class="type">Tracer</span> <span class="variable">noopTracer</span> <span class="operator">=</span> OpenTelemetry.noop().getTracer(SCOPE_NAME);</span><br><span class="line">    noopTracer</span><br><span class="line">        .spanBuilder(<span class="string">&quot;span name&quot;</span>)</span><br><span class="line">        .startSpan()</span><br><span class="line">        .setAttribute(WIDGET_SHAPE, <span class="string">&quot;square&quot;</span>)</span><br><span class="line">        .setStatus(StatusCode.OK)</span><br><span class="line">        .addEvent(<span class="string">&quot;event-name&quot;</span>, Attributes.builder().put(WIDGET_COLOR, <span class="string">&quot;red&quot;</span>).build())</span><br><span class="line">        .end();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Noop metrics</span></span><br><span class="line">    <span class="type">Attributes</span> <span class="variable">attributes</span> <span class="operator">=</span> WIDGET_RED_CIRCLE;</span><br><span class="line">    <span class="type">Meter</span> <span class="variable">noopMeter</span> <span class="operator">=</span> OpenTelemetry.noop().getMeter(SCOPE_NAME);</span><br><span class="line">    <span class="type">DoubleHistogram</span> <span class="variable">histogram</span> <span class="operator">=</span> noopMeter.histogramBuilder(<span class="string">&quot;fully.qualified.histogram&quot;</span>).build();</span><br><span class="line">    histogram.record(<span class="number">1.0</span>, attributes);</span><br><span class="line">    <span class="comment">// counter</span></span><br><span class="line">    <span class="type">LongCounter</span> <span class="variable">counter</span> <span class="operator">=</span> noopMeter.counterBuilder(<span class="string">&quot;fully.qualified.counter&quot;</span>).build();</span><br><span class="line">    counter.add(<span class="number">1</span>, attributes);</span><br><span class="line">    <span class="comment">// async counter</span></span><br><span class="line">    noopMeter</span><br><span class="line">        .counterBuilder(<span class="string">&quot;fully.qualified.counter&quot;</span>)</span><br><span class="line">        .buildWithCallback(observable -&gt; observable.record(<span class="number">10</span>, attributes));</span><br><span class="line">    <span class="comment">// updowncounter</span></span><br><span class="line">    <span class="type">LongUpDownCounter</span> <span class="variable">upDownCounter</span> <span class="operator">=</span></span><br><span class="line">        noopMeter.upDownCounterBuilder(<span class="string">&quot;fully.qualified.updowncounter&quot;</span>).build();</span><br><span class="line">    <span class="comment">// async updowncounter</span></span><br><span class="line">    noopMeter</span><br><span class="line">        .upDownCounterBuilder(<span class="string">&quot;fully.qualified.updowncounter&quot;</span>)</span><br><span class="line">        .buildWithCallback(observable -&gt; observable.record(<span class="number">10</span>, attributes));</span><br><span class="line">    upDownCounter.add(-<span class="number">1</span>, attributes);</span><br><span class="line">    <span class="comment">// gauge</span></span><br><span class="line">    <span class="type">DoubleGauge</span> <span class="variable">gauge</span> <span class="operator">=</span> noopMeter.gaugeBuilder(<span class="string">&quot;fully.qualified.gauge&quot;</span>).build();</span><br><span class="line">    gauge.set(<span class="number">1.1</span>, attributes);</span><br><span class="line">    <span class="comment">// async gauge</span></span><br><span class="line">    noopMeter</span><br><span class="line">        .gaugeBuilder(<span class="string">&quot;fully.qualified.gauge&quot;</span>)</span><br><span class="line">        .buildWithCallback(observable -&gt; observable.record(<span class="number">10</span>, attributes));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Noop logs</span></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">noopLogger</span> <span class="operator">=</span> OpenTelemetry.noop().getLogsBridge().get(SCOPE_NAME);</span><br><span class="line">    noopLogger</span><br><span class="line">        .logRecordBuilder()</span><br><span class="line">        .setBody(<span class="string">&quot;log message&quot;</span>)</span><br><span class="line">        .setAttribute(WIDGET_SHAPE, <span class="string">&quot;square&quot;</span>)</span><br><span class="line">        .setSeverity(Severity.INFO)</span><br><span class="line">        .emit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Semantic-attributes"><a href="#Semantic-attributes" class="headerlink" title="Semantic attributes"></a>Semantic attributes</h3><ol>
<li>The <strong>semantic conventions</strong> describe how to <strong>collect telemetry</strong> in a <strong>standardized way</strong> for <strong>common operations</strong>.</li>
<li>This includes an <strong>attribute registry</strong>, which enumerates definitions for all attributes referenced in the <strong>conventions</strong>, organized by <strong>domain</strong>.</li>
<li>The <strong>semantic-conventions-java</strong> project <strong>generates constants</strong> from the <strong>semantic conventions</strong>, which can be used to <strong>help instrumentation conform</strong>:</li>
</ol>
<table>
<thead>
<tr>
<th>Description</th>
<th>Artifact</th>
</tr>
</thead>
<tbody><tr>
<td>Generated code for <strong>stable semantic conventions</strong></td>
<td>io.opentelemetry.semconv:opentelemetry-semconv:1.37.0-alpha</td>
</tr>
<tr>
<td>Generated code for <strong>incubating semantic conventions</strong></td>
<td>io.opentelemetry.semconv:opentelemetry-semconv-incubating:1.37.0-alpha</td>
</tr>
</tbody></table>
<ol>
<li>While both <strong>opentelemetry-semconv</strong> and <strong>opentelemetry-semconv-incubating</strong> include the <strong>-alpha</strong> suffix and are subject to <strong>breaking changes</strong><ul>
<li>the intent is to <strong>stabilize opentelemetry-semconv</strong> and <strong>leave</strong> the <strong>-alpha</strong> suffix on <strong>opentelemetry-semconv-incubating</strong> permanently.</li>
</ul>
</li>
<li><strong>Libraries</strong> can use <strong>opentelemetry-semconv-incubating</strong> for <strong>testing</strong>, but should <strong>not</strong> include it as a <strong>dependency</strong><ul>
<li>since <strong>attributes</strong> may come and go <strong>from version to version</strong></li>
<li>including it as a <strong>dependency</strong> may expose end users to <strong>runtime errors</strong> when <strong>transitive version conflicts occur</strong>.</li>
</ul>
</li>
<li>The attribute constants generated from <strong>semantic conventions</strong> are instances of <code>AttributeKey&lt;T&gt;</code><ul>
<li>and can be used <strong>anywhere</strong> the <strong>OpenTelemetry API</strong> accepts attributes.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet explores semantic convention attribute API usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.semconv.HttpAttributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.semconv.ServerAttributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.semconv.incubating.HttpIncubatingAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemanticAttributesUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">semanticAttributesUsage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Semantic attributes are organized by top-level domain and whether they are stable or</span></span><br><span class="line">    <span class="comment">// incubating.</span></span><br><span class="line">    <span class="comment">// For example:</span></span><br><span class="line">    <span class="comment">// - stable attributes starting with http.* are in the HttpAttributes class.</span></span><br><span class="line">    <span class="comment">// - stable attributes starting with server.* are in the ServerAttributes class.</span></span><br><span class="line">    <span class="comment">// - incubating attributes starting with http.* are in the HttpIncubatingAttributes class.</span></span><br><span class="line">    <span class="comment">// Attribute keys which define an enumeration of values are accessible in an inner</span></span><br><span class="line">    <span class="comment">// &#123;AttributeKey&#125;Values class.</span></span><br><span class="line">    <span class="comment">// For example, the enumeration of http.request.method values is available in the</span></span><br><span class="line">    <span class="comment">// HttpAttributes.HttpRequestMethodValues class.</span></span><br><span class="line">    <span class="type">Attributes</span> <span class="variable">attributes</span> <span class="operator">=</span></span><br><span class="line">        Attributes.builder()</span><br><span class="line">            .put(HttpAttributes.HTTP_REQUEST_METHOD, HttpAttributes.HttpRequestMethodValues.GET)</span><br><span class="line">            .put(HttpAttributes.HTTP_ROUTE, <span class="string">&quot;/users/:id&quot;</span>)</span><br><span class="line">            .put(ServerAttributes.SERVER_ADDRESS, <span class="string">&quot;example&quot;</span>)</span><br><span class="line">            .put(ServerAttributes.SERVER_PORT, <span class="number">8080L</span>)</span><br><span class="line">            .put(HttpIncubatingAttributes.HTTP_RESPONSE_BODY_SIZE, <span class="number">1024</span>)</span><br><span class="line">            .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Baggage"><a href="#Baggage" class="headerlink" title="Baggage"></a>Baggage</h3><ol>
<li>Baggage is a bundle of <strong>application defined key-value pairs</strong> associated with a <strong>distributed request</strong> or <strong>workflow execution</strong>.</li>
<li>Baggage <strong>keys</strong> and <strong>values</strong> are <strong>strings</strong>, and <strong>values</strong> have <strong>optional string metadata</strong>.</li>
<li><strong>Telemetry</strong> can be <strong>enriched</strong> with data from <strong>baggage</strong> by <strong>configuring</strong> the <strong>SDK</strong> to <strong>add entries as attributes</strong> to <strong>spans</strong>, <strong>metrics</strong>, and <strong>log records</strong>.</li>
<li>The <strong>baggage API</strong> is built on <strong>top</strong> of <strong>context</strong>, which allows <strong>span context</strong> to be <strong>implicitly passed</strong> around an <strong>application</strong> and across <strong>threads</strong>.</li>
<li>Most of the <strong>context API</strong> usage guidance applies to <strong>baggage</strong>.</li>
<li><strong>Baggage</strong> is <strong>propagated</strong> across <strong>application boundaries</strong> with the <strong>W3CBaggagePropagator</strong>.</li>
</ol>
<blockquote>
<p>The following code snippet explores <strong>Baggage API</strong> usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> io.opentelemetry.context.Context.current;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.Baggage;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.BaggageEntry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.BaggageEntryMetadata;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Scope;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaggageUsage</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Attributes</span> <span class="variable">WIDGET_RED_CIRCLE</span> <span class="operator">=</span> Util.WIDGET_RED_CIRCLE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">baggageUsage</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Access current baggage with Baggage.current()</span></span><br><span class="line">    <span class="comment">// output =&gt; context baggage: &#123;&#125;</span></span><br><span class="line">    <span class="type">Baggage</span> <span class="variable">currentBaggage</span> <span class="operator">=</span> Baggage.current();</span><br><span class="line">    System.out.println(<span class="string">&quot;current baggage: &quot;</span> + asString(currentBaggage));</span><br><span class="line">    <span class="comment">// ...or from a Context</span></span><br><span class="line">    currentBaggage = Baggage.fromContext(current());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Baggage has a variety of methods for manipulating and reading data.</span></span><br><span class="line">    <span class="comment">// Convert to builder and add entries:</span></span><br><span class="line">    <span class="type">Baggage</span> <span class="variable">newBaggage</span> <span class="operator">=</span></span><br><span class="line">        Baggage.current().toBuilder()</span><br><span class="line">            .put(<span class="string">&quot;shopId&quot;</span>, <span class="string">&quot;abc123&quot;</span>)</span><br><span class="line">            .put(<span class="string">&quot;shopName&quot;</span>, <span class="string">&quot;opentelemetry-demo&quot;</span>, BaggageEntryMetadata.create(<span class="string">&quot;metadata&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">// ...or uncomment to start from empty</span></span><br><span class="line">    <span class="comment">// newBaggage = Baggage.empty().toBuilder().put(&quot;shopId&quot;, &quot;abc123&quot;).build();</span></span><br><span class="line">    <span class="comment">// output =&gt; new baggage: &#123;shopId=abc123(), shopName=opentelemetry-demo(metadata)&#125;</span></span><br><span class="line">    System.out.println(<span class="string">&quot;new baggage: &quot;</span> + asString(newBaggage));</span><br><span class="line">    <span class="comment">// Read an entry:</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopIdValue</span> <span class="operator">=</span> newBaggage.getEntryValue(<span class="string">&quot;shopId&quot;</span>);</span><br><span class="line">    <span class="comment">// Inspect size:</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> newBaggage.size();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isEmpty</span> <span class="operator">=</span> newBaggage.isEmpty();</span><br><span class="line">    <span class="comment">// Convert to map representation:</span></span><br><span class="line">    Map&lt;String, BaggageEntry&gt; map = newBaggage.asMap();</span><br><span class="line">    <span class="comment">// Iterate through entries:</span></span><br><span class="line">    newBaggage.forEach((s, baggageEntry) -&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The current baggage still doesn&#x27;t contain the new entries</span></span><br><span class="line">    <span class="comment">// output =&gt; context baggage: &#123;&#125;</span></span><br><span class="line">    System.out.println(<span class="string">&quot;current baggage: &quot;</span> + asString(Baggage.current()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Calling Baggage.makeCurrent() sets Baggage.current() to the baggage until the scope is</span></span><br><span class="line">    <span class="comment">// closed, upon which Baggage.current() is restored to the state prior to when</span></span><br><span class="line">    <span class="comment">// Baggage.makeCurrent() was called.</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> newBaggage.makeCurrent()) &#123;</span><br><span class="line">      <span class="comment">// The current baggage now contains the added value</span></span><br><span class="line">      <span class="comment">// output =&gt; context baggage: &#123;shopId=abc123(), shopName=opentelemetry-demo(metadata)&#125;</span></span><br><span class="line">      System.out.println(<span class="string">&quot;current baggage: &quot;</span> + asString(Baggage.current()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The current baggage no longer contains the new entries:</span></span><br><span class="line">    <span class="comment">// output =&gt; context baggage: &#123;&#125;</span></span><br><span class="line">    System.out.println(<span class="string">&quot;current baggage: &quot;</span> + asString(Baggage.current()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">asString</span><span class="params">(Baggage baggage)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> baggage.asMap().entrySet().stream()</span><br><span class="line">        .map(</span><br><span class="line">            entry -&gt;</span><br><span class="line">                String.format(</span><br><span class="line">                    <span class="string">&quot;%s=%s(%s)&quot;</span>,</span><br><span class="line">                    entry.getKey(),</span><br><span class="line">                    entry.getValue().getValue(),</span><br><span class="line">                    entry.getValue().getMetadata().getValue()))</span><br><span class="line">        .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;&#125;&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Incubating-API"><a href="#Incubating-API" class="headerlink" title="Incubating API"></a>Incubating API</h2><ol>
<li>The <strong>io.opentelemetry:opentelemetry-api-incubator:1.54.1-alpha</strong> artifact contains <strong>experimental</strong> trace, metric, log, and context APIs which.</li>
<li>Incubating APIs may have <strong>breaking API changes</strong> in <strong>minor releases</strong>.</li>
<li>Often, these represent <strong>experimental specification features or API designs</strong> we want to vet with <strong>user feedback</strong> before <strong>committing</strong> to.</li>
<li><strong>Libraries</strong> should <strong>not depend on</strong> the <strong>incubating APIs</strong>, since users may be <strong>exposed</strong> to <strong>runtime errors</strong> when <strong>transitive version conflicts</strong> occur.</li>
</ol>
<h1 id="Manage-Telemetry-with-SDK"><a href="#Manage-Telemetry-with-SDK" class="headerlink" title="Manage Telemetry with SDK"></a>Manage Telemetry with SDK</h1><ol>
<li>The <strong>SDK</strong> is the <strong>built-in reference implementation</strong> of the <strong>API</strong>, <strong>processing</strong> and <strong>exporting</strong> telemetry produced by <strong>instrumentation API calls</strong>.</li>
<li>The SDK consists of the following <strong>top level components</strong>:</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>SdkTracerProvider</td>
<td>The <strong>SDK implementation</strong> of <strong>TracerProvider</strong>, including tools for <strong>sampling, processing, and exporting spans</strong>.</td>
</tr>
<tr>
<td>SdkMeterProvider</td>
<td>The <strong>SDK implementation</strong> of <strong>MeterProvider</strong>, including tools for <strong>configuring metric streams</strong> and <strong>reading &#x2F; exporting metrics</strong>.</td>
</tr>
<tr>
<td>SdkLoggerProvider</td>
<td>The <strong>SDK implementation</strong> of <strong>LoggerProvider</strong>, including tools for <strong>processing and exporting logs</strong>.</td>
</tr>
<tr>
<td>TextMapPropagator</td>
<td><strong>Propagates context</strong> across <strong>process boundaries</strong>.</td>
</tr>
</tbody></table>
<ol>
<li>These are <strong>combined</strong> into <strong>OpenTelemetrySdk</strong><ul>
<li>a <strong>carrier</strong> object which makes it convenient to pass <strong>fully-configured SDK components</strong> to <strong>instrumentation</strong>.</li>
</ul>
</li>
<li>The SDK comes <strong>packaged</strong> with a variety of <strong>built-in components</strong> which are <strong>sufficient</strong> for <strong>many use cases</strong><ul>
<li>and supports <strong>plugin interfaces</strong> for <strong>extensibility</strong>.</li>
</ul>
</li>
</ol>
<h2 id="SDK-plugin-extension-interfaces"><a href="#SDK-plugin-extension-interfaces" class="headerlink" title="SDK plugin extension interfaces"></a>SDK plugin extension interfaces</h2><blockquote>
<p>When <strong>built-in components</strong> are <strong>insufficient</strong>, the <strong>SDK</strong> can be <strong>extended</strong> by <strong>implementing various plugin extension interfaces</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Plugin interfaces</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Sampler</td>
<td>Configures which <strong>spans</strong> are <strong>recorded</strong> and <strong>sampled</strong>.</td>
</tr>
<tr>
<td>SpanProcessor</td>
<td>Processes spans when they <strong>start</strong> and <strong>end</strong>.</td>
</tr>
<tr>
<td>SpanExporter</td>
<td>Exports spans out of process.</td>
</tr>
<tr>
<td>MetricReader</td>
<td>Reads aggregated metrics.</td>
</tr>
<tr>
<td>MetricExporter</td>
<td>Exports metrics out of process.</td>
</tr>
<tr>
<td>LogRecordProcessor</td>
<td>Processes log records when they are <strong>emitted</strong>.</td>
</tr>
<tr>
<td>LogRecordExporter</td>
<td>Exports log records out of process.</td>
</tr>
<tr>
<td>TextMapPropagator</td>
<td><strong>Propagates context</strong> across process boundaries.</td>
</tr>
</tbody></table>
<h2 id="SDK-components"><a href="#SDK-components" class="headerlink" title="SDK components"></a>SDK components</h2><ol>
<li>The <strong>io.opentelemetry:opentelemetry-sdk:1.54.1</strong> artifact contains the <strong>OpenTelemetry SDK</strong>.</li>
<li>The following sections describe the <strong>core user-facing components</strong> of the SDK. Each component section includes:<ul>
<li>A brief description, including a link to the Javadoc type reference.</li>
<li>If the <strong>component</strong> is a <strong>plugin extension interface</strong>, a table of available <strong>built-in</strong> and <strong>opentelemetry-java-contrib</strong> implementations.</li>
<li>A simple demonstration of <strong>programmatic-configuration</strong>.</li>
<li>If the <strong>component</strong> is a <strong>plugin extension interface</strong>, a simple demonstration of a <strong>custom implementation</strong>.</li>
</ul>
</li>
</ol>
<h3 id="OpenTelemetrySdk"><a href="#OpenTelemetrySdk" class="headerlink" title="OpenTelemetrySdk"></a>OpenTelemetrySdk</h3><ol>
<li>OpenTelemetrySdk is the <strong>SDK implementation</strong> of <strong>OpenTelemetry</strong>.</li>
<li>It is a <strong>holder</strong> for <strong>top-level SDK components</strong> which makes it convenient to pass <strong>fully-configured SDK components</strong> to <strong>instrumentation</strong>.</li>
<li>OpenTelemetrySdk is <strong>configured</strong> by the <strong>application owner</strong>, and consists of:</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>SdkTracerProvider</td>
<td>The SDK implementation of <strong>TracerProvider</strong></td>
</tr>
<tr>
<td>SdkMeterProvider</td>
<td>The SDK implementation of <strong>MeterProvider</strong></td>
</tr>
<tr>
<td>SdkLoggerProvider</td>
<td>The SDK implementation of <strong>LoggerProvider</strong></td>
</tr>
<tr>
<td>ContextPropagators</td>
<td><strong>Propagates context</strong> across process boundaries</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>OpenTelemetrySdk programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.OpenTelemetrySdk;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpenTelemetrySdkConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> OpenTelemetrySdk <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> ResourceConfig.create();</span><br><span class="line">    <span class="keyword">return</span> OpenTelemetrySdk.builder()</span><br><span class="line">        .setTracerProvider(SdkTracerProviderConfig.create(resource))</span><br><span class="line">        .setMeterProvider(SdkMeterProviderConfig.create(resource))</span><br><span class="line">        .setLoggerProvider(SdkLoggerProviderConfig.create(resource))</span><br><span class="line">        .setPropagators(ContextPropagatorsConfig.create())</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h3><ol>
<li>Resource is a set of <strong>attributes</strong> defining the <strong>telemetry source</strong>.</li>
<li><strong>An application</strong> should associate the <strong>same resource</strong> with <strong>SdkTracerProvider</strong>, <strong>SdkMeterProvider</strong>, <strong>SdkLoggerProvider</strong>.</li>
<li><strong>ResourceProviders</strong> contribute <strong>contextual information</strong> to the <strong>autoconfigured resource</strong> based on the <strong>environment</strong>.</li>
</ol>
<blockquote>
<p>The following code snippet demonstrates <strong>Resource programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.semconv.ServiceAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceConfig</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Resource <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Resource.getDefault().toBuilder()</span><br><span class="line">        .put(ServiceAttributes.SERVICE_NAME, <span class="string">&quot;my-service&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SdkTracerProvider"><a href="#SdkTracerProvider" class="headerlink" title="SdkTracerProvider"></a>SdkTracerProvider</h3><ol>
<li>SdkTracerProvider is the <strong>SDK implementation</strong> of <strong>TracerProvider</strong>, and is responsible for <strong>handling trace telemetry</strong> produced by the <strong>API</strong>.</li>
<li>SdkTracerProvider is <strong>configured</strong> by the <strong>application owner</strong>, and consists of:</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Resource</td>
<td>The resource <strong>spans</strong> are <strong>associated</strong> with.</td>
</tr>
<tr>
<td>Sampler</td>
<td>Configures which spans are <strong>recorded</strong> and <strong>sampled</strong>.</td>
</tr>
<tr>
<td>SpanProcessors</td>
<td>Processes spans when they <strong>start</strong> and <strong>end</strong>.</td>
</tr>
<tr>
<td>SpanExporters</td>
<td>Exports spans out of process (in conjunction with <strong>associated</strong> with <strong>SpanProcessors</strong>).</td>
</tr>
<tr>
<td>SpanLimits</td>
<td>Controls the <strong>limits</strong> of data associated with spans.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>SdkTracerProvider programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.SdkTracerProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SdkTracerProviderConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkTracerProvider <span class="title function_">create</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SdkTracerProvider.builder()</span><br><span class="line">        .setResource(resource)</span><br><span class="line">        .addSpanProcessor(</span><br><span class="line">            SpanProcessorConfig.batchSpanProcessor(</span><br><span class="line">                SpanExporterConfig.otlpHttpSpanExporter(<span class="string">&quot;http://localhost:4318/v1/spans&quot;</span>)))</span><br><span class="line">        .setSampler(SamplerConfig.parentBasedSampler(SamplerConfig.traceIdRatioBased(<span class="number">.25</span>)))</span><br><span class="line">        .setSpanLimits(SpanLimitsConfig::spanLimits)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Sampler"><a href="#Sampler" class="headerlink" title="Sampler"></a>Sampler</h4><ol>
<li>A Sampler is a <strong>plugin extension interface</strong> responsible for <strong>determining</strong> which spans are <strong>recorded</strong> and <strong>sampled</strong>.</li>
<li>By default <strong>SdkTracerProvider</strong> is configured with the <strong>ParentBased(root&#x3D;AlwaysOn)</strong> sampler. <ul>
<li>This results in <strong>100%</strong> of spans being <strong>sampled</strong> if unless a calling application <strong>performs sampling</strong>.</li>
<li>If this is too <strong>noisy</strong> &#x2F; <strong>expensive</strong>, change the sampler.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Samplers <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>ParentBased</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Samples spans based on <strong>sampling status</strong> of the span’s <strong>parent</strong>.</td>
</tr>
<tr>
<td>AlwaysOn</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Samples all spans.</td>
</tr>
<tr>
<td>AlwaysOff</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Drops all spans.</td>
</tr>
<tr>
<td>TraceIdRatioBased</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Samples spans based on a <strong>configurable ratio</strong>.</td>
</tr>
<tr>
<td>JaegerRemoteSampler</td>
<td>io.opentelemetry:opentelemetry-sdk-extension-jaeger-remote-sampler:1.54.1</td>
<td>Samples spans based on <strong>configuration</strong> from a <strong>remote server</strong>.</td>
</tr>
<tr>
<td>LinksBasedSampler</td>
<td>io.opentelemetry.contrib:opentelemetry-samplers:1.50.0-alpha</td>
<td>Samples spans based on <strong>sampling status</strong> of the <strong>span’s links</strong>.</td>
</tr>
<tr>
<td>RuleBasedRoutingSampler</td>
<td>io.opentelemetry.contrib:opentelemetry-samplers:1.50.0-alpha</td>
<td>Samples spans based on <strong>configurable rules</strong>.</td>
</tr>
<tr>
<td>ConsistentSamplers</td>
<td>io.opentelemetry.contrib:opentelemetry-consistent-sampling:1.50.0-alpha</td>
<td>Various <strong>consistent sampler implementations</strong> as defined by <strong>probability sampling</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>Sampler programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.extension.trace.jaeger.sampler.JaegerRemoteSampler;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.samplers.Sampler;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SamplerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sampler <span class="title function_">parentBasedSampler</span><span class="params">(Sampler root)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Sampler.parentBasedBuilder(root)</span><br><span class="line">        .setLocalParentNotSampled(Sampler.alwaysOff())</span><br><span class="line">        .setLocalParentSampled(Sampler.alwaysOn())</span><br><span class="line">        .setRemoteParentNotSampled(Sampler.alwaysOff())</span><br><span class="line">        .setRemoteParentSampled(Sampler.alwaysOn())</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sampler <span class="title function_">alwaysOn</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Sampler.alwaysOn();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sampler <span class="title function_">alwaysOff</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Sampler.alwaysOff();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sampler <span class="title function_">traceIdRatioBased</span><span class="params">(<span class="type">double</span> ratio)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Sampler.traceIdRatioBased(ratio);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Sampler <span class="title function_">jaegerRemoteSampler</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> JaegerRemoteSampler.builder()</span><br><span class="line">        .setInitialSampler(Sampler.alwaysOn())</span><br><span class="line">        .setEndpoint(<span class="string">&quot;http://endpoint&quot;</span>)</span><br><span class="line">        .setPollingInterval(Duration.ofSeconds(<span class="number">60</span>))</span><br><span class="line">        .setServiceName(<span class="string">&quot;my-service-name&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>Sampler interface</strong> to provide your own <strong>custom sampling logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.Attributes;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.SpanKind;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.data.LinkData;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.samplers.Sampler;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.samplers.SamplingResult;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSampler</span> <span class="keyword">implements</span> <span class="title class_">Sampler</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> SamplingResult <span class="title function_">shouldSample</span><span class="params">(</span></span><br><span class="line"><span class="params">      Context parentContext,</span></span><br><span class="line"><span class="params">      String traceId,</span></span><br><span class="line"><span class="params">      String name,</span></span><br><span class="line"><span class="params">      SpanKind spanKind,</span></span><br><span class="line"><span class="params">      Attributes attributes,</span></span><br><span class="line"><span class="params">      List&lt;LinkData&gt; parentLinks)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when span is started, before any SpanProcessor is called.</span></span><br><span class="line">    <span class="comment">// If the SamplingDecision is:</span></span><br><span class="line">    <span class="comment">// - DROP: the span is dropped. A valid span context is created and SpanProcessor#onStart is</span></span><br><span class="line">    <span class="comment">// still called, but no data is recorded and SpanProcessor#onEnd is not called.</span></span><br><span class="line">    <span class="comment">// - RECORD_ONLY: the span is recorded but not sampled. Data is recorded to the span,</span></span><br><span class="line">    <span class="comment">// SpanProcessor#onStart and SpanProcessor#onEnd are called, but the span&#x27;s sampled status</span></span><br><span class="line">    <span class="comment">// indicates it should not be exported out of process.</span></span><br><span class="line">    <span class="comment">// - RECORD_AND_SAMPLE: the span is recorded and sampled. Data is recorded to the span,</span></span><br><span class="line">    <span class="comment">// SpanProcessor#onStart and SpanProcessor#onEnd are called, and the span&#x27;s sampled status</span></span><br><span class="line">    <span class="comment">// indicates it should be exported out of process.</span></span><br><span class="line">    <span class="keyword">return</span> SpanKind.SERVER == spanKind ? SamplingResult.recordAndSample() : SamplingResult.drop();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Return a description of the sampler.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Callback invoked</strong> when <strong>span</strong> is <strong>started</strong>, <strong>before</strong> any <strong>SpanProcessor</strong> is <strong>called</strong>.</li>
<li>If the <strong>SamplingDecision</strong> is:<ul>
<li><strong>DROP</strong>: the span is dropped.<ul>
<li>A <strong>valid span context</strong> is <strong>created</strong> and <strong>SpanProcessor#onStart</strong> is <strong>still called</strong></li>
<li>but <strong>no data</strong> is <strong>recorded</strong> and <strong>SpanProcessor#onEnd</strong> is <strong>not called</strong>.</li>
</ul>
</li>
<li><strong>RECORD_ONLY</strong>: the span is <strong>recorded</strong> but <strong>not sampled</strong>.<ul>
<li><strong>Data</strong> is <strong>recorded</strong> to the span, <strong>SpanProcessor#onStart</strong> and <strong>SpanProcessor#onEnd</strong> are <strong>called</strong></li>
<li>but the <strong>span’s sampled status</strong> indicates it should <strong>not be exported</strong> out of process.</li>
</ul>
</li>
<li><strong>RECORD_AND_SAMPLE</strong>: the span is <strong>recorded</strong> and <strong>sampled</strong>.<ul>
<li><strong>Data</strong> is <strong>recorded</strong> to the span, <strong>SpanProcessor#onStart</strong> and <strong>SpanProcessor#onEnd</strong> are <strong>called</strong></li>
<li>and the <strong>span’s sampled status</strong> indicates it should <strong>be exported</strong> out of process.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>Sampler -&gt; Processor</p>
</blockquote>
<table>
<thead>
<tr>
<th>SamplingDecision</th>
<th>Desc</th>
<th>SpanProcessor#onStart</th>
<th>SpanProcessor#onEnd</th>
</tr>
</thead>
<tbody><tr>
<td>DROP</td>
<td>not recorded + not sampled</td>
<td>Yes</td>
<td><strong>No</strong></td>
</tr>
<tr>
<td>RECORD_ONLY</td>
<td>recorded + <strong>not sampled</strong></td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>RECORD_AND_SAMPLE</td>
<td>recorded + sampled</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody></table>
<h4 id="SpanProcessor"><a href="#SpanProcessor" class="headerlink" title="SpanProcessor"></a>SpanProcessor</h4><ol>
<li>A SpanProcessor is a <strong>plugin extension interface</strong> with <strong>callbacks invoked</strong> when a span is <strong>started</strong> and <strong>ended</strong>.</li>
<li>They are often <strong>paired with SpanExporters</strong> to export spans out of process, but have other applications such as <strong>data enrichment</strong>.</li>
</ol>
<blockquote>
<p>Span processors <strong>built-in to</strong> the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>BatchSpanProcessor</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td><strong>Batches</strong> sampled spans and exports them via a configurable SpanExporter</td>
</tr>
<tr>
<td>SimpleSpanProcessor</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Exports <strong>each</strong> sampled span via a configurable SpanExporter.</td>
</tr>
<tr>
<td>BaggageSpanProcessor</td>
<td>io.opentelemetry.contrib:opentelemetry-baggage-processor:1.50.0-alpha</td>
<td><strong>Enriches spans with baggage.</strong></td>
</tr>
<tr>
<td>JfrSpanProcessor</td>
<td>io.opentelemetry.contrib:opentelemetry-jfr-events:1.50.0-alpha</td>
<td>Creates <strong>JFR events</strong> from spans.</td>
</tr>
<tr>
<td>StackTraceSpanProcessor</td>
<td>io.opentelemetry.contrib:opentelemetry-span-stacktrace:1.50.0-alpha</td>
<td>Enriches select spans with <strong>stack trace</strong> data.</td>
</tr>
<tr>
<td>InferredSpansProcessor</td>
<td>io.opentelemetry.contrib:opentelemetry-inferred-spans:1.50.0-alpha</td>
<td>Generates spans from <strong>async profiler</strong> instead of instrumentation.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>SpanProcessor programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.SpanProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.BatchSpanProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.SimpleSpanProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.SpanExporter;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpanProcessorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanProcessor <span class="title function_">batchSpanProcessor</span><span class="params">(SpanExporter spanExporter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> BatchSpanProcessor.builder(spanExporter)</span><br><span class="line">        .setMaxQueueSize(<span class="number">2048</span>)</span><br><span class="line">        .setExporterTimeout(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">        .setScheduleDelay(Duration.ofSeconds(<span class="number">5</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanProcessor <span class="title function_">simpleSpanProcessor</span><span class="params">(SpanExporter spanExporter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SimpleSpanProcessor.builder(spanExporter).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>SpanProcessor interface</strong> to provide your own <strong>custom span processing logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.ReadWriteSpan;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.ReadableSpan;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.SpanProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSpanProcessor</span> <span class="keyword">implements</span> <span class="title class_">SpanProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStart</span><span class="params">(Context parentContext, ReadWriteSpan span)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when span is started.</span></span><br><span class="line">    <span class="comment">// Enrich the record with a custom attribute.</span></span><br><span class="line">    span.setAttribute(<span class="string">&quot;my.custom.attribute&quot;</span>, <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStartRequired</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Indicate if onStart should be called.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEnd</span><span class="params">(ReadableSpan span)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when span is ended.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEndRequired</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Indicate if onEnd should be called.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally shutdown the processor and cleanup any resources.</span></span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">forceFlush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally process any records which have been queued up but not yet processed.</span></span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SpanExporter"><a href="#SpanExporter" class="headerlink" title="SpanExporter"></a>SpanExporter</h4><ol>
<li>A SpanExporter is a <strong>plugin extension interface</strong> responsible for <strong>exporting spans</strong> out of process.</li>
<li>Rather than <strong>directly registering with SdkTracerProvider</strong>, they are <strong>paired with SpanProcessors</strong> (typically <strong>BatchSpanProcessor</strong>).</li>
</ol>
<blockquote>
<p>Span exporters <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>OtlpHttpSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports spans via OTLP <strong>http&#x2F;protobuf</strong></td>
</tr>
<tr>
<td>OtlpGrpcSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports spans via OTLP <strong>grpc</strong></td>
</tr>
<tr>
<td>LoggingSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging:1.54.1</td>
<td><strong>Logs spans</strong> to <strong>JUL</strong> in a <strong>debugging format</strong>.</td>
</tr>
<tr>
<td>OtlpJsonLoggingSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td><strong>Logs spans</strong> to <strong>JUL</strong> in an <strong>OTLP JSON encoding</strong>.</td>
</tr>
<tr>
<td>OtlpStdoutSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td><strong>Logs spans</strong> to <strong>System.out</strong> in the <strong>OTLP JSON file encoding</strong> (<strong>experimental</strong>).</td>
</tr>
<tr>
<td>ZipkinSpanExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-zipkin:1.54.1</td>
<td>Export spans to <strong>Zipkin</strong>.</td>
</tr>
<tr>
<td>InterceptableSpanExporter</td>
<td>io.opentelemetry.contrib:opentelemetry-processors:1.50.0-alpha</td>
<td>Passes spans to a <strong>flexible interceptor</strong> before exporting.</td>
</tr>
<tr>
<td>KafkaSpanExporter</td>
<td>io.opentelemetry.contrib:opentelemetry-kafka-exporter:1.50.0-alpha</td>
<td>Exports spans by writing to a <strong>Kafka topic</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>SpanExporter programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.LoggingSpanExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.otlp.OtlpJsonLoggingSpanExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.trace.OtlpHttpSpanExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.trace.OtlpGrpcSpanExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.SpanExporter;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpanExporterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanExporter <span class="title function_">otlpHttpSpanExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpHttpSpanExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanExporter <span class="title function_">otlpGrpcSpanExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpGrpcSpanExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanExporter <span class="title function_">logginSpanExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> LoggingSpanExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanExporter <span class="title function_">otlpJsonLoggingSpanExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpJsonLoggingSpanExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>SpanExporter interface</strong> to provide your own <strong>custom span export logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.data.SpanData;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.SpanExporter;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSpanExporter</span> <span class="keyword">implements</span> <span class="title class_">SpanExporter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(CustomSpanExporter.class.getName());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">export</span><span class="params">(Collection&lt;SpanData&gt; spans)</span> &#123;</span><br><span class="line">    <span class="comment">// Export the records. Typically, records are sent out of process via some network protocol, but</span></span><br><span class="line">    <span class="comment">// we simply log for illustrative purposes.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;Exporting spans&quot;</span>);</span><br><span class="line">    spans.forEach(span -&gt; logger.log(Level.INFO, <span class="string">&quot;Span: &quot;</span> + span));</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">flush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Export any records which have been queued up but not yet exported.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;flushing&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Shutdown the exporter and cleanup any resources.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;shutting down&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SpanLimits"><a href="#SpanLimits" class="headerlink" title="SpanLimits"></a>SpanLimits</h4><p>SpanLimits defines <strong>constraints</strong> for the <strong>data captured by spans</strong>, including <strong>max attribute length</strong>, <strong>max number of attributes</strong>, and more.</p>
<blockquote>
<p>The following code snippet demonstrates <strong>SpanLimits programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.SpanLimits;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpanLimitsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SpanLimits <span class="title function_">spanLimits</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SpanLimits.builder()</span><br><span class="line">        .setMaxNumberOfAttributes(<span class="number">128</span>)</span><br><span class="line">        .setMaxAttributeValueLength(<span class="number">1024</span>)</span><br><span class="line">        .setMaxNumberOfLinks(<span class="number">128</span>)</span><br><span class="line">        .setMaxNumberOfAttributesPerLink(<span class="number">128</span>)</span><br><span class="line">        .setMaxNumberOfEvents(<span class="number">128</span>)</span><br><span class="line">        .setMaxNumberOfAttributesPerEvent(<span class="number">128</span>)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SdkMeterProvider"><a href="#SdkMeterProvider" class="headerlink" title="SdkMeterProvider"></a>SdkMeterProvider</h3><ol>
<li>SdkMeterProvider is the <strong>SDK implementation</strong> of <strong>MeterProvider</strong>, and is responsible for <strong>handling metric telemetry</strong> produced by the <strong>API</strong>.</li>
<li>SdkMeterProvider is <strong>configured</strong> by the <strong>application owner</strong>, and consists of:<ul>
<li><strong>Resource</strong>: The resource metrics are <strong>associated</strong> with.</li>
<li><strong>MetricReader</strong>: Reads the <strong>aggregated state</strong> of <strong>metrics</strong>.<ul>
<li>Optionally, with <strong>CardinalityLimitSelector</strong> for <strong>overriding cardinality limit</strong> by <strong>instrument kind</strong>.</li>
<li>If <strong>unset</strong>, each <strong>instrument</strong> is <strong>limited</strong> to <strong>2000 unique combinations</strong> of attributes <strong>per collection cycle</strong>.</li>
<li><strong>Cardinality limits</strong> are also <strong>configurable</strong> for <strong>individual instruments</strong> via <strong>views</strong>.</li>
</ul>
</li>
<li><strong>MetricExporter</strong>: Exports metrics out of process (in <strong>conjunction</strong> with associated <strong>MetricReader</strong>).</li>
<li><strong>Views</strong>: Configures <strong>metric streams</strong>, including <strong>dropping unused metrics</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet demonstrates <strong>SdkMeterProvider programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.SdkMeterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.SdkMeterProviderBuilder;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SdkMeterProviderConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkMeterProvider <span class="title function_">create</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="type">SdkMeterProviderBuilder</span> <span class="variable">builder</span> <span class="operator">=</span></span><br><span class="line">        SdkMeterProvider.builder()</span><br><span class="line">            .setResource(resource)</span><br><span class="line">            .registerMetricReader(</span><br><span class="line">                MetricReaderConfig.periodicMetricReader(</span><br><span class="line">                    MetricExporterConfig.otlpHttpMetricExporter(</span><br><span class="line">                        <span class="string">&quot;http://localhost:4318/v1/metrics&quot;</span>)));</span><br><span class="line">    <span class="comment">// Uncomment to optionally register metric reader with cardinality limits</span></span><br><span class="line">    <span class="comment">// builder.registerMetricReader(</span></span><br><span class="line">    <span class="comment">//     MetricReaderConfig.periodicMetricReader(</span></span><br><span class="line">    <span class="comment">//         MetricExporterConfig.otlpHttpMetricExporter(&quot;http://localhost:4318/v1/metrics&quot;)),</span></span><br><span class="line">    <span class="comment">//     instrumentType -&gt; 100);</span></span><br><span class="line"></span><br><span class="line">    ViewConfig.dropMetricView(builder, <span class="string">&quot;some.custom.metric&quot;</span>);</span><br><span class="line">    ViewConfig.histogramBucketBoundariesView(</span><br><span class="line">        builder, <span class="string">&quot;http.server.request.duration&quot;</span>, List.of(<span class="number">1.0</span>, <span class="number">5.0</span>, <span class="number">10.0</span>));</span><br><span class="line">    ViewConfig.attributeFilterView(</span><br><span class="line">        builder, <span class="string">&quot;http.client.request.duration&quot;</span>, Set.of(<span class="string">&quot;http.request.method&quot;</span>));</span><br><span class="line">    ViewConfig.cardinalityLimitsView(builder, <span class="string">&quot;http.server.active_requests&quot;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> builder.build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MetricReader"><a href="#MetricReader" class="headerlink" title="MetricReader"></a>MetricReader</h4><ol>
<li>A MetricReader is a <strong>plugin extension interface</strong> which is responsible for <strong>reading aggregated metrics</strong>.</li>
<li>They are often <strong>paired with MetricExporters</strong> to <strong>export metrics</strong> out of process<ul>
<li>but may also be used to serve the metrics to <strong>external scrapers</strong> in <strong>pull-based protocols</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Metric readers <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>PeriodicMetricReader</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Reads metrics on a <strong>periodic basis</strong> and <strong>exports</strong> them via a configurable <strong>MetricExporter</strong>.</td>
</tr>
<tr>
<td>PrometheusHttpServer</td>
<td>io.opentelemetry:opentelemetry-exporter-prometheus:1.54.1-alpha</td>
<td>Serves metrics on an <strong>HTTP server</strong> in <strong>various prometheus formats</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>MetricReader programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.prometheus.PrometheusHttpServer;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricReader;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.PeriodicMetricReader;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricReaderConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricReader <span class="title function_">periodicMetricReader</span><span class="params">(MetricExporter metricExporter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PeriodicMetricReader.builder(metricExporter).setInterval(Duration.ofSeconds(<span class="number">60</span>)).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricReader <span class="title function_">prometheusMetricReader</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PrometheusHttpServer.builder().setHost(<span class="string">&quot;localhost&quot;</span>).setPort(<span class="number">9464</span>).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>MetricReader interface</strong> to provide your own <strong>custom metric reader logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.export.MemoryMode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.Aggregation;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.InstrumentType;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.data.AggregationTemporality;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.AggregationTemporalitySelector;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.CollectionRegistration;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricReader;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMetricReader</span> <span class="keyword">implements</span> <span class="title class_">MetricReader</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(CustomMetricReader.class.getName());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ScheduledExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;CollectionRegistration&gt; collectionRef =</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;(CollectionRegistration.noop());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(CollectionRegistration collectionRegistration)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when SdkMeterProvider is initialized, providing a handle to collect metrics.</span></span><br><span class="line">    collectionRef.set(collectionRegistration);</span><br><span class="line">    executorService.scheduleWithFixedDelay(<span class="built_in">this</span>::collectMetrics, <span class="number">0</span>, <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">collectMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Collect metrics. Typically, records are sent out of process via some network protocol, but we</span></span><br><span class="line">    <span class="comment">// simply log for illustrative purposes.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;Collecting metrics&quot;</span>);</span><br><span class="line">    collectionRef</span><br><span class="line">        .get()</span><br><span class="line">        .collectAllMetrics()</span><br><span class="line">        .forEach(metric -&gt; logger.log(Level.INFO, <span class="string">&quot;Metric: &quot;</span> + metric));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">forceFlush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Export any records which have been queued up but not yet exported.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;flushing&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Shutdown the exporter and cleanup any resources.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;shutting down&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> AggregationTemporality <span class="title function_">getAggregationTemporality</span><span class="params">(InstrumentType instrumentType)</span> &#123;</span><br><span class="line">    <span class="comment">// Specify the required aggregation temporality as a function of instrument type</span></span><br><span class="line">    <span class="keyword">return</span> AggregationTemporalitySelector.deltaPreferred()</span><br><span class="line">        .getAggregationTemporality(instrumentType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> MemoryMode <span class="title function_">getMemoryMode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally specify the memory mode, indicating whether metric records can be reused or must</span></span><br><span class="line">    <span class="comment">// be immutable</span></span><br><span class="line">    <span class="keyword">return</span> MemoryMode.REUSABLE_DATA;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Aggregation <span class="title function_">getDefaultAggregation</span><span class="params">(InstrumentType instrumentType)</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally specify the default aggregation as a function of instrument kind</span></span><br><span class="line">    <span class="keyword">return</span> Aggregation.defaultAggregation();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="MetricExporter"><a href="#MetricExporter" class="headerlink" title="MetricExporter"></a>MetricExporter</h4><ol>
<li>A MetricExporter is a <strong>plugin extension interface</strong> responsible for <strong>exporting metrics</strong> out of process. </li>
<li>Rather than <strong>directly registering with SdkMeterProvider</strong>, they are <strong>paired with PeriodicMetricReader</strong>.</li>
</ol>
<blockquote>
<p>Metric exporters <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>OtlpHttpMetricExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports metrics via OTLP <strong>http&#x2F;protobuf</strong>.</td>
</tr>
<tr>
<td>OtlpGrpcMetricExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports metrics via OTLP <strong>grpc</strong>.</td>
</tr>
<tr>
<td>LoggingMetricExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging:1.54.1</td>
<td><strong>Logs metrics</strong> to <strong>JUL</strong> in a <strong>debugging</strong> format.</td>
</tr>
<tr>
<td>OtlpJsonLoggingMetricExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td>Logs metrics to <strong>JUL</strong> in the OTLP JSON encoding.</td>
</tr>
<tr>
<td>OtlpStdoutMetricExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td>Logs metrics to <strong>System.out</strong> in the OTLP JSON file encoding (<strong>experimental</strong>).</td>
</tr>
<tr>
<td>InterceptableMetricExporter</td>
<td>io.opentelemetry.contrib:opentelemetry-processors:1.50.0-alpha</td>
<td>Passes metrics to a <strong>flexible interceptor</strong> before exporting.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>MetricExporter programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.LoggingMetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.otlp.OtlpJsonLoggingMetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.metrics.OtlpHttpMetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.metrics.OtlpGrpcMetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricExporter;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricExporterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricExporter <span class="title function_">otlpHttpMetricExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpHttpMetricExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricExporter <span class="title function_">otlpGrpcMetricExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpGrpcMetricExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricExporter <span class="title function_">logginMetricExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> LoggingMetricExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MetricExporter <span class="title function_">otlpJsonLoggingMetricExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpJsonLoggingMetricExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>MetricExporter interface</strong> to provide your own custom <strong>metric export logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.export.MemoryMode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.Aggregation;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.InstrumentType;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.data.AggregationTemporality;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.data.MetricData;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.AggregationTemporalitySelector;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricExporter;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMetricExporter</span> <span class="keyword">implements</span> <span class="title class_">MetricExporter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(CustomMetricExporter.class.getName());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">export</span><span class="params">(Collection&lt;MetricData&gt; metrics)</span> &#123;</span><br><span class="line">    <span class="comment">// Export the records. Typically, records are sent out of process via some network protocol, but</span></span><br><span class="line">    <span class="comment">// we simply log for illustrative purposes.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;Exporting metrics&quot;</span>);</span><br><span class="line">    metrics.forEach(metric -&gt; logger.log(Level.INFO, <span class="string">&quot;Metric: &quot;</span> + metric));</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">flush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Export any records which have been queued up but not yet exported.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;flushing&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Shutdown the exporter and cleanup any resources.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;shutting down&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> AggregationTemporality <span class="title function_">getAggregationTemporality</span><span class="params">(InstrumentType instrumentType)</span> &#123;</span><br><span class="line">    <span class="comment">// Specify the required aggregation temporality as a function of instrument type</span></span><br><span class="line">    <span class="keyword">return</span> AggregationTemporalitySelector.deltaPreferred()</span><br><span class="line">        .getAggregationTemporality(instrumentType);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> MemoryMode <span class="title function_">getMemoryMode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally specify the memory mode, indicating whether metric records can be reused or must</span></span><br><span class="line">    <span class="comment">// be immutable</span></span><br><span class="line">    <span class="keyword">return</span> MemoryMode.REUSABLE_DATA;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Aggregation <span class="title function_">getDefaultAggregation</span><span class="params">(InstrumentType instrumentType)</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally specify the default aggregation as a function of instrument kind</span></span><br><span class="line">    <span class="keyword">return</span> Aggregation.defaultAggregation();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h4><ol>
<li>Views allow <strong>metric streams</strong> to be <strong>customized</strong><ul>
<li>including <strong>changing metric names</strong>, <strong>metric descriptions</strong>, <strong>metric aggregations</strong> (i.e. <strong>histogram bucket boundaries</strong>)</li>
<li>the set of <strong>attribute keys</strong> to <strong>retain</strong>, <strong>cardinality limit</strong>, etc.</li>
</ul>
</li>
<li>Views have somewhat <strong>unintuitive behavior</strong> when <strong>multiple match a particular instrument</strong>.<ul>
<li>If one matching view <strong>changes the metric name</strong> and another <strong>changes the metric aggregation</strong></li>
<li>you might expect the <strong>name and aggregation are changed</strong>, but this is <strong>not the case</strong>.</li>
<li>Instead, <strong>two metric streams are produced</strong><ul>
<li>one with the <strong>configured metric name</strong> and the <strong>default aggregation</strong></li>
<li>and another with the <strong>original metric name</strong> and the <strong>configured aggregation</strong>.</li>
</ul>
</li>
<li>In other words, <strong>matching views do not merge</strong>. <ul>
<li><strong>For best results</strong>, configure views with <strong>narrow selection criteria</strong> (i.e. select a <strong>single specific instrument</strong>)</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet demonstrates <strong>View programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.Aggregation;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.InstrumentSelector;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.SdkMeterProviderBuilder;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.View;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkMeterProviderBuilder <span class="title function_">dropMetricView</span><span class="params">(</span></span><br><span class="line"><span class="params">      SdkMeterProviderBuilder builder, String metricName)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> builder.registerView(</span><br><span class="line">        InstrumentSelector.builder().setName(metricName).build(),</span><br><span class="line">        View.builder().setAggregation(Aggregation.drop()).build());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkMeterProviderBuilder <span class="title function_">histogramBucketBoundariesView</span><span class="params">(</span></span><br><span class="line"><span class="params">      SdkMeterProviderBuilder builder, String metricName, List&lt;Double&gt; bucketBoundaries)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> builder.registerView(</span><br><span class="line">        InstrumentSelector.builder().setName(metricName).build(),</span><br><span class="line">        View.builder()</span><br><span class="line">            .setAggregation(Aggregation.explicitBucketHistogram(bucketBoundaries))</span><br><span class="line">            .build());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkMeterProviderBuilder <span class="title function_">attributeFilterView</span><span class="params">(</span></span><br><span class="line"><span class="params">      SdkMeterProviderBuilder builder, String metricName, Set&lt;String&gt; keysToRetain)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> builder.registerView(</span><br><span class="line">        InstrumentSelector.builder().setName(metricName).build(),</span><br><span class="line">        View.builder().setAttributeFilter(keysToRetain).build());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkMeterProviderBuilder <span class="title function_">cardinalityLimitsView</span><span class="params">(</span></span><br><span class="line"><span class="params">      SdkMeterProviderBuilder builder, String metricName, <span class="type">int</span> cardinalityLimit)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> builder.registerView(</span><br><span class="line">        InstrumentSelector.builder().setName(metricName).build(),</span><br><span class="line">        View.builder().setCardinalityLimit(cardinalityLimit).build());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SdkLoggerProvider"><a href="#SdkLoggerProvider" class="headerlink" title="SdkLoggerProvider"></a>SdkLoggerProvider</h3><ol>
<li>SdkLoggerProvider is the <strong>SDK implementation</strong> of <strong>LoggerProvider</strong>, and is responsible for <strong>handling log telemetry</strong> produced by the <strong>log bridge API</strong>.</li>
<li>SdkLoggerProvider is <strong>configured</strong> by the <strong>application owner</strong>, and consists of:</li>
</ol>
<table>
<thead>
<tr>
<th>Components</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Resource</td>
<td>The resource logs are <strong>associated</strong> with.</td>
</tr>
<tr>
<td>LogRecordProcessor</td>
<td>Processes logs when they are <strong>emitted</strong>.</td>
</tr>
<tr>
<td>LogRecordExporter</td>
<td>Exports logs out of process (in <strong>conjunction</strong> with associated <strong>LogRecordProcessor</strong>).</td>
</tr>
<tr>
<td>LogLimits</td>
<td>Controls the <strong>limits of data</strong> associated with logs.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>SdkLoggerProvider programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.SdkLoggerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SdkLoggerProviderConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SdkLoggerProvider <span class="title function_">create</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SdkLoggerProvider.builder()</span><br><span class="line">        .setResource(resource)</span><br><span class="line">        .addLogRecordProcessor(</span><br><span class="line">            LogRecordProcessorConfig.batchLogRecordProcessor(</span><br><span class="line">                LogRecordExporterConfig.otlpHttpLogRecordExporter(<span class="string">&quot;http://localhost:4318/v1/logs&quot;</span>)))</span><br><span class="line">        .setLogLimits(LogLimitsConfig::logLimits)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="LogRecordProcessor"><a href="#LogRecordProcessor" class="headerlink" title="LogRecordProcessor"></a>LogRecordProcessor</h4><ol>
<li>A LogRecordProcessor is a <strong>plugin extension interface</strong> with a <strong>callback invoked</strong> when a log is <strong>emitted</strong>.</li>
<li>They are often <strong>paired with LogRecordExporters</strong> to export logs out of process, but have other applications such as <strong>data enrichment</strong>.</li>
</ol>
<blockquote>
<p>Log record processors <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>BatchLogRecordProcessor</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td><strong>Batches</strong> log records and exports them via a configurable <strong>LogRecordExporter</strong>.</td>
</tr>
<tr>
<td>SimpleLogRecordProcessor</td>
<td>io.opentelemetry:opentelemetry-sdk:1.54.1</td>
<td>Exports <strong>each</strong> log record a via a configurable <strong>LogRecordExporter</strong>.</td>
</tr>
<tr>
<td>EventToSpanEventBridge</td>
<td>io.opentelemetry.contrib:opentelemetry-processors:1.50.0-alpha</td>
<td>Records <strong>event log records</strong> as <strong>span events</strong> on the <u>current span</u>.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>LogRecordProcessor programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.LogRecordProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.BatchLogRecordProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.LogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.SimpleLogRecordProcessor;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogRecordProcessorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordProcessor <span class="title function_">batchLogRecordProcessor</span><span class="params">(LogRecordExporter logRecordExporter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> BatchLogRecordProcessor.builder(logRecordExporter)</span><br><span class="line">        .setMaxQueueSize(<span class="number">2048</span>)</span><br><span class="line">        .setExporterTimeout(Duration.ofSeconds(<span class="number">30</span>))</span><br><span class="line">        .setScheduleDelay(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordProcessor <span class="title function_">simpleLogRecordProcessor</span><span class="params">(LogRecordExporter logRecordExporter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SimpleLogRecordProcessor.create(logRecordExporter);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>LogRecordProcessor interface</strong> to provide your own <strong>custom log processing logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.common.AttributeKey;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.LogRecordProcessor;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.ReadWriteLogRecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogRecordProcessor</span> <span class="keyword">implements</span> <span class="title class_">LogRecordProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEmit</span><span class="params">(Context context, ReadWriteLogRecord logRecord)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when log record is emitted.</span></span><br><span class="line">    <span class="comment">// Enrich the record with a custom attribute.</span></span><br><span class="line">    logRecord.setAttribute(AttributeKey.stringKey(<span class="string">&quot;my.custom.attribute&quot;</span>), <span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally shutdown the processor and cleanup any resources.</span></span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">forceFlush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally process any records which have been queued up but not yet processed.</span></span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="LogRecordExporter"><a href="#LogRecordExporter" class="headerlink" title="LogRecordExporter"></a>LogRecordExporter</h4><ol>
<li>A LogRecordExporter is a <strong>plugin extension interface</strong> responsible for <strong>exporting log records out of process</strong>.</li>
<li>Rather than <strong>directly registering with SdkLoggerProvider</strong>, they are <strong>paired with LogRecordProcessors</strong> (typically <strong>BatchLogRecordProcessor</strong>).</li>
</ol>
<blockquote>
<p>Log record exporters <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>OtlpHttpLogRecordExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports log records via OTLP <strong>http&#x2F;protobuf</strong>.</td>
</tr>
<tr>
<td>OtlpGrpcLogRecordExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</td>
<td>Exports log records via OTLP <strong>grpc</strong></td>
</tr>
<tr>
<td>SystemOutLogRecordExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging:1.54.1</td>
<td>Logs log records to <strong>system out</strong> in a <strong>debugging</strong> format.</td>
</tr>
<tr>
<td>OtlpJsonLoggingLogRecordExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td>Logs log records to <strong>JUL</strong> in the OTLP <strong>JSON</strong> encoding.</td>
</tr>
<tr>
<td>OtlpStdoutLogRecordExporter</td>
<td>io.opentelemetry:opentelemetry-exporter-logging-otlp:1.54.1</td>
<td>Logs log records to <strong>System.out</strong> in the OTLP <strong>JSON</strong> file encoding (<strong>experimental</strong>).</td>
</tr>
<tr>
<td>InterceptableLogRecordExporter</td>
<td>io.opentelemetry.contrib:opentelemetry-processors:1.50.0-alpha</td>
<td>Passes log records to a <strong>flexible interceptor</strong> before exporting.</td>
</tr>
</tbody></table>
<ol>
<li><strong>OtlpJsonLoggingLogRecordExporter</strong> logs to <strong>JUL</strong>, and may cause <strong>infinite loops</strong></li>
<li>(i.e. <u>JUL -&gt; SLF4J -&gt; Logback -&gt; OpenTelemetry Appender -&gt; OpenTelemetry Log SDK -&gt; JUL</u>) if not carefully configured.</li>
</ol>
<blockquote>
<p>The following code snippet demonstrates <strong>LogRecordExporter programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.SystemOutLogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.logging.otlp.OtlpJsonLoggingLogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.logs.OtlpHttpLogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.logs.OtlpGrpcLogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.LogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogRecordExporterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordExporter <span class="title function_">otlpHttpLogRecordExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpHttpLogRecordExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordExporter <span class="title function_">otlpGrpcLogRecordExporter</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpGrpcLogRecordExporter.builder()</span><br><span class="line">        .setEndpoint(endpoint)</span><br><span class="line">        .addHeader(<span class="string">&quot;api-key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">        .setTimeout(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordExporter <span class="title function_">systemOutLogRecordExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SystemOutLogRecordExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogRecordExporter <span class="title function_">otlpJsonLoggingLogRecordExporter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OtlpJsonLoggingLogRecordExporter.create();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>LogRecordExporter interface</strong> to provide your <strong>own custom log record export logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.common.CompletableResultCode;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.data.LogRecordData;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.LogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Level;</span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogRecordExporter</span> <span class="keyword">implements</span> <span class="title class_">LogRecordExporter</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(CustomLogRecordExporter.class.getName());</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">export</span><span class="params">(Collection&lt;LogRecordData&gt; logs)</span> &#123;</span><br><span class="line">    <span class="comment">// Export the records. Typically, records are sent out of process via some network protocol, but</span></span><br><span class="line">    <span class="comment">// we simply log for illustrative purposes.</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Exporting logs&quot;</span>);</span><br><span class="line">    logs.forEach(log -&gt; System.out.println(<span class="string">&quot;log record: &quot;</span> + log));</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">flush</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Export any records which have been queued up but not yet exported.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;flushing&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CompletableResultCode <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Shutdown the exporter and cleanup any resources.</span></span><br><span class="line">    logger.log(Level.INFO, <span class="string">&quot;shutting down&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> CompletableResultCode.ofSuccess();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="LogLimits"><a href="#LogLimits" class="headerlink" title="LogLimits"></a>LogLimits</h4><p>LogLimits defines <strong>constraints</strong> for the <strong>data captured by log records</strong>, including <strong>max attribute length</strong>, and <strong>max number of attributes</strong>.</p>
<blockquote>
<p>The following code snippet demonstrates LogLimits <strong>programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.LogLimits;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogLimitsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> LogLimits <span class="title function_">logLimits</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> LogLimits.builder()</span><br><span class="line">        .setMaxNumberOfAttributes(<span class="number">128</span>)</span><br><span class="line">        .setMaxAttributeValueLength(<span class="number">1024</span>)</span><br><span class="line">        .build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TextMapPropagator"><a href="#TextMapPropagator" class="headerlink" title="TextMapPropagator"></a>TextMapPropagator</h3><p>TextMapPropagator is a <strong>plugin extension interface</strong> responsible for <strong>propagating context</strong> across process <strong>boundaries</strong> in a <strong>text format</strong>.</p>
<blockquote>
<p>TextMapPropagators <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>W3CTraceContextPropagator</td>
<td>io.opentelemetry:opentelemetry-api:1.54.1</td>
<td>Propagate trace context using <strong>W3C trace context</strong> propagation protocol.</td>
</tr>
<tr>
<td>W3CBaggagePropagator</td>
<td>io.opentelemetry:opentelemetry-api:1.54.1</td>
<td>Propagate baggage using <strong>W3C baggage</strong> propagation protocol.</td>
</tr>
<tr>
<td>MultiTextMapPropagator</td>
<td>io.opentelemetry:opentelemetry-context:1.54.1</td>
<td><strong>Compose multiple propagators</strong>.</td>
</tr>
<tr>
<td>JaegerPropagator</td>
<td>io.opentelemetry:opentelemetry-extension-trace-propagators:1.54.1</td>
<td>Propagator trace context using the <strong>Jaeger</strong> propagation protocol.</td>
</tr>
<tr>
<td>B3Propagator</td>
<td>io.opentelemetry:opentelemetry-extension-trace-propagators:1.54.1</td>
<td>Propagator trace context using the <strong>B3</strong> propagation protocol.</td>
</tr>
<tr>
<td>OtTracePropagator</td>
<td>io.opentelemetry:opentelemetry-extension-trace-propagators:1.54.1</td>
<td>Propagator trace context using the <strong>OpenTracing</strong> propagation protocol.</td>
</tr>
<tr>
<td>PassThroughPropagator</td>
<td>io.opentelemetry:opentelemetry-api-incubator:1.54.1-alpha</td>
<td>Propagate a <strong>configurable set fields without participating in telemetry</strong>.</td>
</tr>
<tr>
<td>AwsXrayPropagator</td>
<td>io.opentelemetry.contrib:opentelemetry-aws-xray-propagator:1.50.0-alpha</td>
<td>Propagate trace context using <strong>AWS X-Ray</strong> propagation protocol.</td>
</tr>
<tr>
<td>AwsXrayLambdaPropagator</td>
<td>io.opentelemetry.contrib:opentelemetry-aws-xray-propagator:1.50.0-alpha</td>
<td>Propagate trace context using <strong>environment variables</strong> and <strong>AWS X-Ray</strong> propagation protocol.</td>
</tr>
</tbody></table>
<blockquote>
<p>The following code snippet demonstrates <strong>TextMapPropagator programmatic configuration</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.baggage.propagation.W3CBaggagePropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.propagation.W3CTraceContextPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.ContextPropagators;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapPropagator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContextPropagatorsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ContextPropagators <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ContextPropagators.create(</span><br><span class="line">        TextMapPropagator.composite(</span><br><span class="line">            W3CTraceContextPropagator.getInstance(), W3CBaggagePropagator.getInstance()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Implement the <strong>TextMapPropagator interface</strong> to provide your own <strong>custom propagator logic</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.Context;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapGetter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapSetter;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomTextMapPropagator</span> <span class="keyword">implements</span> <span class="title class_">TextMapPropagator</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Collection&lt;String&gt; <span class="title function_">fields</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Return fields used for propagation. See W3CTraceContextPropagator for reference</span></span><br><span class="line">    <span class="comment">// implementation.</span></span><br><span class="line">    <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> &lt;C&gt; <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Context context, C carrier, TextMapSetter&lt;C&gt; setter)</span> &#123;</span><br><span class="line">    <span class="comment">// Inject context. See W3CTraceContextPropagator for reference implementation.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> &lt;C&gt; Context <span class="title function_">extract</span><span class="params">(Context context, C carrier, TextMapGetter&lt;C&gt; getter)</span> &#123;</span><br><span class="line">    <span class="comment">// Extract context. See W3CTraceContextPropagator for reference implementation.</span></span><br><span class="line">    <span class="keyword">return</span> context;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><h3 id="Internal-logging"><a href="#Internal-logging" class="headerlink" title="Internal logging"></a>Internal logging</h3><ol>
<li>SDK components log a <strong>variety of information</strong> to <strong>java.util.logging</strong><ul>
<li>at <strong>different log levels</strong> and using <strong>logger names</strong> based on the <strong>fully qualified class name</strong> of the <strong>relevant component</strong>.</li>
</ul>
</li>
<li>By default, <strong>log messages</strong> are <strong>handled</strong> by the <strong>root handler</strong> in your application.<ul>
<li>If you have <strong>not installed</strong> a <strong>custom root handler</strong> for your application, logs of level <strong>INFO or higher</strong> are sent to the <strong>console</strong> by default.</li>
</ul>
</li>
<li>You may want to change the <strong>behavior</strong> of the <strong>logger</strong> for <strong>OpenTelemetry</strong>.<ul>
<li>For example, you can <strong>reduce</strong> the <strong>logging level</strong> to <strong>output additional information</strong> when <strong>debugging</strong></li>
<li><strong>increase</strong> the <strong>level</strong> for a <strong>particular class</strong> to <strong>ignore errors</strong> coming from the class</li>
<li>or install a <strong>custom handler</strong> or <strong>filter</strong> to run <strong>custom code</strong> whenever OpenTelemetry logs a <strong>particular message</strong>.</li>
</ul>
</li>
<li>No detailed list of <strong>logger names</strong> and <strong>log information</strong> is maintained.<ul>
<li>However, all OpenTelemetry <strong>API</strong>, <strong>SDK</strong>, <strong>contrib</strong> and <strong>instrumentation components</strong> share the same <strong>io.opentelemetry.</strong>* package prefix.</li>
<li>It can be useful to enable <strong>finer grain</strong> logs for all <strong>io.opentelemetry.</strong>*, inspect the output, and <strong>narrow down</strong> to <strong>packages</strong> or <strong>FQCNs</strong> of interest.</li>
</ul>
</li>
</ol>
<blockquote>
<p>For example:</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Turn off all OpenTelemetry logging</span></span><br><span class="line"><span class="attr">io.opentelemetry.level</span> = <span class="string">OFF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Turn off logging for just the BatchSpanProcessor</span></span><br><span class="line"><span class="attr">io.opentelemetry.sdk.trace.export.BatchSpanProcessor.level</span> = <span class="string">OFF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Log &quot;FINE&quot; messages for help in debugging</span></span><br><span class="line"><span class="attr">io.opentelemetry.level</span> = <span class="string">FINE</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## Sets the default ConsoleHandler&#x27;s logger&#x27;s level</span></span><br><span class="line"><span class="comment">## Note this impacts the logging outside of OpenTelemetry as well</span></span><br><span class="line"><span class="attr">java.util.logging.ConsoleHandler.level</span> = <span class="string">FINE</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>For more <strong>fine-grained control</strong> and <strong>special case handling</strong>, custom handlers and filters can be specified with <strong>code</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.logging.LogRecord;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom filter which does not log errors which come from the export</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IgnoreExportErrorsFilter</span> <span class="keyword">implements</span> <span class="title class_">java</span>.util.logging.Filter &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLoggable</span><span class="params">(LogRecord record)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !record.getMessage().contains(<span class="string">&quot;Exception thrown by the export&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Registering the custom filter on the BatchSpanProcessor</span></span><br><span class="line"><span class="attr">io.opentelemetry.sdk.trace.export.BatchSpanProcessor</span> = <span class="string">otel.IgnoreExportErrorsFilter</span></span><br></pre></td></tr></table></figure>

<h3 id="OTLP-exporters"><a href="#OTLP-exporters" class="headerlink" title="OTLP exporters"></a>OTLP exporters</h3><ol>
<li>The <strong>span exporter</strong>, <strong>metric exporter</strong>, and <strong>log exporter</strong> sections describe <strong>OTLP exporters</strong> of the form:<ul>
<li>Otlp<strong>Http</strong>{Signal}Exporter, which exports data via OTLP <strong>http&#x2F;protobuf</strong></li>
<li>Otlp<strong>Grpc</strong>{Signal}Exporter, which exports data via OTLP <strong>grpc</strong></li>
</ul>
</li>
<li>The exporters for all signals are available via <strong>io.opentelemetry:opentelemetry-exporter-otlp:1.54.1</strong><ul>
<li>and have <strong>significant overlap</strong> across <strong>grpc</strong> and <strong>http&#x2F;protobuf</strong> versions of the <strong>OTLP protocol</strong>, and <strong>between signals</strong>.</li>
<li>The following sections elaborate on these key concepts:</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Concepts</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Senders</td>
<td>an abstraction for a different <strong>HTTP &#x2F; gRPC</strong> client libraries.</td>
</tr>
<tr>
<td>Authentication</td>
<td>options for <strong>OTLP exporters</strong></td>
</tr>
</tbody></table>
<h4 id="Senders"><a href="#Senders" class="headerlink" title="Senders"></a>Senders</h4><ol>
<li>The <strong>OTLP exporters</strong> depend on <strong>various client libraries</strong> to <strong>execute HTTP and gRPC requests</strong>.</li>
<li>There is <strong>no single HTTP &#x2F; gRPC client library</strong> which <strong>satisfies all use cases</strong> in the <strong>Java ecosystem</strong>:<ul>
<li><strong>Java 11+</strong> brings the <strong>built-in java.net.http.HttpClient</strong><ul>
<li>but <strong>opentelemetry-java</strong> needs to support <strong>Java 8+</strong> users</li>
<li>and this can’t be used to export via <strong>gRPC</strong> because there is no support for <strong>trailer headers</strong>.</li>
</ul>
</li>
<li><strong>OkHttp</strong> provides a powerful HTTP client with support for <strong>trailer headers</strong>, but depends on the <strong>kotlin standard library</strong>.</li>
<li><strong>grpc-java</strong> provides its own <strong>ManagedChannel abstraction</strong> with <strong>various transport implementations</strong>, but is <strong>not suitable</strong> for <strong>http&#x2F;protobuf</strong>.</li>
</ul>
</li>
<li>In order to <strong>accommodate various use cases</strong><ul>
<li><strong>opentelemetry-exporter-otlp</strong> uses an <strong>internal “sender” abstraction</strong>, with a <strong>variety</strong> of <strong>implementations</strong> to <strong>reflect application constraints</strong>.</li>
</ul>
</li>
<li>To choose <strong>another</strong> implementation<ul>
<li><strong>exclude</strong> the <strong>io.opentelemetry:opentelemetry-exporter-sender-okhttp</strong> default dependency, and <strong>add</strong> a dependency on the <strong>alternative</strong>.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Artifact</th>
<th>Description</th>
<th>OTLP Protocols</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td><strong>io.opentelemetry:opentelemetry-exporter-sender-okhttp:1.54.1</strong></td>
<td>OkHttp based implementation.</td>
<td>grpc, http&#x2F;protobuf</td>
<td>Yes</td>
</tr>
<tr>
<td>io.opentelemetry:opentelemetry-exporter-sender-jdk:1.54.1</td>
<td>Java 11+ java.net.http.HttpClient based implementation.</td>
<td>http&#x2F;protobuf</td>
<td>No</td>
</tr>
<tr>
<td>io.opentelemetry:opentelemetry-exporter-sender-grpc-managed-channel:1.54.1</td>
<td>grpc-java ManagedChannel based implementation.</td>
<td>grpc</td>
<td>No</td>
</tr>
</tbody></table>
<h4 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h4><ol>
<li>The <strong>OTLP exporters</strong> provide mechanisms for <strong>static</strong> and <strong>dynamic header-based authentication</strong>, and for <strong>mTLS</strong>.</li>
<li>If using <strong>zero-code SDK autoconfigure</strong> with <strong>environment variables</strong> and <strong>system properties</strong>, see relevant system properties:<ul>
<li><strong>otel.exporter.otlp.headers</strong> for <strong>static header-based authentication</strong>.</li>
<li><strong>otel.exporter.otlp.client.key</strong>, <strong>otel.exporter.otlp.client.certificate</strong> for <strong>mTLS authentication</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following code snippet demonstrates programmatic configuration of <strong>static and dynamic header-based authentication</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.logs.OtlpHttpLogRecordExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.metrics.OtlpHttpMetricExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.trace.OtlpHttpSpanExporter;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.time.Instant;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OtlpAuthenticationConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticAuthenticationHeader</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="comment">// If the OTLP destination accepts a static, long-lived authentication header like an API key,</span></span><br><span class="line">    <span class="comment">// set it as a header.</span></span><br><span class="line">    <span class="comment">// This reads the API key from the OTLP_API_KEY env var to avoid hard coding the secret in</span></span><br><span class="line">    <span class="comment">// source code.</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">apiKeyHeaderName</span> <span class="operator">=</span> <span class="string">&quot;api-key&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">apiKeyHeaderValue</span> <span class="operator">=</span> System.getenv(<span class="string">&quot;OTLP_API_KEY&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize OTLP Span, Metric, and LogRecord exporters using a similar pattern</span></span><br><span class="line">    <span class="type">OtlpHttpSpanExporter</span> <span class="variable">spanExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpSpanExporter.builder()</span><br><span class="line">            .setEndpoint(endpoint)</span><br><span class="line">            .addHeader(apiKeyHeaderName, apiKeyHeaderValue)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">OtlpHttpMetricExporter</span> <span class="variable">metricExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpMetricExporter.builder()</span><br><span class="line">            .setEndpoint(endpoint)</span><br><span class="line">            .addHeader(apiKeyHeaderName, apiKeyHeaderValue)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">OtlpHttpLogRecordExporter</span> <span class="variable">logRecordExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpLogRecordExporter.builder()</span><br><span class="line">            .setEndpoint(endpoint)</span><br><span class="line">            .addHeader(apiKeyHeaderName, apiKeyHeaderValue)</span><br><span class="line">            .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dynamicAuthenticationHeader</span><span class="params">(String endpoint)</span> &#123;</span><br><span class="line">    <span class="comment">// If the OTLP destination requires a dynamic authentication header, such as a JWT which needs</span></span><br><span class="line">    <span class="comment">// to be periodically refreshed, use a header supplier.</span></span><br><span class="line">    <span class="comment">// Here we implement a simple supplier which adds a header of the form &quot;Authorization: Bearer</span></span><br><span class="line">    <span class="comment">// &lt;token&gt;&quot;, where &lt;token&gt; is fetched from refreshBearerToken every 10 minutes.</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> System.getenv(<span class="string">&quot;OTLP_USERNAME&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> System.getenv(<span class="string">&quot;OTLP_PASSWORD&quot;</span>);</span><br><span class="line">    Supplier&lt;Map&lt;String, String&gt;&gt; supplier =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AuthHeaderSupplier</span>(() -&gt; refreshToken(username, password), Duration.ofMinutes(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize OTLP Span, Metric, and LogRecord exporters using a similar pattern</span></span><br><span class="line">    <span class="type">OtlpHttpSpanExporter</span> <span class="variable">spanExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpSpanExporter.builder().setEndpoint(endpoint).setHeaders(supplier).build();</span><br><span class="line">    <span class="type">OtlpHttpMetricExporter</span> <span class="variable">metricExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpMetricExporter.builder().setEndpoint(endpoint).setHeaders(supplier).build();</span><br><span class="line">    <span class="type">OtlpHttpLogRecordExporter</span> <span class="variable">logRecordExporter</span> <span class="operator">=</span></span><br><span class="line">        OtlpHttpLogRecordExporter.builder().setEndpoint(endpoint).setHeaders(supplier).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AuthHeaderSupplier</span> <span class="keyword">implements</span> <span class="title class_">Supplier</span>&lt;Map&lt;String, String&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Supplier&lt;String&gt; tokenRefresher;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Duration tokenRefreshInterval;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Instant</span> <span class="variable">refreshedAt</span> <span class="operator">=</span> Instant.ofEpochMilli(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> String currentTokenValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AuthHeaderSupplier</span><span class="params">(Supplier&lt;String&gt; tokenRefresher, Duration tokenRefreshInterval)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.tokenRefresher = tokenRefresher;</span><br><span class="line">      <span class="built_in">this</span>.tokenRefreshInterval = tokenRefreshInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Collections.singletonMap(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + getToken());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">synchronized</span> String <span class="title function_">getToken</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">Instant</span> <span class="variable">now</span> <span class="operator">=</span> Instant.now();</span><br><span class="line">      <span class="keyword">if</span> (currentTokenValue == <span class="literal">null</span> || now.isAfter(refreshedAt.plus(tokenRefreshInterval))) &#123;</span><br><span class="line">        currentTokenValue = tokenRefresher.get();</span><br><span class="line">        refreshedAt = now;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> currentTokenValue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">refreshToken</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">    <span class="comment">// For a production scenario, this would be replaced with an out-of-band request to exchange</span></span><br><span class="line">    <span class="comment">// username / password for bearer token.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;abc123&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Configure-the-SDK"><a href="#Configure-the-SDK" class="headerlink" title="Configure the SDK"></a>Configure the SDK</h1><ol>
<li>The <strong>SDK</strong> is the <strong>built-in reference implementation</strong> of the <strong>API</strong>, <strong>processing</strong> and <strong>exporting</strong> telemetry produced by <strong>instrumentation API calls</strong>.</li>
<li><strong>Configuring</strong> the SDK to <strong>process and export appropriately</strong> is an <strong>essential step</strong> to integrating OpenTelemetry into an application.</li>
<li>All <strong>SDK components</strong> have <strong>programmatic configuration APIs</strong>.<ul>
<li>This is the most <strong>flexible</strong>, <strong>expressive</strong> way to configure the SDK.</li>
<li>However, changing configuration requires <strong>adjusting code</strong> and <strong>recompiling the application</strong><ul>
<li>and there is <strong>no language interoperability</strong> since the <strong>API</strong> is written in <strong>java</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>zero-code SDK autoconfigure</strong> module configures <strong>SDK components</strong> through <strong>system properties</strong> or <strong>environment variables</strong><ul>
<li>with <strong>various extension points</strong> for <strong>instances</strong> where the <strong>properties</strong> are <strong>insufficient</strong>.</li>
<li>We <strong>recommend</strong> using the <strong>zero-code SDK autoconfigure</strong> module since it <strong>reduces boilerplate code</strong><ul>
<li>allows <strong>reconfiguration</strong> without <strong>rewriting code</strong> or <strong>recompiling the application</strong>, and has <strong>language interoperability</strong>.</li>
</ul>
</li>
<li><strong>Java agent</strong> and <strong>Spring starter</strong> automatically configure the SDK using the <strong>zero-code SDK autoconfigure</strong> module, and install instrumentation with it.<ul>
<li>All <strong>autoconfigure content</strong> is <strong>applicable</strong> to <strong>Java agent</strong> and <strong>Spring starter</strong> users.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Programmatic-configuration"><a href="#Programmatic-configuration" class="headerlink" title="Programmatic configuration"></a>Programmatic configuration</h2><ol>
<li>The programmatic configuration interface is the set of <strong>APIs</strong> for <strong>constructing SDK components</strong>.</li>
<li><strong>All SDK components</strong> have a programmatic configuration API, and <strong>all other configuration mechanisms</strong> are built on <strong>top</strong> of this <strong>API</strong>.<ul>
<li>For example, the <strong>autoconfigure</strong> environment variable and system property configuration interface</li>
<li><strong>interprets</strong> well-known <strong>environment variables</strong> and <strong>system properties</strong> into a series of <strong>calls</strong> to the <strong>programmatic configuration API</strong>.</li>
</ul>
</li>
<li>While <strong>other configuration mechanisms</strong> offer <strong>more convenience</strong><ul>
<li>none offer the <strong>flexibility</strong> of <strong>writing code</strong> expressing the <strong>precise configuration</strong> required.</li>
</ul>
</li>
<li>When a <strong>particular capability</strong> isn’t supported by a <strong>higher order configuration mechanism</strong><ul>
<li>you might have <strong>no choice</strong> but to use programmatic configuration.</li>
</ul>
</li>
</ol>
<h2 id="Zero-code-SDK-autoconfigure"><a href="#Zero-code-SDK-autoconfigure" class="headerlink" title="Zero-code SDK autoconfigure"></a>Zero-code SDK autoconfigure</h2><ol>
<li>The <strong>autoconfigure module</strong> (artifact <strong>io.opentelemetry:opentelemetry-sdk-extension-autoconfigure:1.54.1</strong>)<ul>
<li>is a <strong>configuration interface</strong> built on <strong>top</strong> of the programmatic configuration interface, which <strong>configures</strong> SDK components with <strong>zero code</strong>.</li>
</ul>
</li>
<li>There are two distinct <strong>autoconfigure workflows</strong>:<ul>
<li><strong>Environment variables</strong> and <strong>system properties</strong><ul>
<li>interprets environment variables and system properties to <strong>create SDK components</strong></li>
<li>including <strong>various customization points</strong> for <strong>overlaying programmatic configuration</strong>.</li>
</ul>
</li>
<li><strong>Declarative configuration</strong> (currently under <strong>development</strong>)<ul>
<li>interprets a <strong>configuration model</strong> to <strong>create SDK components</strong>, which is typically <strong>encoded</strong> in a <strong>YAML configuration file</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Automatically configure SDK components</strong> using with <strong>autoconfigure</strong> as follows:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.OpenTelemetrySdk;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.AutoConfiguredOpenTelemetrySdk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfiguredSdk</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> OpenTelemetrySdk <span class="title function_">autoconfiguredSdk</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> AutoConfiguredOpenTelemetrySdk.initialize().getOpenTelemetrySdk();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>Java agent</strong> and <strong>Spring starter</strong> automatically configure the <strong>SDK</strong> using the <strong>zero-code SDK autoconfigure module</strong>, and <strong>install instrumentation</strong> with it.<ul>
<li>All <strong>autoconfigure content</strong> is <strong>applicable</strong> to <strong>Java agent</strong> and <strong>Spring starter</strong> users.</li>
</ul>
</li>
<li>The <strong>autoconfigure module</strong> registers <strong>Java shutdown hooks</strong> to <strong>shut down the SDK</strong> when <strong>appropriate</strong>.<ul>
<li>Because <strong>OpenTelemetry Java</strong> uses <strong>java.util.logging</strong> for <strong>internal logging</strong>, some logging might be <strong>suppressed</strong> during <strong>shutdown hooks</strong>.</li>
<li>This is a <strong>bug</strong> in the <strong>JDK itself</strong>, and not something under the control of OpenTelemetry Java.</li>
<li>If you require <strong>logging during shutdown hooks</strong><ul>
<li>consider using <strong>System.out</strong> rather than a <strong>logging framework</strong> which might <strong>shut itself down</strong> in a shutdown hook</li>
<li>thus <strong>suppressing</strong> your <strong>log messages</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Environment-variables-and-system-properties"><a href="#Environment-variables-and-system-properties" class="headerlink" title="Environment variables and system properties"></a>Environment variables and system properties</h3><ol>
<li>The <strong>autoconfigure module</strong> supports <strong>properties</strong> listed in the <strong>environment variable configuration specification</strong><ul>
<li>with <strong>occasional experimental</strong> and <strong>Java-specific additions</strong>.</li>
</ul>
</li>
<li>The following properties are listed as <strong>system properties</strong>, but can also be set using <strong>environment variables</strong>.<ul>
<li>Apply the following steps to convert a <strong>system property</strong> to an <strong>environment variable</strong>:<ul>
<li>Convert the name to <strong>uppercase</strong>.</li>
<li>Replace all <code>.</code> and <code>-</code> characters with <code>_</code>.</li>
</ul>
</li>
<li>For example, the <strong>otel.sdk.disabled</strong> system property is equivalent to the <strong>OTEL_SDK_DISABLED</strong> environment variable.</li>
</ul>
</li>
<li>If a property is defined as <strong>both</strong> a system property and environment variable, the <strong>system property takes priority</strong>.</li>
</ol>
<h4 id="Properties-general"><a href="#Properties-general" class="headerlink" title="Properties: general"></a>Properties: general</h4><blockquote>
<p>Properties for <strong>disabling</strong> the <strong>SDK</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.sdk.disabled</td>
<td>If true, disable the OpenTelemetry SDK.</td>
<td>false</td>
</tr>
</tbody></table>
<ol>
<li>If disabled, <strong>AutoConfiguredOpenTelemetrySdk#getOpenTelemetrySdk()</strong> returns a <strong>minimally configured instance</strong></li>
<li>for example, <strong>OpenTelemetrySdk.builder().build()</strong>.</li>
</ol>
<blockquote>
<p>Properties for <strong>attribute limits</strong> (see <strong>span limits</strong>, <strong>log limits</strong>):</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.attribute.value.length.limit</td>
<td>The <strong>maximum length</strong> of <strong>attribute values</strong>. Applies to <strong>spans</strong> and <strong>logs</strong>.<br /><strong>Overridden</strong> by <strong>otel.span.attribute.value.length.limit</strong>, <strong>otel.span.attribute.count.limit</strong>.</td>
<td>No limit</td>
</tr>
<tr>
<td>otel.attribute.count.limit</td>
<td>The <strong>maximum number</strong> of <strong>attributes</strong>.<br />Applies to <strong>spans</strong>, <strong>span events</strong>, <strong>span links</strong>, and <strong>logs</strong>.</td>
<td>128</td>
</tr>
</tbody></table>
<blockquote>
<p>Properties for <strong>context propagation</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.propagators</td>
<td>Comma-separated <strong>list</strong> of propagators.<br />Known values include <strong>tracecontext</strong>, <strong>baggage</strong>, b3, b3multi, jaeger, ottrace, xray, xray-lambda.</td>
<td><strong>tracecontext,baggage (W3C)</strong></td>
</tr>
</tbody></table>
<ol>
<li><strong>tracecontext</strong> configures <strong>W3CTraceContextPropagator</strong>.</li>
<li><strong>baggage</strong> configures <strong>W3CBaggagePropagator</strong>.</li>
<li><strong>b3, b3multi</strong> configures <strong>B3Propagator</strong>.</li>
<li><strong>jaeger</strong> configures <strong>JaegerPropagator</strong>.</li>
<li><strong>ottrace</strong> configures <strong>OtTracePropagator</strong>.</li>
<li><strong>xray</strong> configures <strong>AwsXrayPropagator</strong>.</li>
<li><strong>xray-lambda</strong> configures <strong>AwsXrayLambdaPropagator</strong>.</li>
</ol>
<h4 id="Properties-resource"><a href="#Properties-resource" class="headerlink" title="Properties: resource"></a>Properties: resource</h4><blockquote>
<p>Properties for configuring resource:</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td align="left">otel.service.name</td>
<td>Specify <strong>logical service name</strong>.<br />Takes <strong>precedence</strong> over <strong>service.name</strong> defined with <strong>otel.resource.attributes</strong>.</td>
<td>unknown_service:java</td>
</tr>
<tr>
<td align="left">otel.resource.attributes</td>
<td>Specify resource attributes in the following format: <strong>key1&#x3D;val1,key2&#x3D;val2,key3&#x3D;val3</strong>.</td>
<td></td>
</tr>
<tr>
<td align="left">otel.resource.disabled.keys</td>
<td>Specify resource attribute keys to <strong>filter</strong>.</td>
<td></td>
</tr>
<tr>
<td align="left">otel.java.enabled.resource.providers</td>
<td>Comma-separated <strong>list</strong> of ResourceProvider <strong>fully qualified class names</strong> to enable.<br />If <strong>unset</strong>, <strong>all</strong> resource providers are enabled.</td>
<td></td>
</tr>
<tr>
<td align="left">otel.java.disabled.resource.providers</td>
<td>Comma-separated list of ResourceProvider <strong>fully qualified class names</strong> to disable.</td>
<td></td>
</tr>
</tbody></table>
<ol>
<li>For example, to disable the <strong>OS resource provider</strong><ul>
<li>set -D<strong>otel.java.disabled.resource.providers</strong>&#x3D;<strong>io.opentelemetry.instrumentation.resources.OsResourceProvider</strong>.</li>
</ul>
</li>
<li>The <strong>otel.service.name</strong> and <strong>otel.resource.attributes</strong> system properties &#x2F; environment variables<ul>
<li>are <strong>interpreted</strong> in the <strong>io.opentelemetry.sdk.autoconfigure.EnvironmentResourceProvider</strong> resource provider.</li>
</ul>
</li>
<li>If opting in to specify <strong>resource providers</strong> via <strong>otel.java.enabled.resource-providers</strong>, you’ll likely want to include it to avoid surprises.</li>
</ol>
<h4 id="Properties-traces"><a href="#Properties-traces" class="headerlink" title="Properties: traces"></a>Properties: traces</h4><blockquote>
<p>Properties for <strong>batch span processor</strong>(s) paired with <strong>exporters</strong> specified via <strong>otel.traces.exporter</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.bsp.schedule.delay</td>
<td>The interval, in <strong>milliseconds</strong>, between two <strong>consecutive exports</strong>.</td>
<td>5000</td>
</tr>
<tr>
<td>otel.bsp.max.queue.size</td>
<td>The <strong>maximum number</strong> of spans that can be <strong>queued</strong> before batching.</td>
<td>2048</td>
</tr>
<tr>
<td>otel.bsp.max.export.batch.size</td>
<td>The <strong>maximum number</strong> of spans to <strong>export</strong> in a <strong>single batch</strong>.</td>
<td>512</td>
</tr>
<tr>
<td>otel.bsp.export.timeout</td>
<td>The maximum allowed time, in <strong>milliseconds</strong>, to export data.</td>
<td>30000</td>
</tr>
</tbody></table>
<blockquote>
<p>Properties for <strong>sampler</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.traces.sampler</td>
<td>The sampler to use.<br />Known values include always_on, always_off, traceidratio, parentbased_always_on, parentbased_always_off, <strong>parentbased_traceidratio</strong>, jaeger_remote.</td>
<td><strong>parentbased_always_on</strong></td>
</tr>
<tr>
<td>otel.traces.sampler.arg</td>
<td>An argument to the configured tracer if supported, for example a <strong>ratio</strong>.</td>
<td></td>
</tr>
</tbody></table>
<ol>
<li><strong>always_on</strong> configures <strong>AlwaysOnSampler</strong>.</li>
<li><strong>always_off</strong> configures <strong>AlwaysOffSampler</strong>.</li>
<li><strong>traceidratio</strong> configures <strong>TraceIdRatioBased</strong>.<ul>
<li><strong>otel.traces.sampler.arg</strong> sets the <strong>ratio</strong>.</li>
</ul>
</li>
<li><strong>parentbased_always_on</strong> configures <strong>ParentBased(root&#x3D;AlwaysOnSampler)</strong>.</li>
<li><strong>parentbased_always_off</strong> configures <strong>ParentBased(root&#x3D;AlwaysOffSampler).</strong></li>
<li><strong>parentbased_traceidratio</strong> configures <strong>ParentBased(root&#x3D;TraceIdRatioBased)</strong>.<ul>
<li><strong>otel.traces.sampler.arg</strong> sets the <strong>ratio</strong>.</li>
</ul>
</li>
<li><strong>jaeger_remote</strong> configures <strong>JaegerRemoteSampler</strong>.<ul>
<li><strong>otel.traces.sampler.arg</strong> is a <strong>comma-separated list of args</strong> as described in the specification.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Properties for <strong>span limits</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.span.attribute.value.length.limit</td>
<td>The <strong>maximum length</strong> of span <strong>attribute values</strong>.<br />Takes <strong>precedence</strong> over <strong>otel.attribute.value.length.limit</strong>.</td>
<td>No limit</td>
</tr>
<tr>
<td>otel.span.attribute.count.limit</td>
<td>The <strong>maximum number</strong> of <strong>attributes</strong> per span.<br />Takes <strong>precedence</strong> over <strong>otel.attribute.count.limit</strong>.</td>
<td>128</td>
</tr>
<tr>
<td>otel.span.event.count.limit</td>
<td>The <strong>maximum number</strong> of <strong>events</strong> per span.</td>
<td>128</td>
</tr>
<tr>
<td>otel.span.link.count.limit</td>
<td>The <strong>maximum number</strong> of <strong>links</strong> per span.</td>
<td>128</td>
</tr>
</tbody></table>
<h4 id="Properties-metrics"><a href="#Properties-metrics" class="headerlink" title="Properties: metrics"></a>Properties: metrics</h4><blockquote>
<p>Properties for <strong>periodic metric reader</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.metric.export.interval</td>
<td>The interval, in <strong>milliseconds</strong>, between the <strong>start of two export attempts</strong>.</td>
<td>60000</td>
</tr>
</tbody></table>
<blockquote>
<p>Properties for <strong>exemplars</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.metrics.exemplar.filter</td>
<td>The filter for <strong>exemplar sampling</strong>.<br />Can be <strong>ALWAYS_OFF</strong>, <strong>ALWAYS_ON</strong> or <strong>TRACE_BASED</strong>.</td>
<td><strong>TRACE_BASED</strong></td>
</tr>
</tbody></table>
<blockquote>
<p>Properties for <strong>cardinality limits</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.java.metrics.cardinality.limit</td>
<td>If set, configure cardinality limit.<br />The value dictates the maximum number of <strong>distinct points</strong> per metric.</td>
<td>2000</td>
</tr>
</tbody></table>
<h4 id="Properties-logs"><a href="#Properties-logs" class="headerlink" title="Properties: logs"></a>Properties: logs</h4><blockquote>
<p>Properties for <strong>log record processor</strong>(s) pared with <strong>exporters</strong> via <strong>otel.logs.exporter</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.blrp.schedule.delay</td>
<td>The interval, in <strong>milliseconds</strong>, between two <strong>consecutive exports</strong>.</td>
<td>1000</td>
</tr>
<tr>
<td>otel.blrp.max.queue.size</td>
<td>The maximum number of log records that can be <strong>queued</strong> before batching.</td>
<td>2048</td>
</tr>
<tr>
<td>otel.blrp.max.export.batch.size</td>
<td>The maximum number of log records to <strong>export</strong> in a <strong>single batch</strong>.</td>
<td>512</td>
</tr>
<tr>
<td>otel.blrp.export.timeout</td>
<td>The maximum allowed time, in <strong>milliseconds</strong>, to export data.</td>
<td>30000</td>
</tr>
</tbody></table>
<h4 id="Properties-exporters"><a href="#Properties-exporters" class="headerlink" title="Properties: exporters"></a>Properties: exporters</h4><blockquote>
<p>Properties for setting exporters:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Purpose</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.traces.exporter</td>
<td>Comma-separated <strong>list</strong> of span exporters.<br />Known values include <strong>otlp</strong>, zipkin, console, logging-otlp, none.</td>
<td><strong>otlp</strong></td>
</tr>
<tr>
<td>otel.metrics.exporter</td>
<td>Comma-separated <strong>list</strong> of metric exporters.<br />Known values include <strong>otlp</strong>, prometheus, none.</td>
<td><strong>otlp</strong></td>
</tr>
<tr>
<td>otel.logs.exporter</td>
<td>Comma-separated <strong>list</strong> of log record exporters.<br />Known values include <strong>otlp</strong>, console, logging-otlp, none.</td>
<td><strong>otlp</strong></td>
</tr>
<tr>
<td>otel.java.exporter.memory_mode</td>
<td>If reusable_data, enable reusable memory mode (on exporters which support it) to <strong>reduce allocations</strong>.<br />Known values include <strong>reusable_data</strong>, <strong>immutable_data</strong>.</td>
<td>reusable_data</td>
</tr>
</tbody></table>
<ol>
<li>Known exporters and artifacts<ul>
<li><strong>otlp</strong> configures <strong>OtlpHttp{Signal}Exporter</strong> &#x2F; <strong>OtlpGrpc{Signal}Exporter</strong>.</li>
<li><strong>zipkin</strong> configures <strong>ZipkinSpanExporter</strong>.</li>
<li><strong>console</strong> configures <strong>LoggingSpanExporter</strong>, <strong>LoggingMetricExporter</strong>, <strong>SystemOutLogRecordExporter</strong>.</li>
<li><strong>logging-otlp</strong> configures <strong>OtlpJsonLogging{Signal}Exporter</strong>.</li>
<li><strong>experimental-otlp&#x2F;stdout</strong> configures <strong>OtlpStdout{Signal}Exporter</strong> (this option is <strong>experimental</strong> and subject to <strong>change</strong> or <strong>removal</strong>).</li>
</ul>
</li>
<li>Exporters which adhere to <strong>otel.java.exporter.memory_mode&#x3D;reusable_data</strong><ul>
<li>are <strong>OtlpGrpc{Signal}Exporter</strong>, <strong>OtlpHttp{Signal}Exporter</strong>, <strong>OtlpStdout{Signal}Exporter</strong>, and <strong>PrometheusHttpServer</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Properties for <strong>otlp span, metric, and log exporters</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.{signal}.exporter&#x3D;otlp</td>
<td>Select the OpenTelemetry exporter for {signal}.</td>
<td></td>
</tr>
<tr>
<td>otel.exporter.otlp.protocol</td>
<td>The <strong>transport protocol</strong> to use on OTLP trace, metric, and log requests.<br />Options include <strong>grpc</strong> and <strong>http&#x2F;protobuf</strong>.</td>
<td><strong>grpc</strong></td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.protocol</td>
<td>The <strong>transport protocol</strong> to use on OTLP {signal} requests.<br />Options include <strong>grpc</strong> and <strong>http&#x2F;protobuf</strong></td>
<td><strong>grpc</strong></td>
</tr>
<tr>
<td>otel.exporter.otlp.endpoint</td>
<td>The endpoint to send all OTLP traces, metrics, and logs to.<br />Often the address of an <strong>OpenTelemetry Collector</strong>.<br />Must be a URL with a scheme of either <strong>http</strong> or <strong>https</strong> based on the use of <strong>TLS</strong>.</td>
<td><a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a> when protocol is <strong>grpc</strong><br /><a target="_blank" rel="noopener" href="http://localhost:4318/">http://localhost:4318</a> when protocol is <strong>http&#x2F;protobuf</strong></td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.endpoint</td>
<td>The endpoint to send OTLP {signal} to.<br />Often the address of an <strong>OpenTelemetry Collector</strong>.<br />Must be a URL with a scheme of either <strong>http</strong> or <strong>https</strong> based on the use of <strong>TLS</strong>.<br />If protocol is <strong>http&#x2F;protobuf</strong> the <strong>version</strong> and <strong>signal</strong> must be <strong>appended to the path</strong> (e.g. <strong>v1&#x2F;traces</strong>, <strong>v1&#x2F;metrics</strong>, or <strong>v1&#x2F;logs</strong>)</td>
<td><a target="_blank" rel="noopener" href="http://localhost:4317/">http://localhost:4317</a> when protocol is grpc<br /><strong><a target="_blank" rel="noopener" href="http://localhost:4318/v1/%7Bsignal%7D">http://localhost:4318/v1/{signal}</a></strong> when protocol is <strong>http&#x2F;protobuf</strong>.</td>
</tr>
<tr>
<td>otel.exporter.otlp.certificate</td>
<td>The path to the <strong>file</strong> containing <strong>trusted certificates</strong> to use when verifying an OTLP trace, metric, or log <strong>server’s TLS credentials</strong>.<br />The file should contain one or more <strong>X.509 certificates</strong> in <strong>PEM format</strong>.</td>
<td>The host platform’s <strong>trusted root certificates</strong> are used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.certificate</td>
<td>The path to the <strong>file</strong> containing <strong>trusted certificates</strong> to use when verifying an OTLP {signal} <strong>server’s TLS credentials</strong>.<br />The file should contain one or more <strong>X.509 certificates</strong> in <strong>PEM format</strong>.</td>
<td>The host platform’s <strong>trusted root certificates</strong> are used</td>
</tr>
<tr>
<td>otel.exporter.otlp.client.key</td>
<td>The path to the <strong>file</strong> containing <strong>private client key</strong> to use when verifying an OTLP trace, metric, or log <strong>client’s TLS credentials</strong>.<br />The file should contain one <strong>private key PKCS8 PEM format</strong>.</td>
<td>No client key file is used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.client.key</td>
<td>The path to the <strong>file</strong> containing <strong>private client key</strong> to use when verifying an OTLP {signal} <strong>client’s TLS credentials</strong>.<br />The file should contain one <strong>private key PKCS8 PEM format</strong>.</td>
<td>No client key file is used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.client.certificate</td>
<td>The path to the <strong>file</strong> containing <strong>trusted certificates</strong> to use when verifying an OTLP trace, metric, or log <strong>client’s TLS credentials</strong>.<br />The file should contain one or more <strong>X.509 certificates</strong> in <strong>PEM format</strong>.</td>
<td>No chain file is used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.client.certificate</td>
<td>The path to the <strong>file</strong> containing <strong>trusted certificates</strong> to use when verifying an OTLP {signal} <strong>client’s TLS credentials</strong>.<br />The file should contain one or more <strong>X.509 certificates</strong> in <strong>PEM format</strong>.</td>
<td>No chain file is used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.headers</td>
<td><strong>Key-value pairs</strong> separated by <strong>commas</strong> to pass as <strong>request headers</strong> on OTLP trace, metric, and log requests.</td>
<td></td>
</tr>
<tr>
<td>otel.exporter.otlp.compression</td>
<td>The compression type to use on OTLP trace, metric, and log requests. Options include <strong>gzip</strong>.</td>
<td>No compression will be used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.compression</td>
<td>The compression type to use on OTLP {signal} requests. Options include <strong>gzip</strong>.</td>
<td>No compression will be used.</td>
</tr>
<tr>
<td>otel.exporter.otlp.timeout</td>
<td>The <strong>maximum waiting time</strong>, in <strong>milliseconds</strong>, allowed to send <strong>each</strong> OTLP trace, metric, and log <strong>batch</strong>.</td>
<td>10000</td>
</tr>
<tr>
<td>otel.exporter.otlp.{signal}.timeout</td>
<td>The <strong>maximum waiting time</strong>, in <strong>milliseconds</strong>, allowed to send <strong>each</strong> OTLP {signal} <strong>batch</strong>.</td>
<td>10000</td>
</tr>
<tr>
<td>otel.exporter.otlp.metrics.temporality.preference</td>
<td>The preferred output <strong>aggregation temporality</strong>.<br />Options include <strong>DELTA</strong>, <strong>LOWMEMORY</strong>, and <strong>CUMULATIVE</strong>.<br />If <strong>CUMULATIVE</strong>, <strong>all instruments</strong> will have <strong>cumulative temporality</strong>.<br />If <strong>DELTA</strong>, <strong>counter (sync and async) and histograms</strong> will be <strong>delta</strong>, <strong>up down counters (sync and async)</strong> will be <strong>cumulative</strong>.<br />If <strong>LOWMEMORY</strong>, <strong>sync counter and histograms</strong> will be <strong>delta</strong>, <strong>async counter and up down counters (sync and async)</strong> will be <strong>cumulative</strong>.</td>
<td>CUMULATIVE</td>
</tr>
<tr>
<td>otel.exporter.otlp.metrics.default.histogram.aggregation</td>
<td>The preferred default <strong>histogram aggregation</strong>.<br />Options include <strong>BASE2_EXPONENTIAL_BUCKET_HISTOGRAM</strong> and <strong>EXPLICIT_BUCKET_HISTOGRAM</strong>.</td>
<td>EXPLICIT_BUCKET_HISTOGRAM</td>
</tr>
<tr>
<td>otel.java.exporter.otlp.retry.disabled</td>
<td>If false, retry on when <strong>transient errors occur</strong>.</td>
<td>false</td>
</tr>
</tbody></table>
<ol>
<li>The text placeholder <strong>{signal}</strong> refers to the <strong>supported OpenTelemetry Signal</strong>. Valid values include <strong>traces</strong>, <strong>metrics</strong>, and <strong>logs</strong>.</li>
<li>Signal specific configurations <strong>take priority over</strong> the generic versions. <ul>
<li>For example, if you set both <strong>otel.exporter.otlp.endpoint</strong> and <strong>otel.exporter.otlp.traces.endpoint</strong>, the latter will take precedence.</li>
</ul>
</li>
<li><strong>OpenTelemetry Java agent 2.x</strong> and the <strong>OpenTelemetry Spring Boot starter</strong> use <strong>http&#x2F;protobuf</strong> by default.</li>
<li>OTLP requires <strong>transient errors</strong> to be <strong>handled</strong> with a <strong>retry strategy</strong>.<ul>
<li>When retry is enabled, <strong>retryable gRPC status codes</strong> are retried using an <strong>exponential backoff</strong> with <strong>jitter algorithm</strong>.</li>
<li>The <strong>specific options</strong> of <strong>RetryPolicy</strong> can only be <strong>customized</strong> via <strong>programmatic customization</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Properties for <strong>zipkin span exporter</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.traces.exporter&#x3D;zipkin</td>
<td>Select the Zipkin exporter</td>
<td></td>
</tr>
<tr>
<td>otel.exporter.zipkin.endpoint</td>
<td>The Zipkin endpoint to connect to. Only <strong>HTTP</strong> is supported.</td>
<td><a target="_blank" rel="noopener" href="http://localhost:9411/api/v2/spans">http://localhost:9411/api/v2/spans</a></td>
</tr>
</tbody></table>
<blockquote>
<p>Properties for <strong>prometheus metric exporter</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.metrics.exporter&#x3D;prometheus</td>
<td>Select the Prometheus exporter</td>
<td></td>
</tr>
<tr>
<td>otel.exporter.prometheus.port</td>
<td>The <strong>local port</strong> used to <strong>bind</strong> the <strong>prometheus metric server</strong>.</td>
<td>9464</td>
</tr>
<tr>
<td>otel.exporter.prometheus.host</td>
<td>The <strong>local address</strong> used to <strong>bind</strong> the <strong>prometheus metric server</strong>.</td>
<td>0.0.0.0</td>
</tr>
</tbody></table>
<h4 id="Programmatic-customization"><a href="#Programmatic-customization" class="headerlink" title="Programmatic customization"></a>Programmatic customization</h4><ol>
<li>Programmatic customization provides <strong>hooks</strong> to supplement the <strong>supported properties</strong> with <strong>programmatic configuration</strong>.</li>
<li>If using the <strong>Spring starter</strong>, see also <strong>spring starter programmatic configuration</strong>.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.OpenTelemetrySdk;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.AutoConfiguredOpenTelemetrySdk;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizedAutoConfiguredSdk</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> OpenTelemetrySdk <span class="title function_">autoconfiguredSdk</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> AutoConfiguredOpenTelemetrySdk.builder()</span><br><span class="line">        <span class="comment">// Optionally customize TextMapPropagator.</span></span><br><span class="line">        .addPropagatorCustomizer((textMapPropagator, configProperties) -&gt; textMapPropagator)</span><br><span class="line">        <span class="comment">// Optionally customize Resource.</span></span><br><span class="line">        .addResourceCustomizer((resource, configProperties) -&gt; resource)</span><br><span class="line">        <span class="comment">// Optionally customize Sampler.</span></span><br><span class="line">        .addSamplerCustomizer((sampler, configProperties) -&gt; sampler)</span><br><span class="line">        <span class="comment">// Optionally customize SpanExporter.</span></span><br><span class="line">        .addSpanExporterCustomizer((spanExporter, configProperties) -&gt; spanExporter)</span><br><span class="line">        <span class="comment">// Optionally customize SpanProcessor.</span></span><br><span class="line">        .addSpanProcessorCustomizer((spanProcessor, configProperties) -&gt; spanProcessor)</span><br><span class="line">        <span class="comment">// Optionally supply additional properties.</span></span><br><span class="line">        .addPropertiesSupplier(Collections::emptyMap)</span><br><span class="line">        <span class="comment">// Optionally customize ConfigProperties.</span></span><br><span class="line">        .addPropertiesCustomizer(configProperties -&gt; Collections.emptyMap())</span><br><span class="line">        <span class="comment">// Optionally customize SdkTracerProviderBuilder.</span></span><br><span class="line">        .addTracerProviderCustomizer((builder, configProperties) -&gt; builder)</span><br><span class="line">        <span class="comment">// Optionally customize SdkMeterProviderBuilder.</span></span><br><span class="line">        .addMeterProviderCustomizer((builder, configProperties) -&gt; builder)</span><br><span class="line">        <span class="comment">// Optionally customize MetricExporter.</span></span><br><span class="line">        .addMetricExporterCustomizer((metricExporter, configProperties) -&gt; metricExporter)</span><br><span class="line">        <span class="comment">// Optionally customize MetricReader.</span></span><br><span class="line">        .addMetricReaderCustomizer((metricReader, configProperties) -&gt; metricReader)</span><br><span class="line">        <span class="comment">// Optionally customize SdkLoggerProviderBuilder.</span></span><br><span class="line">        .addLoggerProviderCustomizer((builder, configProperties) -&gt; builder)</span><br><span class="line">        <span class="comment">// Optionally customize LogRecordExporter.</span></span><br><span class="line">        .addLogRecordExporterCustomizer((logRecordExporter, configProperties) -&gt; logRecordExporter)</span><br><span class="line">        <span class="comment">// Optionally customize LogRecordProcessor.</span></span><br><span class="line">        .addLogRecordProcessorCustomizer((processor, configProperties) -&gt; processor)</span><br><span class="line">        .build()</span><br><span class="line">        .getOpenTelemetrySdk();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SPI-Service-provider-interface"><a href="#SPI-Service-provider-interface" class="headerlink" title="SPI (Service provider interface)"></a>SPI (Service provider interface)</h4><ol>
<li>SPIs (artifact <strong>io.opentelemetry:opentelemetry-sdk-extension-autoconfigure-spi:1.54.1</strong>)<ul>
<li><strong>extend SDK autoconfiguration</strong> beyond the components built-in to the SDK.</li>
</ul>
</li>
<li>The following sections describe the available SPIs. Each SPI section includes:<ul>
<li>A brief description, including link to Javadoc type reference.</li>
<li>A table of available <strong>built-in</strong> and <strong>opentelemetry-java-contrib</strong> implementations.</li>
<li>A simple demonstration of a <strong>custom implementation</strong>.</li>
</ul>
</li>
</ol>
<h5 id="ResourceProvider"><a href="#ResourceProvider" class="headerlink" title="ResourceProvider"></a>ResourceProvider</h5><p>ResourceProviders contribute to the <strong>autoconfigured resource</strong>.</p>
<blockquote>
<p>ResourceProviders <strong>built-in</strong> to the <strong>SDK</strong> and maintained by the community in <strong>opentelemetry-java-contrib</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Class</th>
<th>Artifact</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>io.opentelemetry.sdk.autoconfigure.internal.EnvironmentResourceProvider</td>
<td>io.opentelemetry:opentelemetry-sdk-extension-autoconfigure:1.54.1</td>
<td>Provides <strong>resource attributes</strong> based on <strong>OTEL_SERVICE_NAME</strong> and <strong>OTEL_RESOURCE_ATTRIBUTES</strong> env vars.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.ContainerResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides container resource attributes.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.HostResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides host resource attributes.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.HostIdResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides host ID resource attribute.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.ManifestResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides service resource attributes based on <strong>jar manifest</strong>.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.OsResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides OS resource attributes.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.ProcessResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides process resource attributes.</td>
</tr>
<tr>
<td>io.opentelemetry.instrumentation.resources.ProcessRuntimeResourceProvider</td>
<td>io.opentelemetry.instrumentation:opentelemetry-resources:2.20.1-alpha</td>
<td>Provides process runtime resource attributes.</td>
</tr>
</tbody></table>
<blockquote>
<p>Implement the <strong>ResourceProvider interface</strong> to participate in <strong>resource autoconfiguration</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ResourceProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.resources.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomResourceProvider</span> <span class="keyword">implements</span> <span class="title class_">ResourceProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Resource <span class="title function_">createResource</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked to contribute to the resource.</span></span><br><span class="line">    <span class="keyword">return</span> Resource.builder().put(<span class="string">&quot;my.custom.resource.attribute&quot;</span>, <span class="string">&quot;abc123&quot;</span>).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">order</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally influence the order of invocation.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="AutoConfigurationCustomizerProvider"><a href="#AutoConfigurationCustomizerProvider" class="headerlink" title="AutoConfigurationCustomizerProvider"></a>AutoConfigurationCustomizerProvider</h5><blockquote>
<p>Implement the <strong>AutoConfigurationCustomizerProvider interface</strong> to customize a variety of <strong>autoconfigured SDK components</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.AutoConfigurationCustomizer;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.AutoConfigurationCustomizerProvider;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizerProvider</span> <span class="keyword">implements</span> <span class="title class_">AutoConfigurationCustomizerProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(AutoConfigurationCustomizer customizer)</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally customize TextMapPropagator.</span></span><br><span class="line">    customizer.addPropagatorCustomizer((textMapPropagator, configProperties) -&gt; textMapPropagator);</span><br><span class="line">    <span class="comment">// Optionally customize Resource.</span></span><br><span class="line">    customizer.addResourceCustomizer((resource, configProperties) -&gt; resource);</span><br><span class="line">    <span class="comment">// Optionally customize Sampler.</span></span><br><span class="line">    customizer.addSamplerCustomizer((sampler, configProperties) -&gt; sampler);</span><br><span class="line">    <span class="comment">// Optionally customize SpanExporter.</span></span><br><span class="line">    customizer.addSpanExporterCustomizer((spanExporter, configProperties) -&gt; spanExporter);</span><br><span class="line">    <span class="comment">// Optionally customize SpanProcessor.</span></span><br><span class="line">    customizer.addSpanProcessorCustomizer((spanProcessor, configProperties) -&gt; spanProcessor);</span><br><span class="line">    <span class="comment">// Optionally supply additional properties.</span></span><br><span class="line">    customizer.addPropertiesSupplier(Collections::emptyMap);</span><br><span class="line">    <span class="comment">// Optionally customize ConfigProperties.</span></span><br><span class="line">    customizer.addPropertiesCustomizer(configProperties -&gt; Collections.emptyMap());</span><br><span class="line">    <span class="comment">// Optionally customize SdkTracerProviderBuilder.</span></span><br><span class="line">    customizer.addTracerProviderCustomizer((builder, configProperties) -&gt; builder);</span><br><span class="line">    <span class="comment">// Optionally customize SdkMeterProviderBuilder.</span></span><br><span class="line">    customizer.addMeterProviderCustomizer((builder, configProperties) -&gt; builder);</span><br><span class="line">    <span class="comment">// Optionally customize MetricExporter.</span></span><br><span class="line">    customizer.addMetricExporterCustomizer((metricExporter, configProperties) -&gt; metricExporter);</span><br><span class="line">    <span class="comment">// Optionally customize MetricReader.</span></span><br><span class="line">    customizer.addMetricReaderCustomizer((metricReader, configProperties) -&gt; metricReader);</span><br><span class="line">    <span class="comment">// Optionally customize SdkLoggerProviderBuilder.</span></span><br><span class="line">    customizer.addLoggerProviderCustomizer((builder, configProperties) -&gt; builder);</span><br><span class="line">    <span class="comment">// Optionally customize LogRecordExporter.</span></span><br><span class="line">    customizer.addLogRecordExporterCustomizer((exporter, configProperties) -&gt; exporter);</span><br><span class="line">    <span class="comment">// Optionally customize LogRecordProcessor.</span></span><br><span class="line">    customizer.addLogRecordProcessorCustomizer((processor, configProperties) -&gt; processor);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">order</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Optionally influence the order of invocation.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ConfigurableSpanExporterProvider"><a href="#ConfigurableSpanExporterProvider" class="headerlink" title="ConfigurableSpanExporterProvider"></a>ConfigurableSpanExporterProvider</h5><blockquote>
<p>Implement the <strong>ConfigurableSpanExporterProvider interface</strong> to allow a <strong>custom span exporter</strong> to participate in <strong>autoconfiguration</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.traces.ConfigurableSpanExporterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.export.SpanExporter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSpanExporterProvider</span> <span class="keyword">implements</span> <span class="title class_">ConfigurableSpanExporterProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> SpanExporter <span class="title function_">createExporter</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when OTEL_TRACES_EXPORTER includes the value from getName().</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomSpanExporter</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom-exporter&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ConfigurableMetricExporterProvider"><a href="#ConfigurableMetricExporterProvider" class="headerlink" title="ConfigurableMetricExporterProvider"></a>ConfigurableMetricExporterProvider</h5><blockquote>
<p>Implement the <strong>ConfigurableMetricExporterProvider interface</strong> to allow a <strong>custom metric exporter</strong> to participate in <strong>autoconfiguration</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.metrics.ConfigurableMetricExporterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.metrics.export.MetricExporter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMetricExporterProvider</span> <span class="keyword">implements</span> <span class="title class_">ConfigurableMetricExporterProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> MetricExporter <span class="title function_">createExporter</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when OTEL_METRICS_EXPORTER includes the value from getName().</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomMetricExporter</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom-exporter&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ConfigurableLogRecordExporterProvider"><a href="#ConfigurableLogRecordExporterProvider" class="headerlink" title="ConfigurableLogRecordExporterProvider"></a>ConfigurableLogRecordExporterProvider</h5><blockquote>
<p>Implement the ConfigurableLogRecordExporterProvider interface to allow a custom log record exporter to participate in autoconfiguration. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.logs.ConfigurableLogRecordExporterProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.logs.export.LogRecordExporter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomLogRecordExporterProvider</span> <span class="keyword">implements</span> <span class="title class_">ConfigurableLogRecordExporterProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> LogRecordExporter <span class="title function_">createExporter</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when OTEL_LOGS_EXPORTER includes the value from getName().</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomLogRecordExporter</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom-exporter&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ConfigurableSamplerProvider"><a href="#ConfigurableSamplerProvider" class="headerlink" title="ConfigurableSamplerProvider"></a>ConfigurableSamplerProvider</h5><blockquote>
<p>Implement the <strong>ConfigurableSamplerProvider interface</strong> to allow a <strong>custom sampler</strong> to participate in <strong>autoconfiguration</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.traces.ConfigurableSamplerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.trace.samplers.Sampler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomSamplerProvider</span> <span class="keyword">implements</span> <span class="title class_">ConfigurableSamplerProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Sampler <span class="title function_">createSampler</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when OTEL_TRACES_SAMPLER is set to the value from getName().</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomSampler</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom-sampler&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ConfigurablePropagatorProvider"><a href="#ConfigurablePropagatorProvider" class="headerlink" title="ConfigurablePropagatorProvider"></a>ConfigurablePropagatorProvider</h5><blockquote>
<p>Implement the <strong>ConfigurablePropagatorProvider interface</strong> to allow a <strong>custom propagator</strong> to participate in <strong>autoconfiguration</strong>. For example:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.context.propagation.TextMapPropagator;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigProperties;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.ConfigurablePropagatorProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomTextMapPropagatorProvider</span> <span class="keyword">implements</span> <span class="title class_">ConfigurablePropagatorProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> TextMapPropagator <span class="title function_">getPropagator</span><span class="params">(ConfigProperties config)</span> &#123;</span><br><span class="line">    <span class="comment">// Callback invoked when OTEL_PROPAGATORS includes the value from getName().</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomTextMapPropagator</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom-propagator&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Declarative-configuration"><a href="#Declarative-configuration" class="headerlink" title="Declarative configuration"></a>Declarative configuration</h3><ol>
<li>Declarative configuration is currently <strong>under development</strong>.<ul>
<li>It allows for <strong>YAML file-based configuration</strong> as described in <strong>opentelemetry-configuration</strong> and <strong>declarative configuration</strong>.</li>
</ul>
</li>
<li>Include io.opentelemetry:opentelemetry-sdk-extension-incubator:1.54.1-alpha and specify the path to the config file as described in the table below.</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Purpose</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>otel.experimental.config.file</td>
<td>The path to the SDK configuration file.</td>
<td>Unset</td>
</tr>
</tbody></table>
<ol>
<li>When a <strong>config file</strong> is specified, <strong>environment variables</strong> and <strong>system properties</strong> are <strong>ignored</strong>, <strong>programmatic customization</strong> and <strong>SPIs</strong> are <strong>skipped</strong>.</li>
<li>The contents of the file <strong>alone</strong> dictate SDK configuration.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/20/cloud-native-observability-opentelemetry-java/">https://blog.zhongmingmao.top/2025/01/20/cloud-native-observability-opentelemetry-java/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/opentelemetry/">OpenTelemetry</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Observability - OpenTelemetry Java Zero Code</div></div></a></div><div class="next-post pull-right"><a href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">AI Agent - MCP Overview</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-21</div><div class="title">Observability - OpenTelemetry Java Zero Code</div></div></a></div><div><a href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-05</div><div class="title">Observability - OpenTelemetry Python</div></div></a></div><div><a href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="title">Observability - OpenTelemetry Go</div></div></a></div><div><a href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="title">Observability - OpenTelemetry Node.js</div></div></a></div><div><a href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="title">Observability - OpenTelemetry Doc V2</div></div></a></div><div><a href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="title">Observability - OpenTelemetry Doc V1</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">639</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intro-to-OpenTelemetry-Java"><span class="toc-number">1.</span> <span class="toc-text">Intro to OpenTelemetry Java</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-number">1.1.</span> <span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Navigating-the-docs"><span class="toc-number">1.2.</span> <span class="toc-text">Navigating the docs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Repositories"><span class="toc-number">1.3.</span> <span class="toc-text">Repositories</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependencies-and-BOMs"><span class="toc-number">1.4.</span> <span class="toc-text">Dependencies and BOMs</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started-by-Example"><span class="toc-number">2.</span> <span class="toc-text">Getting Started by Example</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-Application"><span class="toc-number">2.1.</span> <span class="toc-text">Example Application</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependencies"><span class="toc-number">2.1.1.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-and-launch-an-HTTP-Server"><span class="toc-number">2.1.2.</span> <span class="toc-text">Create and launch an HTTP Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation"><span class="toc-number">2.2.</span> <span class="toc-text">Instrumentation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Instrumentation-ecosystem"><span class="toc-number">3.</span> <span class="toc-text">Instrumentation ecosystem</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation-categories"><span class="toc-number">3.1.</span> <span class="toc-text">Instrumentation categories</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zero-code-Java-agent"><span class="toc-number">3.1.1.</span> <span class="toc-text">Zero-code: Java agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zero-code-Spring-Boot-starter"><span class="toc-number">3.1.2.</span> <span class="toc-text">Zero-code: Spring Boot starter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Library-instrumentation"><span class="toc-number">3.1.3.</span> <span class="toc-text">Library instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Native-instrumentation"><span class="toc-number">3.1.4.</span> <span class="toc-text">Native instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Manual-instrumentation"><span class="toc-number">3.1.5.</span> <span class="toc-text">Manual instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shims"><span class="toc-number">3.1.6.</span> <span class="toc-text">Shims</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-propagation"><span class="toc-number">3.2.</span> <span class="toc-text">Context propagation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Semantic-conventions"><span class="toc-number">3.3.</span> <span class="toc-text">Semantic conventions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Log-instrumentation"><span class="toc-number">3.4.</span> <span class="toc-text">Log instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Direct-to-collector"><span class="toc-number">3.4.1.</span> <span class="toc-text">Direct to collector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Via-file-or-stdout"><span class="toc-number">3.4.2.</span> <span class="toc-text">Via file or stdout</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Record-Telemetry-with-API"><span class="toc-number">4.</span> <span class="toc-text">Record Telemetry with API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context-API"><span class="toc-number">4.1.</span> <span class="toc-text">Context API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Context"><span class="toc-number">4.1.1.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContextStorage"><span class="toc-number">4.1.2.</span> <span class="toc-text">ContextStorage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ContextPropagators"><span class="toc-number">4.1.3.</span> <span class="toc-text">ContextPropagators</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenTelemetry-API"><span class="toc-number">4.2.</span> <span class="toc-text">OpenTelemetry API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Providers-and-Scopes"><span class="toc-number">4.2.1.</span> <span class="toc-text">Providers and Scopes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Attributes"><span class="toc-number">4.2.2.</span> <span class="toc-text">Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetry"><span class="toc-number">4.2.3.</span> <span class="toc-text">OpenTelemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GlobalOpenTelemetry"><span class="toc-number">4.2.4.</span> <span class="toc-text">GlobalOpenTelemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TracerProvider"><span class="toc-number">4.2.5.</span> <span class="toc-text">TracerProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Tracer"><span class="toc-number">4.2.5.1.</span> <span class="toc-text">Tracer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Span"><span class="toc-number">4.2.5.2.</span> <span class="toc-text">Span</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MeterProvider"><span class="toc-number">4.2.6.</span> <span class="toc-text">MeterProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Meter"><span class="toc-number">4.2.6.1.</span> <span class="toc-text">Meter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Counter"><span class="toc-number">4.2.6.2.</span> <span class="toc-text">Counter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Counter"><span class="toc-number">4.2.6.3.</span> <span class="toc-text">Async Counter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UpDownCounter"><span class="toc-number">4.2.6.4.</span> <span class="toc-text">UpDownCounter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-UpDownCounter"><span class="toc-number">4.2.6.5.</span> <span class="toc-text">Async UpDownCounter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Histogram"><span class="toc-number">4.2.6.6.</span> <span class="toc-text">Histogram</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Gauge"><span class="toc-number">4.2.6.7.</span> <span class="toc-text">Gauge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Async-Gauge"><span class="toc-number">4.2.6.8.</span> <span class="toc-text">Async Gauge</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoggerProvider"><span class="toc-number">4.2.7.</span> <span class="toc-text">LoggerProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Logger"><span class="toc-number">4.2.7.1.</span> <span class="toc-text">Logger</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LogRecordBuilder"><span class="toc-number">4.2.7.2.</span> <span class="toc-text">LogRecordBuilder</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Noop-implementation"><span class="toc-number">4.2.8.</span> <span class="toc-text">Noop implementation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Semantic-attributes"><span class="toc-number">4.2.9.</span> <span class="toc-text">Semantic attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Baggage"><span class="toc-number">4.2.10.</span> <span class="toc-text">Baggage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Incubating-API"><span class="toc-number">4.3.</span> <span class="toc-text">Incubating API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Manage-Telemetry-with-SDK"><span class="toc-number">5.</span> <span class="toc-text">Manage Telemetry with SDK</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SDK-plugin-extension-interfaces"><span class="toc-number">5.1.</span> <span class="toc-text">SDK plugin extension interfaces</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SDK-components"><span class="toc-number">5.2.</span> <span class="toc-text">SDK components</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetrySdk"><span class="toc-number">5.2.1.</span> <span class="toc-text">OpenTelemetrySdk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource"><span class="toc-number">5.2.2.</span> <span class="toc-text">Resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SdkTracerProvider"><span class="toc-number">5.2.3.</span> <span class="toc-text">SdkTracerProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Sampler"><span class="toc-number">5.2.3.1.</span> <span class="toc-text">Sampler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpanProcessor"><span class="toc-number">5.2.3.2.</span> <span class="toc-text">SpanProcessor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpanExporter"><span class="toc-number">5.2.3.3.</span> <span class="toc-text">SpanExporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpanLimits"><span class="toc-number">5.2.3.4.</span> <span class="toc-text">SpanLimits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SdkMeterProvider"><span class="toc-number">5.2.4.</span> <span class="toc-text">SdkMeterProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MetricReader"><span class="toc-number">5.2.4.1.</span> <span class="toc-text">MetricReader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MetricExporter"><span class="toc-number">5.2.4.2.</span> <span class="toc-text">MetricExporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Views"><span class="toc-number">5.2.4.3.</span> <span class="toc-text">Views</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SdkLoggerProvider"><span class="toc-number">5.2.5.</span> <span class="toc-text">SdkLoggerProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LogRecordProcessor"><span class="toc-number">5.2.5.1.</span> <span class="toc-text">LogRecordProcessor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LogRecordExporter"><span class="toc-number">5.2.5.2.</span> <span class="toc-text">LogRecordExporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LogLimits"><span class="toc-number">5.2.5.3.</span> <span class="toc-text">LogLimits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TextMapPropagator"><span class="toc-number">5.2.6.</span> <span class="toc-text">TextMapPropagator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Appendix"><span class="toc-number">5.3.</span> <span class="toc-text">Appendix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internal-logging"><span class="toc-number">5.3.1.</span> <span class="toc-text">Internal logging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OTLP-exporters"><span class="toc-number">5.3.2.</span> <span class="toc-text">OTLP exporters</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Senders"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">Senders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Authentication"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">Authentication</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Configure-the-SDK"><span class="toc-number">6.</span> <span class="toc-text">Configure the SDK</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Programmatic-configuration"><span class="toc-number">6.1.</span> <span class="toc-text">Programmatic configuration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zero-code-SDK-autoconfigure"><span class="toc-number">6.2.</span> <span class="toc-text">Zero-code SDK autoconfigure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Environment-variables-and-system-properties"><span class="toc-number">6.2.1.</span> <span class="toc-text">Environment variables and system properties</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-general"><span class="toc-number">6.2.1.1.</span> <span class="toc-text">Properties: general</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-resource"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">Properties: resource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-traces"><span class="toc-number">6.2.1.3.</span> <span class="toc-text">Properties: traces</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-metrics"><span class="toc-number">6.2.1.4.</span> <span class="toc-text">Properties: metrics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-logs"><span class="toc-number">6.2.1.5.</span> <span class="toc-text">Properties: logs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties-exporters"><span class="toc-number">6.2.1.6.</span> <span class="toc-text">Properties: exporters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Programmatic-customization"><span class="toc-number">6.2.1.7.</span> <span class="toc-text">Programmatic customization</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SPI-Service-provider-interface"><span class="toc-number">6.2.1.8.</span> <span class="toc-text">SPI (Service provider interface)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ResourceProvider"><span class="toc-number">6.2.1.8.1.</span> <span class="toc-text">ResourceProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AutoConfigurationCustomizerProvider"><span class="toc-number">6.2.1.8.2.</span> <span class="toc-text">AutoConfigurationCustomizerProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurableSpanExporterProvider"><span class="toc-number">6.2.1.8.3.</span> <span class="toc-text">ConfigurableSpanExporterProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurableMetricExporterProvider"><span class="toc-number">6.2.1.8.4.</span> <span class="toc-text">ConfigurableMetricExporterProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurableLogRecordExporterProvider"><span class="toc-number">6.2.1.8.5.</span> <span class="toc-text">ConfigurableLogRecordExporterProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurableSamplerProvider"><span class="toc-number">6.2.1.8.6.</span> <span class="toc-text">ConfigurableSamplerProvider</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConfigurablePropagatorProvider"><span class="toc-number">6.2.1.8.7.</span> <span class="toc-text">ConfigurablePropagatorProvider</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Declarative-configuration"><span class="toc-number">6.2.2.</span> <span class="toc-text">Declarative configuration</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-feature-1253868755.cos.ap-guangzhou.myqcloud.com/Java-Foreign-Function-API.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="New Java Feature - Foreign Function API"/></a><div class="content"><a class="title" href="/2025/01/17/new-java-feature-foreign-function-api/" title="New Java Feature - Foreign Function API">New Java Feature - Foreign Function API</a><time datetime="2025-01-16T16:06:25.000Z" title="Created 2025-01-17 00:06:25">2025-01-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2025 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>