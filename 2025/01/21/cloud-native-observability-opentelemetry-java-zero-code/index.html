<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Observability - OpenTelemetry Java Zero Code | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Java Agent Zero-code instrumentation with Java uses a Java agent JAR attached to any Java 8+ application. It dynamically injects bytecode to capture telemetry from many popular libraries and framework">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - OpenTelemetry Java Zero Code">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Java Agent Zero-code instrumentation with Java uses a Java agent JAR attached to any Java 8+ application. It dynamically injects bytecode to capture telemetry from many popular libraries and framework">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png">
<meta property="article:published_time" content="2025-01-20T16:06:25.000Z">
<meta property="article:modified_time" content="2025-10-14T07:31:37.810Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="OpenTelemetry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Observability - OpenTelemetry Java Zero Code",
  "url": "https://blog.zhongmingmao.top/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/",
  "image": "https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png",
  "datePublished": "2025-01-20T16:06:25.000Z",
  "dateModified": "2025-10-14T07:31:37.810Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - OpenTelemetry Java Zero Code',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Observability - OpenTelemetry Java Zero Code</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Observability - OpenTelemetry Java Zero Code</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>48mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-10-14 15:31:37&quot;}" hidden></div><h1 id="Java-Agent"><a href="#Java-Agent" class="headerlink" title="Java Agent"></a>Java Agent</h1><ol>
<li>Zero-code instrumentation with Java uses a Java agent JAR attached to any <strong>Java 8+</strong> application.</li>
<li>It <strong>dynamically injects bytecode</strong> to <strong>capture telemetry</strong> from many popular <strong>libraries</strong> and <strong>frameworks</strong>.</li>
<li>It can be used to capture telemetry data at the “<strong>edges</strong>” of an app or service<ul>
<li>such as <strong>inbound requests</strong>, <strong>outbound HTTP calls</strong>, <strong>database calls</strong>, and so on.</li>
</ul>
</li>
</ol>
<span id="more"></span>

<h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><ol>
<li>Download <strong>opentelemetry-javaagent.jar</strong> from Releases of the <strong>opentelemetry-java-instrumentation</strong> repository<ul>
<li>place the JAR in your <strong>preferred directory</strong>.</li>
<li>The JAR file contains the <strong>agent</strong> and <strong>instrumentation libraries</strong>.</li>
</ul>
</li>
<li>Add <strong>-javaagent</strong>:path&#x2F;to&#x2F;opentelemetry-javaagent.jar and other config to your <strong>JVM startup arguments</strong> and launch your app:</li>
</ol>
<blockquote>
<p>Directly on the <strong>startup command</strong>:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar -Dotel.service.name=your-service-name -jar myapp.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Via the <strong>JAVA_TOOL_OPTIONS</strong> and other environment variables:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_TOOL_OPTIONS=&quot;-javaagent:path/to/opentelemetry-javaagent.jar&quot;</span><br><span class="line">export OTEL_SERVICE_NAME=&quot;your-service-name&quot;</span><br><span class="line">java -jar myapp.jar</span><br></pre></td></tr></table></figure>

<h3 id="Declarative-configuration"><a href="#Declarative-configuration" class="headerlink" title="Declarative configuration"></a>Declarative configuration</h3><ol>
<li>Declarative configuration uses a <strong>YAML file</strong> instead of <strong>environment variables</strong> or <strong>system properties</strong>.</li>
<li>This is useful when you have <strong>many configuration options</strong> to set<ul>
<li>or if you want to use configuration options that are <strong>not available</strong> as <strong>environment variables</strong> or <strong>system properties</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Configuring-the-agent"><a href="#Configuring-the-agent" class="headerlink" title="Configuring the agent"></a>Configuring the agent</h3><p>The agent is <strong>highly configurable</strong>.</p>
<blockquote>
<p>One option is to pass <strong>configuration properties</strong> via the <strong>-D</strong> flag. In this example, a <strong>service name</strong> and <strong>Zipkin exporter</strong> for <strong>traces</strong> are configured:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar \</span><br><span class="line">     -Dotel.service.name=your-service-name \</span><br><span class="line">     -Dotel.traces.exporter=zipkin \</span><br><span class="line">     -jar myapp.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can also use <strong>environment variables</strong> to configure the agent:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OTEL_SERVICE_NAME=your-service-name \</span><br><span class="line">OTEL_TRACES_EXPORTER=zipkin \</span><br><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar \</span><br><span class="line">     -jar myapp.jar</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You can also supply a <strong>Java properties file</strong> and <strong>load configuration values</strong> from there:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar \</span><br><span class="line">     -Dotel.javaagent.configuration-file=path/to/properties/file.properties \</span><br><span class="line">     -jar myapp.jar</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OTEL_JAVAAGENT_CONFIGURATION_FILE=path/to/properties/file.properties \</span><br><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar \</span><br><span class="line">     -jar myapp.jar</span><br></pre></td></tr></table></figure>

<h3 id="Supported-libraries-frameworks-application-services-and-JVMs"><a href="#Supported-libraries-frameworks-application-services-and-JVMs" class="headerlink" title="Supported libraries, frameworks, application services, and JVMs"></a>Supported libraries, frameworks, application services, and JVMs</h3><p>The Java agent ships with <strong>instrumentation libraries</strong> for <strong>many popular components</strong>.</p>
<h3 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h3><blockquote>
<p>Set to <strong>true</strong> to see <strong>debug logs</strong>. Note that these are <strong>quite verbose</strong>.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>System property</td>
<td>otel.javaagent.debug</td>
</tr>
<tr>
<td>Environment variable</td>
<td>OTEL_JAVAAGENT_DEBUG</td>
</tr>
</tbody></table>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>This page describes the <strong>various ways</strong> in which <strong>configuration</strong> can be <strong>supplied</strong> to the <strong>Java agent</strong>.</p>
<h3 id="Agent-Configuration"><a href="#Agent-Configuration" class="headerlink" title="Agent Configuration"></a>Agent Configuration</h3><blockquote>
<p>The agent can <strong>consume configuration</strong> from <strong>one or more</strong> of the following <strong>sources</strong> (ordered from <strong>highest to lowest</strong> priority):</p>
</blockquote>
<ol>
<li>System properties</li>
<li>Environment variables</li>
<li>Configuration file</li>
<li>Properties provided by the <u>AutoConfigurationCustomizer#addPropertiesSupplier()</u> function; using the <strong>AutoConfigurationCustomizerProvider SPI</strong></li>
</ol>
<h3 id="Configuring-with-Environment-Variables"><a href="#Configuring-with-Environment-Variables" class="headerlink" title="Configuring with Environment Variables"></a>Configuring with Environment Variables</h3><ol>
<li>In certain environments, configuring settings through environment variables is often <strong>preferred</strong>.</li>
<li><strong>Any setting</strong> that can be configured using a <strong>system property</strong> can also be set using an <strong>environment variable</strong>. </li>
<li>Use the following steps to determine the <strong>correct name mapping</strong> for the desired system property:<ul>
<li>Convert the system property name to <strong>uppercase</strong>.</li>
<li>Replace all <code>.</code> and <code>-</code> characters with <code>_</code>.</li>
</ul>
</li>
<li>For example <strong>otel.instrumentation.common.default-enabled</strong> would convert to <strong>OTEL_INSTRUMENTATION_COMMON_DEFAULT_ENABLED</strong>.</li>
</ol>
<h3 id="Configuration-file"><a href="#Configuration-file" class="headerlink" title="Configuration file"></a>Configuration file</h3><ol>
<li>You can provide a path to an <strong>agent configuration file</strong> by setting the following property:</li>
<li>Description: Path to a valid <strong>Java properties file</strong> which contains the <strong>agent configuration</strong>.</li>
<li>System property: <strong>otel.javaagent.configuration-file</strong></li>
<li>Environment variable: <strong>OTEL_JAVAAGENT_CONFIGURATION_FILE</strong></li>
</ol>
<h3 id="Extensions"><a href="#Extensions" class="headerlink" title="Extensions"></a>Extensions</h3><ol>
<li>You can <strong>enable extensions</strong> by setting the following property:</li>
<li>Description<ul>
<li>Path to an <strong>extension jar file</strong> or <strong>folder, containing jar files</strong>.</li>
<li>If pointing to a <strong>folder</strong>, every jar file in that folder will be treated as <strong>separate, independent extension</strong>.</li>
</ul>
</li>
<li>System property: <strong>otel.javaagent.extensions</strong></li>
<li>Environment variable: <strong>OTEL_JAVAAGENT_EXTENSIONS</strong></li>
</ol>
<h3 id="Java-agent-logging-output"><a href="#Java-agent-logging-output" class="headerlink" title="Java agent logging output"></a>Java agent logging output</h3><ol>
<li>The <strong>agent’s logging output</strong> can be configured by setting the following property:</li>
<li>System property: <strong>otel.javaagent.logging</strong></li>
<li>Environment variable: <strong>OTEL_JAVAAGENT_LOGGING</strong></li>
<li>Description: The <strong>Java agent logging mode</strong>. The following 3 modes are supported:</li>
</ol>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>simple</td>
<td>The agent will print out its logs using the <strong>standard error stream</strong>.<br />Only <strong>INFO or higher</strong> logs will be printed. This is the <strong>default Java agent logging mode</strong>.</td>
</tr>
<tr>
<td>none</td>
<td>The agent will <strong>not log anything</strong> - not even its own version.</td>
</tr>
<tr>
<td>application</td>
<td>The agent will attempt to <strong>redirect</strong> its own <strong>logs</strong> to the <strong>instrumented application’s slf4j logger</strong>. <br />This works the best for <strong>simple one-jar applications</strong> that do not use <strong>multiple classloaders</strong>; <strong>Spring Boot apps</strong> are supported as well.<br />The Java agent output logs can be further <strong>configured</strong> using the <strong>instrumented application’s logging configuration</strong> (e.g. <strong>logback.xml</strong> or <strong>log4j2.xml</strong>).<br />Make sure to <strong>test</strong> that this mode works for your application before running it in a <strong>production environment</strong>.</td>
</tr>
</tbody></table>
<h3 id="SDK-Configuration"><a href="#SDK-Configuration" class="headerlink" title="SDK Configuration"></a>SDK Configuration</h3><ol>
<li>The <strong>SDK’s autoconfiguration module</strong> is used for <strong>basic configuration</strong> of the agent. </li>
<li>Unlike the <strong>SDK autoconfiguration</strong><ul>
<li>versions <strong>2.0+</strong> of the <strong>Java agent</strong> and <strong>OpenTelemetry Spring Boot starter</strong> use <strong>http&#x2F;protobuf</strong> as the <strong>default protocol</strong>, not <strong>grpc</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Enable-Resource-Providers-that-are-disabled-by-default"><a href="#Enable-Resource-Providers-that-are-disabled-by-default" class="headerlink" title="Enable Resource Providers that are disabled by default"></a>Enable Resource Providers that are disabled by default</h3><blockquote>
<p>In addition to the <strong>resource configuration</strong> from the <strong>SDK autoconfiguration</strong>, you can <u>enable additional resource providers</u> that are <u>disabled by default</u>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.resource.providers.aws.enabled</td>
<td>false</td>
<td>Enables the AWS Resource Provider</td>
</tr>
<tr>
<td>otel.resource.providers.gcp.enabled</td>
<td>false</td>
<td>Enables the GCP Resource Provider</td>
</tr>
<tr>
<td>otel.resource.providers.azure.enabled</td>
<td>false</td>
<td>Enables the Azure Resource Provider</td>
</tr>
</tbody></table>
<h2 id="Declarative-configuration-1"><a href="#Declarative-configuration-1" class="headerlink" title="Declarative configuration"></a>Declarative configuration</h2><ol>
<li>Declarative configuration uses a <strong>YAML file</strong> instead of <strong>environment variables</strong> or <strong>system properties</strong>.</li>
<li>This approach is <strong>useful</strong> when:<ul>
<li>You have <strong>many configuration options</strong> to set</li>
<li>You want to use configuration options that are <strong>not available</strong> as <strong>environment variables</strong> or <strong>system properties</strong></li>
</ul>
</li>
<li>Just like <strong>environment variables</strong>, the <strong>configuration syntax</strong> is <strong>language-agnostic</strong><ul>
<li>and works for <strong>all OpenTelemetry Java SDKs</strong> that <strong>support declarative configuration</strong>, including the <strong>OpenTelemetry Java agent</strong>.</li>
</ul>
</li>
<li>Declarative configuration is <strong>experimental</strong>.</li>
</ol>
<h3 id="Supported-languages"><a href="#Supported-languages" class="headerlink" title="Supported languages"></a>Supported languages</h3><p>Java</p>
<h3 id="Supported-versions"><a href="#Supported-versions" class="headerlink" title="Supported versions"></a>Supported versions</h3><p>Declarative configuration is supported in the OpenTelemetry Java agent version <strong>2.20.0 and later</strong>.</p>
<h2 id="Suppressing-specific-instrumentation"><a href="#Suppressing-specific-instrumentation" class="headerlink" title="Suppressing specific instrumentation"></a>Suppressing specific instrumentation</h2><h3 id="Disabling-the-agent-entirely"><a href="#Disabling-the-agent-entirely" class="headerlink" title="Disabling the agent entirely"></a>Disabling the agent entirely</h3><ol>
<li>System property: <strong>otel.javaagent.enabled</strong></li>
<li>Description: Set the value to false to disable the agent entirely.</li>
</ol>
<h3 id="Enable-only-specific-instrumentation"><a href="#Enable-only-specific-instrumentation" class="headerlink" title="Enable only specific instrumentation"></a>Enable only specific instrumentation</h3><ol>
<li>You can <strong>disable all default auto instrumentation</strong> and <strong>selectively re-enable individual instrumentation</strong>.</li>
<li>This may be desirable to <strong>reduce startup overhead</strong> or to have <strong>more control</strong> of which instrumentation is applied.</li>
<li>Some instrumentation <strong>relies on other instrumentation</strong> to function properly.<ul>
<li>When selectively enabling instrumentation, be sure to <strong>enable</strong> the <strong>transitive dependencies</strong> too.</li>
<li>This is considered <strong>advanced usage</strong> and is not recommended for most users.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.<u>common.default-enabled</u></td>
<td>Set to <strong>false</strong> to <strong>disable all instrumentation</strong> in the agent.</td>
</tr>
<tr>
<td>otel.instrumentation.<u>[name].enabled</u></td>
<td>Set to <strong>true</strong> to enable <strong>each desired instrumentation individually</strong>.</td>
</tr>
</tbody></table>
<h3 id="Enable-manual-instrumentation-only"><a href="#Enable-manual-instrumentation-only" class="headerlink" title="Enable manual instrumentation only"></a>Enable manual instrumentation only</h3><ol>
<li>You can <strong>suppress all auto instrumentations</strong> but have support for <strong>manual instrumentation</strong> with <strong>@WithSpan</strong> and <strong>normal API interactions</strong> by using</li>
<li>-Dotel.instrumentation.<strong>common.default-enabled</strong>&#x3D;false</li>
<li>-Dotel.instrumentation.<strong>opentelemetry-api.enabled</strong>&#x3D;true</li>
<li>-Dotel.instrumentation.<strong>opentelemetry-instrumentation-annotations.enabled</strong>&#x3D;true</li>
</ol>
<h3 id="Suppressing-specific-agent-instrumentation"><a href="#Suppressing-specific-agent-instrumentation" class="headerlink" title="Suppressing specific agent instrumentation"></a>Suppressing specific agent instrumentation</h3><ol>
<li>You can suppress agent instrumentation of <strong>specific libraries</strong>.</li>
<li>System property: otel.instrumentation.<u>[name].enabled</u></li>
<li>Description: Set to <strong>false</strong> to suppress <strong>agent instrumentation</strong> of <strong>specific libraries</strong>, where [name] is the corresponding <strong>instrumentation name</strong>:</li>
</ol>
<table>
<thead>
<tr>
<th>Library&#x2F;Framework</th>
<th>Instrumentation name</th>
</tr>
</thead>
<tbody><tr>
<td>Apache Kafka</td>
<td>kafka</td>
</tr>
<tr>
<td>Spring Core</td>
<td>spring-core</td>
</tr>
</tbody></table>
<ol>
<li>When using <strong>environment variables</strong>, dashes (<code>-</code>) should be converted to underscores (<code>_</code>). </li>
<li>For example, to suppress traces from <strong>akka-actor</strong> library, set <strong>OTEL_INSTRUMENTATION_AKKA_ACTOR_ENABLED</strong> to false.</li>
</ol>
<h3 id="Suppressing-controller-and-or-view-spans"><a href="#Suppressing-controller-and-or-view-spans" class="headerlink" title="Suppressing controller and&#x2F;or view spans"></a>Suppressing controller and&#x2F;or view spans</h3><ol>
<li>Some instrumentations (e.g. <strong>Spring Web MVC</strong> instrumentation) produce <strong>SpanKind.Internal</strong> spans to capture the <strong>controller and&#x2F;or view execution</strong>.</li>
<li>These spans can be suppressed using the configuration settings below<ul>
<li>without suppressing the <strong>entire instrumentation</strong></li>
<li>which would also disable the instrumentation’s capturing of <strong>http.route</strong> and <strong>associated</strong> span name on the parent <strong>SpanKind.Server</strong> span.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.common.experimental.<strong>controller-telemetry</strong>.enabled</td>
<td><strong>false</strong></td>
<td>Set to true to enable controller telemetry.</td>
</tr>
<tr>
<td>otel.instrumentation.common.experimental.<strong>view-telemetry</strong>.enabled</td>
<td><strong>false</strong></td>
<td>Set to true to enable view telemetry.</td>
</tr>
</tbody></table>
<h3 id="Instrumentation-span-suppression-behavior"><a href="#Instrumentation-span-suppression-behavior" class="headerlink" title="Instrumentation span suppression behavior"></a>Instrumentation span suppression behavior</h3><ol>
<li><strong>Some libraries</strong> that this agent instruments <strong>in turn</strong> use <strong>lower-level libraries</strong>, that are also <strong>instrumented</strong>.</li>
<li>This would normally result in <strong>nested spans</strong> containing <strong>duplicate telemetry data</strong>. For example:<ul>
<li>Spans produced by the <u>Reactor Netty HTTP client instrumentation</u> would have <u>duplicate HTTP client spans</u> produced by the <u>Netty instrumentation</u>;</li>
<li>Spans produced by the <u>Tomcat instrumentation</u> would have <u>duplicate HTTP server spans</u> produced by the <u>generic Servlet API instrumentation</u>.</li>
</ul>
</li>
<li>The Java agent prevents these situations by <strong>detecting and suppressing nested spans</strong> that <strong>duplicate telemetry data</strong>.</li>
<li>The <strong>suppression behavior</strong> can be configured using the following configuration option:<ul>
<li>System property: otel.instrumentation.experimental.<strong>span-suppression-strategy</strong></li>
<li>Description: The <strong>Java agent span suppression strategy</strong>. The following 3 strategies are supported:</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>semconv</td>
<td>The agent will suppress <strong>duplicate semantic conventions</strong>. This is the <strong>default behavior</strong> of the Java agent.</td>
</tr>
<tr>
<td>span-kind</td>
<td>The agent will suppress spans with the <strong>same kind</strong> (except <strong>INTERNAL</strong>).</td>
</tr>
<tr>
<td>none</td>
<td>The agent will <strong>not suppress anything</strong> at all.<br />We do <strong>not recommend</strong> using this option for anything other than <strong>debug purposes</strong>, as it <strong>generates lots of duplicate telemetry data</strong>.</td>
</tr>
</tbody></table>
<ol>
<li>For example, suppose we instrument a <strong>database client</strong> which <strong>internally</strong> uses the <strong>Reactor Netty HTTP client</strong>; which in turn uses <strong>Netty</strong>.</li>
<li>Using the <strong>default semconv suppression strategy</strong> would result in <strong>2 nested CLIENT spans</strong>:<ul>
<li><strong>CLIENT span</strong> with <strong>database client semantic attributes</strong> emitted by the <strong>database client instrumentation</strong>;</li>
<li><strong>CLIENT span</strong> with <strong>HTTP client semantic attributes</strong> emitted by the <strong>Reactor Netty instrumentation</strong>.</li>
<li>The <strong>Netty instrumentation</strong> would be <strong>suppressed</strong>, as it <strong>duplicates</strong> the <strong>Reactor Netty HTTP client instrumentation</strong>.</li>
</ul>
</li>
<li>Using the suppression strategy <strong>span-kind</strong> would result in <strong>just one span</strong>:<ul>
<li><strong>CLIENT span</strong> with <strong>database client semantic attributes</strong> emitted by the <strong>database client instrumentation</strong>.</li>
<li>Both <strong>Reactor Netty</strong> and <strong>Netty instrumentations</strong> would be suppressed, as they also emit <strong>CLIENT spans</strong>.</li>
</ul>
</li>
<li>Finally, using the suppression strategy <strong>none</strong> would result in <strong>3 spans</strong>:<ul>
<li><strong>CLIENT span</strong> with <strong>database client semantic attributes</strong> emitted by the <strong>database client instrumentation</strong>;</li>
<li><strong>CLIENT span</strong> with <strong>HTTP client semantic attributes</strong> emitted by the <strong>Reactor Netty instrumentation</strong>;</li>
<li><strong>CLIENT span</strong> with <strong>HTTP client semantic attributes</strong> emitted by the <strong>Netty instrumentation</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h2><ol>
<li>Using <strong>instrumentation annotations</strong> with a <strong>Java agent</strong>.</li>
<li>For <strong>most users</strong>, the <strong>out-of-the-box instrumentation</strong> is <strong>completely sufficient</strong> and <strong>nothing more needs to be done</strong>.</li>
<li>Sometimes, however, users wish to <strong>create spans</strong> for their <strong>own custom code</strong> without having to change much code.</li>
<li>The <strong>WithSpan</strong> and <strong>SpanAttribute</strong> annotations support those use cases.</li>
</ol>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><blockquote>
<p>You’ll need to add a dependency on the <strong>opentelemetry-instrumentation-annotations</strong> library to use the <strong>@WithSpan</strong> annotation.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;opentelemetry-instrumentation-annotations&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.20</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Creating-spans-around-methods-with-WithSpan"><a href="#Creating-spans-around-methods-with-WithSpan" class="headerlink" title="Creating spans around methods with @WithSpan"></a>Creating spans around methods with @WithSpan</h3><blockquote>
<p>To <strong>create a span</strong> that <strong>instruments</strong> a <strong>particular method</strong>, annotate the <strong>method</strong> with <strong>@WithSpan</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.WithSpan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">  <span class="meta">@WithSpan</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myMethod</span><span class="params">()</span> &#123;</span><br><span class="line">      &lt;...&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>Each time the application <strong>invokes</strong> the <strong>annotated method</strong>, it <strong>creates a span</strong> that denotes its <strong>duration</strong> and provides any thrown <strong>exceptions</strong>.</li>
<li>By default, the <strong>span name</strong> will be <code>&lt;className&gt;.&lt;methodName&gt;</code>, unless a <strong>name</strong> is provided through the <strong>value annotation parameter</strong>.</li>
<li>If the <strong>return type</strong> of the <strong>method</strong> annotated by <strong>@WithSpan</strong> is one of the <strong>future-</strong> or <strong>promise-like</strong> types listed below then the <strong>span will not be ended until the future completes</strong><ul>
<li>java.util.concurrent.CompletableFuture</li>
<li>java.util.concurrent.CompletionStage</li>
<li>com.google.common.util.concurrent.ListenableFuture</li>
<li>org.reactivestreams.Publisher</li>
<li>reactor.core.publisher.Mono</li>
<li>reactor.core.publisher.Flux</li>
<li>io.reactivex.Completable</li>
<li>io.reactivex.Maybe</li>
<li>io.reactivex.Single</li>
<li>io.reactivex.Observable</li>
<li>io.reactivex.Flowable</li>
<li>io.reactivex.parallel.ParallelFlowable</li>
</ul>
</li>
</ol>
<h4 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h4><blockquote>
<p>The <strong>@WithSpan</strong> attribute supports the following <strong>optional parameters</strong> to allow <strong>customization</strong> of <strong>spans</strong>:</p>
</blockquote>
<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>default</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String</td>
<td>“”</td>
<td>The <strong>span name</strong>.<br />If not specified, the default <code>&lt;className&gt;.&lt;methodName&gt;</code> is used.</td>
</tr>
<tr>
<td>kind</td>
<td>SpanKind (enum)</td>
<td>INTERNAL</td>
<td>The kind of span.</td>
</tr>
<tr>
<td>inheritContext</td>
<td>boolean</td>
<td>true</td>
<td>Since <strong>2.14.0</strong>.<br />Controls whether or not the <strong>new span</strong> will be <strong>parented</strong> in the existing (<strong>current</strong>) context.<br />If <strong>false</strong>, a <strong>new context</strong> is <strong>created</strong>.</td>
</tr>
</tbody></table>
<blockquote>
<p>Example parameter usage:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WithSpan(kind = SpanKind.CLIENT, inheritContext = false, value = &quot;my span name&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    &lt;...&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WithSpan(&quot;my span name&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myOtherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    &lt;...&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Adding-attributes-to-the-span-with-SpanAttribute"><a href="#Adding-attributes-to-the-span-with-SpanAttribute" class="headerlink" title="Adding attributes to the span with @SpanAttribute"></a>Adding attributes to the span with @SpanAttribute</h3><ol>
<li>When a <strong>span</strong> is <strong>created</strong> for an <strong>annotated method</strong><ul>
<li>the <strong>values of the arguments</strong> to the <strong>method</strong> invocation can be <strong>automatically added as attributes</strong> to the <strong>created span</strong>.</li>
</ul>
</li>
<li>Simply <strong>annotate the method parameters</strong> with the <strong>@SpanAttribute</strong> annotation:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.SpanAttribute;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.WithSpan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WithSpan</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myMethod</span><span class="params">(<span class="meta">@SpanAttribute(&quot;parameter1&quot;)</span> String parameter1,</span></span><br><span class="line"><span class="params">        <span class="meta">@SpanAttribute(&quot;parameter2&quot;)</span> <span class="type">long</span> parameter2)</span> &#123;</span><br><span class="line">        &lt;...&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unless <strong>specified</strong> as an <strong>argument</strong> to the <strong>annotation</strong>, the <strong>attribute name</strong> will be <strong>derived from</strong> the <strong>formal parameter names</strong> if they are compiled into the <strong>.class</strong> files by passing the <strong>-parameters</strong> option to the <strong>javac</strong> compiler.</p>
<h3 id="Suppressing-WithSpan-instrumentation"><a href="#Suppressing-WithSpan-instrumentation" class="headerlink" title="Suppressing @WithSpan instrumentation"></a>Suppressing @WithSpan instrumentation</h3><ol>
<li>Suppressing @WithSpan is useful<ul>
<li>if you have code that is <strong>over-instrumented</strong> using @WithSpan and you want to suppress some of them <strong>without modifying the code</strong>.</li>
</ul>
</li>
<li>System property: otel.instrumentation.<strong>opentelemetry-instrumentation-annotations.exclude-methods</strong></li>
<li>Description: Suppress <strong>@WithSpan instrumentation</strong> for <strong>specific methods</strong>.<ul>
<li>Format is <u>my.package.MyClass1[method1,method2];my.package.MyClass2[method3]</u>.</li>
</ul>
</li>
</ol>
<h3 id="Creating-spans-around-methods-with-otel-instrumentation-methods-include"><a href="#Creating-spans-around-methods-with-otel-instrumentation-methods-include" class="headerlink" title="Creating spans around methods with otel.instrumentation.methods.include"></a>Creating spans around methods with otel.instrumentation.methods.include</h3><ol>
<li>In cases where you are <strong>unable to modify the code</strong>, you can still configure the <strong>Java agent</strong> to <strong>capture spans</strong> around <strong>specific methods</strong>.</li>
<li>System property: otel.instrumentation.<strong>methods.include</strong></li>
<li>Description: <strong>Add instrumentation</strong> for <strong>specific methods</strong> in lieu of <strong>@WithSpan</strong>.<ul>
<li>Format is <u>my.package.MyClass1[method1,method2];my.package.MyClass2[method3]</u>.</li>
</ul>
</li>
<li>If a method is <strong>overloaded</strong> (appears more than once on the <strong>same class</strong> with the <strong>same name</strong> but <strong>different parameters</strong>)<ul>
<li><strong>all versions</strong> of the method will be <strong>instrumented</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Extending-instrumentations-with-the-API"><a href="#Extending-instrumentations-with-the-API" class="headerlink" title="Extending instrumentations with the API"></a>Extending instrumentations with the API</h2><p>Use the <strong>OpenTelemetry API</strong> in <strong>combination</strong> with the <strong>Java agent</strong> to <strong>extend</strong> the <strong>automatically generated telemetry</strong> with <strong>custom spans and metrics</strong></p>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><ol>
<li>In addition to the <strong>out-of-the-box instrumentation</strong><ul>
<li>you can extend the <strong>Java agent</strong> with <strong>custom manual instrumentation</strong> using the <strong>OpenTelemetry API</strong></li>
</ul>
</li>
<li>This allows you to <strong>create spans and metrics</strong> for your own code without doing too many code changes.</li>
</ol>
<h3 id="Dependencies-1"><a href="#Dependencies-1" class="headerlink" title="Dependencies"></a>Dependencies</h3><blockquote>
<p>Add a dependency on the <strong>opentelemetry-api</strong> library.</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.54.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="OpenTelemetry"><a href="#OpenTelemetry" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h3><ol>
<li>The Java agent is a special case where <strong>GlobalOpenTelemetry</strong> is set by the <strong>agent</strong>.</li>
<li>Simply call <strong>GlobalOpenTelemetry.get()</strong> to access the <strong>OpenTelemetry</strong> instance.</li>
</ol>
<h3 id="Span"><a href="#Span" class="headerlink" title="Span"></a>Span</h3><blockquote>
<p>For the <strong>most common use cases</strong>, use the <strong>@WithSpan</strong> annotation instead of <strong>manual instrumentation</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.opentelemetry.api.GlobalOpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"></span><br><span class="line"><span class="type">Tracer</span> <span class="variable">tracer</span> <span class="operator">=</span> GlobalOpenTelemetry.getTracer(<span class="string">&quot;application&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Use the <strong>Tracer</strong> to create a <strong>span</strong> as explained in the Span section.</p>
<h3 id="Meter"><a href="#Meter" class="headerlink" title="Meter"></a>Meter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.opentelemetry.api.GlobalOpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"></span><br><span class="line"><span class="type">Meter</span> <span class="variable">meter</span> <span class="operator">=</span> GlobalOpenTelemetry.getMeter(<span class="string">&quot;application&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>Use the <strong>Meter</strong> to create a <strong>counter</strong>, <strong>gauge</strong> or <strong>histogram</strong> as explained in the Meter section.</p>
<h2 id="Instrumentation-configuration"><a href="#Instrumentation-configuration" class="headerlink" title="Instrumentation configuration"></a>Instrumentation configuration</h2><p>This page describes <strong>common settings</strong> that apply to <strong>multiple instrumentations</strong> at once.</p>
<h3 id="Peer-service-name"><a href="#Peer-service-name" class="headerlink" title="Peer service name"></a>Peer service name</h3><ol>
<li>The peer service name is the name of a <strong>remote service</strong> to which a <strong>connection</strong> is made.</li>
<li>It corresponds to <strong>service.name</strong> in the <strong>resource</strong> for the <strong>local service</strong>.</li>
<li>System property: otel.instrumentation.common.<strong>peer-service-mapping</strong></li>
<li>Description: Used to specify a <strong>mapping</strong> from <strong>host names or IP addresses</strong> to <strong>peer services</strong>, as a <strong>comma-separated list</strong> pairs<ul>
<li>The <strong>peer service</strong> is <strong>added</strong> as an <strong>attribute</strong> to a <strong>span</strong> whose host or IP address <strong>match</strong> the <strong>mapping</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>For example, if set to the following:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.2.3.4=cats-service,dogs-abcdef123.serverlessapis.com=dogs-api</span><br></pre></td></tr></table></figure>

<ol>
<li>Then, requests to <strong>1.2.3.4</strong> will have a <strong>peer.service attribute</strong> of <strong>cats-service</strong></li>
<li>and requests to <strong>dogs-abcdef123.serverlessapis.com</strong> will have an attribute of <strong>dogs-api</strong>.</li>
</ol>
<blockquote>
<p>Since Java agent version <strong>1.31.0</strong>, it is possible to provide a <strong>port</strong> and a <strong>path</strong> to define a <strong>peer.service</strong>. For example, if set to the following:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.2.3.4:443=cats-service,dogs-abcdef123.serverlessapis.com:80/api=dogs-api</span><br></pre></td></tr></table></figure>

<ol>
<li>Then, requests to <strong>1.2.3.4</strong> will have <strong>no override for peer.service attribute</strong>, while <strong>1.2.3.4:443</strong> will have <strong>peer.service</strong> of <strong>cats-service</strong></li>
<li>and requests to <strong>dogs-abcdef123.serverlessapis.com:80&#x2F;api&#x2F;v1</strong> will have an attribute of dogs-api.</li>
</ol>
<h3 id="DB-statement-sanitization"><a href="#DB-statement-sanitization" class="headerlink" title="DB statement sanitization"></a>DB statement sanitization</h3><ol>
<li>The agent <strong>sanitizes all database queries&#x2F;statements</strong> before setting the <strong>db.statement</strong> semantic attribute.</li>
<li>All values (strings, numbers) in the <strong>query string</strong> are replaced with a question mark (<strong>?</strong>).</li>
<li>Note: <strong>JDBC bind parameters</strong> are <strong>not captured</strong> in <strong>db.statement</strong>.</li>
<li>Examples:<ul>
<li>SQL query <code>SELECT a from b where password=&quot;secret&quot;</code> will appear as <code>SELECT a from b where password=?</code> in the <strong>exported span</strong>;</li>
<li>Redis command <code>HSET map password &quot;secret&quot;</code> will appear as <code>HSET map password ?</code> in the <strong>exported span</strong>.</li>
</ul>
</li>
<li>This behavior is <strong>turned on by default</strong> for <strong>all database instrumentations</strong>. Use the following property to disable it:</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.common.<strong>db-statement-sanitizer</strong>.enabled</td>
<td>true</td>
<td>Enables the DB statement sanitization.</td>
</tr>
</tbody></table>
<h3 id="Capturing-consumer-message-receive-telemetry-in-messaging-instrumentations"><a href="#Capturing-consumer-message-receive-telemetry-in-messaging-instrumentations" class="headerlink" title="Capturing consumer message receive telemetry in messaging instrumentations"></a>Capturing consumer message receive telemetry in messaging instrumentations</h3><ol>
<li>You can configure the agent to <strong>capture</strong> the <strong>consumer message receive telemetry</strong> in <strong>messaging instrumentation</strong>.</li>
<li>Note that this will cause the <strong>consumer side</strong> to <strong>start a new trace</strong>, with only a <strong>span link</strong> connecting it to the <strong>producer trace</strong>.</li>
<li>The property&#x2F;environment variable names listed in the table are still <strong>experimental</strong>, and thus are subject to <strong>change</strong>.</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.messaging.experimental.receive-telemetry.enabled</td>
<td>false</td>
<td>Enables the consumer message receive telemetry.</td>
</tr>
</tbody></table>
<h3 id="Capturing-enduser-attributes"><a href="#Capturing-enduser-attributes" class="headerlink" title="Capturing enduser attributes"></a>Capturing enduser attributes</h3><ol>
<li>You can configure the agent to capture <strong>general identity attributes</strong> (enduser.id, enduser.role, enduser.scope)<ul>
<li>from <strong>instrumentation libraries</strong> like <u>JavaEE&#x2F;JakartaEE Servlet</u> and <u>Spring Security</u>.</li>
</ul>
</li>
<li>Given the <strong>sensitive nature</strong> of the <strong>data involved</strong>, this feature is <strong>turned off by default</strong> while allowing <strong>selective activation</strong> for <strong>particular attributes</strong>.<ul>
<li>You must <strong>carefully evaluate</strong> each <strong>attribute’s privacy implications</strong> before enabling the collection of the data.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.common.enduser.id.enabled</td>
<td>false</td>
<td>Determines whether to capture <strong>enduser.id</strong> semantic attribute.</td>
</tr>
<tr>
<td>otel.instrumentation.common.enduser.role.enabled</td>
<td>false</td>
<td>Determines whether to capture <strong>enduser.role</strong> semantic attribute.</td>
</tr>
<tr>
<td>otel.instrumentation.common.enduser.scope.enabled</td>
<td>false</td>
<td>Determines whether to capture <strong>enduser.scope</strong> semantic attribute.</td>
</tr>
</tbody></table>
<h4 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h4><ol>
<li>For users of Spring Security who use <strong>custom granted authority prefixes</strong></li>
<li>you can use the following properties to <strong>strip those prefixes</strong> from the <strong>enduser.</strong>* attribute values to <strong>better represent</strong> the <strong>actual role</strong> and <strong>scope</strong> names:</li>
</ol>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.spring-security.enduser.role.granted-authority-prefix</td>
<td>ROLE_</td>
<td>Prefix of <strong>granted authorities</strong> identifying <strong>roles</strong> to capture in the <strong>enduser.role</strong> semantic attribute.</td>
</tr>
<tr>
<td>otel.instrumentation.spring-security.enduser.scope.granted-authority-prefix</td>
<td>SCOPE_</td>
<td>Prefix of <strong>granted authorities</strong> identifying <strong>scopes</strong> to capture in the <strong>enduser.scopes</strong> semantic attribute.</td>
</tr>
</tbody></table>
<h3 id="HTTP-instrumentation-configuration"><a href="#HTTP-instrumentation-configuration" class="headerlink" title="HTTP instrumentation configuration"></a>HTTP instrumentation configuration</h3><h4 id="Capturing-HTTP-request-and-response-headers"><a href="#Capturing-HTTP-request-and-response-headers" class="headerlink" title="Capturing HTTP request and response headers"></a>Capturing HTTP request and response headers</h4><p>You can configure the <strong>agent</strong> to capture <strong>predefined HTTP headers</strong> as <strong>span attributes</strong>, according to the semantic convention.</p>
<ol>
<li>otel.instrumentation.http.<strong>client.capture-request-headers</strong><ul>
<li>A <strong>comma-separated</strong> list of <strong>HTTP header names</strong>.</li>
<li><strong>HTTP client instrumentations</strong> will capture <strong>HTTP request header values</strong> for all configured header names.</li>
</ul>
</li>
<li>otel.instrumentation.http.<strong>client.capture-response-headers</strong><ul>
<li>A <strong>comma-separated</strong> list of <strong>HTTP header names</strong>.</li>
<li><strong>HTTP client instrumentations</strong> will capture <strong>HTTP response header values</strong> for all configured header names.</li>
</ul>
</li>
<li>otel.instrumentation.http.<strong>server.capture-request-headers</strong><ul>
<li>A <strong>comma-separated</strong> list of <strong>HTTP header names</strong>.</li>
<li><strong>HTTP server instrumentations</strong> will capture <strong>HTTP request header values</strong> for all configured header names.</li>
</ul>
</li>
<li>otel.instrumentation.http.<strong>server.capture-response-headers</strong><ul>
<li>A <strong>comma-separated</strong> list of <strong>HTTP header names</strong>.</li>
<li><strong>HTTP server instrumentations</strong> will capture <strong>HTTP response header values</strong> for all configured header names.</li>
</ul>
</li>
</ol>
<blockquote>
<p>These configuration options are supported by all <strong>HTTP client and server instrumentations</strong>.</p>
</blockquote>
<p>The <strong>property&#x2F;environment variable names</strong> listed in the table are still <strong>experimental</strong>, and thus are subject to <strong>change</strong>.</p>
<h4 id="Capturing-servlet-request-parameters"><a href="#Capturing-servlet-request-parameters" class="headerlink" title="Capturing servlet request parameters"></a>Capturing servlet request parameters</h4><p>You can configure the agent to capture <strong>predefined HTTP request parameters</strong> as <strong>span attributes</strong> for requests that are <strong>handled</strong> by the <strong>Servlet API</strong>.</p>
<ol>
<li>otel.instrumentation.<strong>servlet.experimental.capture-request-parameters</strong></li>
<li>A <strong>comma-separated list</strong> of <strong>request parameter names</strong>.</li>
</ol>
<p>The <strong>property&#x2F;environment variable names</strong> listed in the table are still <strong>experimental</strong>, and thus are subject to <strong>change</strong>.</p>
<h4 id="Configuring-known-HTTP-methods"><a href="#Configuring-known-HTTP-methods" class="headerlink" title="Configuring known HTTP methods"></a>Configuring known HTTP methods</h4><p>Configures the <strong>instrumentation</strong> to <strong>recognize</strong> an <strong>alternative set</strong> of <strong>HTTP request methods</strong>. All other methods will be treated as <strong>_OTHER</strong>.</p>
<ol>
<li>System property: otel.instrumentation.<strong>http.known-methods</strong></li>
<li>Default: <strong>CONNECT,DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT,TRACE</strong></li>
<li>Description: A <strong>comma-separated list</strong> of <strong>known HTTP methods</strong>.</li>
</ol>
<h4 id="Enabling-experimental-HTTP-telemetry"><a href="#Enabling-experimental-HTTP-telemetry" class="headerlink" title="Enabling experimental HTTP telemetry"></a>Enabling experimental HTTP telemetry</h4><p>You can configure the agent to capture <strong>additional experimental HTTP telemetry data</strong>.</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.<strong>http.client.emit-experimental-telemetry</strong></td>
<td>false</td>
<td>Enables the <strong>experimental HTTP client telemetry</strong>.</td>
</tr>
<tr>
<td>otel.instrumentation.<strong>http.server.emit-experimental-telemetry</strong></td>
<td>false</td>
<td>Enables the <strong>experimental HTTP server telemetry</strong>.</td>
</tr>
</tbody></table>
<p>For <strong>client and server spans</strong>, the following <strong>attributes</strong> are added:</p>
<ul>
<li><strong>http.request.body.size</strong> and <strong>http.response.body.size</strong>: The size of the request and response bodies, respectively.</li>
</ul>
<p>For <strong>client metrics</strong>, the following metrics are created:</p>
<ul>
<li><u>http.client.request.body.size</u></li>
<li><u>http.client.response.body.size</u></li>
</ul>
<p>For <strong>server metrics</strong>, the following metrics are created:</p>
<ul>
<li>http.server.active_requests</li>
<li>http.server.request.body.size</li>
<li>http.server.response.body.size</li>
</ul>
<h2 id="Application-server-configuration"><a href="#Application-server-configuration" class="headerlink" title="Application server configuration"></a>Application server configuration</h2><ol>
<li>Learn how to <strong>define agent paths</strong> for <strong>Java application servers</strong></li>
<li>When <strong>instrumenting an app</strong> that <strong>runs on a Java application server</strong> with a <strong>Java agent</strong><ul>
<li>You must add the <strong>javaagent path</strong> to the <strong>JVM arguments</strong>.</li>
<li>The way to do this <strong>differs from server to server</strong>.</li>
</ul>
</li>
</ol>
<h2 id="Extensions-1"><a href="#Extensions-1" class="headerlink" title="Extensions"></a>Extensions</h2><blockquote>
<p>Extensions <strong>add capabilities to the agent</strong> without having to create a <strong>separate distribution</strong>.</p>
</blockquote>
<h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><ol>
<li><p>Extensions are designed to <strong>override</strong> or <strong>customize</strong> the <strong>instrumentation</strong> provided by the <strong>upstream agent</strong></p>
<ul>
<li>without having to <strong>create a new OpenTelemetry distribution</strong> or <strong>alter the agent code</strong> in any way.</li>
</ul>
</li>
<li><p>Consider an <strong>instrumented database client</strong> that <strong>creates a span per database call</strong></p>
<ul>
<li>and <strong>extracts data from the database connection</strong> to <strong>provide span attributes</strong>.</li>
</ul>
</li>
<li><p>The following are <strong>sample use cases</strong> for that <strong>scenario</strong> that can be <strong>solved</strong> by <strong>using extensions</strong>:</p>
<ul>
<li>“I don’t want this span at all”:<ul>
<li>Create an extension to <strong>disable selected instrumentation</strong> by providing new default settings.</li>
</ul>
</li>
<li>“I want to edit some attributes that don’t depend on any db connection instance”:<ul>
<li>Create an extension that provide a custom <strong>SpanProcessor</strong>.</li>
</ul>
</li>
<li>“I want to edit some attributes and their values depend on a specific db connection instance”:<ul>
<li>Create an extension with new instrumentation which <strong>injects its own advice</strong> into the <strong>same method</strong> as the original one.</li>
<li>You can use the <strong>order</strong> method to ensure it <strong>runs after</strong> the <strong>original instrumentation</strong> and <strong>augment the current span with new information</strong>.</li>
</ul>
</li>
<li>“I want to remove some attributes”:<ul>
<li>Create an extension with a <strong>custom exporter</strong> or use the <strong>attribute filtering functionality</strong> in the <strong>OpenTelemetry Collector</strong>.</li>
</ul>
</li>
<li>“I don’t like the OTel spans. I want to modify them and their lifecycle”:<ul>
<li>Create an extension that <strong>disables existing instrumentation</strong> and <strong>replace it</strong> with new one that <strong>injects Advice</strong> into the same (or a better) method as the original instrumentation.</li>
<li>You can write your <strong>Advice</strong> for this and use the <strong>existing Tracer directly</strong> or <strong>extend</strong> it.</li>
<li>As you have your own <strong>Advice</strong>, you can control which <strong>Tracer</strong> you use.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Extension-examples"><a href="#Extension-examples" class="headerlink" title="Extension examples"></a>Extension examples</h3><h4 id="Introduction-2"><a href="#Introduction-2" class="headerlink" title="Introduction"></a>Introduction</h4><p>Extensions add new <strong>features</strong> and <strong>capabilities</strong> to the <strong>agent</strong> without having to <strong>create a separate distribution</strong></p>
<h4 id="Add-extensions"><a href="#Add-extensions" class="headerlink" title="Add extensions"></a>Add extensions</h4><blockquote>
<p>To add the extension to the <strong>instrumentation agent</strong>:</p>
</blockquote>
<ol>
<li>Copy the jar file to a host that is running an application to which you’ve attached the OpenTelemetry Java instrumentation.</li>
<li>Modify the <strong>startup command</strong> to add the <strong>full path</strong> to the <strong>extension file</strong>. For example:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -javaagent:path/to/opentelemetry-javaagent.jar \</span><br><span class="line">     -Dotel.javaagent.extensions=build/libs/opentelemetry-java-instrumentation-extension-demo-1.0-all.jar</span><br><span class="line">     -jar myapp.jar</span><br></pre></td></tr></table></figure>

<p>To load <strong>multiple extensions</strong>, you can specify a <strong>comma-separated list</strong> of <strong>extension jars</strong> or <strong>directories</strong> (that contain extension jars) for the <strong>otel.javaagent.extensions</strong> value.</p>
<h4 id="Embed-extensions-in-the-OpenTelemetry-Agent"><a href="#Embed-extensions-in-the-OpenTelemetry-Agent" class="headerlink" title="Embed extensions in the OpenTelemetry Agent"></a>Embed extensions in the OpenTelemetry Agent</h4><ol>
<li>To simplify deployment, you can <strong>embed extensions into the OpenTelemetry Java Agent</strong> to produce a <strong>single jar file</strong>.</li>
<li>With an <strong>integrated extension</strong>, you no longer need the <strong>-Dotel.javaagent.extensions</strong> command line option.</li>
</ol>
<h4 id="Extensions-examples"><a href="#Extensions-examples" class="headerlink" title="Extensions examples"></a>Extensions examples</h4><ol>
<li><strong>ConfigurablePropagatorProvider</strong> and <strong>AutoConfigurationCustomizer</strong> implementations and custom instrumentation (<strong>InstrumentationModule</strong>)<ul>
<li>need the <strong>correct SPI</strong> (through <strong>@AutoService</strong>) in order to be <strong>loaded</strong> by the agent.</li>
</ul>
</li>
<li>Once a <strong>ConfigurablePropagatorProvider</strong> is added, it can be <strong>referenced by name</strong> in the <strong>OTEL_PROPAGATORS</strong> setting.</li>
<li><strong>AutoConfigurationCustomizer</strong> and instrumentation will be <strong>applied automatically</strong>.</li>
<li>To apply the <strong>other extension classes</strong> to the <strong>Java Agent</strong>, include an <strong>AutoConfigurationCustomizer</strong> in your extension.</li>
</ol>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><ol>
<li>The OpenTelemetry Java agent instruments your application by <strong>running inside</strong> the <strong>same Java Virtual Machine (JVM)</strong>.</li>
<li>Like any other software agent, the Java agent requires <strong>system resources</strong> like <strong>CPU</strong>, <strong>memory</strong>, and <strong>network bandwidth</strong>.</li>
<li>The <strong>use</strong> of <strong>resources</strong> by the agent is called <strong>agent overhead</strong> or <strong>performance overhead</strong>.</li>
<li>The OpenTelemetry Java agent has <strong>minimal impact</strong> on <strong>system performance</strong> when <strong>instrumenting JVM applications</strong><ul>
<li>although the final agent overhead depends on <strong>multiple factors</strong>.</li>
</ul>
</li>
<li>Some factors that might <strong>increase agent overhead</strong> are <strong>environmental</strong><ul>
<li>such as the <u>physical machine architecture</u>, <u>CPU frequency</u>, <u>amount and speed of memory</u>, <u>system temperature</u>, and <u>resource contention</u>.</li>
</ul>
</li>
<li>Other factors include <strong>virtualization</strong> and <strong>containerization</strong><ul>
<li>the <strong>operating system</strong> and <strong>its libraries</strong>, the <u>JVM version and vendor</u>, <u>JVM settings</u></li>
<li>the <u>algorithmic design of the software</u> being monitored, and <u>software dependencies</u>.</li>
</ul>
</li>
<li>Due to the <u>complexity of modern software</u> and the <u>broad diversity in deployment scenarios</u><ul>
<li>it is <strong>impossible</strong> to come up with a <strong>single agent overhead estimate</strong>.</li>
<li>To find the overhead of any instrumentation agent in a given deployment, you have to <strong>conduct experiments</strong> and <strong>collect measurements</strong> directly.</li>
<li>Therefore, treat all statements about performance as <strong>general information and guidelines</strong> that are subject to <strong>evaluation</strong> in a <strong>specific system</strong>.</li>
</ul>
</li>
<li>The following sections describe the <strong>minimum requirements</strong> of the <strong>OpenTelemetry Java agent</strong><ul>
<li>as well as <strong>potential constraints impacting performance</strong>, and guidelines to <strong>optimize and troubleshoot the performance</strong> of the agent.</li>
</ul>
</li>
</ol>
<h3 id="Guidelines-to-reduce-agent-overhead"><a href="#Guidelines-to-reduce-agent-overhead" class="headerlink" title="Guidelines to reduce agent overhead"></a>Guidelines to reduce agent overhead</h3><h4 id="Configure-trace-sampling"><a href="#Configure-trace-sampling" class="headerlink" title="Configure trace sampling"></a>Configure trace sampling</h4><ol>
<li>The <strong>volume of spans processed</strong> by the <strong>instrumentation</strong> might <strong>impact agent overhead</strong>.</li>
<li>You can configure <strong>trace sampling</strong> to adjust the <strong>span volume</strong> and <strong>reduce resource usage</strong>.</li>
</ol>
<h4 id="Turn-off-specific-instrumentations"><a href="#Turn-off-specific-instrumentations" class="headerlink" title="Turn off specific instrumentations"></a>Turn off specific instrumentations</h4><ol>
<li>You can further reduce agent overhead by <strong>turning off instrumentations</strong> that <strong>aren’t needed</strong> or are <strong>producing too many spans</strong>.</li>
<li>To turn off an instrumentation<ul>
<li>use <code>-Dotel.instrumentation.&lt;name&gt;.enabled=false</code> or the <code>OTEL_INSTRUMENTATION_&lt;NAME&gt;_ENABLED</code> environment variable</li>
<li>where <code>&lt;name&gt;</code> is the name of the instrumentation.</li>
</ul>
</li>
<li>For example, the following option turns off the JDBC instrumentation: <strong>-Dotel.instrumentation.jdbc.enabled&#x3D;false</strong></li>
</ol>
<h4 id="Allocate-more-memory-for-the-application"><a href="#Allocate-more-memory-for-the-application" class="headerlink" title="Allocate more memory for the application"></a>Allocate more memory for the application</h4><ol>
<li>Increasing the <strong>maximum heap size</strong> of the JVM using the <code>-Xmx&lt;size&gt;</code> option might help in <strong>alleviating</strong> agent overhead issues</li>
<li>as instrumentations can generate a <strong>large number</strong> of <strong>short-lived objects</strong> in <strong>memory</strong>.</li>
</ol>
<h4 id="Reduce-manual-instrumentation-to-what-you-need"><a href="#Reduce-manual-instrumentation-to-what-you-need" class="headerlink" title="Reduce manual instrumentation to what you need"></a>Reduce manual instrumentation to what you need</h4><ol>
<li><strong>Too much manual instrumentation</strong> might <strong>introduce inefficiencies</strong> that <strong>increase agent overhead</strong>.</li>
<li>For example, using <strong>@WithSpan</strong> on <strong>every method</strong> results in a <strong>high span volume</strong><ul>
<li>which in turn <strong>increases noise</strong> in the data and consumes <strong>more system resources</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Provision-adequate-resources"><a href="#Provision-adequate-resources" class="headerlink" title="Provision adequate resources"></a>Provision adequate resources</h4><ol>
<li>Make sure to <strong>provision enough resources</strong> for your <strong>instrumentation</strong> and for the <strong>Collector</strong>.</li>
<li>The amount of resources such as <strong>memory</strong> or <strong>disk</strong> depend on your <strong>application architecture</strong> and needs.</li>
<li>For example, a common setup is to run the <strong>instrumented application</strong> on the <strong>same host</strong> as the <strong>OpenTelemetry Collector</strong>.<ul>
<li>In that case, consider <strong>rightsizing the resources</strong> for the Collector and <strong>optimize its settings</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Constraints-impacting-the-performance-of-the-Java-agent"><a href="#Constraints-impacting-the-performance-of-the-Java-agent" class="headerlink" title="Constraints impacting the performance of the Java agent"></a>Constraints impacting the performance of the Java agent</h3><ol>
<li>In general, the <strong>more telemetry</strong> you collect from your application, the <strong>greater the impact</strong> on agent overhead.</li>
<li>For example, tracing methods that <strong>aren’t relevant</strong> to your application can still <strong>produce considerable agent overhead</strong><ul>
<li>because <strong>tracing such methods</strong> is <strong>computationally more expensive</strong> than <strong>running the method itself</strong>.</li>
</ul>
</li>
<li>Similarly, <strong>high cardinality tags</strong> in <strong>metrics</strong> might <strong>increase memory usage</strong>.<ul>
<li><strong>Debug logging</strong>, if turned on, also <strong>increases write operations to disk</strong> and <strong>memory usage</strong>.</li>
</ul>
</li>
<li>Some instrumentations, for example <strong>JDBC</strong> or <strong>Redis</strong>, produce <strong>high span volumes</strong> that <strong>increase agent overhead</strong>.</li>
<li><strong>Experimental features</strong> of the Java agent might <strong>increase agent overhead</strong> due to the experimental focus on <strong>functionality over performance</strong>.<ul>
<li><strong>Stable features</strong> are <strong>safer</strong> in terms of <strong>agent overhead</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Troubleshooting-agent-overhead-issues"><a href="#Troubleshooting-agent-overhead-issues" class="headerlink" title="Troubleshooting agent overhead issues"></a>Troubleshooting agent overhead issues</h3><p>When troubleshooting agent overhead issues, do the following:</p>
<ul>
<li>Check <strong>minimum requirements</strong>.</li>
<li>Use the <strong>latest compatible version</strong> of the <strong>Java agent</strong>.</li>
<li>Use the <strong>latest compatible version</strong> of your <strong>JVM</strong>.</li>
</ul>
<p>Consider taking the following actions to <strong>decrease agent overhead</strong>:</p>
<ul>
<li>If your application is <strong>approaching memory limits</strong>, consider giving it <strong>more memory</strong>.</li>
<li>If your application is <strong>using all the CPU</strong>, you might want to <strong>scale it horizontally</strong>.</li>
<li>Try <strong>turning off or tuning metrics</strong>.</li>
<li>Tune <strong>trace sampling</strong> settings to <strong>reduce span volume</strong>.</li>
<li><strong>Turn off specific instrumentations</strong>.</li>
<li>Review <strong>manual instrumentation</strong> for <strong>unnecessary span generation</strong>.</li>
</ul>
<h1 id="Spring-Boot-starter"><a href="#Spring-Boot-starter" class="headerlink" title="Spring Boot starter"></a>Spring Boot starter</h1><p>You can use two options to <strong>instrument Spring Boot applications</strong> with <strong>OpenTelemetry</strong>.</p>
<ol>
<li>The <strong>default choice</strong> for instrumenting Spring Boot applications is the <strong>OpenTelemetry Java agent</strong> with <strong>bytecode instrumentation</strong>:<ul>
<li><strong>More out of the box instrumentation</strong> than the <strong>OpenTelemetry starter</strong></li>
</ul>
</li>
<li>The <strong>OpenTelemetry Spring Boot starter</strong> can help you with:<ul>
<li><strong>Spring Boot Native image applications</strong> for which the OpenTelemetry Java agent <strong>does not work</strong></li>
<li><strong>Startup overhead</strong> of the OpenTelemetry Java agent <strong>exceeding your requirements</strong></li>
<li>A <strong>Java monitoring agent</strong> already used because the OpenTelemetry Java agent <strong>might not work with the other agent</strong></li>
<li><strong>Spring Boot configuration files</strong> (application.properties, application.yml) to <strong>configure the OpenTelemetry</strong><ul>
<li><strong>Spring Boot starter</strong> which doesn’t work with the <strong>OpenTelemetry Java agent</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Getting-started-1"><a href="#Getting-started-1" class="headerlink" title="Getting started"></a>Getting started</h2><h3 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h3><p>The OpenTelemetry Spring Boot starter works with <strong>Spring Boot 2.6+</strong> and <strong>3.1+</strong>, and <strong>Spring Boot native image applications</strong>.</p>
<h3 id="Dependency-management"><a href="#Dependency-management" class="headerlink" title="Dependency management"></a>Dependency management</h3><ol>
<li>A Bill of Material (<strong>BOM</strong>) ensures that <strong>versions</strong> of <strong>dependencies</strong> (including <strong>transitive</strong> ones) are <strong>aligned</strong>.</li>
<li>To ensure <strong>version alignment</strong> across <strong>all OpenTelemetry dependencies</strong><ul>
<li>you must import the <strong>opentelemetry-instrumentation-bom</strong> BOM when using the <strong>OpenTelemetry starter</strong>.</li>
</ul>
</li>
<li>When using <strong>Maven</strong>, import the OpenTelemetry BOMs <strong>before any other BOMs in your project</strong>.<ul>
<li>For example, if you import the <strong>spring-boot-dependencies BOM</strong>, you have to declare it <strong>after</strong> the <strong>OpenTelemetry BOMs</strong>.</li>
</ul>
</li>
<li><strong>Gradle</strong> selects the <strong>latest version</strong> of a dependency when <strong>multiple BOMs</strong>, so the order of <strong>BOMs</strong> is <strong>not important</strong>.</li>
</ol>
<blockquote>
<p>The following example shows how to import the <strong>OpenTelemetry BOMs</strong> using Maven:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry.instrumentation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-instrumentation-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.20.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="OpenTelemetry-Starter-dependency"><a href="#OpenTelemetry-Starter-dependency" class="headerlink" title="OpenTelemetry Starter dependency"></a>OpenTelemetry Starter dependency</h3><p>Add the dependency given below to enable the OpenTelemetry starter.</p>
<blockquote>
<p>The OpenTelemetry starter uses <strong>OpenTelemetry Spring Boot autoconfiguration</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.opentelemetry.instrumentation&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;opentelemetry-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Extending-instrumentations-with-the-API-1"><a href="#Extending-instrumentations-with-the-API-1" class="headerlink" title="Extending instrumentations with the API"></a>Extending instrumentations with the API</h2><p>Use the <strong>OpenTelemetry API</strong> in <strong>combination</strong> with the <strong>Spring Boot starter</strong> to <strong>extend</strong> the <u>automatically generated telemetry</u> with <u>custom spans and metrics</u></p>
<h3 id="Introduction-3"><a href="#Introduction-3" class="headerlink" title="Introduction"></a>Introduction</h3><ol>
<li>In addition to the <strong>out-of-the-box instrumentation</strong><ul>
<li>you can <strong>extend</strong> the <strong>Spring starter</strong> with <strong>custom manual instrumentation</strong> using the <strong>OpenTelemetry API</strong>.</li>
</ul>
</li>
<li>This allows you to <strong>create spans and metrics</strong> for your own code without doing too many code changes.</li>
</ol>
<h3 id="OpenTelemetry-1"><a href="#OpenTelemetry-1" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h3><p>The Spring Boot starter is a special case where <strong>OpenTelemetry</strong> is available as a <strong>Spring bean</strong>. Simply <strong>inject</strong> OpenTelemetry into your <strong>Spring components</strong>.</p>
<h3 id="Span-1"><a href="#Span-1" class="headerlink" title="Span"></a>Span</h3><blockquote>
<p>For the <strong>most common use cases</strong>, use the <strong>@WithSpan</strong> annotation instead of <strong>manual instrumentation</strong>.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Tracer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Tracer tracer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MyController</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.tracer = openTelemetry.getTracer(<span class="string">&quot;application&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use the <strong>Tracer</strong> to <strong>create a span</strong> as explained in the Span section.</p>
<h3 id="Meter-1"><a href="#Meter-1" class="headerlink" title="Meter"></a>Meter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.OpenTelemetry;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.metrics.Meter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Meter meter;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">MyController</span><span class="params">(OpenTelemetry openTelemetry)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.meter = openTelemetry.getMeter(<span class="string">&quot;application&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use the <strong>Meter</strong> to create a <strong>counter</strong>, <strong>gauge</strong> or <strong>histogram</strong> as explained in the Meter section.</p>
<h2 id="SDK-configuration"><a href="#SDK-configuration" class="headerlink" title="SDK configuration"></a>SDK configuration</h2><p>This spring starter supports <strong>configuration metadata</strong>, which means that you can see and <strong>autocomplete</strong> all <strong>available properties</strong> in your <strong>IDE</strong>.</p>
<h3 id="General-configuration"><a href="#General-configuration" class="headerlink" title="General configuration"></a>General configuration</h3><ol>
<li>The OpenTelemetry Starter supports all the <strong>SDK Autoconfiguration</strong> (since <strong>2.2.0</strong>).</li>
<li>You can update the configuration with <strong>properties</strong> in the <strong>application.properties</strong> or the <strong>application.yaml</strong> file, or with <strong>environment variables</strong>.</li>
</ol>
<blockquote>
<p><strong>application.properties</strong> example:</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">otel.propagators</span>=<span class="string">tracecontext,b3</span></span><br><span class="line"><span class="attr">otel.resource.attributes.deployment.environment</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">otel.resource.attributes.service.name</span>=<span class="string">cart</span></span><br><span class="line"><span class="attr">otel.resource.attributes.service.namespace</span>=<span class="string">shop</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>application.yaml</strong> example:</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">otel:</span></span><br><span class="line">  <span class="attr">propagators:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">tracecontext</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">b3</span></span><br><span class="line">  <span class="attr">resource:</span></span><br><span class="line">    <span class="attr">attributes:</span></span><br><span class="line">      <span class="attr">deployment.environment:</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">cart</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">shop</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Environment variables</strong> example:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_PROPAGATORS=&quot;tracecontext,b3&quot;</span><br><span class="line">export OTEL_RESOURCE_ATTRIBUTES=&quot;deployment.environment=dev,service.name=cart,service.namespace=shop&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Overriding-Resource-Attributes"><a href="#Overriding-Resource-Attributes" class="headerlink" title="Overriding Resource Attributes"></a>Overriding Resource Attributes</h3><ol>
<li>As usual in Spring Boot, you can <strong>override properties</strong> in the <u>application.properties</u> and <u>application.yaml</u> files with <strong>environment variables</strong>.</li>
<li>For example, you can set or override the <strong>deployment.environment</strong> resource attribute (<strong>not changing</strong> <u>service.name</u> or <u>service.namespace</u>)<ul>
<li>by setting the standard <strong>OTEL_RESOURCE_ATTRIBUTES</strong> environment variable:</li>
</ul>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_RESOURCE_ATTRIBUTES=&quot;deployment.environment=prod&quot;</span><br></pre></td></tr></table></figure>

<p>You can use the <strong>OTEL_RESOURCE_ATTRIBUTES_DEPLOYMENT_ENVIRONMENT</strong> environment variable to <strong>set</strong> or <strong>override</strong> a <strong>single resource attribute</strong>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export OTEL_RESOURCE_ATTRIBUTES_DEPLOYMENT_ENVIRONMENT=&quot;prod&quot;</span><br></pre></td></tr></table></figure>

<ol>
<li>The second option supports <strong>SpEL</strong> expressions.</li>
<li>Note that <strong>DEPLOYMENT_ENVIRONMENT</strong> gets converted to <strong>deployment.environment</strong> by Spring Boot’s <strong>Relaxed Binding</strong></li>
</ol>
<h3 id="Disable-the-OpenTelemetry-Starter"><a href="#Disable-the-OpenTelemetry-Starter" class="headerlink" title="Disable the OpenTelemetry Starter"></a>Disable the OpenTelemetry Starter</h3><ol>
<li>System property: <strong>otel.sdk.disabled</strong></li>
<li>Description: Set the value to true to disable the starter, e.g. for testing purposes.</li>
</ol>
<h3 id="Programmatic-configuration"><a href="#Programmatic-configuration" class="headerlink" title="Programmatic configuration"></a>Programmatic configuration</h3><ol>
<li>You can use the <strong>AutoConfigurationCustomizerProvider</strong> for programmatic configuration.</li>
<li>Programmatic configuration is <strong>recommended</strong> for <strong>advanced use cases</strong>, which are <strong>not configurable</strong> using <strong>properties</strong>.</li>
</ol>
<h4 id="Exclude-actuator-endpoints-from-tracing"><a href="#Exclude-actuator-endpoints-from-tracing" class="headerlink" title="Exclude actuator endpoints from tracing"></a>Exclude actuator endpoints from tracing</h4><blockquote>
<p>As an example, you can customize the <strong>sampler</strong> to <strong>exclude health check endpoints</strong> from <strong>tracing</strong>:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry.contrib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-samplers<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.33.0-alpha<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.SpanKind;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.contrib.sampler.RuleBasedRoutingSampler;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.AutoConfigurationCustomizerProvider;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.semconv.UrlAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterPaths</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> AutoConfigurationCustomizerProvider <span class="title function_">otelCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p -&gt;</span><br><span class="line">        p.addSamplerCustomizer(</span><br><span class="line">            (fallback, config) -&gt;</span><br><span class="line">                RuleBasedRoutingSampler.builder(SpanKind.SERVER, fallback)</span><br><span class="line">                    .drop(UrlAttributes.URL_PATH, <span class="string">&quot;^/actuator&quot;</span>)</span><br><span class="line">                    .build());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Configure-the-exporter-programmatically"><a href="#Configure-the-exporter-programmatically" class="headerlink" title="Configure the exporter programmatically"></a>Configure the exporter programmatically</h4><ol>
<li>You can also configure <strong>OTLP exporters</strong> programmatically.</li>
<li>This configuration <strong>replaces</strong> the <strong>default OTLP exporter</strong> and adds a <strong>custom header</strong> to the requests.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.exporter.otlp.http.trace.OtlpHttpSpanExporter;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.sdk.autoconfigure.spi.AutoConfigurationCustomizerProvider;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomAuth</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> AutoConfigurationCustomizerProvider <span class="title function_">otelCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p -&gt;</span><br><span class="line">        p.addSpanExporterCustomizer(</span><br><span class="line">            (exporter, config) -&gt; &#123;</span><br><span class="line">              <span class="keyword">if</span> (exporter <span class="keyword">instanceof</span> OtlpHttpSpanExporter) &#123;</span><br><span class="line">                <span class="keyword">return</span> ((OtlpHttpSpanExporter) exporter)</span><br><span class="line">                    .toBuilder().setHeaders(<span class="built_in">this</span>::headers).build();</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> exporter;</span><br><span class="line">            &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Map&lt;String, String&gt; <span class="title function_">headers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Collections.singletonMap(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + refreshToken());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">refreshToken</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// e.g. read the token from a kubernetes secret</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;token&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Resource-Providers"><a href="#Resource-Providers" class="headerlink" title="Resource Providers"></a>Resource Providers</h3><p>The <strong>OpenTelemetry Starter</strong> includes the <strong>same resource providers</strong> as the <strong>Java agent</strong>:</p>
<ul>
<li><strong>Common</strong> resource providers - <u>Container &#x2F; Host &#x2F; OS &#x2F; Process &#x2F; Java Runtime &#x2F; Platforms</u></li>
<li>Resource providers that are <strong>disabled</strong> by default</li>
</ul>
<p>In addition, the <strong>OpenTelemetry Starter</strong> includes the following <strong>Spring Boot specific resource providers</strong>:</p>
<h4 id="Distribution-Resource-Provider"><a href="#Distribution-Resource-Provider" class="headerlink" title="Distribution Resource Provider"></a>Distribution Resource Provider</h4><blockquote>
<p>FQN: <strong>io.opentelemetry.instrumentation.spring.autoconfigure.resources.DistroVersionResourceProvider</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>telemetry.distro.name</td>
<td>opentelemetry-spring-boot-starter</td>
</tr>
<tr>
<td>telemetry.distro.version</td>
<td>version of the starter</td>
</tr>
</tbody></table>
<h4 id="Spring-Resource-Provider"><a href="#Spring-Resource-Provider" class="headerlink" title="Spring Resource Provider"></a>Spring Resource Provider</h4><blockquote>
<p>FQN: <strong>io.opentelemetry.instrumentation.spring.autoconfigure.resources.SpringResourceProvider</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>service.name</td>
<td><strong>spring.application.name</strong> or <strong>build.name</strong> from <strong>build-info.properties</strong></td>
</tr>
<tr>
<td>service.version</td>
<td><strong>build.version</strong> from <strong>build-info.properties</strong></td>
</tr>
</tbody></table>
<h3 id="Service-name"><a href="#Service-name" class="headerlink" title="Service name"></a>Service name</h3><p>Using these resource providers, the service name is determined by the following <strong>precedence rules</strong>, in accordance with the <strong>OpenTelemetry specification</strong>:</p>
<ol>
<li><strong>otel.service.name</strong> spring property or <strong>OTEL_SERVICE_NAME</strong> environment variable (<strong>highest</strong> precedence)</li>
<li><strong>service.name</strong> in <strong>otel.resource.attributes</strong> system&#x2F;spring property or <strong>OTEL_RESOURCE_ATTRIBUTES</strong> environment variable</li>
<li><strong>spring.application.name</strong> spring property</li>
<li><strong>build-info.properties</strong></li>
<li><strong>Implementation-Title</strong> from META-INF&#x2F;MANIFEST.MF</li>
<li>The <strong>default value</strong> is <strong>unknown_service:java</strong> (<strong>lowest</strong> precedence)</li>
</ol>
<blockquote>
<p>Use the following snippet in your pom.xml file to <strong>generate</strong> the <strong>build-info.properties</strong> file:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>build-info<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Out-of-the-box-instrumentation"><a href="#Out-of-the-box-instrumentation" class="headerlink" title="Out of the box instrumentation"></a>Out of the box instrumentation</h2><p>Out of the box instrumentation is available for several frameworks:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Property</th>
<th>Default Value</th>
</tr>
</thead>
<tbody><tr>
<td>JDBC</td>
<td>otel.instrumentation.jdbc.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Logback</td>
<td>otel.instrumentation.logback-appender.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Logback MDC</td>
<td>otel.instrumentation.logback-mdc.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Spring Web</td>
<td>otel.instrumentation.spring-web.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Spring Web MVC</td>
<td>otel.instrumentation.spring-webmvc.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Spring WebFlux</td>
<td>otel.instrumentation.spring-webflux.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Kafka</td>
<td>otel.instrumentation.kafka.enabled</td>
<td>true</td>
</tr>
<tr>
<td>MongoDB</td>
<td>otel.instrumentation.mongo.enabled</td>
<td>true</td>
</tr>
<tr>
<td>Micrometer</td>
<td>otel.instrumentation.micrometer.enabled</td>
<td>false</td>
</tr>
<tr>
<td>R2DBC (reactive JDBC)</td>
<td>otel.instrumentation.r2dbc.enabled</td>
<td>true</td>
</tr>
</tbody></table>
<h3 id="Turn-on-instrumentations-selectively"><a href="#Turn-on-instrumentations-selectively" class="headerlink" title="Turn on instrumentations selectively"></a>Turn on instrumentations selectively</h3><ol>
<li>To use only specific instrumentations<ul>
<li><strong>turn off all the instrumentations first</strong> by setting the <strong>otel.instrumentation.common.default-enabled</strong> property to <strong>false</strong>.</li>
<li>Then, turn on instrumentations <strong>one by one</strong>.</li>
</ul>
</li>
<li>For example, if you want to only enable the JDBC instrumentation, set <strong>otel.instrumentation.jdbc.enabled</strong> to true.</li>
</ol>
<h3 id="Common-instrumentation-configuration"><a href="#Common-instrumentation-configuration" class="headerlink" title="Common instrumentation configuration"></a>Common instrumentation configuration</h3><p><strong>Common properties</strong> for <strong>all database instrumentations</strong>:</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.common.<strong>db-statement-sanitizer</strong>.enabled</td>
<td>Boolean</td>
<td>true</td>
<td>Enables the DB statement sanitization.</td>
</tr>
</tbody></table>
<h3 id="JDBC-Instrumentation"><a href="#JDBC-Instrumentation" class="headerlink" title="JDBC Instrumentation"></a>JDBC Instrumentation</h3><table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.jdbc.<strong>statement-sanitizer</strong>.enabled</td>
<td>Boolean</td>
<td>true</td>
<td>Enables the DB statement sanitization.</td>
</tr>
</tbody></table>
<h3 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h3><p>You can enable <strong>experimental features</strong> with <strong>system properties</strong> to <strong>capture attributes</strong> :</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.logback-appender.experimental-<strong>log-attributes</strong></td>
<td>Boolean</td>
<td>false</td>
<td>Enable the capture of experimental log attributes <strong>thread.name</strong> and <strong>thread.id</strong>.</td>
</tr>
<tr>
<td>otel.instrumentation.logback-appender.experimental.<strong>capture-code-attributes</strong></td>
<td>Boolean</td>
<td>false</td>
<td>Enable the capture of <strong>source code attributes</strong>.<br />Note that capturing source code attributes at logging sites might add a <strong>performance overhead</strong>.</td>
</tr>
<tr>
<td>otel.instrumentation.logback-appender.experimental.<strong>capture-marker-attribute</strong></td>
<td>Boolean</td>
<td>false</td>
<td>Enable the capture of <strong>Logback markers</strong> as attributes.</td>
</tr>
<tr>
<td>otel.instrumentation.logback-appender.experimental.<strong>capture-key-value-pair-attributes</strong></td>
<td>Boolean</td>
<td>false</td>
<td>Enable the capture of <strong>Logback key value pairs</strong> as attributes.</td>
</tr>
<tr>
<td>otel.instrumentation.logback-appender.experimental.<strong>capture-logger-context-attributes</strong></td>
<td>Boolean</td>
<td>false</td>
<td>Enable the capture of <strong>Logback logger context properties</strong> as attributes.</td>
</tr>
<tr>
<td>otel.instrumentation.logback-appender.experimental.<strong>capture-mdc-attributes</strong></td>
<td>String</td>
<td></td>
<td>Comma separated list of <strong>MDC attributes</strong> to capture.<br />Use the <strong>wildcard</strong> character <code>*</code> to capture <strong>all attributes</strong>.</td>
</tr>
</tbody></table>
<p>Alternatively, you can enable these features by adding the <strong>OpenTelemetry Logback appender</strong> in your <strong>logback.xml</strong> or <strong>logback-spring.xml</strong> file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;OpenTelemetry&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;io.opentelemetry.instrumentation.logback.appender.v1_0.OpenTelemetryAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureExperimentalAttributes</span>&gt;</span>false<span class="tag">&lt;/<span class="name">captureExperimentalAttributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureCodeAttributes</span>&gt;</span>true<span class="tag">&lt;/<span class="name">captureCodeAttributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureMarkerAttribute</span>&gt;</span>true<span class="tag">&lt;/<span class="name">captureMarkerAttribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureKeyValuePairAttributes</span>&gt;</span>true<span class="tag">&lt;/<span class="name">captureKeyValuePairAttributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureLoggerContext</span>&gt;</span>true<span class="tag">&lt;/<span class="name">captureLoggerContext</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">captureMdcAttributes</span>&gt;</span>*<span class="tag">&lt;/<span class="name">captureMdcAttributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;OpenTelemetry&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Spring-Web-Autoconfiguration"><a href="#Spring-Web-Autoconfiguration" class="headerlink" title="Spring Web Autoconfiguration"></a>Spring Web Autoconfiguration</h3><ol>
<li>Provides <strong>autoconfiguration</strong> for the <strong>RestTemplate trace interceptor</strong> defined in <strong>opentelemetry-spring-web-3.1</strong>. </li>
<li>This autoconfiguration instruments <strong>all requests</strong> sent using <strong>Spring RestTemplate beans</strong> by applying a RestTemplate <strong>bean post processor</strong>.</li>
<li>This feature is supported for <strong>spring web versions 3.1+</strong>.</li>
</ol>
<blockquote>
<p>The following ways of creating a <strong>RestTemplate</strong> are <strong>supported</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.client.RestTemplateBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">RestTemplateController</span><span class="params">(RestTemplateBuilder restTemplateBuilder)</span> &#123;</span><br><span class="line">    restTemplate = restTemplateBuilder.rootUri(<span class="string">&quot;http://localhost:8080&quot;</span>).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>The following ways of creating a <strong>RestClient</strong> are <strong>supported</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> RestClient <span class="title function_">restClient</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RestClient.create();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestClientController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RestClient restClient;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">RestClientController</span><span class="params">(RestClient.Builder restClientBuilder)</span> &#123;</span><br><span class="line">    restClient = restClientBuilder.baseUrl(<span class="string">&quot;http://localhost:8080&quot;</span>).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>As it’s possible with the <strong>Java agent</strong>, you can configure the capture of the following entities:</p>
</blockquote>
<ul>
<li>HTTP request and response headers</li>
<li>Known HTTP methods</li>
<li>Experimental HTTP telemetry</li>
</ul>
<h3 id="Spring-Web-MVC-Autoconfiguration"><a href="#Spring-Web-MVC-Autoconfiguration" class="headerlink" title="Spring Web MVC Autoconfiguration"></a>Spring Web MVC Autoconfiguration</h3><ol>
<li>This feature autoconfigures instrumentation for <strong>Spring WebMVC controllers</strong><ul>
<li>by adding a <strong>telemetry</strong> producing <strong>servlet Filter bean</strong> to the <strong>application context</strong>.</li>
</ul>
</li>
<li>The filter <strong>decorates</strong> the <strong>request execution</strong> with a <strong>server span</strong>, <strong>propagating</strong> the <strong>incoming tracing context</strong> if received in the HTTP request.</li>
</ol>
<blockquote>
<p>As it’s possible with the <strong>Java agent</strong>, you can configure the capture of the following entities:</p>
</blockquote>
<ul>
<li>HTTP request and response headers</li>
<li>Known HTTP methods</li>
<li>Experimental HTTP telemetry</li>
</ul>
<h3 id="Spring-WebFlux-Autoconfiguration"><a href="#Spring-WebFlux-Autoconfiguration" class="headerlink" title="Spring WebFlux Autoconfiguration"></a>Spring WebFlux Autoconfiguration</h3><ol>
<li>Provides <strong>autoconfigurations</strong> for the <strong>OpenTelemetry WebClient ExchangeFilter</strong> defined in <strong>opentelemetry-spring-webflux-5.3</strong></li>
<li>This autoconfiguration instruments <strong>all outgoing HTTP requests</strong> sent using <strong>Spring’s WebClient and WebClient Builder beans</strong><ul>
<li>by applying a <strong>bean post processor</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>The following ways of creating a <strong>WebClient</strong> are <strong>supported</strong>:</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> WebClient <span class="title function_">webClient</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> WebClient.create();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package otel;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class WebClientController &#123;</span><br><span class="line"></span><br><span class="line">  private final WebClient webClient;</span><br><span class="line"></span><br><span class="line">  public WebClientController(WebClient.Builder webClientBuilder) &#123;</span><br><span class="line">    webClient = webClientBuilder.baseUrl(&quot;http://localhost:8080&quot;).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Kafka-Instrumentation"><a href="#Kafka-Instrumentation" class="headerlink" title="Kafka Instrumentation"></a>Kafka Instrumentation</h3><p>Provides <strong>autoconfiguration</strong> for the <strong>Kafka client instrumentation</strong>.</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.kafka.experimental-span-attributes</td>
<td>Boolean</td>
<td>false</td>
<td>Enables the capture of experimental span attributes.</td>
</tr>
</tbody></table>
<h3 id="Micrometer-Instrumentation"><a href="#Micrometer-Instrumentation" class="headerlink" title="Micrometer Instrumentation"></a>Micrometer Instrumentation</h3><p>Provides <strong>autoconfiguration</strong> for the <strong>Micrometer</strong> to OpenTelemetry <strong>bridge</strong>.</p>
<h3 id="MongoDB-Instrumentation"><a href="#MongoDB-Instrumentation" class="headerlink" title="MongoDB Instrumentation"></a>MongoDB Instrumentation</h3><p>Provides <strong>autoconfiguration</strong> for the <strong>MongoDB client instrumentation</strong>.</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.mongo.statement-sanitizer.enabled</td>
<td>Boolean</td>
<td>true</td>
<td>Enables the DB statement sanitization.</td>
</tr>
</tbody></table>
<h3 id="R2DBC-Instrumentation"><a href="#R2DBC-Instrumentation" class="headerlink" title="R2DBC Instrumentation"></a>R2DBC Instrumentation</h3><p>Provides <strong>autoconfiguration</strong> for the <strong>OpenTelemetry R2DBC instrumentation</strong>.</p>
<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.r2dbc.statement-sanitizer.enabled</td>
<td>Boolean</td>
<td>true</td>
<td>Enables the DB statement sanitization.</td>
</tr>
</tbody></table>
<h2 id="Annotations-1"><a href="#Annotations-1" class="headerlink" title="Annotations"></a>Annotations</h2><ol>
<li>For <strong>most users</strong>, the <strong>out-of-the-box instrumentation</strong> is <strong>completely sufficient</strong> and nothing more has to be done.</li>
<li>Sometimes, however, users wish to <strong>create spans</strong> for their own <strong>custom code</strong> without needing to make many code changes.<ul>
<li>If you add the <strong>WithSpan</strong> annotation to a <strong>method</strong>, the method is <strong>wrapped in a span</strong>.</li>
<li>The <strong>SpanAttribute</strong> annotation allows you to <strong>capture</strong> the <strong>method arguments</strong> as <strong>attributes</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.Span;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.api.trace.SpanKind;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.SpanAttribute;</span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.WithSpan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Test WithSpan */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TracedClass</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@WithSpan</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tracedMethod</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@WithSpan(value = &quot;span name&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tracedMethodWithName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Span</span> <span class="variable">currentSpan</span> <span class="operator">=</span> Span.current();</span><br><span class="line">    currentSpan.addEvent(<span class="string">&quot;ADD EVENT TO tracedMethodWithName SPAN&quot;</span>);</span><br><span class="line">    currentSpan.setAttribute(<span class="string">&quot;isTestAttribute&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@WithSpan(kind = SpanKind.CLIENT)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tracedClientSpan</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@WithSpan</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">tracedMethodWithAttribute</span><span class="params">(<span class="meta">@SpanAttribute(&quot;attributeName&quot;)</span> String parameter)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>The <strong>OpenTelemetry annotations</strong> use <strong>Spring AOP</strong> based on <strong>proxies</strong>.</li>
<li>These annotations <strong>work only for</strong> the <strong>methods</strong> of the <strong>proxy</strong>.</li>
<li>In the following example, the <strong>WithSpan</strong> annotation <strong>won’t do anything</strong> when the GET endpoint is called:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> otel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.opentelemetry.instrumentation.annotations.WithSpan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyControllerManagedBySpring</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/ping&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    anotherMethod();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@WithSpan</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">anotherMethod</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>To be able to use the <strong>OpenTelemetry annotations</strong>, you have to add the <strong>Spring Boot Starter AOP dependency</strong> to your project:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can <strong>disable</strong> the <strong>OpenTelemetry annotations</strong> by setting the <strong>otel.instrumentation.annotations.enabled</strong> property to <strong>false</strong>.</p>
<blockquote>
<p>You can <strong>customize</strong> the <strong>span</strong> by using the <strong>elements</strong> of the <strong>WithSpan</strong> annotation:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String</td>
<td>Span name</td>
<td>ClassName.Method</td>
</tr>
<tr>
<td>kind</td>
<td>SpanKind</td>
<td>Span kind of the span</td>
<td><strong>SpanKind.INTERNAL</strong></td>
</tr>
</tbody></table>
<blockquote>
<p>You can set the <strong>attribute name</strong> from the <strong>value element</strong> of the <strong>SpanAttribute</strong> annotation:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String</td>
<td>Attribute name</td>
<td>Method parameter name</td>
</tr>
</tbody></table>
<h2 id="Additional-instrumentation"><a href="#Additional-instrumentation" class="headerlink" title="Additional instrumentation"></a>Additional instrumentation</h2><p>The OpenTelemetry Spring Boot starter provides out of the box instrumentation that you can augment with <strong>additional instrumentations</strong>.</p>
<h3 id="Log4j2-Instrumentation"><a href="#Log4j2-Instrumentation" class="headerlink" title="Log4j2 Instrumentation"></a>Log4j2 Instrumentation</h3><blockquote>
<p>You have to add the <strong>OpenTelemetry appender</strong> to your <strong>log4j2.xml</strong> file:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span> <span class="attr">packages</span>=<span class="string">&quot;io.opentelemetry.instrumentation.log4j.appender.v2_17&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">OpenTelemetry</span> <span class="attr">name</span>=<span class="string">&quot;OpenTelemetryAppender&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;OpenTelemetryAppender&quot;</span> <span class="attr">level</span>=<span class="string">&quot;All&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>System property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>otel.instrumentation.log4j-appender.enabled</td>
<td>Boolean</td>
<td>true</td>
<td>Enables the configuration of the <strong>Log4j OpenTelemetry appender</strong> with an <strong>OpenTelemetry instance</strong>.</td>
</tr>
</tbody></table>
<h2 id="Other-Spring-autoconfiguration"><a href="#Other-Spring-autoconfiguration" class="headerlink" title="Other Spring autoconfiguration"></a>Other Spring autoconfiguration</h2><p>Instead of using the <strong>OpenTelemetry Spring starter</strong>, you can use the <strong>OpenTelemetry Zipkin starter</strong>.</p>
<h3 id="Zipkin-starter"><a href="#Zipkin-starter" class="headerlink" title="Zipkin starter"></a>Zipkin starter</h3><ol>
<li><strong>OpenTelemetry Zipkin Exporter Starter</strong> is a starter package that includes the <strong>opentelemetry-api</strong>, <strong>opentelemetry-sdk</strong>, <strong>opentelemetry-extension-annotations</strong>, <strong>opentelemetry-logging-exporter</strong>, <strong>opentelemetry-spring-boot-autoconfigurations</strong> and <strong>spring framework starters</strong> required to setup distributed tracing.</li>
<li>It also provides the <strong>opentelemetry-exporters-zipkin</strong> artifact and corresponding <strong>exporter autoconfiguration</strong>.</li>
<li>If an <strong>exporter</strong> is <strong>present in the classpath</strong> during <strong>runtime</strong> and a <strong>spring bean</strong> of the <strong>exporter</strong> is <strong>missing</strong> from the <strong>spring application context</strong><ul>
<li>an <strong>exporter bean</strong> is <strong>initialized</strong> and added to a <strong>simple span processor</strong> in the <strong>active tracer provider</strong>.</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.opentelemetry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opentelemetry-exporter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.54.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Property</th>
<th>Default Value</th>
<th>ConditionalOnClass</th>
</tr>
</thead>
<tbody><tr>
<td>otel.exporter.zipkin.enabled</td>
<td>true</td>
<td>ZipkinSpanExporter</td>
</tr>
</tbody></table>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/">https://blog.zhongmingmao.top/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a><a class="post-meta__tags" href="/tags/opentelemetry/">OpenTelemetry</a></div><div class="post-share"><div class="social-share" data-image="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Observability - Prometheus Introduction</div></div><div class="info-2"><div class="info-item-1">Summary Open source metrics and monitoring for your systems and services. Monitor your applications, systems, and services with the leading open source monitoring solution. Instrument, collect, store, and query your metrics for alerting, dashboarding, and other use cases.       Feature Desc    Dimensional data model Prometheus models time series in a flexible dimensional data model.Time series are identified by a metric name and a set of key-value pairs.   Powerful queries The PromQL query language allow...</div></div></div></a><a class="pagination-related" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Observability - OpenTelemetry Java</div></div><div class="info-2"><div class="info-item-1">Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.    Overview The API is a set of classes and interfaces for recording telemetry across key observability signals.  It supports multiple implementations, with a low-overhead minimalist Noop and SDK reference implementation provided out of the box.  It is designed to be taken as a direct dependency by libraries, framewor...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-20</div><div class="info-item-2">Observability - OpenTelemetry Java</div></div><div class="info-2"><div class="info-item-1">Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.    Overview The API is a set of classes and interfaces for recording telemetry across key observability signals.  It supports multiple implementations, with a low-overhead minimalist Noop and SDK reference implementation provided out of the box.  It is designed to be taken as a direct dependency by libraries, framewor...</div></div></div></a><a class="pagination-related" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-05</div><div class="info-item-2">Observability - OpenTelemetry Python</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development   Version supportOpenTelemetry-Python supports Python 3.9 and higher.   Installation The API and SDK packages are available on PyPI, and can be installed via pip:  12pip install opentelemetry-apipip install opentelemetry-sdk   In addition, there are several extension packages which can be installed separately as:  12pip install opentelemetry-exporter-&#123;exporter&#125;pip install opentelemetry-instrumentation-&#123;instrumen...</div></div></div></a><a class="pagination-related" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="info-item-2">Observability - OpenTelemetry Go</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases The logs signal is still experimental. Breaking changes may be introduced in future versions.     Traces Metrics Logs    Stable Stable Beta     Getting StartedExample applicationSetup To begin, set up a go.mod in a new directory:  12345$ go mod init dicego: creating new go.mod: module dice$ lsgo.mod  Create and launch an HTTP server In that same folder, create a file called main.go and add the following code to the file:  123456789101112package mainimport (    &quot;log&quot; ...</div></div></div></a><a class="pagination-related" href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="info-item-2">Observability - OpenTelemetry Node.js</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development    Client instrumentation for the browser is experimental and mostly unspecified.    Version Support OpenTelemetry JavaScript supports all active or maintenance LTS versions of Node.js. Previous versions of Node.js may work, but are not tested by OpenTelemetry.   OpenTelemetry JavaScript has no official supported list of browsers. It is aimed to work on currently supported versions of major browsers. OpenTelemetry JavaScript f...</div></div></div></a><a class="pagination-related" href="/2025/01/02/cloud-native-observability-opentelemetry-doc-v2/" title="Observability - OpenTelemetry Doc V2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-beelines.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="info-item-2">Observability - OpenTelemetry Doc V2</div></div><div class="info-2"><div class="info-item-1">Language APIs &amp; SDKs OpenTelemetry code instrumentation is supported for many popular programming languages     OpenTelemetry code instrumentation is supported for the languages listed in the Statuses and Releases table below. For Go, .NET, PHP, Python, Java and JavaScript you can use zero-code solutions to add instrumentation to your application without code changes. If you are using Kubernetes, you can use the OpenTelemetry Operator for Kubernetes to inject these zero-code solutions into your appli...</div></div></div></a><a class="pagination-related" href="/2025/01/01/cloud-native-observability-opentelemetry-doc-v1/" title="Observability - OpenTelemetry Doc V1"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/opentelemetry.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="info-item-2">Observability - OpenTelemetry Doc V1</div></div><div class="info-2"><div class="info-item-1">架构 OpenTelemetry 也被称为 OTel，是一个供应商中立的、开源的可观测性框架， 可用于插桩、生成、采集和导出链路、 指标和日志等遥测数据     概述 专注于数据标准，不提供存储和可视化   OpenTelemetry 是一个可观测性框架和工具包， 旨在创建和管理遥测数据，如链路、 指标和日志 OpenTelemetry 是供应商和工具无关的，这意味着它可以与各种可观测性后端一起使用， 包括 Jaeger 和 Prometheus 这类开源工具以及商业化产品 OpenTelemetry 不是像 Jaeger、Prometheus 或其他商业供应商那样的可观测性后端 OpenTelemetry 专注于遥测数据的生成、采集、管理和导出 OpenTelemetry 的一个主要目标是， 无论应用程序或系统采用何种编程语言、基础设施或运行时环境，你都可以轻松地将其仪表化 遥测数据的存储和可视化是有意留给其他工具处理    可观测性 可观测性是通过检查系统输出来理解系统内部状态的能力 在软件的背景下，这意味着能够通过检查遥测数据（包括链路、指标和日志）来理解系统的内部状态   要使系统可观测，必须对...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-Agent"><span class="toc-number">1.</span> <span class="toc-text">Java Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-started"><span class="toc-number">1.1.</span> <span class="toc-text">Getting started</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup"><span class="toc-number">1.1.1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Declarative-configuration"><span class="toc-number">1.1.2.</span> <span class="toc-text">Declarative configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring-the-agent"><span class="toc-number">1.1.3.</span> <span class="toc-text">Configuring the agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Supported-libraries-frameworks-application-services-and-JVMs"><span class="toc-number">1.1.4.</span> <span class="toc-text">Supported libraries, frameworks, application services, and JVMs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Troubleshooting"><span class="toc-number">1.1.5.</span> <span class="toc-text">Troubleshooting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration"><span class="toc-number">1.2.</span> <span class="toc-text">Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Agent-Configuration"><span class="toc-number">1.2.1.</span> <span class="toc-text">Agent Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring-with-Environment-Variables"><span class="toc-number">1.2.2.</span> <span class="toc-text">Configuring with Environment Variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuration-file"><span class="toc-number">1.2.3.</span> <span class="toc-text">Configuration file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extensions"><span class="toc-number">1.2.4.</span> <span class="toc-text">Extensions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-agent-logging-output"><span class="toc-number">1.2.5.</span> <span class="toc-text">Java agent logging output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SDK-Configuration"><span class="toc-number">1.2.6.</span> <span class="toc-text">SDK Configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-Resource-Providers-that-are-disabled-by-default"><span class="toc-number">1.2.7.</span> <span class="toc-text">Enable Resource Providers that are disabled by default</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Declarative-configuration-1"><span class="toc-number">1.3.</span> <span class="toc-text">Declarative configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Supported-languages"><span class="toc-number">1.3.1.</span> <span class="toc-text">Supported languages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Supported-versions"><span class="toc-number">1.3.2.</span> <span class="toc-text">Supported versions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Suppressing-specific-instrumentation"><span class="toc-number">1.4.</span> <span class="toc-text">Suppressing specific instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Disabling-the-agent-entirely"><span class="toc-number">1.4.1.</span> <span class="toc-text">Disabling the agent entirely</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-only-specific-instrumentation"><span class="toc-number">1.4.2.</span> <span class="toc-text">Enable only specific instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enable-manual-instrumentation-only"><span class="toc-number">1.4.3.</span> <span class="toc-text">Enable manual instrumentation only</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suppressing-specific-agent-instrumentation"><span class="toc-number">1.4.4.</span> <span class="toc-text">Suppressing specific agent instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suppressing-controller-and-or-view-spans"><span class="toc-number">1.4.5.</span> <span class="toc-text">Suppressing controller and&#x2F;or view spans</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instrumentation-span-suppression-behavior"><span class="toc-number">1.4.6.</span> <span class="toc-text">Instrumentation span suppression behavior</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annotations"><span class="toc-number">1.5.</span> <span class="toc-text">Annotations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependencies"><span class="toc-number">1.5.1.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-spans-around-methods-with-WithSpan"><span class="toc-number">1.5.2.</span> <span class="toc-text">Creating spans around methods with @WithSpan</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Parameters"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">Parameters</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adding-attributes-to-the-span-with-SpanAttribute"><span class="toc-number">1.5.3.</span> <span class="toc-text">Adding attributes to the span with @SpanAttribute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suppressing-WithSpan-instrumentation"><span class="toc-number">1.5.4.</span> <span class="toc-text">Suppressing @WithSpan instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-spans-around-methods-with-otel-instrumentation-methods-include"><span class="toc-number">1.5.5.</span> <span class="toc-text">Creating spans around methods with otel.instrumentation.methods.include</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extending-instrumentations-with-the-API"><span class="toc-number">1.6.</span> <span class="toc-text">Extending instrumentations with the API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-number">1.6.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependencies-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">Dependencies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetry"><span class="toc-number">1.6.3.</span> <span class="toc-text">OpenTelemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Span"><span class="toc-number">1.6.4.</span> <span class="toc-text">Span</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meter"><span class="toc-number">1.6.5.</span> <span class="toc-text">Meter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instrumentation-configuration"><span class="toc-number">1.7.</span> <span class="toc-text">Instrumentation configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Peer-service-name"><span class="toc-number">1.7.1.</span> <span class="toc-text">Peer service name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DB-statement-sanitization"><span class="toc-number">1.7.2.</span> <span class="toc-text">DB statement sanitization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Capturing-consumer-message-receive-telemetry-in-messaging-instrumentations"><span class="toc-number">1.7.3.</span> <span class="toc-text">Capturing consumer message receive telemetry in messaging instrumentations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Capturing-enduser-attributes"><span class="toc-number">1.7.4.</span> <span class="toc-text">Capturing enduser attributes</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Security"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">Spring Security</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-instrumentation-configuration"><span class="toc-number">1.7.5.</span> <span class="toc-text">HTTP instrumentation configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Capturing-HTTP-request-and-response-headers"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">Capturing HTTP request and response headers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Capturing-servlet-request-parameters"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">Capturing servlet request parameters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configuring-known-HTTP-methods"><span class="toc-number">1.7.5.3.</span> <span class="toc-text">Configuring known HTTP methods</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enabling-experimental-HTTP-telemetry"><span class="toc-number">1.7.5.4.</span> <span class="toc-text">Enabling experimental HTTP telemetry</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Application-server-configuration"><span class="toc-number">1.8.</span> <span class="toc-text">Application server configuration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extensions-1"><span class="toc-number">1.9.</span> <span class="toc-text">Extensions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-1"><span class="toc-number">1.9.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extension-examples"><span class="toc-number">1.9.2.</span> <span class="toc-text">Extension examples</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Introduction-2"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Add-extensions"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">Add extensions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Embed-extensions-in-the-OpenTelemetry-Agent"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">Embed extensions in the OpenTelemetry Agent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Extensions-examples"><span class="toc-number">1.9.2.4.</span> <span class="toc-text">Extensions examples</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Performance"><span class="toc-number">1.10.</span> <span class="toc-text">Performance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Guidelines-to-reduce-agent-overhead"><span class="toc-number">1.10.1.</span> <span class="toc-text">Guidelines to reduce agent overhead</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-trace-sampling"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">Configure trace sampling</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Turn-off-specific-instrumentations"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">Turn off specific instrumentations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Allocate-more-memory-for-the-application"><span class="toc-number">1.10.1.3.</span> <span class="toc-text">Allocate more memory for the application</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reduce-manual-instrumentation-to-what-you-need"><span class="toc-number">1.10.1.4.</span> <span class="toc-text">Reduce manual instrumentation to what you need</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Provision-adequate-resources"><span class="toc-number">1.10.1.5.</span> <span class="toc-text">Provision adequate resources</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Constraints-impacting-the-performance-of-the-Java-agent"><span class="toc-number">1.10.2.</span> <span class="toc-text">Constraints impacting the performance of the Java agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Troubleshooting-agent-overhead-issues"><span class="toc-number">1.10.3.</span> <span class="toc-text">Troubleshooting agent overhead issues</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot-starter"><span class="toc-number">2.</span> <span class="toc-text">Spring Boot starter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-started-1"><span class="toc-number">2.1.</span> <span class="toc-text">Getting started</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Compatibility"><span class="toc-number">2.1.1.</span> <span class="toc-text">Compatibility</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dependency-management"><span class="toc-number">2.1.2.</span> <span class="toc-text">Dependency management</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetry-Starter-dependency"><span class="toc-number">2.1.3.</span> <span class="toc-text">OpenTelemetry Starter dependency</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extending-instrumentations-with-the-API-1"><span class="toc-number">2.2.</span> <span class="toc-text">Extending instrumentations with the API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction-3"><span class="toc-number">2.2.1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenTelemetry-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">OpenTelemetry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Span-1"><span class="toc-number">2.2.3.</span> <span class="toc-text">Span</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meter-1"><span class="toc-number">2.2.4.</span> <span class="toc-text">Meter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SDK-configuration"><span class="toc-number">2.3.</span> <span class="toc-text">SDK configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#General-configuration"><span class="toc-number">2.3.1.</span> <span class="toc-text">General configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Overriding-Resource-Attributes"><span class="toc-number">2.3.2.</span> <span class="toc-text">Overriding Resource Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-the-OpenTelemetry-Starter"><span class="toc-number">2.3.3.</span> <span class="toc-text">Disable the OpenTelemetry Starter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Programmatic-configuration"><span class="toc-number">2.3.4.</span> <span class="toc-text">Programmatic configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Exclude-actuator-endpoints-from-tracing"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">Exclude actuator endpoints from tracing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configure-the-exporter-programmatically"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">Configure the exporter programmatically</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource-Providers"><span class="toc-number">2.3.5.</span> <span class="toc-text">Resource Providers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Distribution-Resource-Provider"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">Distribution Resource Provider</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring-Resource-Provider"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">Spring Resource Provider</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service-name"><span class="toc-number">2.3.6.</span> <span class="toc-text">Service name</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Out-of-the-box-instrumentation"><span class="toc-number">2.4.</span> <span class="toc-text">Out of the box instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Turn-on-instrumentations-selectively"><span class="toc-number">2.4.1.</span> <span class="toc-text">Turn on instrumentations selectively</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Common-instrumentation-configuration"><span class="toc-number">2.4.2.</span> <span class="toc-text">Common instrumentation configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC-Instrumentation"><span class="toc-number">2.4.3.</span> <span class="toc-text">JDBC Instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Logback"><span class="toc-number">2.4.4.</span> <span class="toc-text">Logback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Web-Autoconfiguration"><span class="toc-number">2.4.5.</span> <span class="toc-text">Spring Web Autoconfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Web-MVC-Autoconfiguration"><span class="toc-number">2.4.6.</span> <span class="toc-text">Spring Web MVC Autoconfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-WebFlux-Autoconfiguration"><span class="toc-number">2.4.7.</span> <span class="toc-text">Spring WebFlux Autoconfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka-Instrumentation"><span class="toc-number">2.4.8.</span> <span class="toc-text">Kafka Instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Micrometer-Instrumentation"><span class="toc-number">2.4.9.</span> <span class="toc-text">Micrometer Instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-Instrumentation"><span class="toc-number">2.4.10.</span> <span class="toc-text">MongoDB Instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#R2DBC-Instrumentation"><span class="toc-number">2.4.11.</span> <span class="toc-text">R2DBC Instrumentation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Annotations-1"><span class="toc-number">2.5.</span> <span class="toc-text">Annotations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Additional-instrumentation"><span class="toc-number">2.6.</span> <span class="toc-text">Additional instrumentation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Log4j2-Instrumentation"><span class="toc-number">2.6.1.</span> <span class="toc-text">Log4j2 Instrumentation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other-Spring-autoconfiguration"><span class="toc-number">2.7.</span> <span class="toc-text">Other Spring autoconfiguration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zipkin-starter"><span class="toc-number">2.7.1.</span> <span class="toc-text">Zipkin starter</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>