<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Observability - Prometheus Introduction | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Summary Open source metrics and monitoring for your systems and services. Monitor your applications, systems, and services with the leading open source monitoring solution. Instrument, collect, store,">
<meta property="og:type" content="article">
<meta property="og:title" content="Observability - Prometheus Introduction">
<meta property="og:url" content="https://blog.zhongmingmao.top/2025/01/22/cloud-native-observability-prometheus-introduction/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="Summary Open source metrics and monitoring for your systems and services. Monitor your applications, systems, and services with the leading open source monitoring solution. Instrument, collect, store,">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png">
<meta property="article:published_time" content="2025-01-21T16:06:25.000Z">
<meta property="article:modified_time" content="2025-11-08T09:32:22.873Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Observability">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Observability - Prometheus Introduction",
  "url": "https://blog.zhongmingmao.top/2025/01/22/cloud-native-observability-prometheus-introduction/",
  "image": "https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png",
  "datePublished": "2025-01-21T16:06:25.000Z",
  "dateModified": "2025-11-08T09:32:22.873Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2025/01/22/cloud-native-observability-prometheus-introduction/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Observability - Prometheus Introduction',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Observability - Prometheus Introduction</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Observability - Prometheus Introduction</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/observability/">Observability</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>25mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-11-08 17:32:22&quot;}" hidden></div><h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><ol>
<li>Open source <strong>metrics</strong> and <strong>monitoring</strong> for your systems and services.</li>
<li>Monitor your <strong>applications</strong>, <strong>systems</strong>, and <strong>services</strong> with the leading open source monitoring solution.<ul>
<li><strong>Instrument</strong>, <strong>collect</strong>, <strong>store</strong>, and <strong>query</strong> your metrics for <strong>alerting</strong>, <strong>dashboarding</strong>, and other use cases.</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Dimensional</strong> data model</td>
<td>Prometheus models <strong>time series</strong> in a flexible <strong>dimensional</strong> data model.<br /><strong>Time series</strong> are identified by a <strong>metric name</strong> and a set of <strong>key-value pairs</strong>.</td>
</tr>
<tr>
<td>Powerful <strong>queries</strong></td>
<td>The <strong>PromQL</strong> query language allows you to <strong>query</strong>, <strong>correlate</strong>, and <strong>transform</strong> your time series data in powerful ways<br />for <strong>visualizations</strong>, <strong>alerts</strong>, and more.</td>
</tr>
<tr>
<td>Precise <strong>alerting</strong></td>
<td><strong>Alerting rules</strong> are based on <strong>PromQL</strong> and make full use of the <strong>dimensional</strong> data model. <br />A separate <strong>Alertmanager</strong> component handles <strong>notifications</strong> and <strong>silencing</strong>.</td>
</tr>
<tr>
<td>Simple <strong>operation</strong></td>
<td>Prometheus servers <strong>operate independently</strong> and only rely on <strong>local storage.</strong><br />Developed in <strong>Go</strong>, the <strong>statically linked binaries</strong> are easy to deploy across various environments.</td>
</tr>
<tr>
<td><strong>Instrumentation</strong> libraries</td>
<td>Prometheus provides a large number of <strong>official</strong> and <strong>community-contributed</strong> metrics instrumentation libraries<br />that cover most major languages.</td>
</tr>
<tr>
<td>Ubiquitous <strong>integrations</strong></td>
<td>Prometheus comes with hundreds of <strong>official</strong> and <strong>community-contributed</strong> integrations that allow you to<br />easily <strong>extract metrics</strong> from existing systems.</td>
</tr>
</tbody></table>
<span id="more"></span>

<blockquote>
<p><strong>Modern monitoring</strong></p>
</blockquote>
<ol>
<li>Monitoring for the <strong>cloud native world</strong></li>
<li>Designed for the cloud native world, Prometheus integrates with <strong>Kubernetes</strong> and other <strong>cloud</strong> and <strong>container managers</strong><ul>
<li>to continuously <strong>discover</strong> and <strong>monitor</strong> your services.</li>
<li>It is the <strong>second project</strong> to graduate from the <strong>CNCF</strong> after <strong>Kubernetes</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Open Source</p>
</blockquote>
<ol>
<li>Prometheus is <strong>100% open source</strong> and <strong>community-driven</strong>.</li>
<li>All components are available under the <strong>Apache 2 License</strong> on GitHub.</li>
</ol>
<blockquote>
<p>Open <strong>Governance</strong></p>
</blockquote>
<ol>
<li>Prometheus is a Cloud Native Computing Foundation graduated project.</li>
</ol>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="What-is-Prometheus"><a href="#What-is-Prometheus" class="headerlink" title="What is Prometheus?"></a>What is Prometheus?</h3><ol>
<li>Prometheus is an open-source systems <strong>monitoring</strong> and <strong>alerting</strong> toolkit originally built at <strong>SoundCloud</strong>. </li>
<li>Since its inception in <strong>2012</strong>, many <strong>companies</strong> and <strong>organizations</strong> have <strong>adopted</strong> Prometheus<ul>
<li>and the project has a very active <strong>developer</strong> and user <strong>community</strong>.</li>
</ul>
</li>
<li>It is now a <strong>standalone open source project</strong> and <strong>maintained independently</strong> of any company.</li>
<li>To emphasize this, and to clarify the project’s <strong>governance structure</strong><ul>
<li>Prometheus joined the <strong>Cloud Native Computing Foundation</strong> in <strong>2016</strong> as the <strong>second</strong> hosted project, after <strong>Kubernetes</strong></li>
</ul>
</li>
<li>Prometheus <strong>collects</strong> and <strong>stores</strong> its <strong>metrics</strong> as <strong>time series data</strong>, i.e.<ul>
<li>metrics information is stored with the <strong>timestamp</strong> at which it was <strong>recorded</strong>, alongside optional <strong>key-value pairs</strong> called <strong>labels</strong>.</li>
</ul>
</li>
</ol>
<h4 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h4><blockquote>
<p>Prometheus’s main features are:</p>
</blockquote>
<ol>
<li>a <strong>multi-dimensional</strong> data model with <strong>time series</strong> data identified by <strong>metric name</strong> and <strong>key&#x2F;value pairs</strong></li>
<li><strong>PromQL</strong>, a <strong>flexible</strong> query language to <strong>leverage</strong> this <strong>dimensionality</strong></li>
<li><strong>no reliance</strong> on <strong>distributed storage</strong>; single server nodes are autonomous</li>
<li>time series <strong>collection</strong> happens via a <strong>pull model</strong> over <strong>HTTP</strong></li>
<li><strong>pushing</strong> time series is supported via an <strong>intermediary gateway</strong></li>
<li>targets are <strong>discovered</strong> via <strong>service discovery</strong> or <strong>static configuration</strong></li>
<li><strong>multiple modes</strong> of <strong>graphing</strong> and <strong>dashboarding</strong> support</li>
</ol>
<h4 id="What-are-metrics"><a href="#What-are-metrics" class="headerlink" title="What are metrics?"></a>What are metrics?</h4><ol>
<li>Metrics are <strong>numerical measurements</strong> in layperson terms.</li>
<li>The <strong>term time series</strong> refers to the <strong>recording of changes over time</strong>.</li>
<li>What users want to measure <strong>differs</strong> from application to application.<ul>
<li>For a <strong>web server</strong>, it could be <strong>request times</strong>;</li>
<li>for a <strong>database</strong>, it could be the number of <strong>active connections</strong> or <strong>active queries</strong>, and so on.</li>
</ul>
</li>
<li>Metrics play an important role in <strong>understanding</strong> why your application is working in a certain way.</li>
<li>Let’s assume you are running a web application and discover that it is slow.<ul>
<li>To learn what is happening with your application, you will need some information.</li>
<li>For example, when the number of requests is high, the application may become slow.</li>
<li>If you have the request count metric, you can determine the cause and increase the number of servers to handle the load.</li>
</ul>
</li>
</ol>
<h4 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h4><blockquote>
<p>The Prometheus ecosystem consists of multiple components, many of which are optional:</p>
</blockquote>
<ol>
<li>the main <strong>Prometheus server</strong> which <strong>scrapes</strong> and <strong>stores</strong> time series data</li>
<li><strong>client libraries</strong> for <strong>instrumenting</strong> application code</li>
<li>a <strong>push gateway</strong> for supporting <strong>short-lived jobs</strong></li>
<li><strong>special-purpose exporters</strong> for services like HAProxy, StatsD, Graphite, etc.</li>
<li>an <strong>alertmanager</strong> to handle alerts</li>
<li>various support tools</li>
</ol>
<p>Most Prometheus components are written in <strong>Go</strong>, making them easy to <strong>build</strong> and <strong>deploy</strong> as <strong>static binaries</strong>.</p>
<h4 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h4><blockquote>
<p>This diagram illustrates the architecture of Prometheus and some of its ecosystem components:</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-architecture.svg" alt="prometheus-architecture"></p>
<ol>
<li>Prometheus <strong>scrapes metrics</strong> from <strong>instrumented jobs</strong>, either <strong>directly</strong> or via an <strong>intermediary push gateway</strong> for short-lived jobs.</li>
<li>It <strong>stores</strong> all <strong>scraped samples locally</strong><ul>
<li>and <strong>runs rules</strong> over this data to either <strong>aggregate</strong> and <strong>record new time series</strong> from existing data or <strong>generate alerts</strong>.</li>
</ul>
</li>
<li><strong>Grafana</strong> or other <strong>API consumers</strong> can be used to <strong>visualize</strong> the <strong>collected data</strong>.</li>
</ol>
<h4 id="When-does-it-fit"><a href="#When-does-it-fit" class="headerlink" title="When does it fit?"></a>When does it fit?</h4><ol>
<li>Prometheus works well for recording any <strong>purely numeric time series</strong>.</li>
<li>It fits both <strong>machine-centric</strong> monitoring as well as monitoring of <strong>highly dynamic service-oriented</strong> architectures.</li>
<li>In a world of <strong>microservices</strong>, its support for <strong>multi-dimensional</strong> data <strong>collection</strong> and <strong>querying</strong> is a particular strength.</li>
<li>Prometheus is designed for <strong>reliability</strong>, to be the system you go to during an <strong>outage</strong> to allow you to <strong>quickly diagnose problems</strong>.</li>
<li><strong>Each Prometheus server</strong> is <strong>standalone</strong>, not depending on <strong>network storage</strong> or other <strong>remote services</strong>.</li>
<li>You can rely on it when other parts of your infrastructure are broken, and you do <strong>not need</strong> to setup <strong>extensive infrastructure</strong> to use it.</li>
</ol>
<h4 id="When-does-it-not-fit"><a href="#When-does-it-not-fit" class="headerlink" title="When does it not fit?"></a>When does it not fit?</h4><ol>
<li>Prometheus values <strong>reliability</strong>. You can always view what <strong>statistics</strong> are <strong>available</strong> about your system, even under <strong>failure conditions</strong>.</li>
<li>If you need <strong>100% accuracy</strong>, such as for per-request billing<ul>
<li>Prometheus is not a good choice as the collected data will likely <strong>not</strong> be <strong>detailed</strong> and <strong>complete</strong> enough.</li>
</ul>
</li>
<li>In such a case you would be best off using some other system to collect and analyze the data for billing, and Prometheus for the rest of your monitoring.</li>
</ol>
<h2 id="First-steps-with-Prometheus"><a href="#First-steps-with-Prometheus" class="headerlink" title="First steps with Prometheus"></a>First steps with Prometheus</h2><ol>
<li>Prometheus is a <strong>monitoring platform</strong> that <strong>collects metrics</strong> from <strong>monitored targets</strong> by <strong>scraping metrics HTTP endpoints</strong> on these targets.</li>
<li>This guide will show you how to <strong>install</strong>, <strong>configure</strong> and <strong>monitor</strong> our first resource with Prometheus. You’ll download, install and run Prometheus.</li>
<li>You’ll also download and install an <strong>exporter</strong>, tools that <strong>expose time series data</strong> on <strong>hosts</strong> and <strong>services</strong>.</li>
<li>Our first exporter will be Prometheus itself, which provides a wide variety of <strong>host-level metrics</strong> about <strong>memory usage</strong>, <strong>garbage collection</strong>, and more.</li>
</ol>
<h3 id="Downloading-Prometheus"><a href="#Downloading-Prometheus" class="headerlink" title="Downloading Prometheus"></a>Downloading Prometheus</h3><p>Download the latest release of Prometheus for your platform, then extract it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xvfz prometheus-*.tar.gz</span><br><span class="line">cd prometheus-*</span><br></pre></td></tr></table></figure>

<p>The Prometheus server is a <strong>single binary</strong> called <strong>prometheus</strong>，We can run the binary and see help on its options by passing the <code>--help</code> flag.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./prometheus --help</span><br><span class="line">usage: prometheus [&lt;flags&gt;]</span><br><span class="line"></span><br><span class="line">The Prometheus monitoring server</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Prometheus"><a href="#Configuring-Prometheus" class="headerlink" title="Configuring Prometheus"></a>Configuring Prometheus</h3><ol>
<li>Prometheus configuration is <strong>YAML</strong>.</li>
<li>The Prometheus download comes with a <strong>sample configuration</strong> in a file called <strong>prometheus.yml</strong> that is a good place to get started.</li>
</ol>
<p>We’ve stripped out most of the comments in the example file to make it more succinct</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  scrape_interval:     15s</span><br><span class="line">  evaluation_interval: 15s</span><br><span class="line"></span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first.rules&quot;</span><br><span class="line">  # - &quot;second.rules&quot;</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: prometheus</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;localhost:9090&#x27;]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">全局配置 (Global Config)</span><br><span class="line"></span><br><span class="line">global:</span><br><span class="line">  scrape_interval: 15s    # 每15秒收集一次指标（默认1分钟）</span><br><span class="line">  evaluation_interval: 15s # 每15秒评估一次告警规则（默认1分钟）</span><br><span class="line"></span><br><span class="line">告警管理器配置 (Alertmanager)</span><br><span class="line"></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">          # - alertmanager:9093  # 目前被注释掉，未启用</span><br><span class="line">- 定义告警管理器的地址，用于发送告警通知</span><br><span class="line">- 当前配置被注释，意味着没有配置告警通知</span><br><span class="line"></span><br><span class="line">规则文件 (Rule Files)</span><br><span class="line"></span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first_rules.yml&quot;</span><br><span class="line">  # - &quot;second_rules.yml&quot;</span><br><span class="line">- 指定告警规则文件的位置</span><br><span class="line">- 当前没有启用任何规则文件</span><br><span class="line"></span><br><span class="line">抓取配置 (Scrape Configs)</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &quot;prometheus&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&quot;localhost:9090&quot;]</span><br><span class="line">        labels:</span><br><span class="line">          app: &quot;prometheus&quot;</span><br><span class="line"></span><br><span class="line">抓取配置详解：</span><br><span class="line"></span><br><span class="line">- job_name: &quot;prometheus&quot; - 定义作业名称，会作为标签添加到所有指标</span><br><span class="line">- targets: [&quot;localhost:9090&quot;] - 指定要监控的目标地址</span><br><span class="line">- labels: app: &quot;prometheus&quot; - 为所有来自此目标的指标添加额外标签</span><br><span class="line"></span><br><span class="line">当前配置状态</span><br><span class="line"></span><br><span class="line">这个配置文件当前只监控 Prometheus 自身（通过</span><br><span class="line">localhost:9090），这是一个基础的自监控设置。要完整使用</span><br><span class="line">Prometheus，通常需要：</span><br><span class="line"></span><br><span class="line">1. 添加更多监控目标（如应用服务、数据库等）</span><br><span class="line">2. 启用告警管理器配置</span><br><span class="line">3. 定义告警规则</span><br><span class="line">4. 添加更多的抓取作业</span><br></pre></td></tr></table></figure>

<ol>
<li>There are three blocks of configuration in the example configuration file: <strong>global</strong>, <strong>rule_files</strong>, and <strong>scrape_configs</strong>.</li>
<li>The <strong>global</strong> block controls the Prometheus server’s global configuration. <ul>
<li>We have two options present. The first, <strong>scrape_interval</strong>, controls how <strong>often</strong> Prometheus will <strong>scrape targets</strong>.<ul>
<li>You can <strong>override</strong> this for <strong>individual targets</strong>.</li>
<li>In this case the global setting is to scrape every 15 seconds.</li>
</ul>
</li>
<li>The <strong>evaluation_interval</strong> option controls how often Prometheus will <strong>evaluate rules</strong>.<ul>
<li>Prometheus uses <strong>rules</strong> to <strong>create new time series</strong> and to <strong>generate alerts</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>rule_files</strong> block specifies the location of any rules we want the Prometheus server to <strong>load</strong>. For now we’ve got no rules.</li>
<li>The last block, <strong>scrape_configs</strong>, controls what <strong>resources</strong> Prometheus <strong>monitors</strong>.<ul>
<li>Since Prometheus also exposes data about itself as an <strong>HTTP endpoint</strong> it can <strong>scrape</strong> and <strong>monitor</strong> its own health.</li>
<li>In the default configuration there is a <strong>single job</strong>, called <strong>prometheus</strong><ul>
<li>which scrapes the <strong>time series data</strong> exposed by the <strong>Prometheus server</strong>.</li>
</ul>
</li>
<li>The job contains a <strong>single, statically configured, target</strong>, the <strong>localhost</strong> on port <strong>9090</strong>.</li>
<li><strong>Prometheus</strong> expects metrics to be available on targets on a path of <strong>&#x2F;metrics</strong>.<ul>
<li>So this default job is scraping via the URL: <a target="_blank" rel="noopener" href="http://localhost:9090/metrics">http://localhost:9090/metrics</a>.</li>
</ul>
</li>
</ul>
</li>
<li>The <strong>time series data</strong> returned will <strong>detail</strong> the <strong>state</strong> and <strong>performance</strong> of the <strong>Prometheus server</strong>.</li>
</ol>
<h3 id="Starting-Prometheus"><a href="#Starting-Prometheus" class="headerlink" title="Starting Prometheus"></a>Starting Prometheus</h3><p>To start Prometheus with our newly created configuration file, change to the directory containing the Prometheus binary and run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./prometheus --config.file=prometheus.yml</span><br></pre></td></tr></table></figure>

<ol>
<li>Prometheus should start up. You should also be able to browse to a status page about itself at <a target="_blank" rel="noopener" href="http://localhost:9090/">http://localhost:9090</a>.</li>
<li>Give it about 30 seconds to collect data about itself from its own HTTP metrics endpoint.</li>
<li>You can also verify that Prometheus is serving metrics about itself<ul>
<li>by navigating to its own metrics endpoint: <a target="_blank" rel="noopener" href="http://localhost:9090/metrics">http://localhost:9090/metrics</a>.</li>
</ul>
</li>
</ol>
<h3 id="Using-the-expression-browser"><a href="#Using-the-expression-browser" class="headerlink" title="Using the expression browser"></a>Using the expression browser</h3><ol>
<li>Let us try looking at some data that Prometheus has collected about itself.</li>
<li>To use Prometheus’s <strong>built-in expression browser</strong><ul>
<li>navigate to <a target="_blank" rel="noopener" href="http://localhost:9090/graph">http://localhost:9090/graph</a> and choose the “<strong>Table</strong>“ view within the “<strong>Graph</strong>“ tab.</li>
</ul>
</li>
<li>As you can gather from <a target="_blank" rel="noopener" href="http://localhost:9090/metrics">http://localhost:9090/metrics</a>,<ul>
<li>one metric that Prometheus exports about itself is called <code>promhttp_metric_handler_requests_total</code></li>
<li>the total number of <strong>&#x2F;metrics</strong> requests the Prometheus server has served.</li>
</ul>
</li>
<li>Go ahead and enter this into the <strong>expression console</strong>:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promhttp_metric_handler_requests_total</span><br></pre></td></tr></table></figure>

<p>This should return a number of <strong>different time series</strong> (along with the <strong>latest value recorded</strong> for each), all with the <strong>metric name</strong> promhttp_metric_handler_requests_total, but with <strong>different labels</strong>. These labels designate <strong>different requests statuses</strong>.</p>
<p>If we were only interested in requests that resulted in HTTP code <strong>200</strong>, we could use this query to retrieve that information:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promhttp_metric_handler_requests_total&#123;code=&quot;200&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>To count the <strong>number</strong> of returned <strong>time series</strong>, you could write:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count(promhttp_metric_handler_requests_total)</span><br></pre></td></tr></table></figure>

<h3 id="Using-the-graphing-interface"><a href="#Using-the-graphing-interface" class="headerlink" title="Using the graphing interface"></a>Using the graphing interface</h3><p>To graph expressions, navigate to <a target="_blank" rel="noopener" href="http://localhost:9090/graph">http://localhost:9090/graph</a> and use the “<strong>Graph</strong>“ tab.</p>
<p>For example, enter the following expression to graph the <strong>per-second HTTP request rate</strong> returning status code 200 happening in the self-scraped Prometheus:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(promhttp_metric_handler_requests_total&#123;code=&quot;200&quot;&#125;[1m])</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">这个 PromQL 查询语句计算的是 promhttp_metric_handler_requests_total</span><br><span class="line">  指标在过去1分钟内，状态码为200的请求的速率（rate）。</span><br><span class="line"></span><br><span class="line">  让我详细解释一下：</span><br><span class="line"></span><br><span class="line">  指标解析</span><br><span class="line"></span><br><span class="line">  - promhttp_metric_handler_requests_total - 这是 Prometheus HTTP</span><br><span class="line">  指标处理器收到的请求总数（计数器类型）</span><br><span class="line">  - &#123;code=&quot;200&quot;&#125; - 过滤条件，只关注HTTP状态码为200的成功请求</span><br><span class="line">  - [1m] - 时间窗口，查看过去1分钟的数据</span><br><span class="line">  - rate() - 计算函数，计算时间序列在指定窗口内的平均每秒增长率</span><br><span class="line"></span><br><span class="line">  计算逻辑</span><br><span class="line"></span><br><span class="line">  rate(promhttp_metric_handler_requests_total&#123;code=&quot;200&quot;&#125;[1m])</span><br><span class="line"></span><br><span class="line">  这个查询会：</span><br><span class="line">  1. 获取过去1分钟内所有状态码为200的请求样本点</span><br><span class="line">  2. 计算这些样本点的线性回归斜率</span><br><span class="line">  3. 返回平均每秒的请求增长率</span><br><span class="line"></span><br><span class="line">  实际含义</span><br><span class="line"></span><br><span class="line">  - 结果值表示每秒处理的200状态码请求数</span><br><span class="line">  - 例如：结果为 5.2 表示平均每秒处理5.2个成功请求</span><br><span class="line">  - 适用于监控 Prometheus HTTP 端点的负载情况</span><br><span class="line"></span><br><span class="line">  使用场景</span><br><span class="line"></span><br><span class="line">  - 监控 Prometheus 自身的 HTTP 请求处理性能</span><br><span class="line">  - 评估指标查询的频率和负载</span><br><span class="line">  - 设置告警阈值，如速率异常增高可能表示存在异常查询行为</span><br></pre></td></tr></table></figure>

<h3 id="Monitoring-other-targets"><a href="#Monitoring-other-targets" class="headerlink" title="Monitoring other targets"></a>Monitoring other targets</h3><ol>
<li>Collecting metrics from Prometheus alone isn’t a great <strong>representation</strong> of Prometheus’ <strong>capabilities</strong>.</li>
<li>To get a better sense of what Prometheus can do, we recommend exploring documentation about other <strong>exporters</strong>.</li>
</ol>
<h2 id="Frequently-asked-questions"><a href="#Frequently-asked-questions" class="headerlink" title="Frequently asked questions"></a>Frequently asked questions</h2><h3 id="General"><a href="#General" class="headerlink" title="General"></a>General</h3><blockquote>
<p>What is Prometheus?</p>
</blockquote>
<ol>
<li>Prometheus is an <strong>open-source</strong> systems <strong>monitoring</strong> and <strong>alerting</strong> toolkit with an <strong>active ecosystem</strong>.</li>
<li>It is the only system <strong>directly supported</strong> by <strong>Kubernetes</strong> and the <strong>de facto standard</strong> across the <strong>cloud native ecosystem</strong>.</li>
</ol>
<blockquote>
<p>What dependencies does Prometheus have?</p>
</blockquote>
<p>The main <strong>Prometheus server</strong> runs <strong>standalone</strong> as a <strong>single monolithic binary</strong> and has <strong>no external dependencies</strong>.</p>
<blockquote>
<p>Is this cloud native? - <strong>Yes.</strong></p>
</blockquote>
<ol>
<li>Cloud native is a <strong>flexible operating model</strong>, breaking up <strong>old service boundaries</strong> to allow for more <strong>flexible</strong> and <strong>scalable</strong> deployments.</li>
<li>Prometheus’s <strong>service discovery</strong> integrates with most <strong>tools</strong> and <strong>clouds</strong>.<ul>
<li>Its <strong>dimensional data model</strong> and scale into the <strong>tens of millions</strong>（数千万） of <strong>active series</strong> allows it to monitor <strong>large cloud-native deployments</strong>.</li>
<li>There are always <strong>trade-offs</strong> to make when running services, and Prometheus values reliably <strong>getting alerts out to humans</strong> above all else.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Can Prometheus be made <strong>highly available</strong>?</p>
</blockquote>
<ol>
<li><strong>Yes</strong>, run identical Prometheus servers on two or more <strong>separate machines</strong>.<ul>
<li><strong>Identical alerts</strong> will be <strong>deduplicated</strong> by the <strong>Alertmanager</strong></li>
</ul>
</li>
<li>Alertmanager supports high availability by <strong>interconnecting multiple Alertmanager instances</strong> to build an <strong>Alertmanager cluster</strong>.<ul>
<li><strong>Instances</strong> of a cluster <strong>communicate</strong> using a <strong>gossip</strong> protocol managed via HashiCorp’s Memberlist library.</li>
</ul>
</li>
</ol>
<blockquote>
<p>I was told Prometheus “doesn’t scale”.</p>
</blockquote>
<ol>
<li>This is often more of a <strong>marketing claim</strong> than anything else.</li>
<li>A <strong>single instance</strong> of Prometheus can be <strong>more performant</strong> than some systems positioning themselves as <strong>long term storage solution</strong> for Prometheus.<ul>
<li>You can run Prometheus <strong>reliably</strong> with <strong>tens of millions</strong> of <strong>active series</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>What language is Prometheus written in?</p>
</blockquote>
<p>Most Prometheus components are written in <strong>Go</strong>. Some are also written in <strong>Java</strong>, <strong>Python</strong>, and <strong>Ruby</strong>.</p>
<blockquote>
<p>How <strong>stable</strong> are Prometheus <strong>features</strong>, <strong>storage formats</strong>, and <strong>APIs</strong>?</p>
</blockquote>
<ol>
<li><strong>All</strong> repositories in the Prometheus GitHub organization that have reached version <strong>1.0.0</strong> broadly follow <strong>semantic versioning</strong>.<ul>
<li><strong>Breaking changes</strong> are indicated by increments of the <strong>major version</strong>.</li>
<li>Exceptions are possible for <strong>experimental components</strong>, which are clearly marked as such in announcements.</li>
</ul>
</li>
<li>Even repositories that have not yet reached version <strong>1.0.0</strong> are, in general, <strong>quite stable</strong>.<ul>
<li>We aim for a <strong>proper release process</strong> and an <strong>eventual 1.0.0 release</strong> for <strong>each repository</strong>.</li>
<li>In any case, <strong>breaking changes</strong> will be pointed out in <strong>release notes</strong> (marked by [<strong>CHANGE</strong>]) or <strong>communicated clearly</strong> for components that do <strong>not have formal releases yet</strong>.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Why do you <strong>pull</strong> rather than push?</p>
</blockquote>
<ol>
<li><strong>Pulling</strong> over HTTP offers a number of <strong>advantages</strong>:<ul>
<li>You can start <strong>extra monitoring instances</strong> as needed, e.g. on your laptop when developing changes.</li>
<li>You can more <strong>easily</strong> and <strong>reliably</strong> tell if a target is <strong>down</strong>.</li>
<li>You can manually go to a target and <strong>inspect its health</strong> with a <strong>web browser</strong>.</li>
</ul>
</li>
<li>Overall, we believe that <strong>pulling</strong> is <strong>slightly better</strong> than <strong>pushing</strong>, but it should <strong>not</strong> be considered a <strong>major point</strong> when considering a <strong>monitoring system</strong>.</li>
<li>For cases where you must <strong>push</strong>, we offer the <strong>Pushgateway</strong>.</li>
</ol>
<blockquote>
<p>How to feed <strong>logs</strong> into Prometheus?</p>
</blockquote>
<ol>
<li>Short answer: <strong>Don’t!</strong> Use something like <strong>Grafana Loki</strong> or <strong>OpenSearch</strong> instead.</li>
<li>Longer answer: Prometheus is a system to collect and process <strong>metrics</strong>, not an <strong>event logging system</strong>.</li>
<li>If you want to <strong>extract Prometheus metrics</strong> from application logs, <strong>Grafana Loki</strong> is designed for just that.</li>
</ol>
<blockquote>
<p>Who wrote Prometheus?</p>
</blockquote>
<ol>
<li>Prometheus was <strong>initially started</strong> privately by <u>Matt T. Proud</u> and <u>Julius Volz</u>. The majority of its <strong>initial development</strong> was sponsored by <strong>SoundCloud</strong></li>
<li>It’s now <strong>maintained</strong> and <strong>extended</strong> by a wide range of <strong>companies</strong> and <strong>individuals</strong>.</li>
</ol>
<blockquote>
<p>What license is Prometheus released under?</p>
</blockquote>
<p>Prometheus is released under the <strong>Apache 2.0</strong> license.</p>
<blockquote>
<p>What is the plural of Prometheus?</p>
</blockquote>
<ol>
<li>After extensive research, it has been determined that the correct plural of ‘Prometheus’ is ‘<strong>Prometheis</strong>‘.</li>
<li>If you can not remember this, “<strong>Prometheus instances</strong>“ is a good workaround.</li>
</ol>
<blockquote>
<p>Can I reload Prometheus’s configuration?</p>
</blockquote>
<ol>
<li>Yes, sending <strong>SIGHUP</strong> to the Prometheus process or an HTTP POST request to the <code>/-/reload</code> endpoint will reload and apply the configuration file.</li>
<li>The <strong>various components</strong> attempt to <strong>handle failing changes gracefully</strong>.</li>
</ol>
<blockquote>
<p>Can I send alerts?</p>
</blockquote>
<ol>
<li>Yes, with the Alertmanager</li>
<li>We support sending alerts through <strong>email</strong>, <strong>various native integrations</strong>, and a <strong>webhook system</strong> anyone can add integrations to.</li>
</ol>
<blockquote>
<p>Can I create dashboards?</p>
</blockquote>
<p>Yes, we recommend <strong>Grafana</strong> for production usage. There are also <strong>Console templates</strong>.</p>
<blockquote>
<p>Can I change the timezone? Why is everything in <strong>UTC</strong>?</p>
</blockquote>
<ol>
<li>To avoid any kind of <strong>timezone confusion</strong>, especially when the so-called <strong>daylight saving time</strong> is involved<ul>
<li>we decided to <strong>exclusively</strong> use <strong>Unix time internally</strong> and <strong>UTC</strong> for <strong>display purposes</strong> in <strong>all components</strong> of Prometheus.</li>
</ul>
</li>
<li>A carefully done <strong>timezone selection</strong> could be <strong>introduced</strong> into the <strong>UI</strong>. - Grafana</li>
</ol>
<h3 id="Instrumentation"><a href="#Instrumentation" class="headerlink" title="Instrumentation"></a>Instrumentation</h3><blockquote>
<p>Which languages have instrumentation libraries?</p>
</blockquote>
<ol>
<li>There are a number of <strong>client libraries</strong> for <strong>instrumenting</strong> your <strong>services</strong> with <strong>Prometheus metrics</strong>.</li>
<li>If you are interested in contributing a client library for a new language, see the exposition formats.</li>
</ol>
<blockquote>
<p>Can I monitor machines?</p>
</blockquote>
<p>Yes, the <strong>Node Exporter</strong> exposes an extensive set of <strong>machine-level metrics</strong> on <strong>Linux</strong> and other <strong>Unix</strong> systems such as CPU usage, memory, disk utilization, filesystem fullness, and network bandwidth.</p>
<blockquote>
<p>Can I monitor <strong>network devices</strong>?</p>
</blockquote>
<p>Yes, the <strong>SNMP Exporter</strong> allows monitoring of devices that support SNMP. For <strong>industrial networks</strong>, there’s also a <strong>Modbus exporter</strong>.</p>
<blockquote>
<p>Can I monitor batch jobs?</p>
</blockquote>
<p>Yes, using the <strong>Pushgateway</strong>. See also the best practices for monitoring batch jobs.</p>
<blockquote>
<p>Can I monitor JVM applications via JMX?</p>
</blockquote>
<p>Yes, for applications that you <strong>cannot instrument directly</strong> with the <strong>Java client</strong>, you can use the <strong>JMX Exporter</strong> either <strong>standalone</strong> or as a <strong>Java Agent</strong>.</p>
<blockquote>
<p>What is the performance impact of instrumentation?</p>
</blockquote>
<ol>
<li>Performance across client libraries and languages may <strong>vary</strong>.</li>
<li>For Java, <strong>benchmarks</strong> indicate that <strong>incrementing a counter&#x2F;gauge</strong> with the Java client will take <strong>12-17ns</strong>, depending on <strong>contention</strong>.</li>
<li>This is <strong>negligible</strong> for all but the most <strong>latency-critical</strong> code.</li>
</ol>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><blockquote>
<p>Why are all sample values <strong>64-bit floats</strong>?</p>
</blockquote>
<ol>
<li>We restrained ourselves to <strong>64-bit floats</strong> to <strong>simplify the design</strong>.</li>
<li>The <strong>IEEE 754 double-precision binary floating-point format</strong> supports <strong>integer precision</strong> for values up to <strong>2^53</strong>.<ul>
<li>Supporting <strong>native 64 bit integers</strong> would (only) help if you need integer precision above <strong>2^53</strong> but below <strong>2^63</strong>.</li>
</ul>
</li>
<li>In principle, support for <strong>different sample value types</strong> (including some kind of <strong>big integer</strong>, supporting even <strong>more than 64 bit</strong>) could be implemented, but it is <strong>not a priority right now</strong>.</li>
<li>A counter, even if incremented <strong>one million times per second</strong>（一百万次每秒）, will only run into <strong>precision issues</strong> after over <strong>285 years</strong>.</li>
</ol>
<h2 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h2><h3 id="Alert"><a href="#Alert" class="headerlink" title="Alert"></a>Alert</h3><p>An alert is the <strong>outcome</strong> of an <strong>alerting rule</strong> in Prometheus that is <strong>actively firing</strong>. Alerts are sent from <strong>Prometheus</strong> to the <strong>Alertmanager</strong>.</p>
<h3 id="Alertmanager"><a href="#Alertmanager" class="headerlink" title="Alertmanager"></a>Alertmanager</h3><p>The Alertmanager takes in alerts, <strong>aggregates</strong> them into groups, <strong>de-duplicates</strong>, applies <strong>silences</strong>, <strong>throttles</strong>, and then sends out <strong>notifications</strong> to email, Pagerduty, Slack etc.</p>
<h3 id="Bridge"><a href="#Bridge" class="headerlink" title="Bridge"></a>Bridge</h3><ol>
<li>A bridge is a <strong>component</strong> that <strong>takes samples</strong> from a <strong>client library</strong> and <strong>exposes</strong> them to a <strong>non-Prometheus monitoring system</strong>.</li>
<li>For example, the Python, Go, and Java clients can export metrics to <strong>Graphite</strong>.<ul>
<li>Prometheus -&gt; Graphite</li>
</ul>
</li>
</ol>
<h3 id="Client-library"><a href="#Client-library" class="headerlink" title="Client library"></a>Client library</h3><ol>
<li>A client library is a library in some language (e.g. <strong>Go</strong>, <strong>Java</strong>, <strong>Python</strong>, <strong>Ruby</strong>) that makes it easy to <strong>directly instrument</strong> your code</li>
<li>write <strong>custom collectors</strong> to <strong>pull metrics</strong> from other systems and <strong>expose</strong> the metrics to <strong>Prometheus</strong>.</li>
</ol>
<h3 id="Collector"><a href="#Collector" class="headerlink" title="Collector"></a>Collector</h3><ol>
<li>A collector is a part of an <strong>exporter</strong> that <strong>represents</strong> a <strong>set of metrics</strong>.</li>
<li>It may be a <strong>single metric</strong> if it is part of <strong>direct instrumentation</strong>, or <strong>many metrics</strong> if it is <strong>pulling metrics</strong> from another system.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">根据文档中的定义和 Prometheus 的工作原理，Collector 是 Prometheus 监控体系中的一个核心概念。让我来详细解释：</span><br><span class="line"></span><br><span class="line">  Collector 的本质</span><br><span class="line"></span><br><span class="line">  Collector 是指标的收集者，它负责从各种源头获取指标数据并将其转换为 Prometheus 可以理解的格式。</span><br><span class="line"></span><br><span class="line">  两种主要的 Collector 类型</span><br><span class="line"></span><br><span class="line">  1. 直接嵌入式 Collector</span><br><span class="line"></span><br><span class="line">  // Go 示例：直接在应用代码中嵌入</span><br><span class="line">  httpRequestsTotal := prometheus.NewCounterVec(</span><br><span class="line">      prometheus.CounterOpts&#123;</span><br><span class="line">          Name: &quot;http_requests_total&quot;,</span><br><span class="line">          Help: &quot;Total number of HTTP requests&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">      []string&#123;&quot;method&quot;, &quot;endpoint&quot;&#125;,</span><br><span class="line">  )</span><br><span class="line">  - 单一指标或相关指标组</span><br><span class="line">  - 直接嵌入在你的应用程序代码中</span><br><span class="line">  - 实时收集应用程序内部的状态</span><br><span class="line">  - 例如：HTTP 请求数、数据库连接数、内存使用情况</span><br><span class="line"></span><br><span class="line">  2. 拉取式 Collector（Exporter 中）</span><br><span class="line"></span><br><span class="line">  # Python 示例：从外部系统拉取</span><br><span class="line">  class DatabaseCollector:</span><br><span class="line">      def collect(self):</span><br><span class="line">          # 从 MySQL 拉取指标</span><br><span class="line">          metrics = self.query_mysql_metrics()</span><br><span class="line">          yield from self.convert_to_prometheus_format(metrics)</span><br><span class="line">  - 多个指标的集合</span><br><span class="line">  - 从外部系统（数据库、消息队列等）拉取数据</span><br><span class="line">  - 将外部系统的指标转换为 Prometheus 格式</span><br><span class="line">  - 例如：MySQL Exporter、Redis Exporter</span><br><span class="line"></span><br><span class="line">  Collector 的工作流程</span><br><span class="line"></span><br><span class="line">  外部系统/应用程序</span><br><span class="line">          ↓</span><br><span class="line">      Collector 收集指标</span><br><span class="line">          ↓</span><br><span class="line">      转换为 Prometheus 格式</span><br><span class="line">          ↓</span><br><span class="line">      暴露给 Prometheus Server</span><br><span class="line">          ↓</span><br><span class="line">      Prometheus 定期拉取</span><br><span class="line"></span><br><span class="line">  实际应用场景</span><br><span class="line"></span><br><span class="line">  场景1：Web 应用中的 Collector</span><br><span class="line"></span><br><span class="line">  // Java Spring Boot 应用</span><br><span class="line">  @Component</span><br><span class="line">  public class RequestCollector &#123;</span><br><span class="line">      private final Counter requestCounter = Counter.build()</span><br><span class="line">          .name(&quot;http_requests_total&quot;)</span><br><span class="line">          .help(&quot;Total HTTP requests&quot;)</span><br><span class="line">          .labelNames(&quot;method&quot;, &quot;status&quot;)</span><br><span class="line">          .register();</span><br><span class="line"></span><br><span class="line">      public void recordRequest(String method, int status) &#123;</span><br><span class="line">          requestCounter.labels(method, String.valueOf(status)).inc();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  场景2：MySQL Exporter 中的 Collector</span><br><span class="line"></span><br><span class="line">  // MySQL Exporter 示例</span><br><span class="line">  type MySQLCollector struct &#123;</span><br><span class="line">      db *sql.DB</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  func (c *MySQLCollector) Collect(ch chan&lt;- prometheus.Metric) &#123;</span><br><span class="line">      // 收集连接数</span><br><span class="line">      ch &lt;- c.collectConnections()</span><br><span class="line"></span><br><span class="line">      // 收集查询统计</span><br><span class="line">      ch &lt;- c.collectQueries()</span><br><span class="line"></span><br><span class="line">      // 收集 InnoDB 状态</span><br><span class="line">      ch &lt;- c.collectInnoDBStats()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  关键特点</span><br><span class="line"></span><br><span class="line">  1. 抽象层：隐藏了指标来源的复杂性</span><br><span class="line">  2. 转换器：将各种格式的数据统一为 Prometheus 格式</span><br><span class="line">  3. 集合体：一个 Collector 可以包含多个相关指标</span><br><span class="line">  4. 可扩展：支持自定义业务指标和系统指标</span><br><span class="line"></span><br><span class="line">  理解要点</span><br><span class="line"></span><br><span class="line">  - Collector 不是单一指标，而是指标的收集者</span><br><span class="line">  - 它可以是单个指标（如简单的计数器），也可以是指标集合（如数据库的所有性能指标）</span><br><span class="line">  - 直接嵌入的 Collector 通常更简单，拉取式的 Collector 通常更复杂</span><br><span class="line">  - 所有最终都会通过 HTTP /metrics 端点暴露给 Prometheus</span><br><span class="line"></span><br><span class="line">  这样理解的话，Collector 就是连接你的监控系统（Prometheus）和数据源（应用程序、数据库等）之间的桥梁。</span><br></pre></td></tr></table></figure>

<h3 id="Direct-instrumentation"><a href="#Direct-instrumentation" class="headerlink" title="Direct instrumentation"></a>Direct instrumentation</h3><p>Direct instrumentation is <strong>instrumentation</strong> added <strong>inline</strong> as <strong>part</strong> of the <strong>source code</strong> of a program, using a client library.</p>
<h3 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h3><p>A <strong>source</strong> of metrics that can be <strong>scraped</strong>, usually corresponding to a <strong>single process</strong>.</p>
<h3 id="Exporter"><a href="#Exporter" class="headerlink" title="Exporter"></a>Exporter</h3><ol>
<li>An exporter is a <strong>binary</strong> running <strong>alongside</strong> the <strong>application</strong> you want to obtain metrics from.</li>
<li>The exporter exposes Prometheus metrics<ul>
<li>commonly by <strong>converting</strong> metrics that are exposed in a <strong>non-Prometheus format</strong> into a format that Prometheus supports.</li>
</ul>
</li>
</ol>
<h3 id="Instance"><a href="#Instance" class="headerlink" title="Instance"></a>Instance</h3><p>An instance is a <strong>label</strong> that <strong>uniquely identifies</strong> a <strong>target</strong> in a job.</p>
<h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><p>A <strong>collection</strong> of <strong>targets</strong> with the <strong>same purpose</strong>, for example monitoring a <strong>group</strong> of <strong>like processes replicated for scalability or reliability</strong>, is called a job.</p>
<h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p>A notification represents a group of one or more alerts, and is sent by the <strong>Alertmanager</strong> to <strong>email</strong>, <strong>Pagerduty</strong>, <strong>Slack</strong> etc.</p>
<h3 id="Promdash"><a href="#Promdash" class="headerlink" title="Promdash"></a>Promdash</h3><p>Promdash was a <strong>native dashboard builder</strong> for Prometheus. It has been <strong>deprecated</strong> and replaced by <strong>Grafana</strong>.</p>
<h3 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h3><p>Prometheus usually refers to the <strong>core binary</strong> of the Prometheus system. It may also refer to the <strong>Prometheus monitoring system</strong> as a whole.</p>
<h3 id="PromQL"><a href="#PromQL" class="headerlink" title="PromQL"></a>PromQL</h3><ol>
<li>PromQL is the <strong>Prometheus Query Language</strong>.</li>
<li>It allows for a <strong>wide range of operations</strong> including <strong>aggregation</strong>, <strong>slicing</strong> and <strong>dicing</strong>, <strong>prediction</strong> and <strong>joins</strong>.</li>
</ol>
<h3 id="Pushgateway"><a href="#Pushgateway" class="headerlink" title="Pushgateway"></a>Pushgateway</h3><ol>
<li>The Pushgateway <strong>persists</strong> the <strong>most recent push</strong> of <strong>metrics</strong> from <strong>batch jobs</strong>.</li>
<li>This allows Prometheus to <strong>scrape</strong> their metrics <strong>after</strong> they have <strong>terminated</strong>.</li>
</ol>
<h3 id="Recording-Rules"><a href="#Recording-Rules" class="headerlink" title="Recording Rules"></a>Recording Rules</h3><p>Recording rules <strong>precompute</strong> <u>frequently needed</u> or <u>computationally expensive expressions</u> and save their <strong>results</strong> as a <strong>new set of time series</strong>.</p>
<h3 id="Remote-Read"><a href="#Remote-Read" class="headerlink" title="Remote Read"></a>Remote Read</h3><p>Remote read is a <strong>Prometheus feature</strong> that allows <strong>transparent reading</strong> of <strong>time series</strong> from other systems (such as <strong>long term storage</strong>) as part of <strong>queries</strong>.</p>
<h3 id="Remote-Read-Adapter"><a href="#Remote-Read-Adapter" class="headerlink" title="Remote Read Adapter"></a>Remote Read Adapter</h3><ol>
<li>Not all systems <strong>directly support</strong> remote read.</li>
<li>A remote read adapter sits between <strong>Prometheus</strong> and <strong>another system</strong>, converting <strong>time series requests and responses</strong> between them.</li>
</ol>
<h3 id="Remote-Read-Endpoint"><a href="#Remote-Read-Endpoint" class="headerlink" title="Remote Read Endpoint"></a>Remote Read Endpoint</h3><p>A remote read endpoint is what Prometheus talks to when doing a remote read.</p>
<h3 id="Remote-Write"><a href="#Remote-Write" class="headerlink" title="Remote Write"></a>Remote Write</h3><p>Remote write is a <strong>Prometheus feature</strong> that allows sending <strong>ingested samples</strong> on the fly to other systems, such as <strong>long term storage</strong>.</p>
<h3 id="Remote-Write-Adapter"><a href="#Remote-Write-Adapter" class="headerlink" title="Remote Write Adapter"></a>Remote Write Adapter</h3><ol>
<li>Not all systems <strong>directly support</strong> remote write.</li>
<li>A remote write adapter sits between <strong>Prometheus</strong> and <strong>another system</strong><ul>
<li><strong>converting</strong> the <strong>samples</strong> in the remote write into a format the other system can <strong>understand</strong>.</li>
</ul>
</li>
</ol>
<h3 id="Remote-Write-Endpoint"><a href="#Remote-Write-Endpoint" class="headerlink" title="Remote Write Endpoint"></a>Remote Write Endpoint</h3><p>A remote write endpoint is what Prometheus talks to when doing a remote write.</p>
<h3 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h3><blockquote>
<p>a float64 value + a millisecond-precision timestamp</p>
</blockquote>
<ol>
<li>A sample is a <strong>single value</strong> at a <strong>point</strong> in <strong>time</strong> in <strong>a time series</strong>.</li>
<li>In Prometheus, each sample consists of <strong>a float64 value</strong> and <strong>a millisecond-precision timestamp</strong>.</li>
</ol>
<h3 id="Silence"><a href="#Silence" class="headerlink" title="Silence"></a>Silence</h3><p>A silence in the Alertmanager <strong>prevents alerts</strong>, with <strong>labels matching</strong> the silence, <strong>from being included in notifications</strong>.</p>
<h3 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h3><ol>
<li>A target is the definition of <strong>an object to scrape</strong>.</li>
<li>For example, what <strong>labels</strong> to apply, any <strong>authentication</strong> required to connect, or other information that defines <strong>how the scrape</strong> will occur.</li>
</ol>
<h3 id="Time-Series"><a href="#Time-Series" class="headerlink" title="Time Series"></a>Time Series</h3><blockquote>
<p>same metric + same set of labeled dimensions</p>
</blockquote>
<ol>
<li>The Prometheus time series are <strong>streams</strong> of <strong>timestamped values</strong> belonging to the <strong>same metric</strong> and the <strong>same set of labeled dimensions</strong>.</li>
<li>Prometheus stores <strong>all data</strong> as <strong>time series</strong>.</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2025/01/22/cloud-native-observability-prometheus-introduction/">https://blog.zhongmingmao.top/2025/01/22/cloud-native-observability-prometheus-introduction/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/observability/">Observability</a></div><div class="post-share"><div class="social-share" data-image="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Observability - Prometheus Concepts</div></div><div class="info-2"><div class="info-item-1">Data model Prometheus fundamentally stores all data as time series streams of timestamped values belonging to the same metric and the same set of labeled dimensions.   Besides stored time series, Prometheus may generate temporary derived time series as the result of queries.    Metric names and labelsEvery time series is uniquely identified by its metric name and optional key-value pairs called labels. Metric names Metric names SHOULD specify the general feature of a system that is measured e.g. http_req...</div></div></div></a><a class="pagination-related" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Observability - OpenTelemetry Java Zero Code</div></div><div class="info-2"><div class="info-item-1">Java Agent Zero-code instrumentation with Java uses a Java agent JAR attached to any Java 8+ application. It dynamically injects bytecode to capture telemetry from many popular libraries and frameworks. It can be used to capture telemetry data at the “edges” of an app or service such as inbound requests, outbound HTTP calls, database calls, and so on.      Getting startedSetup Download opentelemetry-javaagent.jar from Releases of the opentelemetry-java-instrumentation repository place the JAR in your pre...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-23</div><div class="info-item-2">Observability - Prometheus Concepts</div></div><div class="info-2"><div class="info-item-1">Data model Prometheus fundamentally stores all data as time series streams of timestamped values belonging to the same metric and the same set of labeled dimensions.   Besides stored time series, Prometheus may generate temporary derived time series as the result of queries.    Metric names and labelsEvery time series is uniquely identified by its metric name and optional key-value pairs called labels. Metric names Metric names SHOULD specify the general feature of a system that is measured e.g. http_req...</div></div></div></a><a class="pagination-related" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-21</div><div class="info-item-2">Observability - OpenTelemetry Java Zero Code</div></div><div class="info-2"><div class="info-item-1">Java Agent Zero-code instrumentation with Java uses a Java agent JAR attached to any Java 8+ application. It dynamically injects bytecode to capture telemetry from many popular libraries and frameworks. It can be used to capture telemetry data at the “edges” of an app or service such as inbound requests, outbound HTTP calls, database calls, and so on.      Getting startedSetup Download opentelemetry-javaagent.jar from Releases of the opentelemetry-java-instrumentation repository place the JAR in your pre...</div></div></div></a><a class="pagination-related" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-20</div><div class="info-item-2">Observability - OpenTelemetry Java</div></div><div class="info-2"><div class="info-item-1">Intro to OpenTelemetry Java OpenTelemetry Java is the set of OpenTelemetry observability tools for the Java ecosystem. At a high level, it consists of the API, the SDK, and instrumentation.    Overview The API is a set of classes and interfaces for recording telemetry across key observability signals.  It supports multiple implementations, with a low-overhead minimalist Noop and SDK reference implementation provided out of the box.  It is designed to be taken as a direct dependency by libraries, framewor...</div></div></div></a><a class="pagination-related" href="/2025/01/05/cloud-native-observability-opentelemetry-python/" title="Observability - OpenTelemetry Python"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-python-instrumentation.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-05</div><div class="info-item-2">Observability - OpenTelemetry Python</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development   Version supportOpenTelemetry-Python supports Python 3.9 and higher.   Installation The API and SDK packages are available on PyPI, and can be installed via pip:  12pip install opentelemetry-apipip install opentelemetry-sdk   In addition, there are several extension packages which can be installed separately as:  12pip install opentelemetry-exporter-&#123;exporter&#125;pip install opentelemetry-instrumentation-&#123;instrumen...</div></div></div></a><a class="pagination-related" href="/2025/01/04/cloud-native-observability-opentelemetry-go/" title="Observability - OpenTelemetry Go"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/o11y-otel-go.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-04</div><div class="info-item-2">Observability - OpenTelemetry Go</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases The logs signal is still experimental. Breaking changes may be introduced in future versions.     Traces Metrics Logs    Stable Stable Beta     Getting StartedExample applicationSetup To begin, set up a go.mod in a new directory:  12345$ go mod init dicego: creating new go.mod: module dice$ lsgo.mod  Create and launch an HTTP server In that same folder, create a file called main.go and add the following code to the file:  123456789101112package mainimport (    &quot;log&quot; ...</div></div></div></a><a class="pagination-related" href="/2025/01/03/cloud-native-observability-opentelemetry-js/" title="Observability - OpenTelemetry Node.js"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/Nodejs-Instrumentation-OpenTelemetry.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-03</div><div class="info-item-2">Observability - OpenTelemetry Node.js</div></div><div class="info-2"><div class="info-item-1">OverviewStatus and Releases   Traces Metrics Logs    Stable Stable Development    Client instrumentation for the browser is experimental and mostly unspecified.    Version Support OpenTelemetry JavaScript supports all active or maintenance LTS versions of Node.js. Previous versions of Node.js may work, but are not tested by OpenTelemetry.   OpenTelemetry JavaScript has no official supported list of browsers. It is aimed to work on currently supported versions of major browsers. OpenTelemetry JavaScript f...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">641</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Summary"><span class="toc-number">1.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">2.</span> <span class="toc-text">Introduction</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-number">2.1.</span> <span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-Prometheus"><span class="toc-number">2.1.1.</span> <span class="toc-text">What is Prometheus?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Features"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">Features</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#What-are-metrics"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">What are metrics?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Components"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">Components</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Architecture"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">Architecture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#When-does-it-fit"><span class="toc-number">2.1.1.5.</span> <span class="toc-text">When does it fit?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#When-does-it-not-fit"><span class="toc-number">2.1.1.6.</span> <span class="toc-text">When does it not fit?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#First-steps-with-Prometheus"><span class="toc-number">2.2.</span> <span class="toc-text">First steps with Prometheus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Downloading-Prometheus"><span class="toc-number">2.2.1.</span> <span class="toc-text">Downloading Prometheus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring-Prometheus"><span class="toc-number">2.2.2.</span> <span class="toc-text">Configuring Prometheus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Starting-Prometheus"><span class="toc-number">2.2.3.</span> <span class="toc-text">Starting Prometheus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-the-expression-browser"><span class="toc-number">2.2.4.</span> <span class="toc-text">Using the expression browser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Using-the-graphing-interface"><span class="toc-number">2.2.5.</span> <span class="toc-text">Using the graphing interface</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Monitoring-other-targets"><span class="toc-number">2.2.6.</span> <span class="toc-text">Monitoring other targets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frequently-asked-questions"><span class="toc-number">2.3.</span> <span class="toc-text">Frequently asked questions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#General"><span class="toc-number">2.3.1.</span> <span class="toc-text">General</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instrumentation"><span class="toc-number">2.3.2.</span> <span class="toc-text">Instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implementation"><span class="toc-number">2.3.3.</span> <span class="toc-text">Implementation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Glossary"><span class="toc-number">2.4.</span> <span class="toc-text">Glossary</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Alert"><span class="toc-number">2.4.1.</span> <span class="toc-text">Alert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Alertmanager"><span class="toc-number">2.4.2.</span> <span class="toc-text">Alertmanager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bridge"><span class="toc-number">2.4.3.</span> <span class="toc-text">Bridge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-library"><span class="toc-number">2.4.4.</span> <span class="toc-text">Client library</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector"><span class="toc-number">2.4.5.</span> <span class="toc-text">Collector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Direct-instrumentation"><span class="toc-number">2.4.6.</span> <span class="toc-text">Direct instrumentation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Endpoint"><span class="toc-number">2.4.7.</span> <span class="toc-text">Endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exporter"><span class="toc-number">2.4.8.</span> <span class="toc-text">Exporter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instance"><span class="toc-number">2.4.9.</span> <span class="toc-text">Instance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Job"><span class="toc-number">2.4.10.</span> <span class="toc-text">Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Notification"><span class="toc-number">2.4.11.</span> <span class="toc-text">Notification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Promdash"><span class="toc-number">2.4.12.</span> <span class="toc-text">Promdash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prometheus"><span class="toc-number">2.4.13.</span> <span class="toc-text">Prometheus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PromQL"><span class="toc-number">2.4.14.</span> <span class="toc-text">PromQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pushgateway"><span class="toc-number">2.4.15.</span> <span class="toc-text">Pushgateway</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recording-Rules"><span class="toc-number">2.4.16.</span> <span class="toc-text">Recording Rules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Read"><span class="toc-number">2.4.17.</span> <span class="toc-text">Remote Read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Read-Adapter"><span class="toc-number">2.4.18.</span> <span class="toc-text">Remote Read Adapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Read-Endpoint"><span class="toc-number">2.4.19.</span> <span class="toc-text">Remote Read Endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Write"><span class="toc-number">2.4.20.</span> <span class="toc-text">Remote Write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Write-Adapter"><span class="toc-number">2.4.21.</span> <span class="toc-text">Remote Write Adapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Write-Endpoint"><span class="toc-number">2.4.22.</span> <span class="toc-text">Remote Write Endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sample"><span class="toc-number">2.4.23.</span> <span class="toc-text">Sample</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Silence"><span class="toc-number">2.4.24.</span> <span class="toc-text">Silence</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Target"><span class="toc-number">2.4.25.</span> <span class="toc-text">Target</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Time-Series"><span class="toc-number">2.4.26.</span> <span class="toc-text">Time Series</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>