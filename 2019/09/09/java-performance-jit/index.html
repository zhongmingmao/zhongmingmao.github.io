<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Java性能 -- JIT | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="编译 前端编译：即常见的**.java文件被编译成.class文件**的过程 运行时编译：机器无法直接运行Java生成的字节码，在运行时，JIT或者解释器会将字节码转换为机器码 类文件在运行时被进一步编译，可以变成高度优化的机器代码   C&#x2F;C++编译器的所有优化都是在编译期完成的，运行期的性能监控仅作为基础的优化措施是无法进行的 JIT编译器是JVM中运行时编译最重要的部分之一">
<meta property="og:type" content="article">
<meta property="og:title" content="Java性能 -- JIT">
<meta property="og:url" content="https://blog.zhongmingmao.top/2019/09/09/java-performance-jit/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="编译 前端编译：即常见的**.java文件被编译成.class文件**的过程 运行时编译：机器无法直接运行Java生成的字节码，在运行时，JIT或者解释器会将字节码转换为机器码 类文件在运行时被进一步编译，可以变成高度优化的机器代码   C&#x2F;C++编译器的所有优化都是在编译期完成的，运行期的性能监控仅作为基础的优化措施是无法进行的 JIT编译器是JVM中运行时编译最重要的部分之一">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-1.webp">
<meta property="article:published_time" content="2019-09-09T03:57:01.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.583Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Java Performance">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="JIT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-1.webp"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2019/09/09/java-performance-jit/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java性能 -- JIT',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-03 18:04:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">581</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">180</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">74</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-1.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java性能 -- JIT</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2019-09-09T03:57:01.000Z" title="Created 2019-09-09 11:57:01">2019-09-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/performance/">Performance</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>10min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><ol>
<li><strong>前端编译</strong>：即常见的**.java文件<strong>被编译成</strong>.class文件**的过程</li>
<li><strong>运行时编译</strong>：机器无法直接运行Java生成的字节码，在<strong>运行时</strong>，<strong>JIT</strong>或者<strong>解释器</strong>会将<strong>字节码</strong>转换为<strong>机器码</strong><ul>
<li>类文件在运行时被进一步编译，可以变成<strong>高度优化</strong>的机器代码</li>
</ul>
</li>
<li>C&#x2F;C++编译器的所有优化都是在<strong>编译期</strong>完成的，运行期的性能监控仅作为基础的优化措施是无法进行的</li>
<li><strong>JIT编译器</strong>是JVM中<strong>运行时编译</strong>最重要的部分之一</li>
</ol>
<span id="more"></span>

<h2 id="编译-加载-执行"><a href="#编译-加载-执行" class="headerlink" title="编译 &#x2F; 加载 &#x2F; 执行"></a>编译 &#x2F; 加载 &#x2F; 执行</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-performance-1253868755.cos.ap-guangzhou.myqcloud.com/java-performance-jit-compile-run.jpg" width=1000>

<h3 id="类编译"><a href="#类编译" class="headerlink" title="类编译"></a>类编译</h3><ol>
<li><strong>javac</strong>：将.java文件<strong>编译</strong>成.class文件</li>
<li><strong>javap</strong>：<strong>反编译</strong>.class文件，重点关注<strong>常量池</strong>和<strong>方法表集合</strong><ul>
<li>常量池主要记录的是类文件中出现的<strong>字面量</strong>和<strong>符号引用</strong><ul>
<li>字面量：<strong>字符串常量</strong>、<strong>基本类型的常量</strong></li>
<li>符号引用：<strong>类和接口的全限定名</strong>、<strong>类引用</strong>、<strong>方法引用</strong>、<strong>成员变量引用</strong></li>
</ul>
</li>
<li>方法表集合<ul>
<li>方法的字节码、方法访问权限、方法名索引、描述符索引、JVM执行指令、属性集合等</li>
</ul>
</li>
</ul>
</li>
</ol>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://java-performance-1253868755.cos.ap-guangzhou.myqcloud.com/java-performance-jit-javap.png" width=1000>

<h3 id="类加载"><a href="#类加载" class="headerlink" title="类加载"></a>类加载</h3><ol>
<li>当一个类<strong>被创建实例</strong>或者<strong>被其他对象引用</strong>时，JVM如果没有加载过该类，会通过<strong>类加载器</strong>将**.class文件<strong>加载到</strong>内存**中</li>
<li>不同的实现类由不同的类加载器加载<ul>
<li><strong>JDK中的本地方法类</strong>一般由根加载器（<strong>Bootstrap Loader</strong>）加载</li>
<li><strong>JDK中内部实现的扩展类</strong>一般由扩展加载器（<strong>ExtClassLoader</strong>）加载</li>
<li><strong>程序中的类文件</strong>则由系统加载器（<strong>AppClassLoader</strong>）加载</li>
</ul>
</li>
<li>在类加载后，.class类文件中的<strong>常量池信息</strong>以及其他数据会被保存到JVM内存的<strong>方法区</strong>中</li>
</ol>
<h3 id="类连接"><a href="#类连接" class="headerlink" title="类连接"></a>类连接</h3><ol>
<li>类在加载进内存后，会进行<strong>连接、初始化</strong>，最后才能被使用，连接又包括<strong>验证</strong>、<strong>准备</strong>、<strong>解析</strong>三部分</li>
<li>验证<ul>
<li>验证类<strong>符合JVM规范</strong>，在保证符合规范的前提下，<strong>避免危害虚拟机安全</strong></li>
</ul>
</li>
<li>准备<ul>
<li><strong>为类的静态变量分配内存</strong>，初始化为<strong>系统的初始值</strong></li>
<li>对于<code>final static</code>修饰的变量，<strong>直接赋值</strong>为用户的定义值<ul>
<li><code>private final static int value = 123</code>，会在准备阶段分配内存，并初始化值为<strong>123</strong></li>
<li><code>private static int value = 123</code>，会在准备阶段分配内存，并初始化值为<strong>0</strong></li>
</ul>
</li>
</ul>
</li>
<li>解析<ul>
<li>将<strong>符号引用</strong>转为<strong>直接引用</strong></li>
<li>在<strong>编译</strong>时，Java类<strong>并不知道</strong>所引用的类的<strong>实际地址</strong>，因此只能使用符号引用来代替</li>
<li><strong>.class文件的常量池</strong>中存储了<strong>符号引用</strong>，实际使用时，需要将它们转化为<strong>JVM能直接获取的内存地址或指针</strong></li>
</ul>
</li>
</ol>
<h3 id="类初始化"><a href="#类初始化" class="headerlink" title="类初始化"></a>类初始化</h3><ol>
<li>类初始化是类加载过程的最后阶段，首先执行构造器**<code>&lt;clinit&gt;</code>**方法</li>
<li>前端编译时（<strong>javac</strong>），收集所有的<strong>静态变量赋值语句</strong>、<em>s</em>静态代码块<strong>、</strong>静态方法<strong>，成为</strong><code>&lt;clinit&gt;</code>**方法</li>
<li>初始化类的<strong>静态变量</strong>和<strong>静态代码块</strong>均为用户自定义的值，初始化顺序和Java源码<strong>从上到下</strong>的顺序一致</li>
<li>子类初始化时，会先调用<strong>父类</strong>的**<code>&lt;clinit&gt;</code><strong>方法，再调用子类的</strong><code>&lt;clinit&gt;</code>**方法</li>
<li>JVM会保证**<code>&lt;clinit&gt;</code><strong>方法的</strong>线程安全**，保证同一时间只有一个线程执行</li>
<li>JVM在<strong>实例化新对象</strong>时，会调用**<code>&lt;init&gt;</code><strong>方法对</strong>实例变量**进行初始化，并执行对应的构造方法内的代码</li>
</ol>
<h2 id="即时编译"><a href="#即时编译" class="headerlink" title="即时编译"></a>即时编译</h2><ol>
<li>初始化完成后，类在调用执行过程中，执行引擎需要把<strong>字节码</strong>转换为<strong>机器码</strong>，然后才能在<strong>操作系统</strong>中执行<ul>
<li>在字节码转换为机器码的过程中，虚拟机还存在着一道编译，那就是<strong>即时编译</strong></li>
</ul>
</li>
<li>起初，虚拟机中的字节码是由<strong>解释器</strong>（Interpreter）完成编译的<ul>
<li>当虚拟机发现某个方法或者代码块运行得特别频繁的时候，就会把这些代码认定为<strong>热点代码</strong></li>
<li>为了提高热点代码的<strong>执行效率</strong>，<strong>JIT</strong>会把热点代码编译成<strong>与本地平台相关的高度优化的机器码</strong>，然后保存在<strong>内存</strong>中</li>
</ul>
</li>
</ol>
<h3 id="即时编译类型"><a href="#即时编译类型" class="headerlink" title="即时编译类型"></a>即时编译类型</h3><ol>
<li>在<strong>HotSpot VM</strong>中，内置了两个JIT，分别是<strong>C1</strong>编译器（<strong>Client</strong> Compiler）和<strong>C2</strong>编译器（<strong>Server</strong> Compiler）</li>
<li><strong>C1</strong>编译器是一个<strong>简单快速</strong>的编译器，主要的关注点在于<strong>局部性</strong>的优化，适用于<strong>执行时间较短</strong>或<strong>对启动速度有要求</strong>的程序</li>
<li><strong>C2</strong>编译器是为<strong>长期运行</strong>的<strong>服务器端</strong>应用程序做性能调优的编译器，适用于<strong>执行时间较长</strong>或<strong>对峰值性能有要求</strong>的程序</li>
<li>在Java 7之前，需要根据<strong>应用的特性</strong>来选择对应的JIT，虚拟机默认采用<strong>解释器</strong>和其中一个<strong>即时编译器</strong>配合工作</li>
<li><strong>Java 7引入了分层编译</strong>，综合了<strong>C1的启动性能优势</strong>和<strong>C2的峰值性能优势</strong><ul>
<li>也可以通过参数<code>-client</code>、<code>-server</code>强制指定虚拟机的<strong>即时编译模式</strong></li>
<li>分层编译是将<strong>JVM的执行状态</strong>分了5个层次</li>
<li>第0层<ul>
<li>程序解释执行，默认开启Profiling（如果不开启，可触发第2层编译）</li>
</ul>
</li>
<li>第1层<ul>
<li>称为C1编译，将字节码编译为本地代码，进行<strong>简单可靠</strong>的优化，不开启Profiling</li>
</ul>
</li>
<li>第2层<ul>
<li>称为C1编译，开启Profiling，仅执行带<strong>方法调用次数</strong>和<strong>循环回边执行次数</strong>Profiling的C1编译</li>
</ul>
</li>
<li>第3层<ul>
<li>称为C1编译，开启Profiling，执行<strong>所有</strong>带Profiling的C1编译</li>
</ul>
</li>
<li>第4层<ul>
<li>称为C2编译，将字节码编译为本地代码</li>
<li>但会启用一些<strong>编译耗时较长</strong>的优化，甚至会根据性能监控信息进行一些<strong>不可靠的激进优化</strong></li>
</ul>
</li>
</ul>
</li>
<li>Java 8<strong>默认开启分层编译</strong>，参数<code>-client</code>、<code>-server</code>已失效<ul>
<li>如果<strong>只想开启C2</strong>，可以<strong>关闭分层编译</strong><code>-XX:-TieredCompilation</code></li>
<li>如果<strong>只想开启C1</strong>，可以<strong>打开分层编译</strong>，并且使用参数<code>-XX:TieredStopAtLevel=1</code></li>
</ul>
</li>
<li><strong>单一编译模式</strong>（上面的都是<strong>混合编译</strong>模式）<ul>
<li><strong><code>-Xint</code></strong><ul>
<li>强制虚拟机运行于<strong>只有解释器的编译模式下</strong>，<strong>JIT完全不介入工作</strong></li>
</ul>
</li>
<li><strong><code>-Xcomp</code></strong><ul>
<li>强制虚拟机运行于<strong>只有JIT的编译模式下</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br><span class="line">openjdk version &quot;1.8.0_222&quot;</span><br><span class="line">OpenJDK Runtime Environment (Zulu 8.40.0.25-CA-macosx) (build 1.8.0_222-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (Zulu 8.40.0.25-CA-macosx) (build 25.222-b10, mixed mode)</span><br><span class="line"></span><br><span class="line">$ java -Xint -version</span><br><span class="line">openjdk version &quot;1.8.0_222&quot;</span><br><span class="line">OpenJDK Runtime Environment (Zulu 8.40.0.25-CA-macosx) (build 1.8.0_222-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (Zulu 8.40.0.25-CA-macosx) (build 25.222-b10, interpreted mode)</span><br><span class="line"></span><br><span class="line">$ java -Xcomp -version</span><br><span class="line">openjdk version &quot;1.8.0_222&quot;</span><br><span class="line">OpenJDK Runtime Environment (Zulu 8.40.0.25-CA-macosx) (build 1.8.0_222-b10)</span><br><span class="line">OpenJDK 64-Bit Server VM (Zulu 8.40.0.25-CA-macosx) (build 25.222-b10, compiled mode)</span><br></pre></td></tr></table></figure>

<h3 id="热点探测"><a href="#热点探测" class="headerlink" title="热点探测"></a>热点探测</h3><ol>
<li>HotSpot VM的热点探测是JIT优化的条件，热点探测是基于<strong>计数器</strong>的热点探测<ul>
<li>采用这种方法的虚拟机会为每个方法建立<strong>计数器</strong>统计方法的执行次数</li>
<li>如果执行次数超过一定的<strong>阈值</strong>就认为是热点方法</li>
</ul>
</li>
<li>虚拟机为<strong>每个方法</strong>准备了两类计数器：<strong>方法调用计数器</strong>（Invocation Counter）、<strong>回边计数器</strong>（Back Edge Counter）<ul>
<li>在确定虚拟机运行参数的前提下，这两个计数器都有一个<strong>明确的阈值</strong>，当计数器<strong>超过阈值</strong>，就会触发<strong>JIT编译</strong></li>
</ul>
</li>
<li><strong>方法调用计数器</strong><ul>
<li><strong>C1</strong>模式下是<strong>1500</strong>次，<strong>C2</strong>模式下是<strong>10000</strong>次，可通过参数<code>-XX:CompileThreshold</code>来设置</li>
<li>在<strong>分层编译</strong>的情况下，参数<code>-XX:CompileThreshold</code>将<strong>失效</strong><ul>
<li>将会根据当前<strong>待编译的方法数</strong>以及<strong>编译线程数</strong>来<strong>动态调整</strong></li>
<li>当方法计数器和回边计数器<strong>之和</strong>超过<strong>方法计数器阈值</strong>时，触发<strong>JIT编译</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong>回边计数器</strong><ul>
<li>用于统计一个方法中<strong>循环体</strong>代码执行的次数（<strong>回边</strong>：字节码中遇到控制流<strong>向后跳转</strong>的指令）</li>
<li>不开启分层编译时，<strong>C1</strong>默认为<strong>13995</strong>，<strong>C2</strong>默认为<strong>10700</strong>，可通过参数<code>-XX:OnStackReplacePercentage</code>来设置</li>
<li>在<strong>分层编译</strong>的情况下，参数<code>-XX:OnStackReplacePercentage</code>同样会<strong>失效</strong><ul>
<li>将会根据当前<strong>待编译的方法数</strong>以及<strong>编译线程数</strong>来<strong>动态调整</strong></li>
</ul>
</li>
<li>建立回边计数器的主要目的是为了触发<strong>OSR</strong>（On Stack Replacement）编译，即_<strong>栈上编译</strong>_<ul>
<li>在一些<strong>循环周期比较长</strong>的代码段中，当循环达到回边计数器阈值时，JVM会认为这段代码是<strong>热点代码</strong></li>
<li>JIT编译器会将这段代码编译成<strong>机器语言</strong>并<strong>缓存</strong>，在该循环时间内，<strong>直接替换</strong>执行代码，<strong>执行缓存的机器语言</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="编译优化技术"><a href="#编译优化技术" class="headerlink" title="编译优化技术"></a>编译优化技术</h3><h4 id="方法内联"><a href="#方法内联" class="headerlink" title="方法内联"></a>方法内联</h4><ol>
<li>调用一个方法通常要经历<strong>压栈</strong>和<strong>出栈</strong><ul>
<li>调用方法是将程序执行顺序转移到存储该方法的内存地址，将方法的内容执行完后，再返回到执行该方法前的位置</li>
<li>方法调用会产生一定的<strong>时间开销</strong>和<strong>空间开销</strong>，对于<strong>方法体代码不是很大</strong>，又<strong>频繁调用</strong>的方法来说，这个<strong>开销会很大</strong></li>
</ul>
</li>
<li>方法内联：_<strong>把目标方法的代码复制到发起调用的方法中，避免发生真实的方法调用</strong>_</li>
<li>JVM会<strong>自动识别</strong>热点方法，并对它们使用<strong>方法内联</strong>进行优化，可以通过<code>-XX:CompileThreshold</code>来设置热点方法的阈值</li>
<li>热点方法<strong>不一定</strong>会被JVM做内联优化，如果<strong>方法体太大</strong>，JVM将不执行内联操作<ul>
<li><strong>经常执行</strong>的方法，默认情况下，方法体大小<strong>小于325字节</strong>的都会进行内联，参数**<code>-XX:MaxFreqInlineSize</code>**</li>
<li><strong>不经常执行</strong>的方法，默认情况下，方法体大小<strong>小于35字节</strong>的才会进行内联，参数**<code>-XX:MaxInlineSize</code>**</li>
</ul>
</li>
<li>提高<strong>方法内联</strong>的方式<ul>
<li>减少<code>-XX:CompileThreshold</code>，增加<code>-XX:MaxFreqInlineSize</code>或<code>-XX:MaxInlineSize</code></li>
<li>避免在一个方法中写大量代码，习惯使用<strong>小方法体</strong></li>
<li>尽量使用<strong>private</strong>、<strong>static</strong>、<strong>final</strong>关键字<strong>修饰方法</strong>，编码方法因为<strong>继承</strong>，会需要_<strong>额外的类型检查</strong>_</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UnlockDiagnosticVMOptions  // 解锁对 JVM 进行诊断的选项参数。默认是关闭的，开启后支持一些特定参数对 JVM 进行诊断</span><br><span class="line">-XX:+PrintCompilation           // 在控制台打印编译过程信息</span><br><span class="line">-XX:+PrintInlining              // 将内联方法打印出来</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add1</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> x2, <span class="type">int</span> x3, <span class="type">int</span> x4)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> add2(x1, x2) + add2(x3, x4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add2</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> x2)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x1 + x2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 方法调用计数器的默认阈值在C1模式下是1500次，在C2模式在是10_000次</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1_000_000</span>; i++) &#123;</span><br><span class="line">        add1(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">377   21       4       Test::add1 (12 bytes)</span><br><span class="line">                            @ 2   Test::add2 (4 bytes)   inline (hot)</span><br><span class="line">                            @ 7   Test::add2 (4 bytes)   inline (hot)</span><br><span class="line">...</span><br><span class="line">384   24 %     4       Test::main @ 2 (23 bytes)</span><br><span class="line">                            @ 12   Test::add1 (12 bytes)   inline (hot)</span><br><span class="line">                              @ 2   Test::add2 (4 bytes)   inline (hot)</span><br><span class="line">                              @ 7   Test::add2 (4 bytes)   inline (hot)</span><br></pre></td></tr></table></figure>

<h4 id="逃逸分析"><a href="#逃逸分析" class="headerlink" title="逃逸分析"></a>逃逸分析</h4><p>逃逸分析是判断一个对象是否被<strong>外部方法引用</strong>或<strong>外部线程访问</strong>的分析技术，编译器会根据逃逸分析的结果对代码进行优化</p>
<h5 id="栈上分配"><a href="#栈上分配" class="headerlink" title="栈上分配"></a>栈上分配</h5><ol>
<li>在Java中默认创建一个对象是在<strong>堆</strong>上分配内存的，当堆内存中的对象不再使用时，会被垃圾回收<ul>
<li>这个过程相对分配在<strong>栈</strong>上的对象的创建和销毁来说，更耗<strong>时间</strong>和<strong>性能</strong></li>
</ul>
</li>
<li>逃逸分析如果发现<strong>一个对象只在方法中使用</strong>，就会将对象分配在<strong>栈</strong>上</li>
<li>HotSpot VM暂时没有实现这项优化</li>
</ol>
<h5 id="锁消除"><a href="#锁消除" class="headerlink" title="锁消除"></a>锁消除</h5><ol>
<li>在局部方法中创建的对象只能被<strong>当前线程</strong>访问，无法被其他线程访问，JIT会对该对象的方法锁进行<strong>锁消除</strong></li>
</ol>
<h5 id="标量替换"><a href="#标量替换" class="headerlink" title="标量替换"></a>标量替换</h5><ol>
<li>逃逸分析证明一个对象<strong>不会被外部访问</strong><ul>
<li>如果该对象可以被<strong>拆分</strong>的话，当程序真正执行的时候，可能不会创建这个对象，而是直接创建它的<strong>成员变量</strong>来代替</li>
</ul>
</li>
<li>将对象拆分后，可以分配对象的<strong>成员变量</strong>在<strong>栈</strong>或<strong>寄存器</strong>上，原本的对象就无需分配内存空间了，称为<strong>标量替换</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">TestInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestInfo</span>();</span><br><span class="line">    info.id = <span class="number">1</span>;</span><br><span class="line">    info.count = <span class="number">99</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>逃逸分析后，代码被优化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">    id = <span class="number">1</span>;</span><br><span class="line">    count = <span class="number">99</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="JVM参数"><a href="#JVM参数" class="headerlink" title="JVM参数"></a>JVM参数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-XX:+DoEscapeAnalysis 开启逃逸分析（JDK 1.8默认开启）</span><br><span class="line">-XX:+EliminateLocks 开启锁消除（JDK 1.8默认开启）</span><br><span class="line">-XX:+EliminateAllocations 开启标量替换（JDK 1.8默认开启）</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100028001">Java性能调优实战</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2019/09/09/java-performance-jit/">https://blog.zhongmingmao.top/2019/09/09/java-performance-jit/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">Java</a><a class="post-meta__tags" href="/tags/java-performance/">Java Performance</a><a class="post-meta__tags" href="/tags/jvm/">JVM</a><a class="post-meta__tags" href="/tags/jit/">JIT</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2019/09/10/kafka-consumer-manage-tcp-connection/" title="Kafka -- Java消费者管理TCP连接"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Kafka -- Java消费者管理TCP连接</div></div></a></div><div class="next-post pull-right"><a href="/2019/09/08/kafka-multi-thread-consumer/" title="Kafka -- 多线程消费者"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Kafka -- 多线程消费者</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2019/09/13/java-performance-jvm-heap-allocation/" title="Java性能 -- JVM堆内存分配"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-13</div><div class="title">Java性能 -- JVM堆内存分配</div></div></a></div><div><a href="/2019/09/11/java-performance-gc/" title="Java性能 -- GC"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-18.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-11</div><div class="title">Java性能 -- GC</div></div></a></div><div><a href="/2019/09/07/java-performance-jvm-memory-model/" title="Java性能 -- JVM内存模型"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-24.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-07</div><div class="title">Java性能 -- JVM内存模型</div></div></a></div><div><a href="/2022/02/22/jvm-bytecode-manipulation-asm-introduction/" title="ASM - Introduction"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-22.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-22</div><div class="title">ASM - Introduction</div></div></a></div><div><a href="/2022/02/11/jvm-bytecode-manipulation-javassist/" title="Bytecode Manipulation - Javassist"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-16.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-11</div><div class="title">Bytecode Manipulation - Javassist</div></div></a></div><div><a href="/2022/02/10/jvm-bytecode-manipulation-java-agent-practice/" title="Bytecode Manipulation - Java Agent Practice"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-23.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-10</div><div class="title">Bytecode Manipulation - Java Agent Practice</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">581</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">180</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">74</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">1.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91-%E5%8A%A0%E8%BD%BD-%E6%89%A7%E8%A1%8C"><span class="toc-number">2.</span> <span class="toc-text">编译 &#x2F; 加载 &#x2F; 执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%BC%96%E8%AF%91"><span class="toc-number">2.1.</span> <span class="toc-text">类编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD"><span class="toc-number">2.2.</span> <span class="toc-text">类加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.3.</span> <span class="toc-text">类连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.4.</span> <span class="toc-text">类初始化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91"><span class="toc-number">3.</span> <span class="toc-text">即时编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B3%E6%97%B6%E7%BC%96%E8%AF%91%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text">即时编译类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E7%82%B9%E6%8E%A2%E6%B5%8B"><span class="toc-number">3.2.</span> <span class="toc-text">热点探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">3.3.</span> <span class="toc-text">编译优化技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%86%85%E8%81%94"><span class="toc-number">3.3.1.</span> <span class="toc-text">方法内联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90"><span class="toc-number">3.3.2.</span> <span class="toc-text">逃逸分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%88%E4%B8%8A%E5%88%86%E9%85%8D"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">栈上分配</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%81%E6%B6%88%E9%99%A4"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">锁消除</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">标量替换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JVM%E5%8F%82%E6%95%B0"><span class="toc-number">3.3.2.4.</span> <span class="toc-text">JVM参数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/11/bigdata-batch-stream/" title="Big Data - Batch + Stream"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241115160715474.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Big Data - Batch + Stream"/></a><div class="content"><a class="title" href="/2024/09/11/bigdata-batch-stream/" title="Big Data - Batch + Stream">Big Data - Batch + Stream</a><time datetime="2024-09-10T16:06:25.000Z" title="Created 2024-09-11 00:06:25">2024-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/10/bigdata-distributed-system/" title="Big Data - Distributed System"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/image-20241115122617632.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Big Data - Distributed System"/></a><div class="content"><a class="title" href="/2024/09/10/bigdata-distributed-system/" title="Big Data - Distributed System">Big Data - Distributed System</a><time datetime="2024-09-09T16:06:25.000Z" title="Created 2024-09-10 00:06:25">2024-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://rag-1253868755.cos.ap-guangzhou.myqcloud.com/qdrant.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RAG - Qdrant"/></a><div class="content"><a class="title" href="/2024/09/09/rag-vector-qdrant/" title="RAG - Qdrant">RAG - Qdrant</a><time datetime="2024-09-08T16:06:25.000Z" title="Created 2024-09-09 00:06:25">2024-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/08/python-debug-profile/" title="Python - Debug + Profile"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://python-1253868755.cos.ap-guangzhou.myqcloud.com/python-debugging.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - Debug + Profile"/></a><div class="content"><a class="title" href="/2024/09/08/python-debug-profile/" title="Python - Debug + Profile">Python - Debug + Profile</a><time datetime="2024-09-07T16:06:25.000Z" title="Created 2024-09-08 00:06:25">2024-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/07/python-with/" title="Python - With"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://python-1253868755.cos.ap-guangzhou.myqcloud.com/python-with.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python - With"/></a><div class="content"><a class="title" href="/2024/09/07/python-with/" title="Python - With">Python - With</a><time datetime="2024-09-06T16:06:25.000Z" title="Created 2024-09-07 00:06:25">2024-09-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2024 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>