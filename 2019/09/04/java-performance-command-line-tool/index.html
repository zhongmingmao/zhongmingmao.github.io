<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java性能 -- 命令行工具 | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-&#x2F;+ buffers&#x2F;cache:       8880">
<meta property="og:type" content="article">
<meta property="og:title" content="Java性能 -- 命令行工具">
<meta property="og:url" content="https://blog.zhongmingmao.top/2019/09/04/java-performance-command-line-tool/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="free12345$ free -m             total       used       free     shared    buffers     cachedMem:         15948      15261        687        304         37       6343-&#x2F;+ buffers&#x2F;cache:       8880">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png">
<meta property="article:published_time" content="2019-09-04T11:48:26.000Z">
<meta property="article:modified_time" content="2023-04-03T10:04:59.582Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Java Performance">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Java性能 -- 命令行工具",
  "url": "https://blog.zhongmingmao.top/2019/09/04/java-performance-command-line-tool/",
  "image": "https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png",
  "datePublished": "2019-09-04T11:48:26.000Z",
  "dateModified": "2023-04-03T10:04:59.582Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2019/09/04/java-performance-command-line-tool/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java性能 -- 命令行工具',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Java性能 -- 命令行工具</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Java性能 -- 命令行工具</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2019-09-04T11:48:26.000Z" title="Created 2019-09-04 19:48:26">2019-09-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/performance/">Performance</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">3.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>20mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-04-03 18:04:59&quot;}" hidden></div><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:         15948      15261        687        304         37       6343</span><br><span class="line">-/+ buffers/cache:       8880       7068</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<ol>
<li><code>Mem</code>是从<strong>操作系统</strong>的角度来看的<ul>
<li>总共有15948M物理内存，其中15261M被使用了，还有687可用，<code>15948 = 15261 + 687</code></li>
<li>有若干线程共享了304M物理内存，已经被弃用（值总为0）</li>
<li>buffer &#x2F; cached ：为了<strong>提高IO性能</strong>，由OS管理<ul>
<li>A buffer is something that has yet to be <strong>“written”</strong> to disk.</li>
<li>A cache is something that has been <strong>“read”</strong> from the disk and stored for later use.</li>
<li>buffer和cached占用的内存可以<strong>被快速回收</strong></li>
</ul>
</li>
</ul>
</li>
<li><code>-/+ buffers/cache</code>是从<strong>应用程序</strong>的角度来看的<ul>
<li>应用程序认为系统被用掉了8880M物理内存，还剩下7068M物理内存</li>
<li><code>8880 ≈ (15261 - 37 - 6343 = 8881)</code></li>
<li><code>7068 ≈ (687 + 37 + 6343 = 7067)</code></li>
</ul>
</li>
</ol>
<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ top -v</span><br><span class="line">    top: procps version 3.2.8</span><br><span class="line">usage:    top -hv | -abcHimMsS -d delay -n iterations [-u user | -U user] -p pid [,pid ...]</span><br><span class="line"></span><br><span class="line">$ top</span><br><span class="line">top - 09:08:28 up 36 days, 13:19,  1 user,  load average: 0.31, 0.16, 0.11</span><br><span class="line">Tasks: 274 total,   1 running, 273 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s):  2.5%us,  1.6%sy,  0.0%ni, 95.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Mem:  16331512k total, 16141616k used,   189896k free,     5372k buffers</span><br><span class="line">Swap:        0k total,        0k used,        0k free,  7526888k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+   PPID RUSER     UID GROUP    TTY      P SWAP   TIME CODE DATA nFLT nDRT WCHAN     Flags    COMMAND</span><br><span class="line">21862 dc        20   0 5113m 551m 5096 S  0.0  3.5  25:34.77     1 dc        555 dc       ?        4    0  25:34    4 4.8g  13k    0 futex_wai ..4.2... java</span><br><span class="line">12692 dc        20   0 5109m 513m 5792 S  0.2  3.2  19:54.09     1 dc        555 dc       ?        2    0  19:54    4 4.8g  30k    0 futex_wai ..4.2... java</span><br><span class="line">20299 dc        20   0 5054m 508m 2644 S  0.0  3.2 179:37.25     1 dc        555 dc       ?        4    0 179:37    4 4.8g  65k    0 futex_wai ..4.2... java</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ol>
<li>top命令可以实时显示正在执行进程的<strong>CPU使用率</strong>、<strong>内存使用率</strong>以及<strong>系统负载</strong>等信息<ul>
<li>上半部分显示的是<strong>系统的统计信息</strong>，下半部分显示的是<strong>进程的使用率统计信息</strong></li>
</ul>
</li>
<li>系统的统计信息<ul>
<li>Cpu<ul>
<li>%us：用户空间占用CPU百分比</li>
<li>%sy：内核空间占用CPU百分比</li>
<li>%ni：用户进程空间内<strong>改变过优先级</strong>的进程占用CPU百分比</li>
<li>%id：<strong>空闲</strong>CPU百分比</li>
<li>%wa：<strong>等待输入输出</strong>的CPU时间百分比</li>
<li>%hi：<strong>硬件中断</strong>占用百分比</li>
<li>%si：<strong>软中断</strong>占用百分比</li>
<li>%st：<strong>虚拟机</strong>占用百分比</li>
</ul>
</li>
</ul>
</li>
<li>进程的使用率统计信息<ul>
<li><strong>PID</strong>: Process Id<ul>
<li>The task’s unique process ID, which periodically wraps, though never restarting at zero.</li>
</ul>
</li>
<li><strong>PPID</strong>: Parent Process Pid<ul>
<li>The process ID of a task’s parent.</li>
</ul>
</li>
<li><strong>RUSER</strong>: Real User Name<ul>
<li>The real user name of the task’s owner.</li>
</ul>
</li>
<li><strong>UID</strong>: User Id<ul>
<li>The effective user ID of the task’s owner.</li>
</ul>
</li>
<li><strong>USER</strong>: User Name<ul>
<li>The effective user name of the task’s owner.</li>
</ul>
</li>
<li><strong>GROUP</strong>: Group Name<ul>
<li>The effective group name of the task’s owner.</li>
</ul>
</li>
<li><strong>TTY</strong>: Controlling Tty<ul>
<li>The name of the controlling terminal. This is usually the device (serial port, pty, etc.) from which the process was started, and which it uses for input or output. However, a task <strong>need not be associated with a terminal</strong>, in which case you’ll see <strong><code>&#39;?&#39;</code></strong> displayed.</li>
</ul>
</li>
<li><strong>%CPU</strong>: CPU usage<ul>
<li>The task’s share of the elapsed CPU time since the last screen update, expressed as a percentage of total CPU time.</li>
<li>In a true SMP environment, if ‘Irix mode’ is Off, top will operate in ‘Solaris mode’ where a task’s cpu usage will be divided by the total number of CPUs. You toggle ‘Irix&#x2F;Solaris’ modes with the ‘I’ interactive command.</li>
</ul>
</li>
<li><strong>S</strong>: Process Status<ul>
<li>The status of the task which can be one of<ul>
<li><code>&#39;D&#39; = uninterruptible sleep</code></li>
<li><code>&#39;R&#39; = running</code></li>
<li><code>&#39;S&#39; = sleeping</code></li>
<li><code>&#39;T&#39; = traced or stopped</code></li>
<li><code>&#39;Z&#39; = zombie</code></li>
</ul>
</li>
<li>Tasks shown as <strong>running</strong> should be more properly thought of as <strong><code>ready to run</code></strong><ul>
<li>their task_struct is simply represented on the Linux <strong>run-queue</strong>.</li>
<li>Even without a true SMP machine, you may see numerous tasks in this state depending on top’s <strong>delay interval</strong> and <strong>nice value</strong>.</li>
</ul>
</li>
</ul>
</li>
<li><strong>P</strong>: Last used CPU (SMP)<ul>
<li>A number representing the last used processor. In a true SMP environment this will likely change frequently since the kernel intentionally uses weak affinity. Also, the very act of running top may break this weak affinity and cause more processes to change CPUs more often (because of the extra demand for cpu time).</li>
</ul>
</li>
<li><strong>PR</strong>: Priority<ul>
<li>The priority of the task.</li>
</ul>
</li>
<li><strong>NI</strong>: Nice value<ul>
<li>The nice value of the task.</li>
<li>A <strong>negative nice value</strong> means <strong>higher priority</strong>, whereas a <strong>positive nice value</strong> means <strong>lower priority</strong>.</li>
<li><strong>Zero</strong> in this field simply means <strong>priority will not be adjusted</strong> in determining a task’s dispatchability.</li>
</ul>
</li>
<li><strong>TIME</strong>: CPU Time<ul>
<li>Total CPU time the task has used since it started.</li>
</ul>
</li>
<li><strong>TIME+</strong>: CPU Time, hundredths<ul>
<li>The same as ‘TIME’, but reflecting more granularity through <strong>hundredths of a second</strong>.</li>
</ul>
</li>
<li><strong>%MEM</strong>: Memory usage (RES)<ul>
<li>A task’s currently used share of <strong>available physical memory</strong>.</li>
</ul>
</li>
<li><strong>RES</strong>: Resident size (kb)<ul>
<li>The <strong>non-swapped physical memory</strong> a task has used.</li>
<li><em><strong>RES &#x3D; CODE + DATA</strong></em>.</li>
</ul>
</li>
<li><strong>CODE</strong>: Code size (kb)<ul>
<li>The amount of <strong>physical memory</strong> devoted to <strong>executable code</strong>, also known as the <strong><code>&#39;text resident set&#39;</code></strong> size or <strong>TRS</strong>.</li>
</ul>
</li>
<li><strong>DATA</strong>: Data+Stack size (kb)<ul>
<li>The amount of <strong>physical memory</strong> devoted to <strong>other than executable code</strong>, also known as the <strong><code>&#39;data resident set&#39;</code></strong> size or <strong>DRS</strong>.</li>
</ul>
</li>
<li><strong>SWAP</strong>: Swapped size (kb)<ul>
<li>Per-process swap values are now taken from <strong>&#x2F;proc&#x2F;#&#x2F;status VmSwap field</strong>.</li>
</ul>
</li>
<li><strong>VIRT</strong>: Virtual Image (kb)<ul>
<li>The <strong>total amount of virtual memory</strong> used by the task.</li>
<li>It includes all <strong>code</strong>, <strong>data</strong> and <strong>shared libraries</strong> plus <strong>pages that have been swapped out</strong>.</li>
</ul>
</li>
<li><strong>SHR</strong>: Shared Mem size (kb)<ul>
<li>The <strong>amount of shared memory</strong> used by a task.</li>
<li>It simply reflects memory that could be potentially shared with other processes.</li>
</ul>
</li>
<li><strong>nFLT</strong>: Page Fault count<ul>
<li>The number of <strong>major page faults</strong> that have occurred for a task. A page fault occurs when a process attempts to <strong>read from or write to a virtual page that is not currently present in its address space</strong>. A major page fault is when <strong>disk access</strong> is involved in making that page available.</li>
</ul>
</li>
<li><strong>nDRT</strong>: Dirty Pages count<ul>
<li>The number of pages that have been modified since they were last written to disk. <strong>Dirty pages must be written to disk before the corresponding physical memory location can be used for some other virtual page</strong>.</li>
</ul>
</li>
<li><strong>WCHAN</strong>: Sleeping in Function<ul>
<li>Depending on the availability of the kernel link map (‘System.map’), this field will show the name or the address of the <strong>kernel function</strong> in which the task is currently sleeping. Running tasks will display a dash (‘-‘) in this column.</li>
</ul>
</li>
<li><strong>Flags</strong>: Task Flags<ul>
<li>This column represents the task’s current scheduling flags which are expressed in hexadecimal notation and with zeros suppressed.</li>
</ul>
</li>
<li><strong>COMMAND</strong>: Command line or Program name</li>
</ul>
</li>
<li>常用选项<ul>
<li><strong>-a : Sort by memory usage</strong><ul>
<li>This switch makes top to sort the processes by <strong>allocated memory</strong></li>
</ul>
</li>
<li><strong>-d : Delay time</strong> interval as: <strong>-d ss.tt</strong> (seconds.tenths)<ul>
<li>Specifies the delay between screen updates, and overrides the corresponding value in one’s personal configuration file or the startup default.</li>
<li>Later this can be changed with the <strong><code>&#39;d&#39;</code></strong> or <strong><code>&#39;s&#39;</code></strong> <strong>interactive commands</strong>.</li>
</ul>
</li>
<li><strong>-H : Threads</strong> toggle<ul>
<li>When this toggle is On, all <strong>individual threads</strong> will be displayed. Otherwise, top displays <strong>a summation of all threads in a process</strong>.</li>
</ul>
</li>
<li><strong>-M : Detect memory units</strong><ul>
<li>Show memory units (<strong>k&#x2F;M&#x2F;G</strong>) and display floating point values in the memory summary.</li>
</ul>
</li>
<li><strong>-n : Number of iterations</strong> limit as: <strong>-n number</strong><ul>
<li>Specifies the <strong>maximum number of iterations</strong>, or frames, top should produce before ending</li>
</ul>
</li>
<li><strong>-p : Monitor PIDs</strong> as: <strong>-pN1 -pN2</strong> … or <strong>-pN1, N2 [,…]</strong><ul>
<li>Monitor only processes with specified process IDs. This option can be given up to <strong>20</strong> times, or you can provide a <strong>comma</strong> delimited list with up to 20 pids. <strong>Co-mingling</strong> both approaches is <strong>permitted</strong>.</li>
<li>This is a command-line option only. And should you wish to <strong>return to normal operation</strong>, it is not necessary to quit and and restart top – just issue the <strong>‘&#x3D;’ interactive command</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>交互命令<ul>
<li><strong><code>P</code><strong>： 根据</strong>CPU</strong>资源使用大小进行排序</li>
<li><strong><code>M</code><strong>： 根据</strong>内存</strong>资源使用大小进行排序</li>
<li><code>T</code>： 根据进程使用<strong>CPU的累积时间</strong>排序</li>
<li><code>N</code>： 按PID由高到低排列</li>
<li><code>r</code>： 修改进程的nice值(优先级)。优先级默认为10，正值使优先级降低，反之则提高的优先级</li>
<li><code>S</code>： 累计模式（把已完成或退出的子进程占用的CPU时间累计到<strong>父进程</strong>的TIME+ ）</li>
<li><code>W</code>： 将当前设置写入~&#x2F;.toprc文件，下次启动自动调用toprc文件的设置</li>
<li><code>&lt;</code>： 向前翻页</li>
<li><code>&gt;</code>： 向后翻页</li>
<li><code>1</code>： 显示每个CPU的详细情况</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Help for Interactive Commands - procps version 3.2.8</span><br><span class="line">Window 1:Def: Cumulative mode Off.  System: Delay 3.0 secs; Secure mode Off.</span><br><span class="line"></span><br><span class="line">  Z,B       Global: &#x27;Z&#x27; change color mappings; &#x27;B&#x27; disable/enable bold</span><br><span class="line">  l,t,m     Toggle Summaries: &#x27;l&#x27; load avg; &#x27;t&#x27; task/cpu stats; &#x27;m&#x27; mem info</span><br><span class="line">  1,I       Toggle SMP view: &#x27;1&#x27; single/separate states; &#x27;I&#x27; Irix/Solaris mode</span><br><span class="line"></span><br><span class="line">  f,o     . Fields/Columns: &#x27;f&#x27; add or remove; &#x27;o&#x27; change display order</span><br><span class="line">  F or O  . Select sort field</span><br><span class="line">  &lt;,&gt;     . Move sort field: &#x27;&lt;&#x27; next col left; &#x27;&gt;&#x27; next col right</span><br><span class="line">  R,H     . Toggle: &#x27;R&#x27; normal/reverse sort; &#x27;H&#x27; show threads</span><br><span class="line">  c,i,S   . Toggle: &#x27;c&#x27; cmd name/line; &#x27;i&#x27; idle tasks; &#x27;S&#x27; cumulative time</span><br><span class="line">  x,y     . Toggle highlights: &#x27;x&#x27; sort field; &#x27;y&#x27; running tasks</span><br><span class="line">  z,b     . Toggle: &#x27;z&#x27; color/mono; &#x27;b&#x27; bold/reverse (only if &#x27;x&#x27; or &#x27;y&#x27;)</span><br><span class="line">  u       . Show specific user only</span><br><span class="line">  n or #  . Set maximum tasks displayed</span><br><span class="line"></span><br><span class="line">  k,r       Manipulate tasks: &#x27;k&#x27; kill; &#x27;r&#x27; renice</span><br><span class="line">  d or s    Set update interval</span><br><span class="line">  W         Write configuration file</span><br><span class="line">  q         Quit</span><br><span class="line">          ( commands shown with &#x27;.&#x27; require a visible task display window )</span><br><span class="line">Press &#x27;h&#x27; or &#x27;?&#x27; for help with Windows,</span><br><span class="line">any other key to continue</span><br></pre></td></tr></table></figure>

<h2 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ vmstat -S M 1 5</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 2  0      0    295      1   5684    0    0     8    23    1    2  5  1 93  0  0</span><br><span class="line"> 0  0      0    295      1   5684    0    0     0     0 11326 25112  6  5 90  0  0</span><br><span class="line"> 0  0      0    295      1   5685    0    0     0     0 10855 24065  2  2 96  0  0</span><br><span class="line"> 0  0      0    294      1   5686    0    0     0     4 11756 25472  4  2 94  0  0</span><br><span class="line"> 0  0      0    294      1   5686    0    0     0     0 10208 22726  4  4 91  0  0</span><br><span class="line"></span><br><span class="line">$ free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:         15948      15655        293       5362          1       5687</span><br><span class="line">-/+ buffers/cache:       9966       5981</span><br><span class="line">Swap:            0          0          0</span><br></pre></td></tr></table></figure>

<ol>
<li>vmstat是一款指定采样周期和次数的<strong>功能性监控工具</strong>，可以用来监控进程上下文切换的情况</li>
<li>procs<ul>
<li>r: The number of <strong>runnable</strong> processes (<strong>running</strong> or <strong>waiting</strong> for run time)</li>
<li>b: The number of processes in <strong>uninterruptible sleep</strong></li>
</ul>
</li>
<li>memory<ul>
<li>swpd: the amount of <strong>virtual</strong> memory used</li>
<li>free: the amount of <strong>idle</strong> memory</li>
<li>buff: the amount of memory used as <strong>buffers</strong></li>
<li>cache: the amount of memory used as <strong>cache</strong></li>
</ul>
</li>
<li>swap<ul>
<li>si: Amount of memory <strong>swapped in from disk</strong> (&#x2F;s)</li>
<li>so: Amount of memory <strong>swapped to</strong> disk (&#x2F;s)</li>
</ul>
</li>
<li>io<ul>
<li>bi: Blocks <strong>received</strong> from a block device (blocks&#x2F;s)</li>
<li>bo: Blocks <strong>sent</strong> to a block device (blocks&#x2F;s)</li>
</ul>
</li>
<li>system<ul>
<li>in: The number of <strong>interrupts</strong> per second, including the clock</li>
<li>cs: The number of <strong>context switches</strong> per second</li>
</ul>
</li>
<li>cpu<ul>
<li>us: Time spent running <strong>non-kernel code</strong></li>
<li>sy: Time spent running <strong>kernel code</strong></li>
<li>id: Time spent idle, this <strong>includes IO-wait time</strong></li>
<li>wa: Time spent waiting for IO, <strong>included in idle</strong></li>
<li>st: Time stolen from a virtual machine</li>
</ul>
</li>
</ol>
<h2 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h2><ol>
<li>pidstat可以监测到<strong>具体线程的上下文切换</strong>，pidstat是<strong>sysstat</strong>中的一个组件</li>
<li>常用参数<ul>
<li><code>-u</code>: Report <strong>CPU utilization</strong></li>
<li><code>-r</code>: Report <strong>page faults</strong> and <strong>memory utilization</strong></li>
<li><code>-d</code>: Report <strong>I&#x2F;O statistics</strong></li>
<li><code>-w</code>: Report <strong>task switching activity</strong></li>
<li><code>-t</code>: Also display <strong>statistics for threads</strong> associated with selected tasks</li>
<li><code>-p &#123; pid [,...] | SELF | ALL &#125;</code>: Select tasks (processes) for which statistics are to be reported</li>
</ul>
</li>
</ol>
<h3 id="CPU使用率"><a href="#CPU使用率" class="headerlink" title="CPU使用率"></a>CPU使用率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -u -p 4256 1 3</span><br><span class="line">Linux 2.6.32-696.el6.x86_64 (XXXX)     2019年XX月XX日 	_x86_64_	(32 CPU)</span><br><span class="line"></span><br><span class="line">22时59分32秒       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">22时59分33秒      4256   71.00   13.00    0.00   84.00     1  java</span><br><span class="line">22时59分34秒      4256   60.00   10.00    0.00   70.00     1  java</span><br><span class="line">22时59分35秒      4256   76.24   12.87    0.00   89.11     1  java</span><br><span class="line">平均时间:      4256   69.10   11.96    0.00   81.06     -  java</span><br><span class="line"></span><br><span class="line">$ pidstat -u -I -p 4256 1 3</span><br><span class="line">Linux 2.6.32-696.el6.x86_64 (XXXX)     2019年XX月XX日 	_x86_64_	(32 CPU)</span><br><span class="line"></span><br><span class="line">23时06分18秒       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">23时06分19秒      4256   69.31   12.87    0.00    2.63     1  java</span><br><span class="line">23时06分20秒      4256   69.00   12.00    0.00    2.57     1  java</span><br><span class="line">23时06分21秒      4256   62.00   12.00    0.00    2.34     1  java</span><br><span class="line">平均时间:      4256   66.78   12.29    0.00    2.51     -  java</span><br></pre></td></tr></table></figure>
<ol>
<li>%usr<ul>
<li>Percentage of CPU used by the task while executing at the <strong>user level</strong> (<strong>application</strong>)</li>
<li>Note that this field does <strong>NOT include time spent running a virtual processor</strong></li>
</ul>
</li>
<li>%system<ul>
<li>Percentage of CPU used by the task while executing at the <strong>system level</strong> (<strong>kernel</strong>)</li>
</ul>
</li>
<li>%guest<ul>
<li>Percentage of CPU spent by the task in virtual machine (running a <strong>virtual processor</strong>)</li>
</ul>
</li>
<li>%CPU<ul>
<li><strong>Total percentage</strong> of CPU time used by the task</li>
<li>In an <strong>SMP</strong> environment, the task’s CPU usage will be <strong>divided</strong> by the <strong>total number of CPU’s</strong> if option <strong>-I</strong> has been entered on the command line</li>
</ul>
</li>
<li>CPU<ul>
<li><strong>Processor number</strong> to which the task is attached</li>
</ul>
</li>
</ol>
<h3 id="页错误-内存使用率"><a href="#页错误-内存使用率" class="headerlink" title="页错误 + 内存使用率"></a>页错误 + 内存使用率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -r -p 4256 1 3</span><br><span class="line">23时11分26秒       PID  minflt/s  majflt/s     VSZ    RSS   %MEM  Command</span><br><span class="line">23时11分27秒      4256   2132.00      0.00 22427892 5172756   7.84  java</span><br><span class="line">23时11分28秒      4256   1623.00      0.00 22427892 5172728   7.84  java</span><br><span class="line">23时11分29秒      4256   1942.00      0.00 22427892 5172728   7.84  java</span><br><span class="line">平均时间:      4256   1899.00      0.00 22427892 5172737   7.84  java</span><br></pre></td></tr></table></figure>
<ol>
<li>minflt&#x2F;s<ul>
<li>Total number of <strong>minor faults</strong> the task has made per second, those which have <strong>not required loading a memory page from disk</strong></li>
</ul>
</li>
<li>majflt&#x2F;s<ul>
<li>Total number of <strong>major faults</strong> the task has made per second, those which have <strong>required loading a memory page from disk</strong></li>
</ul>
</li>
<li>VSZ<ul>
<li>Virtual Size: The <strong>virtual memory</strong> usage of entire task in <strong>kilobytes</strong></li>
</ul>
</li>
<li>RSS<ul>
<li>Resident Set Size: The <strong>non-swapped physical memory</strong> used by the task in <strong>kilobytes</strong></li>
</ul>
</li>
</ol>
<h3 id="IO统计"><a href="#IO统计" class="headerlink" title="IO统计"></a>IO统计</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -d -p 4256 1 3</span><br><span class="line">23时24分59秒       PID   kB_rd/s   kB_wr/s kB_ccwr/s  Command</span><br><span class="line">23时25分00秒      4256      0.00    408.00      0.00  java</span><br><span class="line">23时25分01秒      4256      0.00    356.44      0.00  java</span><br><span class="line">23时25分02秒      4256      0.00    375.76      0.00  java</span><br><span class="line">平均时间:      4256      0.00    380.00      0.00  java</span><br></pre></td></tr></table></figure>
<ol>
<li>kB_rd&#x2F;s<ul>
<li>Number of <strong>kilobytes</strong> the task has caused to be <strong>read from disk</strong> per second</li>
</ul>
</li>
<li>kB_wr&#x2F;s<ul>
<li>Number of <strong>kilobytes</strong> the task has caused, or shall cause to be <strong>written to disk</strong> per second</li>
</ul>
</li>
<li>kB_ccwr&#x2F;s<ul>
<li>Number of <strong>kilobytes</strong> whose <strong>writing to disk</strong> has been <strong>cancelled</strong> by the task</li>
<li>This may occur when the task <strong>truncates some dirty pagecache</strong><ul>
<li>In this case, some IO which another task has been accounted for will <strong>not be happening</strong></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="进程上下文切换"><a href="#进程上下文切换" class="headerlink" title="进程上下文切换"></a>进程上下文切换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -w -p 4256 1 3</span><br><span class="line">22时54分33秒       PID   cswch/s nvcswch/s  Command</span><br><span class="line">22时54分34秒      4256      0.00      0.00  java</span><br><span class="line">22时54分35秒      4256      0.00      0.00  java</span><br><span class="line">22时54分36秒      4256      0.00      0.00  java</span><br><span class="line">平均时间:      4256      0.00      0.00  java</span><br></pre></td></tr></table></figure>
<ol>
<li>cswch&#x2F;s<ul>
<li>Total number of <strong>voluntary context switches</strong> the task made per second</li>
<li>A voluntary context switch occurs when a task blocks because it <strong>requires a resource that is unavailable</strong></li>
</ul>
</li>
<li>nvcswch&#x2F;s<ul>
<li>Total number of <strong>non voluntary context switches</strong> the task made per second</li>
<li>A involuntary context switch takes place when a task executes for the duration of its <strong>time slice</strong> and then is <strong>forced to relinquish</strong> the processor</li>
</ul>
</li>
</ol>
<h3 id="线程上下文切换"><a href="#线程上下文切换" class="headerlink" title="线程上下文切换"></a>线程上下文切换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -w -t -p 4256 | head -n 10</span><br><span class="line"></span><br><span class="line">23时32分03秒      TGID       TID   cswch/s nvcswch/s  Command</span><br><span class="line">23时32分03秒      4256         -      0.00      0.00  java</span><br><span class="line">23时32分03秒         -      4256      0.00      0.00  |__java</span><br><span class="line">23时32分03秒         -      4259      0.00      0.00  |__java</span><br><span class="line">23时32分03秒         -      4306      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4307      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4308      0.04      0.01  |__java</span><br><span class="line">23时32分03秒         -      4315      0.04      0.01  |__java</span><br></pre></td></tr></table></figure>

<h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -options</span><br><span class="line">-class</span><br><span class="line">-compiler</span><br><span class="line">-gc</span><br><span class="line">-gccapacity</span><br><span class="line">-gccause</span><br><span class="line">-gcnew</span><br><span class="line">-gcnewcapacity</span><br><span class="line">-gcold</span><br><span class="line">-gcoldcapacity</span><br><span class="line">-gcpermcapacity</span><br><span class="line">-gcutil</span><br><span class="line">-printcompilation</span><br></pre></td></tr></table></figure>
<ol>
<li>class<ul>
<li>显示<strong>类加载</strong>的相关信息</li>
</ul>
</li>
<li>compiler<ul>
<li>显示<strong>JIT编译</strong>的相关信息</li>
</ul>
</li>
<li>gc<ul>
<li>显示和GC相关的堆信息</li>
</ul>
</li>
<li>gccapacity<ul>
<li>显示各个代的容量以及使用情况</li>
</ul>
</li>
<li>gccause<ul>
<li>显示垃圾回收的相关信息，同时显示最后一次或当前正在发生的垃圾回收的诱因</li>
</ul>
</li>
<li>gcnew<ul>
<li>显示新生代信息</li>
</ul>
</li>
<li>gcnewcapacity<ul>
<li>显示新生代的大小和使用情况</li>
</ul>
</li>
<li>gcold<ul>
<li>显示老年代和永久代的信息</li>
</ul>
</li>
<li>gcoldcapacity<ul>
<li>显示老年代的大小</li>
</ul>
</li>
<li>gcpermcapacity<ul>
<li>显示永久代的大小</li>
</ul>
</li>
<li><em><strong>gcutil</strong></em><ul>
<li>显示垃圾收集信息</li>
</ul>
</li>
<li>printcompilation<ul>
<li>输出JIT编译的方法信息</li>
</ul>
</li>
</ol>
<h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><p>jstack可以查看<strong>线程堆栈</strong>的运行情况，可以结合<code>pidstat -t -p PID</code>来查看具体线程的<strong>状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /usr/local/java/bin/jstack -F 5850</span><br><span class="line">Thread 5853: (state = BLOCKED)</span><br><span class="line"> - java.lang.Object.wait(long) @bci=0 (Interpreted frame)</span><br><span class="line"> - java.lang.Object.wait() @bci=2, line=503 (Interpreted frame)</span><br><span class="line"> - xx.xx.xx.service.client.proxy.Provider.start() @bci=889, line=208 (Interpreted frame)</span><br><span class="line"> - xx.xx.xx.xx.xx.main(java.lang.String[]) @bci=368, line=90 (Interpreted frame)</span><br></pre></td></tr></table></figure>

<h2 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h2><p>可以通过<code>jamp -heap</code>查看堆内存的<strong>初始化配置信息</strong>以及堆内存的<strong>使用情况</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap 23594</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Garbage-First (G1) GC with 12 thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio = 40</span><br><span class="line">   MaxHeapFreeRatio = 70</span><br><span class="line">   MaxHeapSize      = 268435456 (256.0MB)</span><br><span class="line">   NewSize          = 1363144 (1.2999954223632812MB)</span><br><span class="line">   MaxNewSize       = 17592186044415 MB</span><br><span class="line">   OldSize          = 5452592 (5.1999969482421875MB)</span><br><span class="line">   NewRatio         = 2</span><br><span class="line">   SurvivorRatio    = 8</span><br><span class="line">   PermSize         = 134217728 (128.0MB)</span><br><span class="line">   MaxPermSize      = 134217728 (128.0MB)</span><br><span class="line">   G1HeapRegionSize = 4194304 (4.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">G1 Heap:</span><br><span class="line">   regions  = 64</span><br><span class="line">   capacity = 268435456 (256.0MB)</span><br><span class="line">   used     = 159804896 (152.40182495117188MB)</span><br><span class="line">   free     = 108630560 (103.59817504882812MB)</span><br><span class="line">   59.531962871551514% used</span><br><span class="line">G1 Young Generation:</span><br><span class="line">Eden Space:</span><br><span class="line">   regions  = 27</span><br><span class="line">   capacity = 163577856 (156.0MB)</span><br><span class="line">   used     = 113246208 (108.0MB)</span><br><span class="line">   free     = 50331648 (48.0MB)</span><br><span class="line">   69.23076923076923% used</span><br><span class="line">Survivor Space:</span><br><span class="line">   regions  = 1</span><br><span class="line">   capacity = 4194304 (4.0MB)</span><br><span class="line">   used     = 4194304 (4.0MB)</span><br><span class="line">   free     = 0 (0.0MB)</span><br><span class="line">   100.0% used</span><br><span class="line">G1 Old Generation:</span><br><span class="line">   regions  = 12</span><br><span class="line">   capacity = 100663296 (96.0MB)</span><br><span class="line">   used     = 42364384 (40.401824951171875MB)</span><br><span class="line">   free     = 58298912 (55.598175048828125MB)</span><br><span class="line">   42.08523432413737% used</span><br><span class="line">Perm Generation:</span><br><span class="line">   capacity = 134217728 (128.0MB)</span><br><span class="line">   used     = 43099600 (41.10298156738281MB)</span><br><span class="line">   free     = 91118128 (86.89701843261719MB)</span><br><span class="line">   32.11170434951782% used</span><br><span class="line"></span><br><span class="line">16133 interned Strings occupying 1421648 bytes.</span><br></pre></td></tr></table></figure>

<p>可以通过<code>jamp -histo[:live]</code>查看堆内存中的<strong>对象数目、大小统计直方图</strong>，live只统计<strong>存活对象</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -histo -F 23594 | head</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line">Iterating over heap. This may take a while...</span><br><span class="line">Object Histogram:</span><br><span class="line"></span><br><span class="line">num       #instances	#bytes	Class description</span><br><span class="line">--------------------------------------------------------------------------</span><br><span class="line">1:        9547	24873832	int[]</span><br><span class="line">2:        78517	11010880	* ConstMethodKlass</span><br><span class="line">3:        78517	10062240	* MethodKlass</span><br><span class="line">4:        7196	8222752	* ConstantPoolKlass</span><br><span class="line">5:        187123	7484920	java.util.HashMap$EntryIterator</span><br><span class="line">6:        43559	6833504	char[]</span><br><span class="line">Heap traversal took 33.612 seconds.</span><br></pre></td></tr></table></figure>

<p>可以通过<code>jmap -dump:format=b,file=/tmp/heap.hprof</code>把<strong>堆内存的使用情况</strong>dump到文件中，随后通过<strong>MAT</strong>工具进行分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -dump:format=b,file=/tmp/wall.hprof -F 23594</span><br><span class="line">Attaching to process ID 23594, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.65-b04</span><br><span class="line">Dumping heap to /tmp/wall.hprof ...</span><br><span class="line">Heap dump file created</span><br><span class="line"></span><br><span class="line">$ du -sh /tmp/wall.hprof</span><br><span class="line">231M    /tmp/wall.hprof</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100028001">Java性能调优实战</a></p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2019/09/04/java-performance-command-line-tool/">https://blog.zhongmingmao.top/2019/09/04/java-performance-command-line-tool/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">Java</a><a class="post-meta__tags" href="/tags/java-performance/">Java Performance</a></div><div class="post-share"><div class="social-share" data-image="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-14.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2019/09/05/java-performance-consistency/" title="Java性能 -- 并发一致性"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-7.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Java性能 -- 并发一致性</div></div><div class="info-2"><div class="info-item-1">背景在并发编程中，Java是通过共享内存来实现共享变量操作的，所以在多线程编程中会涉及到数据一致性的问题 1234567public class Example &#123;    int x = 0;    public void count() &#123;        x++;                    // 1        System.out.println(x)   // 2    &#125;&#125;     有两个线程分别执行count方法，x是共享变量 可能出现3种结果：**&lt;1,1&gt;**，&lt;2,1&gt;，&lt;1,2&gt;  Java内存模型    Java采用共享内存模型来实现多线程之间的信息交换和数据同步 程序运行时，局部变量将会存放在虚拟机栈中，而共享变量将会被保存在堆内存中 由于局部变量随线程的创建而创建，线程的销毁而销毁，Java栈数据并非线程共享，所以不需要关心数据的一致性 共享变量存储在堆内存或方法区中，堆内存和方法区的数据是线程共享的 堆内存中的共享变量在被不同线程操作时，会被加载到线程的工作内存中，即_CPU中的高速缓存_...</div></div></div></a><a class="pagination-related" href="/2019/09/03/kafka-commit-offset/" title="Kafka -- 提交位移"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-13.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Kafka -- 提交位移</div></div><div class="info-2"><div class="info-item-1">消费位移 Consumer的消费位移，记录了Consumer要消费的下一条消息的位移 假设一个分区中有10条消息，位移分别为0到9 某个Consumer消费了5条消息，实际消费了位移0到4的5条消息，此时Consumer的位移为5，指向下一条消息的位移   Consumer需要向Kafka汇报自己的位移数据，这个汇报过程就是提交位移 Consumer能够同时消费多个分区的数据，所以位移的提交实际上是在分区粒度上进行的 Consumer需要为分配给它的每个分区提交各自的位移数据   提交位移主要是为了表征Consumer的消费进度 当Consumer发生故障重启后，能够从Kafka中读取之前提交的位移值，然后从相应的位移处继续消费   位移提交的语义 如果提交了位移X，那么Kafka会认为位移值小于X的消息都已经被成功消费了      灵活 位移提交非常灵活，可以提交任何位移值，但要承担相应的后果 假设Consumer消费了位移为0~9的10条消息 如果提交的位移为20，位移位于10~19的消息可能会丢失 如果提交的位移为5，位移位于5~9的消息可能会被重复消费   位移提交的语义保障由应用程序保证，Ka...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2019/09/24/java-performance-high-performance-sql/" title="Java性能 -- 高性能SQL"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-3.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-24</div><div class="info-item-2">Java性能 -- 高性能SQL</div></div><div class="info-2"><div class="info-item-1">慢SQL诱因 无索引、索引失效 锁等待 InnoDB支持行锁，MyISAM支持表锁 InnoDB支持行锁更适合高并发场景，但行锁有可能会升级为表锁 一种情况是在批量更新时 行锁是基于索引加的锁，如果在更新操作时，条件索引失效，那么行锁会升级为表锁   基于表锁的数据库操作，会导致SQL阻塞等待，影响执行速度 在写大于读的情况下，不建议使用MyISAM   行锁相对于表锁，虽然粒度更细，并发能力提升，但也带来了新的问题，那就是死锁   不恰当的SQL SELECT * SELECT COUNT(*) 大表中使用LIMIT M,N 对非索引字段进行排序      SQL诊断EXPLAIN id：每个执行计划都有一个id，如果是一个联合查询，会有多个id select_type SIMPLE：普通查询，即没有联合查询、子查询 PRIMARY：主查询 UNION：UNION中后面的查询 SUBQUERY：子查询   table：当前执行计划查询的表，如果表有别名，则显示别名 partitions：分区表信息 type 从表中查询到行所执行的方式 由好到坏：_**system &gt; const &gt; eq...</div></div></div></a><a class="pagination-related" href="/2019/09/22/java-performance-producer-consumer/" title="Java性能 -- 生产者消费者模式 + 装饰器模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-22.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-22</div><div class="info-item-2">Java性能 -- 生产者消费者模式 + 装饰器模式</div></div><div class="info-2"><div class="info-item-1">生产者消费者模式实现方式Object的wait&#x2F;notify&#x2F;notifyAll 基于Object的wait&#x2F;notify&#x2F;notifyAll与对象监视器（Monitor）实现线程间的等待和通知 这种方式实现的生产者消费者模式是基于内核实现的，可能会导致大量的上下文切换，性能不是最理想的    Lock中Condition的await&#x2F;signal&#x2F;signalAll 相对于Object的wait&#x2F;notify&#x2F;notifyAll，更推荐JUC包提供的Lock &amp;&amp; Condition实现的生产者消费者模式 Lock &amp;&amp; Condition实现的生产者消费者模式，是基于Java代码层实现的，在性能和扩展性方面更有优势  BlockingQueue 简单明了  限流算法漏桶算法通过限制容量池大小来控制流量，而令牌桶算法则通过限制发放令牌的速率来控制流量 漏桶算法 请求如果要进入业务层，就必须经过漏桶，而漏桶出口的请求速率是均衡的 如果漏桶已经满了，请求将会溢出，不会因为入口的请求量突然增加而导...</div></div></div></a><a class="pagination-related" href="/2019/09/21/java-performance-concurrent-design-pattern/" title="Java性能 -- 并发设计模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-24.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-21</div><div class="info-item-2">Java性能 -- 并发设计模式</div></div><div class="info-2"><div class="info-item-1">线程上下文模式 线程上下文指的是贯穿线程整个生命周期的对象中的一些全局信息，如Spring中的ApplicationContext 可以使用ThreadLocal实现上下文 ThreadLocal是线程本地变量，可以实现多线程的数据隔离，每个线程只能访问各自内部的副本变量      Thread-Per-Message模式 一个消息一个线程 在Socket通信中，一个线程监听IO事件，每当监听到一个IO事件，就交给另一个处理线程执行IO操作   如果遇到高并发，就会出现严重的性能问题，因为线程在操作系统中也是昂贵的资源，不能无限制地创建 如果针对每个IO请求都创建一个线程来处理，在有大量请求同时进来时，就会创建大量线程 每次请求都需要创建和销毁线程，性能开销很大   可以使用线程池来代替线程的创建和销毁  ServerHandler1234567891011121314151617181920212223242526272829303132333435363738@AllArgsConstructorpublic class ServerHandler implements Runnable &#123...</div></div></div></a><a class="pagination-related" href="/2019/09/19/java-performance-prototype-flyweight/" title="Java性能 -- 原型模式 + 享元模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-19</div><div class="info-item-2">Java性能 -- 原型模式 + 享元模式</div></div><div class="info-2"><div class="info-item-1">原型模式 原型模式：通过给出一个原型对象来指明所创建的对象的类型，然后使用自身实现的克隆接口来复制这个原型对象 使用这种方式创新的对象的话，就无需再通过new实例化来创建对象了 Object类的clone方法是一个Native方法，可以直接操作内存中的二进制流，所以相对new实例化来说，性能更佳      实现原型模式12345678910111213141516171819202122232425262728class Prototype implements Cloneable &#123;    @Override    public Prototype clone() &#123;        Prototype prototype = null;        try &#123;            prototype = (Prototype) super.clone();        &#125; catch (CloneNotSupportedException e) &#123;            e.printStackTrace();        &#125;    ...</div></div></div></a><a class="pagination-related" href="/2019/09/17/java-performance-singleton/" title="Java性能 -- 单例模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-8.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-17</div><div class="info-item-2">Java性能 -- 单例模式</div></div><div class="info-2"><div class="info-item-1">饿汉模式class1234567891011// 饿汉模式public final class Singleton &#123;    private static Singleton instance = new Singleton();    private Singleton() &#123;    &#125;    public static Singleton getInstance() &#123;        return instance;    &#125;&#125;     使用了static修饰了成员变量instance，所以该变量会在类初始化的过程中被收集进_类构造器&lt;clinit&gt;_ 在多线程场景下，JVM会保证只有一个线程能够执行该类的&lt;clinit&gt;方法，其它线程将会被阻塞等待 等到唯一的一次&lt;clinit&gt;方法执行完成后，其它线程将不会再执行&lt;clinit&gt;方法，转而执行自己的代码 因此，static修饰的成员变量instance，在多线程的情况下能保证只实例化一次   在类初始化阶段就已经在堆内存中开辟了一块内存，用...</div></div></div></a><a class="pagination-related" href="/2019/09/13/java-performance-jvm-heap-allocation/" title="Java性能 -- JVM堆内存分配"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/go-8.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-13</div><div class="info-item-2">Java性能 -- JVM堆内存分配</div></div><div class="info-2"><div class="info-item-1">JVM内存分配性能问题 JVM内存分配不合理最直接的表现就是频繁的GC，这会导致上下文切换，从而降低系统的吞吐量，增加系统的响应时间  对象在堆中的生命周期 在JVM内存模型的堆中，堆被划分为新生代和老年代 新生代又被进一步划分为Eden区和Survivor区，Survivor区由From Survivor和To Survivor组成   当创建一个对象时，对象会被优先分配到新生代的Eden区 此时JVM会给对象定义一个对象年轻计数器（-XX:MaxTenuringThreshold）   当Eden空间不足时，JVM将执行新生代的垃圾回收（Minor GC） JVM会把存活的对象转移到Survivor中，并且对象年龄+1 对象在Survivor中同样也会经历Minor GC，每经历一次Minor GC，对象年龄都会+1   如果分配的对象超过了-XX:PetenureSizeThreshold，对象会直接被分配到老年代    查看JVM堆内存分配 在默认不配置JVM堆内存大小的情况下，JVM根据默认值来配置当前内存大小 在JDK 1.7中，默认情况下新生代和老年代的比例是1:2，可以通过–XX:New...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">642</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#free"><span class="toc-number">1.</span> <span class="toc-text">free</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#top"><span class="toc-number">2.</span> <span class="toc-text">top</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vmstat"><span class="toc-number">3.</span> <span class="toc-text">vmstat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pidstat"><span class="toc-number">4.</span> <span class="toc-text">pidstat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-number">4.1.</span> <span class="toc-text">CPU使用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%94%99%E8%AF%AF-%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-number">4.2.</span> <span class="toc-text">页错误 + 内存使用率</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IO%E7%BB%9F%E8%AE%A1"><span class="toc-number">4.3.</span> <span class="toc-text">IO统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2"><span class="toc-number">4.4.</span> <span class="toc-text">进程上下文切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2"><span class="toc-number">4.5.</span> <span class="toc-text">线程上下文切换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jstat"><span class="toc-number">5.</span> <span class="toc-text">jstat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jstack"><span class="toc-number">6.</span> <span class="toc-text">jstack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jmap"><span class="toc-number">7.</span> <span class="toc-text">jmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-server.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Server V1"/></a><div class="content"><a class="title" href="/2025/01/24/cloud-native-observability-prometheus-server-v1/" title="Observability - Prometheus Server V1">Observability - Prometheus Server V1</a><time datetime="2025-01-23T16:06:25.000Z" title="Created 2025-01-24 00:06:25">2025-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus-concepts.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Concepts"/></a><div class="content"><a class="title" href="/2025/01/23/cloud-native-observability-prometheus-concepts/" title="Observability - Prometheus Concepts">Observability - Prometheus Concepts</a><time datetime="2025-01-22T16:06:25.000Z" title="Created 2025-01-23 00:06:25">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>