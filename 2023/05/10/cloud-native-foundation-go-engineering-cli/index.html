<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Go Engineering - CLI | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="应用框架 命令行参数解析 - Pflag 配置文件解析 - Viper 应用的命令行框架 - Cobra 命令需要具备 help 功能 命令需要能够解析命令行参数和配置文件 命令需要能够初始化业务代码，并最终启动业务进程">
<meta property="og:type" content="article">
<meta property="og:title" content="Go Engineering - CLI">
<meta property="og:url" content="https://blog.zhongmingmao.top/2023/05/10/cloud-native-foundation-go-engineering-cli/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="应用框架 命令行参数解析 - Pflag 配置文件解析 - Viper 应用的命令行框架 - Cobra 命令需要具备 help 功能 命令需要能够解析命令行参数和配置文件 命令需要能够初始化业务代码，并最终启动业务进程">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-framework.png">
<meta property="article:published_time" content="2023-05-09T16:06:25.000Z">
<meta property="article:modified_time" content="2024-06-17T13:40:02.314Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Cloud Native">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="Go Engineering">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-framework.png"><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2023/05/10/cloud-native-foundation-go-engineering-cli/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: {"limitDay":512,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":256},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go Engineering - CLI',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-17 21:40:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">590</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">183</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">75</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-framework.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ByteCoding"><span class="site-name">ByteCoding</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Go Engineering - CLI</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-05-09T16:06:25.000Z" title="Created 2023-05-10 00:06:25">2023-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/">Cloud Native</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/">Cloud Native Foundation</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud-native/cloud-native-foundation/go-engineering/">Go Engineering</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">4.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>22min</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="应用框架"><a href="#应用框架" class="headerlink" title="应用框架"></a>应用框架</h1><ol>
<li>命令行参数解析 - <code>Pflag</code></li>
<li>配置文件解析 - <code>Viper</code></li>
<li>应用的命令行框架 - <code>Cobra</code><ul>
<li>命令需要具备 help 功能</li>
<li>命令需要能够解析命令行参数和配置文件</li>
<li>命令需要能够初始化业务代码，并最终启动业务进程</li>
</ul>
</li>
</ol>
<span id="more"></span>

<h1 id="Pflag"><a href="#Pflag" class="headerlink" title="Pflag"></a>Pflag</h1><blockquote>
<p>命令行参数解析工具 - Kubernetes &#x2F; Istio &#x2F; Helm &#x2F; Docker &#x2F; Etcd &#x2F; …</p>
</blockquote>
<h2 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h2><blockquote>
<p>一个命令行参数会被解析成一个 Flag 类型的变量</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A Flag represents the state of a flag.</span></span><br><span class="line"><span class="keyword">type</span> Flag <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name                <span class="type">string</span>              <span class="comment">// name as it appears on command line</span></span><br><span class="line">    Shorthand           <span class="type">string</span>              <span class="comment">// one-letter abbreviated flag</span></span><br><span class="line">    Usage               <span class="type">string</span>              <span class="comment">// help message</span></span><br><span class="line">    Value               Value               <span class="comment">// value as set</span></span><br><span class="line">    DefValue            <span class="type">string</span>              <span class="comment">// default value (as text); for usage message</span></span><br><span class="line">    Changed             <span class="type">bool</span>                <span class="comment">// If the user set the value (or if left to default)</span></span><br><span class="line">    NoOptDefVal         <span class="type">string</span>              <span class="comment">// default value (as text); if the flag is on the command line without any options</span></span><br><span class="line">    Deprecated          <span class="type">string</span>              <span class="comment">// If this flag is deprecated, this string is the new or now thing to use</span></span><br><span class="line">    Hidden              <span class="type">bool</span>                <span class="comment">// used by cobra.Command to allow flags to be hidden from help/usage text</span></span><br><span class="line">    ShorthandDeprecated <span class="type">string</span>              <span class="comment">// If the shorthand of this flag is deprecated, this string is the new or now thing to use</span></span><br><span class="line">    Annotations         <span class="keyword">map</span>[<span class="type">string</span>][]<span class="type">string</span> <span class="comment">// used by cobra.Command bash autocomple code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将 Flag 的值抽象成一个 interface 接口，可以自定义 Flag 类型</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Value is the interface to the dynamic value stored in a flag.</span></span><br><span class="line"><span class="comment">// (The default value is represented as a string.)</span></span><br><span class="line"><span class="keyword">type</span> Value <span class="keyword">interface</span> &#123;</span><br><span class="line">    String() <span class="type">string</span>    <span class="comment">// 将 Flag 类型的值转换为 string 类型的值，并返回 string 的内容</span></span><br><span class="line">    Set(<span class="type">string</span>) <span class="type">error</span>  <span class="comment">// 将 string 类型的值转换为 Flag 类型的值，转换失败报错</span></span><br><span class="line">    Type() <span class="type">string</span>      <span class="comment">// 返回 Flag 的类型，如 string、int 等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FlagSet"><a href="#FlagSet" class="headerlink" title="FlagSet"></a>FlagSet</h2><blockquote>
<p>预先定义好的 Flag 的集合</p>
</blockquote>
<ol>
<li>调用 <code>NewFlagSet</code> 创建一个 FlagSet</li>
<li>使用 Pflag 包定义的全局 FlagSet - <code>CommandLine</code><ul>
<li>CommandLine 也是由 NewFlagSet 函数创建</li>
</ul>
</li>
</ol>
<h3 id="NewFlagSet"><a href="#NewFlagSet" class="headerlink" title="NewFlagSet"></a>NewFlagSet</h3><blockquote>
<p>通过定义一个新的 FlagSet 来定义<code>命令</code>及其<code>子命令</code>的 Flag</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    flags := pflag.NewFlagSet(<span class="string">&quot;test&quot;</span>, pflag.ContinueOnError)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> version <span class="type">string</span></span><br><span class="line">    flags.StringVar(&amp;version, <span class="string">&quot;version&quot;</span>, <span class="string">&quot;v1.0.0&quot;</span>, <span class="string">&quot;Print version information and quit.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    err := flags.Parse(os.Args[<span class="number">1</span>:])</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;version: %+v\n&quot;</span>, version)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --version v1.0.1</span><br><span class="line">version: v1.0.1</span><br></pre></td></tr></table></figure>

<h3 id="CommandLine"><a href="#CommandLine" class="headerlink" title="CommandLine"></a>CommandLine</h3><blockquote>
<p>使用全局 FlagSet</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> version <span class="type">string</span></span><br><span class="line">    pflag.StringVar(&amp;version, <span class="string">&quot;version&quot;</span>, <span class="string">&quot;v1.0.0&quot;</span>, <span class="string">&quot;Print version information and quit.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;version: %+v\n&quot;</span>, version)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --version v1.0.2</span><br><span class="line">version: v1.0.2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CommandLine 是一个<code>包级别</code>的变量</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StringVar defines a string flag with specified name, default value, and usage string.</span></span><br><span class="line"><span class="comment">// The argument p points to a string variable in which to store the value of the flag.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StringVar</span><span class="params">(p *<span class="type">string</span>, name <span class="type">string</span>, value <span class="type">string</span>, usage <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    CommandLine.VarP(newStringValue(value, p), name, <span class="string">&quot;&quot;</span>, usage)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommandLine is the default set of command-line flags, parsed from os.Args.</span></span><br><span class="line"><span class="keyword">var</span> CommandLine = NewFlagSet(os.Args[<span class="number">0</span>], ExitOnError)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果不需要定义<code>子命令</code>，可以直接使用 <code>CommandLine</code></p>
</blockquote>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="参数定义"><a href="#参数定义" class="headerlink" title="参数定义"></a>参数定义</h3><ol>
<li>函数名带 <code>Var</code> 将标志的值绑定到<code>变量</code>，否则将标志的值存储到<code>指针</code>中</li>
<li>函数名带 <code>P</code> 说明支持<code>短选项</code>，否则不支持短选项</li>
</ol>
<blockquote>
<p>支持长选项、默认值和使用文本，并将标志的值存储在指针中</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := pflag.String(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Input Your Name&quot;</span>)</span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;type: &quot;</span>, reflect.TypeOf(name).String()) <span class="comment">// *string</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;Hello, &quot;</span>, *name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --name string   Input Your Name (default &quot;zhongmingmao&quot;)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main --name go</span><br><span class="line">type:  *string</span><br><span class="line">Hello,  go</span><br></pre></td></tr></table></figure>

<blockquote>
<p>支持长选项、短选项、默认值和使用文本，并将标志的值存储在指针中</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := pflag.StringP(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Input Your Name&quot;</span>)</span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;type: &quot;</span>, reflect.TypeOf(name).String()) <span class="comment">// *string</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;Hello, &quot;</span>, *name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">  -n, --name string   Input Your Name (default &quot;zhongmingmao&quot;)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main -n rust</span><br><span class="line">type:  *string</span><br><span class="line">Hello,  rust</span><br><span class="line"></span><br><span class="line">$ ./main --name go</span><br><span class="line">type:  *string</span><br><span class="line">Hello,  go</span><br></pre></td></tr></table></figure>

<blockquote>
<p>支持长选项、默认值和使用文本，并将标志的值绑定到变量</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">    pflag.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Input Your Name&quot;</span>)</span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;type: &quot;</span>, reflect.TypeOf(name).String()) <span class="comment">// string</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;Hello, &quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --name string   Input Your Name (default &quot;zhongmingmao&quot;)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main --name rust</span><br><span class="line">type:  string</span><br><span class="line">Hello,  rust</span><br></pre></td></tr></table></figure>

<blockquote>
<p>支持长选项、短选项、默认值和使用文本，并将标志的值绑定到变量</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">    pflag.StringVarP(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Input Your Name&quot;</span>)</span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;type: &quot;</span>, reflect.TypeOf(name).String()) <span class="comment">// string</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;Hello, &quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">  -n, --name string   Input Your Name (default &quot;zhongmingmao&quot;)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main -n rust</span><br><span class="line">type:  string</span><br><span class="line">Hello,  rust</span><br><span class="line"></span><br><span class="line">$ ./main --name go</span><br><span class="line">type:  string</span><br><span class="line">Hello,  go</span><br></pre></td></tr></table></figure>

<h3 id="Get"><a href="#Get" class="headerlink" title="Get&lt;Type&gt;"></a><code>Get&lt;Type&gt;</code></h3><blockquote>
<p>参数<code>存在</code> + 类型<code>匹配</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f := pflag.CommandLine</span><br><span class="line">    ageA := f.Int(<span class="string">&quot;age&quot;</span>, <span class="number">10</span>, <span class="string">&quot;age of the person&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    ageB, err := f.GetInt(<span class="string">&quot;age&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>(err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;ageA type: &quot;</span>, reflect.TypeOf(ageA).String()) <span class="comment">// *int</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;ageA value: &quot;</span>, *ageA)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;ageB type: &quot;</span>, reflect.TypeOf(ageB).String()) <span class="comment">// int</span></span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;ageB value: &quot;</span>, ageB)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --age int   age of the person (default 10)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main</span><br><span class="line">ageA type:  *int</span><br><span class="line">ageA value:  10</span><br><span class="line">ageB type:  int</span><br><span class="line">ageB value:  10</span><br><span class="line"></span><br><span class="line">$ ./main --age 11</span><br><span class="line">ageA type:  *int</span><br><span class="line">ageA value:  11</span><br><span class="line">ageB type:  int</span><br><span class="line">ageB value:  11</span><br><span class="line"></span><br><span class="line">$ ./main --age 11.0</span><br><span class="line">invalid argument &quot;11.0&quot; for &quot;--age&quot; flag: strconv.ParseInt: parsing &quot;11.0&quot;: invalid syntax</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --age int   age of the person (default 10)</span><br><span class="line">invalid argument &quot;11.0&quot; for &quot;--age&quot; flag: strconv.ParseInt: parsing &quot;11.0&quot;: invalid syntax</span><br><span class="line"></span><br><span class="line">$ echo $?</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h3 id="非选项参数"><a href="#非选项参数" class="headerlink" title="非选项参数"></a>非选项参数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := pflag.String(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;help message for name&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;args count: %d\n&quot;</span>, pflag.NArg())</span><br><span class="line">    fmt.Printf(<span class="string">&quot;args values: %s\n&quot;</span>, pflag.Args())</span><br><span class="line">    fmt.Printf(<span class="string">&quot;first arg: %s\n&quot;</span>, pflag.Arg(<span class="number">0</span>))</span><br><span class="line">    </span><br><span class="line">    fmt.Printf(<span class="string">&quot;name: %s\n&quot;</span>, *name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --name string   help message for name (default &quot;zhongmingmao&quot;)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main</span><br><span class="line">args count: 0</span><br><span class="line">args values: []</span><br><span class="line">first arg: </span><br><span class="line">name: zhongmingmao</span><br><span class="line"></span><br><span class="line">$ ./main --name rust</span><br><span class="line">args count: 0</span><br><span class="line">args values: []</span><br><span class="line">first arg: </span><br><span class="line">name: rust</span><br><span class="line"></span><br><span class="line">$ ./main --name rust go java</span><br><span class="line">args count: 2</span><br><span class="line">args values: [go java]</span><br><span class="line">first arg: go</span><br><span class="line">name: rust</span><br></pre></td></tr></table></figure>

<h3 id="未指定选项值"><a href="#未指定选项值" class="headerlink" title="未指定选项值"></a>未指定选项值</h3><blockquote>
<p>如果一个 Flag 具有 <code>NoOptDefVal</code>，该 Flag 在命令行上没有设置该 Flag 的值，则设置为 NoOptDefVal</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    age := pflag.IntP(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">10</span>, <span class="string">&quot;Age&quot;</span>)</span><br><span class="line">    pflag.Lookup(<span class="string">&quot;age&quot;</span>).NoOptDefVal = <span class="string">&quot;20&quot;</span></span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;age: %d\n&quot;</span>, *age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">  -a, --age int[=20]   Age (default 10)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main</span><br><span class="line">age: 10</span><br><span class="line"></span><br><span class="line">$ ./main --age</span><br><span class="line">age: 20</span><br><span class="line"></span><br><span class="line">$ ./main --age=21</span><br><span class="line">age: 21</span><br></pre></td></tr></table></figure>

<h3 id="弃用标志"><a href="#弃用标志" class="headerlink" title="弃用标志"></a>弃用标志</h3><ol>
<li>弃用的标志或者标志的简写在帮助文本中会被隐藏</li>
<li>在使用不推荐的标志和简写时打印正确的用法提示</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    pflag.StringP(<span class="string">&quot;logmode&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;std&quot;</span>, <span class="string">&quot;Log mode&quot;</span>)</span><br><span class="line">    err := pflag.CommandLine.MarkDeprecated(<span class="string">&quot;logmode&quot;</span>, <span class="string">&quot;please use --log-mode instead&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main --logmode std</span><br><span class="line">Flag --logmode has been deprecated, please use --log-mode instead</span><br><span class="line"></span><br><span class="line">$ ./main -l std</span><br><span class="line">Flag --logmode has been deprecated, please use --log-mode instead</span><br></pre></td></tr></table></figure>

<h3 id="弃用简写"><a href="#弃用简写" class="headerlink" title="弃用简写"></a>弃用简写</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> port <span class="type">int</span></span><br><span class="line">    pflag.IntVarP(&amp;port, <span class="string">&quot;port&quot;</span>, <span class="string">&quot;P&quot;</span>, <span class="number">3306</span>, <span class="string">&quot;MySQL service host port.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    err := pflag.CommandLine.MarkShorthandDeprecated(<span class="string">&quot;port&quot;</span>, <span class="string">&quot;please use --port only&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;port: %d\n&quot;</span>, port)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">      --port int   MySQL service host port. (default 3306)</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main --port 3307</span><br><span class="line">port: 3307</span><br><span class="line"></span><br><span class="line">$ ./main -P 3308</span><br><span class="line">Flag shorthand -P has been deprecated, please use --port only</span><br><span class="line">port: 3308</span><br></pre></td></tr></table></figure>

<h3 id="隐藏标志"><a href="#隐藏标志" class="headerlink" title="隐藏标志"></a>隐藏标志</h3><blockquote>
<p>标记仍然能正常运行，但不会显示在帮助文本中 - 只在内部使用</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/spf13/pflag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> secret <span class="type">string</span></span><br><span class="line">    pflag.StringVarP(&amp;secret, <span class="string">&quot;secret&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;12345678&quot;</span>, <span class="string">&quot;MySQL service host secret.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    err := pflag.CommandLine.MarkHidden(<span class="string">&quot;secret&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    fmt.Printf(<span class="string">&quot;secret: %s\n&quot;</span>, secret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">pflag: help requested</span><br><span class="line"></span><br><span class="line">$ ./main</span><br><span class="line">secret: 12345678</span><br><span class="line"></span><br><span class="line">$ ./main --secret 1234</span><br><span class="line">secret: 1234</span><br><span class="line"></span><br><span class="line">$ ./main -S 4321</span><br><span class="line">secret: 4321</span><br></pre></td></tr></table></figure>

<h1 id="Viper"><a href="#Viper" class="headerlink" title="Viper"></a>Viper</h1><blockquote>
<p>Viper 配置键<code>不区分大小写</code></p>
</blockquote>
<h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><ol>
<li>通过 <code>viper.Set</code> 函数<code>显式设置</code>的配置</li>
<li>命令行参数</li>
<li>环境变量</li>
<li>配置文件</li>
<li>远程 KV 存储</li>
<li>默认值</li>
</ol>
<h2 id="读入配置"><a href="#读入配置" class="headerlink" title="读入配置"></a>读入配置</h2><blockquote>
<p>将配置读入到 Viper 中</p>
</blockquote>
<ol>
<li>设置默认的配置文件名</li>
<li>读取配置文件</li>
<li>监听和重新读取配置文件</li>
<li>从 io.Reader 读取配置</li>
<li>从环境变量读取</li>
<li>从命令行标志读取</li>
<li>从远程 KV 存储读取</li>
</ol>
<h3 id="设置默认值"><a href="#设置默认值" class="headerlink" title="设置默认值"></a>设置默认值</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    viper.SetDefault(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%+v\n&quot;</span>, viper.Get(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="读取配置文件"><a href="#读取配置文件" class="headerlink" title="读取配置文件"></a>读取配置文件</h3><ol>
<li>JSON &#x2F; TOML &#x2F; YAML &#x2F; YML &#x2F; Properties &#x2F; Props &#x2F; Prop &#x2F; HCL &#x2F; Dotenv &#x2F; Env</li>
<li>Viper 支持搜索多个路径，默认不配置任何搜索路径</li>
</ol>
<blockquote>
<p>使用 Viper 搜索和读取配置，Viper 会根据添加的路径<code>顺序</code>搜索配置文件，如果找到则停止</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    config = pflag.StringP(<span class="string">&quot;config&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Configuration file.&quot;</span>)</span><br><span class="line">    help   = pflag.BoolP(<span class="string">&quot;help&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;Show this help message.&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    pflag.Parse()</span><br><span class="line">    <span class="keyword">if</span> *help &#123;</span><br><span class="line">        pflag.Usage()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从配置文件中读取配置</span></span><br><span class="line">    <span class="keyword">if</span> *config != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        viper.SetConfigFile(*config) <span class="comment">// 指定配置文件名</span></span><br><span class="line">        viper.SetConfigType(<span class="string">&quot;yaml&quot;</span>)  <span class="comment">// 如果配置文件名中没有文件扩展名，则需要指定配置文件的格式，告诉viper以何种格式解析文件</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)      <span class="comment">// 把当前目录加入到配置文件的搜索路径中</span></span><br><span class="line">        viper.AddConfigPath(<span class="string">&quot;$HOME/&quot;</span>) <span class="comment">// 配置文件搜索路径，可以设置多个配置文件搜索路径</span></span><br><span class="line">        viper.SetConfigName(<span class="string">&quot;config&quot;</span>) <span class="comment">// 配置文件名称（没有文件扩展名，尝试搜索所有支持的扩展类型）</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123; <span class="comment">// 读取配置文件。如果指定了配置文件名，则使用指定的配置文件，否则在注册的搜索路径中搜索</span></span><br><span class="line">        <span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;Fatal error config file: %s \n&quot;</span>, err))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;Used configuration file is: %s\n&quot;</span>, viper.ConfigFileUsed())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ./main --help</span><br><span class="line">Usage of ./main:</span><br><span class="line">  -c, --config string   Configuration file.</span><br><span class="line">  -h, --help            Show this help message.</span><br><span class="line">  </span><br><span class="line">$ ./main -c config.yaml</span><br><span class="line">Used configuration file is: config.yaml</span><br><span class="line"></span><br><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── config</span><br><span class="line">├── config.yaml</span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── main</span><br><span class="line">└── main.go</span><br><span class="line"></span><br><span class="line">$ ./main</span><br><span class="line">Used configuration file is: /Users/zhongmingmao/workspace/go/src/github.com/zhongmingmao/go101/config.yaml</span><br></pre></td></tr></table></figure>

<h3 id="监听和重新读取配置文件"><a href="#监听和重新读取配置文件" class="headerlink" title="监听和重新读取配置文件"></a>监听和重新读取配置文件</h3><blockquote>
<p><code>热加载</code>（不推荐使用） - 在调用 <code>WatchConfig</code> 函数之前，需要确保已经添加了配置文件的<code>搜索路径</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">viper.WatchConfig()</span><br><span class="line">viper.OnConfigChange(<span class="function"><span class="keyword">func</span><span class="params">(e fsnotify.Event)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;Config file changed: &quot;</span>, e.Name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="设置配置值"><a href="#设置配置值" class="headerlink" title="设置配置值"></a>设置配置值</h3><blockquote>
<p>显式设置</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viper.Set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="使用环境变量"><a href="#使用环境变量" class="headerlink" title="使用环境变量"></a>使用环境变量</h3><ol>
<li>相关函数<ul>
<li>AutomaticEnv()</li>
<li>BindEnv(input …string) error</li>
<li>SetEnvPrefix(in string)</li>
<li>SetEnvKeyReplacer(r *strings.Replacer)</li>
<li>AllowEmptyEnv(allowEmptyEnv bool)</li>
</ul>
</li>
<li>Viper 读取环境变量是<code>区分大小写</code>的</li>
<li>SetEnvPrefix<ul>
<li>viper.SetEnvPrefix(“VIPER”) + viper.Get(“apiversion”)</li>
<li>实际读取的环境变量为 VIPER_APIVERSION</li>
</ul>
</li>
<li>BindEnv 需要 1 个和或 2 个参数<ul>
<li>第一个参数为<code>键名</code>，第二个参数为<code>环境变量名称</code> - 区分<code>大小写</code></li>
<li>如果未提供环境变量名称，则自动推断为 <code>环境变量前缀_键名全大写</code></li>
<li>当显式提供环境变量名称时，不会自动添加前缀</li>
<li>每次访问都将读取环境变量，在调用 BindEnv 时<code>不固定</code>该值</li>
</ul>
</li>
<li>SetEnvKeyReplacer<ul>
<li>使用 strings.Replacer 对象来重写 Env 键</li>
</ul>
</li>
<li>默认情况下，<code>空环境变量</code>会被认为<code>未设置</code> - AllowEmptyEnv</li>
</ol>
<blockquote>
<p>SetEnvKeyReplacer</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USER_SECRET_KEY</span></span><br><span class="line">viper.SetEnvKeyReplacer(strings.NewReplacer(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;_&quot;</span>))</span><br><span class="line">viper.Get(<span class="string">&quot;user.secret-key&quot;</span>) <span class="comment">// user.secret-key -&gt; user_secret_key -&gt; USER_SECRET_KEY</span></span><br></pre></td></tr></table></figure>

<h3 id="使用标志"><a href="#使用标志" class="headerlink" title="使用标志"></a>使用标志</h3><ol>
<li>Viper 支持 Pflag，将 key 绑定到 Flag</li>
<li>与 BindEnv 类似，只在<code>访问时设置</code></li>
</ol>
<blockquote>
<p>单个标志</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := pflag.String(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line"></span><br><span class="line">    err := viper.BindPFlag(<span class="string">&quot;name&quot;</span>, pflag.Lookup(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    nameFromViper := viper.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    fmt.Println(*name == nameFromViper) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一组标志</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    name := pflag.String(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhongmingmao&quot;</span>, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line"></span><br><span class="line">    err := viper.BindPFlags(pflag.CommandLine)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pflag.Parse()</span><br><span class="line">    nameFromViper := viper.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    fmt.Println(*name == nameFromViper) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="读取配置"><a href="#读取配置" class="headerlink" title="读取配置"></a>读取配置</h2><blockquote>
<p>每一个 Get 方法在找不到值的时候都会返回<code>类型零值</code></p>
</blockquote>
<ol>
<li>Get(key string) interface{}</li>
<li><code>Get&lt;Type&gt;(key string) &lt;Type&gt;</code></li>
<li>AllSettings() map[string]interface{}</li>
<li>IsSet(key string) : bool</li>
</ol>
<h3 id="访问嵌套键"><a href="#访问嵌套键" class="headerlink" title="访问嵌套键"></a>访问嵌套键</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">5799</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datastore&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;metric&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">3099</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;warehouse&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;198.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2112</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    host := viper.GetString(<span class="string">&quot;datastore.metric.host&quot;</span>)</span><br><span class="line">    fmt.Println(host) <span class="comment">// 127.0.0.1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果 datastore.metric 被直接赋值覆盖，则 datastore.metric 下所有子键都将变成未定义状态</span></span><br><span class="line">    viper.Set(<span class="string">&quot;datastore.metric&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">    host = viper.GetString(<span class="string">&quot;datastore.metric.host&quot;</span>)</span><br><span class="line">    fmt.Println(host == <span class="string">&quot;&quot;</span>) <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果存在与分隔的键路径匹配的键，则直接返回其值</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;datastore.metric.host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">5799</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;datastore&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;metric&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">3099</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;warehouse&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;198.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">2112</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    host := viper.GetString(<span class="string">&quot;datastore.metric.host&quot;</span>)</span><br><span class="line">    fmt.Println(host) <span class="comment">// 0.0.0.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><blockquote>
<p>将<code>所有</code>或者<code>特定</code>的值解析到 <code>struct</code> or<code>map</code> 等</p>
</blockquote>
<ol>
<li>Unmarshal(rawVal interface{}) error</li>
<li>UnmarshalKey(key string, rawVal interface{}) error</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;Port&quot;</span><span class="punctuation">:</span> <span class="number">3306</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MySQL&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;path_map&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/mysql&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> c config</span><br><span class="line">    err := viper.Unmarshal(&amp;c)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%+v\n&quot;</span>, c) <span class="comment">// &#123;Port:3306 Name:MySQL PathMap:/usr/mysql&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><blockquote>
<p>将 Viper 中保存的所有设置序列化成一个字符串</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;config&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    c := viper.AllSettings()</span><br><span class="line">    bytes, err := yaml.Marshal(c)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%+v\n&quot;</span>, <span class="type">string</span>(bytes))</span><br><span class="line">    <span class="comment">// name: MySQL</span></span><br><span class="line">    <span class="comment">// path_map: /usr/mysql</span></span><br><span class="line">    <span class="comment">// port: 3306</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cobra"><a href="#Cobra" class="headerlink" title="Cobra"></a>Cobra</h1><blockquote>
<p>创建 CLI + 生成应用和命令文件</p>
</blockquote>
<table>
<thead>
<tr>
<th>Component</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Command</td>
<td>命令</td>
</tr>
<tr>
<td>Argument</td>
<td>非选项参数</td>
</tr>
<tr>
<td>Flag</td>
<td>选项参数 - 标志</td>
</tr>
</tbody></table>
<blockquote>
<p><code>APPNAME COMMAND ARG --FLAG</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone URL --bare # clone 是一个命令，URL 是一个非选项参数，bare 是一个选项参数</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建命令的 2 种方式</p>
</blockquote>
<table>
<thead>
<tr>
<th>Method</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Cobra 命令</td>
<td>生成一个 Command 命令模板（可以引用 Cobra 库来构建命令）</td>
</tr>
<tr>
<td>Cobra 库</td>
<td></td>
</tr>
</tbody></table>
<h2 id="Cobra-库"><a href="#Cobra-库" class="headerlink" title="Cobra 库"></a>Cobra 库</h2><h3 id="cmd-root-go"><a href="#cmd-root-go" class="headerlink" title="cmd&#x2F;root.go"></a>cmd&#x2F;root.go</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;hugo&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;Hugo is a very fast static site generator&quot;</span>,</span><br><span class="line">    Long: <span class="string">`A Fast and Flexible Static Site Generator built with </span></span><br><span class="line"><span class="string">  love by spf13 and friends in Go. </span></span><br><span class="line"><span class="string">  Complete documentation is available at http://hugo.spf13.com`</span>,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// Do Stuff Here</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 <code>init()</code> 函数中定义标志和处理配置</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    cfgFile     <span class="type">string</span></span><br><span class="line">    projectBase <span class="type">string</span></span><br><span class="line">    userLicense <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initConfig</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> cfgFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="comment">// Use config file from the flag.</span></span><br><span class="line">        viper.SetConfigFile(cfgFile)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        hme, err := homedir.Dir()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="built_in">panic</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        viper.AddConfigPath(hme)</span><br><span class="line">        viper.SetConfigName(<span class="string">&quot;.cobra&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cobra.OnInitialize(initConfig)</span><br><span class="line"></span><br><span class="line">    rootCmd.PersistentFlags().StringVar(&amp;cfgFile, <span class="string">&quot;config&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;config file (default is $HOME/.cobra.yaml)&quot;</span>)</span><br><span class="line">    rootCmd.PersistentFlags().StringVarP(&amp;projectBase, <span class="string">&quot;projectbase&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;base project directory eg. github.com/spf13/&quot;</span>)</span><br><span class="line">    rootCmd.PersistentFlags().StringP(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;Author name for copyright attribution&quot;</span>)</span><br><span class="line">    rootCmd.PersistentFlags().StringVarP(&amp;userLicense, <span class="string">&quot;license&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Name of license for the project (can provide `licensetext` in config)&quot;</span>)</span><br><span class="line">    rootCmd.PersistentFlags().Bool(<span class="string">&quot;viper&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;Use Viper for configuration&quot;</span>)</span><br><span class="line"></span><br><span class="line">    _ = viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))</span><br><span class="line">    _ = viper.BindPFlag(<span class="string">&quot;projectbase&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;projectbase&quot;</span>))</span><br><span class="line">    _ = viper.BindPFlag(<span class="string">&quot;useViper&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;viper&quot;</span>))</span><br><span class="line">    viper.SetDefault(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;NAME HERE &lt;EMAIL ADDRESS&gt;&quot;</span>)</span><br><span class="line">    viper.SetDefault(<span class="string">&quot;license&quot;</span>, <span class="string">&quot;apache&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="main-go"><a href="#main-go" class="headerlink" title="main.go"></a>main.go</h3><blockquote>
<p>main.go 中的代码要尽量精简</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/zhongmingmao/cobra101/cmd&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="cmd-version-go"><a href="#cmd-version-go" class="headerlink" title="cmd&#x2F;version.go"></a>cmd&#x2F;version.go</h3><blockquote>
<p>通过 AddCommand 添加其它命令</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rootCmd.AddCommand(versionCmd)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionCmd = &amp;cobra.Command&#123;</span><br><span class="line">    Use:   <span class="string">&quot;version&quot;</span>,</span><br><span class="line">    Short: <span class="string">&quot;Print the version number of Hugo&quot;</span>,</span><br><span class="line">    Long:  <span class="string">`All software has versions. This is Hugo&#x27;s`</span>,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Hugo Static Site Generator v0.9 -- HEAD&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="compile-run"><a href="#compile-run" class="headerlink" title="compile &amp; run"></a>compile &amp; run</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ go build -v .</span><br><span class="line">github.com/spf13/cobra</span><br><span class="line">github.com/zhongmingmao/cobra101/cmd</span><br><span class="line">github.com/zhongmingmao/cobra101</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ./cobra101 -h</span><br><span class="line">A Fast and Flexible Static Site Generator built with </span><br><span class="line">  love by spf13 and friends in Go. </span><br><span class="line">  Complete documentation is available at http://hugo.spf13.com</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  hugo [flags]</span><br><span class="line">  hugo [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  completion  Generate the autocompletion script for the specified shell</span><br><span class="line">  help        Help about any command</span><br><span class="line">  version     Print the version number of Hugo</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -a, --author string         Author name for copyright attribution (default &quot;YOUR NAME&quot;)</span><br><span class="line">      --config string         config file (default is $HOME/.cobra.yaml)</span><br><span class="line">  -h, --help                  help for hugo</span><br><span class="line">  -l, --license licensetext   Name of license for the project (can provide licensetext in config)</span><br><span class="line">  -b, --projectbase string    base project directory eg. github.com/spf13/</span><br><span class="line">      --viper                 Use Viper for configuration (default true)</span><br><span class="line"></span><br><span class="line">Use &quot;hugo [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure>

<h2 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h2><h3 id="使用-Flag"><a href="#使用-Flag" class="headerlink" title="使用 Flag"></a>使用 Flag</h3><blockquote>
<p>Cobra + Pflag</p>
</blockquote>
<h4 id="持久化标志"><a href="#持久化标志" class="headerlink" title="持久化标志"></a>持久化标志</h4><blockquote>
<p>标志可用于其所分配的命令以及该命令下的每个<code>子命令</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, <span class="string">&quot;verbose&quot;</span>, <span class="string">&quot;v&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;verbose output&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="本地标志"><a href="#本地标志" class="headerlink" title="本地标志"></a>本地标志</h4><blockquote>
<p>本地标志仅能在其所绑定的命令上使用</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Source, <span class="string">&quot;source&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;Source directory to read from&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="将标志绑定到-Viper"><a href="#将标志绑定到-Viper" class="headerlink" title="将标志绑定到 Viper"></a>将标志绑定到 Viper</h4><blockquote>
<p>可以通过 <code>viper.Get()</code> 获取配置的值</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> author <span class="type">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  rootCmd.PersistentFlags().StringVar(&amp;author, <span class="string">&quot;author&quot;</span>, <span class="string">&quot;YOUR NAME&quot;</span>, <span class="string">&quot;Author name for copyright attribution&quot;</span>)</span><br><span class="line">  viper.BindPFlag(<span class="string">&quot;author&quot;</span>, rootCmd.PersistentFlags().Lookup(<span class="string">&quot;author&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="必选标志"><a href="#必选标志" class="headerlink" title="必选标志"></a>必选标志</h4><blockquote>
<p>默认情况下，标志是<code>必选</code>的 - 如果没有提供标志，Cobra 会报错</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Region, <span class="string">&quot;region&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;AWS region (required)&quot;</span>)</span><br><span class="line">rootCmd.MarkFlagRequired(<span class="string">&quot;region&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="验证-Argument"><a href="#验证-Argument" class="headerlink" title="验证 Argument"></a>验证 Argument</h3><blockquote>
<p>内置验证函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>Verification</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>NoArgs</td>
<td>如果存在任何 Argument，则报错</td>
</tr>
<tr>
<td>ArbitraryArgs</td>
<td>接受任何 Argument</td>
</tr>
<tr>
<td>OnlyValidArgs</td>
<td>如果有任何 Argument 不在 Command 的 <code>ValidArgs</code> 字段中，则报错</td>
</tr>
<tr>
<td>MinimumNArgs(int)</td>
<td>最少 N 个 Argument</td>
</tr>
<tr>
<td>MaximumNArgs(int)</td>
<td>最多 N 个 Argument</td>
</tr>
<tr>
<td>ExactArgs(int)</td>
<td>精确等于 N 个 Argument</td>
</tr>
<tr>
<td>ExactValidArgs(int)</td>
<td>ExactArgs(int) + OnlyValidArgs</td>
</tr>
<tr>
<td>RangeArgs(min, max)</td>
<td>Argument 个数介于 min 和 max 之间</td>
</tr>
</tbody></table>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &amp;cobra.Command&#123;</span><br><span class="line">    Short: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    Args:  cobra.MinimumNArgs(<span class="number">1</span>),</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;hello rust&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>自定义验证函数</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = &amp;cobra.Command&#123;</span><br><span class="line">    Short: <span class="string">&quot;hello&quot;</span>,</span><br><span class="line">    Args: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;hello rust&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h3><blockquote>
<p>如果子命令没有指定 <code>Persistent*Run</code> 函数，则子命令将会继承父命令的 <code>Persistent*Run</code> 函数，执行顺序如下</p>
</blockquote>
<ol>
<li>PersistentPreRun</li>
<li>PreRun</li>
<li><code>Run</code></li>
<li>PostRun</li>
<li>PersistentPostRun</li>
</ol>
<blockquote>
<p>父命令的 PreRun 只会在父命令运行时调用，运行子命令时是不会调用的</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2023/05/10/cloud-native-foundation-go-engineering-cli/">https://blog.zhongmingmao.top/2023/05/10/cloud-native-foundation-go-engineering-cli/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/cloud-native/">Cloud Native</a><a class="post-meta__tags" href="/tags/go/">Go</a><a class="post-meta__tags" href="/tags/go-engineering/">Go Engineering</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/11/cloud-native-foundation-k8s-helm-doc/" title="Kubernetes - Helm Doc"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cnf-1253868755.cos.ap-guangzhou.myqcloud.com/k8s/helm.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Kubernetes - Helm Doc</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/09/cloud-native-foundation-go-engineering-log/" title="Go Engineering - Log"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-log.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Go Engineering - Log</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/05/09/cloud-native-foundation-go-engineering-log/" title="Go Engineering - Log"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-log.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-09</div><div class="title">Go Engineering - Log</div></div></a></div><div><a href="/2023/05/08/cloud-native-foundation-go-engineering-err-code/" title="Go Engineering - Error Code"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-error-handling.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-08</div><div class="title">Go Engineering - Error Code</div></div></a></div><div><a href="/2023/05/07/cloud-native-foundation-go-engineering-doc/" title="Go Engineering - Doc"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-doc.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-07</div><div class="title">Go Engineering - Doc</div></div></a></div><div><a href="/2023/05/06/cloud-native-foundation-go-engineering-lint/" title="Go Engineering - Lint"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-lint.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-06</div><div class="title">Go Engineering - Lint</div></div></a></div><div><a href="/2023/05/05/cloud-native-foundation-go-engineering-makefile/" title="Go Engineering - Makefile"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-makefile.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-05</div><div class="title">Go Engineering - Makefile</div></div></a></div><div><a href="/2023/05/04/cloud-native-foundation-go-engineering-rpc-api/" title="Go Engineering - RPC API"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-engineering-1253868755.cos.ap-guangzhou.myqcloud.com/go-engineering-grpc-7924583.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-04</div><div class="title">Go Engineering - RPC API</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhongmingmao</div><div class="author-info__description">Focus on Infrastructure.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">590</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">183</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">75</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">应用框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pflag"><span class="toc-number">2.</span> <span class="toc-text">Pflag</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Flag"><span class="toc-number">2.1.</span> <span class="toc-text">Flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FlagSet"><span class="toc-number">2.2.</span> <span class="toc-text">FlagSet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NewFlagSet"><span class="toc-number">2.2.1.</span> <span class="toc-text">NewFlagSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CommandLine"><span class="toc-number">2.2.2.</span> <span class="toc-text">CommandLine</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage"><span class="toc-number">2.3.</span> <span class="toc-text">Usage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="toc-number">2.3.1.</span> <span class="toc-text">参数定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Get"><span class="toc-number">2.3.2.</span> <span class="toc-text">Get&lt;Type&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0"><span class="toc-number">2.3.3.</span> <span class="toc-text">非选项参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%8C%87%E5%AE%9A%E9%80%89%E9%A1%B9%E5%80%BC"><span class="toc-number">2.3.4.</span> <span class="toc-text">未指定选项值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%83%E7%94%A8%E6%A0%87%E5%BF%97"><span class="toc-number">2.3.5.</span> <span class="toc-text">弃用标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%83%E7%94%A8%E7%AE%80%E5%86%99"><span class="toc-number">2.3.6.</span> <span class="toc-text">弃用简写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E6%A0%87%E5%BF%97"><span class="toc-number">2.3.7.</span> <span class="toc-text">隐藏标志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Viper"><span class="toc-number">3.</span> <span class="toc-text">Viper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">3.1.</span> <span class="toc-text">优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">读入配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">3.2.1.</span> <span class="toc-text">设置默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.2.</span> <span class="toc-text">读取配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%92%8C%E9%87%8D%E6%96%B0%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.3.</span> <span class="toc-text">监听和重新读取配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%85%8D%E7%BD%AE%E5%80%BC"><span class="toc-number">3.2.4.</span> <span class="toc-text">设置配置值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">3.2.5.</span> <span class="toc-text">使用环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A0%87%E5%BF%97"><span class="toc-number">3.2.6.</span> <span class="toc-text">使用标志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">读取配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%B5%8C%E5%A5%97%E9%94%AE"><span class="toc-number">3.3.1.</span> <span class="toc-text">访问嵌套键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.3.2.</span> <span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">3.3.3.</span> <span class="toc-text">序列化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cobra"><span class="toc-number">4.</span> <span class="toc-text">Cobra</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cobra-%E5%BA%93"><span class="toc-number">4.1.</span> <span class="toc-text">Cobra 库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cmd-root-go"><span class="toc-number">4.1.1.</span> <span class="toc-text">cmd&#x2F;root.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-go"><span class="toc-number">4.1.2.</span> <span class="toc-text">main.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cmd-version-go"><span class="toc-number">4.1.3.</span> <span class="toc-text">cmd&#x2F;version.go</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#compile-run"><span class="toc-number">4.1.4.</span> <span class="toc-text">compile &amp; run</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">4.2.</span> <span class="toc-text">核心特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Flag"><span class="toc-number">4.2.1.</span> <span class="toc-text">使用 Flag</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%A0%87%E5%BF%97"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">持久化标志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%A0%87%E5%BF%97"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">本地标志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E6%A0%87%E5%BF%97%E7%BB%91%E5%AE%9A%E5%88%B0-Viper"><span class="toc-number">4.2.1.3.</span> <span class="toc-text">将标志绑定到 Viper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%85%E9%80%89%E6%A0%87%E5%BF%97"><span class="toc-number">4.2.1.4.</span> <span class="toc-text">必选标志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81-Argument"><span class="toc-number">4.2.2.</span> <span class="toc-text">验证 Argument</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hook"><span class="toc-number">4.2.3.</span> <span class="toc-text">Hook</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/20/bigdata-spark-streaming/" title="Spark - Streaming"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-spark-streaming.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spark - Streaming"/></a><div class="content"><a class="title" href="/2024/09/20/bigdata-spark-streaming/" title="Spark - Streaming">Spark - Streaming</a><time datetime="2024-09-19T16:06:25.000Z" title="Created 2024-09-20 00:06:25">2024-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/19/bigdata-spark-sql/" title="Spark - SQL"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-spark-sql.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spark - SQL"/></a><div class="content"><a class="title" href="/2024/09/19/bigdata-spark-sql/" title="Spark - SQL">Spark - SQL</a><time datetime="2024-09-18T16:06:25.000Z" title="Created 2024-09-19 00:06:25">2024-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/18/bigdata-spark-rdd/" title="Spark - RDD"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-spark-rdd.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spark - RDD"/></a><div class="content"><a class="title" href="/2024/09/18/bigdata-spark-rdd/" title="Spark - RDD">Spark - RDD</a><time datetime="2024-09-17T16:06:25.000Z" title="Created 2024-09-18 00:06:25">2024-09-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/17/bigdata-spark-overview/" title="Spark - Overview"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-spark.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spark - Overview"/></a><div class="content"><a class="title" href="/2024/09/17/bigdata-spark-overview/" title="Spark - Overview">Spark - Overview</a><time datetime="2024-09-16T16:06:25.000Z" title="Created 2024-09-17 00:06:25">2024-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/bigdata-kappa/" title="Big Data - Kappa"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://big-data-1253868755.cos.ap-guangzhou.myqcloud.com/bigdata-kappa.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Big Data - Kappa"/></a><div class="content"><a class="title" href="/2024/09/16/bigdata-kappa/" title="Big Data - Kappa">Big Data - Kappa</a><time datetime="2024-09-15T16:06:25.000Z" title="Created 2024-09-16 00:06:25">2024-09-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.pixabay.com/photo/2018/08/27/15/17/fishing-3635221_1280.png')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2024 By zhongmingmao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>