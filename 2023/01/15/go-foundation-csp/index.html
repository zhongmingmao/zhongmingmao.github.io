<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Go - CSP | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="并发 vs 并行单核单进程 内部仅有一条代码执行流，不存在竞态，无需考虑同步问题">
<meta property="og:type" content="article">
<meta property="og:title" content="Go - CSP">
<meta property="og:url" content="https://blog.zhongmingmao.top/2023/01/15/go-foundation-csp/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="并发 vs 并行单核单进程 内部仅有一条代码执行流，不存在竞态，无需考虑同步问题">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-csp.webp">
<meta property="article:published_time" content="2023-01-14T16:06:25.000Z">
<meta property="article:modified_time" content="2023-11-25T03:40:05.163Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="Cloud">
<meta property="article:tag" content="Native">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-csp.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go - CSP",
  "url": "https://blog.zhongmingmao.top/2023/01/15/go-foundation-csp/",
  "image": "https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-csp.webp",
  "datePublished": "2023-01-14T16:06:25.000Z",
  "dateModified": "2023-11-25T03:40:05.163Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2023/01/15/go-foundation-csp/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go - CSP',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-csp.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Go - CSP</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Go - CSP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-01-14T16:06:25.000Z" title="Created 2023-01-15 00:06:25">2023-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/go/">Go</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>5mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-11-25 11:40:05&quot;}" hidden></div><h1 id="并发-vs-并行"><a href="#并发-vs-并行" class="headerlink" title="并发 vs 并行"></a>并发 vs 并行</h1><h2 id="单核"><a href="#单核" class="headerlink" title="单核"></a>单核</h2><h3 id="单进程"><a href="#单进程" class="headerlink" title="单进程"></a>单进程</h3><blockquote>
<p>内部仅有一条代码执行流，不存在<code>竞态</code>，无需考虑<code>同步</code>问题</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231124082840830.png" alt="image-20231124082840830"></p>
<span id="more"></span>

<ol>
<li>每个<code>单进程应用</code>对应一个操作系统<code>进程</code></li>
<li>操作系统的多个进程按照<code>时间片</code>大小，被<code>轮流调度</code>到<code>单核</code>上执行</li>
<li>单核在<code>某个时刻</code>只能执行一个进程对应的程序代码，两个进程不存在<code>并行</code>执行的可能<ul>
<li><code>并行</code>（Parallelism）：在<code>同一时刻</code>，有<code>两个或两个以上</code>的进程的代码在处理器上执行</li>
<li>因此，<code>多处理器</code>或者<code>多核处理器</code>是并行执行的<code>必要条件</code></li>
</ul>
</li>
</ol>
<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><blockquote>
<p>应用结构清晰，维护性更好</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231124083731320.png" alt="image-20231124083731320"></p>
<ol>
<li>应用通过 <code>fork</code> 等系统调用创建多个子进程，共同实现应用的功能</li>
<li>App1 内部划分为多个模块，每个模块用一个<code>进程</code>来承载执行，每个模块都是一个单独的<code>执行流</code></li>
<li>在单核下，多进程依然无法并行执行，只能按照<code>时间片</code>被操作系统调度到单核上执行</li>
</ol>
<h2 id="多核"><a href="#多核" class="headerlink" title="多核"></a>多核</h2><h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231124084628590.png" alt="image-20231124084628590"></p>
<ol>
<li>进程并不适合用于承载采用了<code>并发设计</code>的应用的模块执行流<ul>
<li>进程是操作系统中<code>资源分配</code>的基本单位：应用代码+应用数据、操作系统资源（文件描述符、内存地址空间等）</li>
<li>因此，进程的创建、切换和撤销的<code>代价</code>都很大</li>
</ul>
</li>
<li>线程是运行于<code>进程上下文</code>中的<code>更轻量</code>的<code>执行流</code></li>
<li>随着处理器技术的发展，<code>多核处理器</code>成为了主流，让<code>真正的并行</code>成为了可能</li>
<li>基于线程的应用通常采用<code>单进程多线程</code>的模型<ul>
<li><code>一个应用</code>对应<code>一个进程</code>，应用通过<code>并发设计</code>将自身划分为多个<code>模块</code>，每个模块由一个<code>线程</code>独立承载执行</li>
<li>多个线程<code>共享</code>该进程内的资源，而线程作为<code>执行单元</code>可以被<code>独立调度</code>到<code>处理器</code>上执行<ul>
<li>线程的创建、切换和撤销的代价相对于进程要<code>小得多</code></li>
</ul>
</li>
<li>当应用的多个线程<code>同时</code>被调度到<code>不同</code>的处理器核上执行时，该应用是<code>并行</code>的</li>
</ul>
</li>
</ol>
<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><blockquote>
<p><code>并发</code>关乎<code>结构</code>、而<code>并行</code>关乎<code>执行</code></p>
</blockquote>
<ol>
<li>并发是应用<code>设计</code>和<code>实现</code>阶段要考虑的问题<ul>
<li>考虑如何将应用<code>划分</code>为多个相互配合、可独立执行的<code>模块</code></li>
<li>采用<code>并发设计</code>的程序并不一定是<code>并行执行</code>的，如仅有一个单核 CPU</li>
</ul>
</li>
<li>并发让并行<code>变得容易</code><ul>
<li>采用<code>并发设计</code>的应用可以将负载自然扩展到各个 CPU 核上，从而提升处理器的利用效率</li>
</ul>
</li>
</ol>
<blockquote>
<p><code>并发</code>是一种<code>能力</code>，让程序可以由若干代码片段<code>组合</code>而成，并且每个片段都是<code>独立运行</code>的</p>
</blockquote>
<blockquote>
<p><code>并行</code>的<code>必要条件</code>是具有<code>多个处理器</code>或者<code>多核处理器</code></p>
</blockquote>
<h1 id="原生线程"><a href="#原生线程" class="headerlink" title="原生线程"></a>原生线程</h1><ol>
<li>在传统编程语言（C++、Java）中，基于<code>多线程模型</code>的应用设计，是一种典型的<code>并发设计</code></li>
<li>但并非<code>面向并发</code>而生，多以<code>操作系统线程</code>作为承载分解后的代码片段的<code>执行单元</code>，由<code>操作系统执行调度</code></li>
</ol>
<blockquote>
<p>不足</p>
</blockquote>
<ol>
<li><code>复杂</code><ul>
<li>在 C++ 中，线程<code>创建容易退出难</code></li>
<li>并发执行单元间的<code>通信困难且易错</code><ul>
<li>一旦涉及到<code>共享内存</code>，会涉及到各种<code>锁互斥</code>机制，容易造成<code>死锁</code></li>
</ul>
</li>
<li>需要设定<code>线程栈大小</code></li>
</ul>
</li>
<li><code>难以规模化</code><ul>
<li>线程的使用代价虽然远小于进程，但依然<code>不能创建大量线程</code><ul>
<li>每个线程会<code>占用不小的资源</code>，且操作系统<code>调度切换</code>线程的代价也不小</li>
</ul>
</li>
<li>对于<code>网络服务</code>而言，只能基于少量线程做<code>IO 多路复用</code></li>
</ul>
</li>
</ol>
<h1 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h1><blockquote>
<p><code>goroutine</code> - 由 <code>Go Runtime</code> 负责调度的<code>轻量级用户线程</code>，为<code>并发设计</code>提供了<code>原生支持</code></p>
</blockquote>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><blockquote>
<p>占用资源少 + 在用户层调度 + 支持 CSP 模型</p>
</blockquote>
<ol>
<li>占用资源小，每个 goroutine 的<code>初始栈大小</code>仅为 <code>2K</code></li>
<li>由 <code>Go Runtime</code> 而非操作系统<code>调度</code>，goroutine 上下文切换在<code>用户层</code>完成，开销更小</li>
<li>在<code>语言层面</code>而不是通过标准库提供<ul>
<li>goroutine 由 go 关键字创建，<code>一退出</code>就会被<code>回收</code>或者<code>销毁</code>，开发体验更佳</li>
</ul>
</li>
<li>语言内置 <code>channel</code> 作为 goroutine 间的<code>通信原语</code>，为并发设计提供了强大支撑</li>
</ol>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><blockquote>
<p>无论是 Go Runtime 代码，还是用户层代码，都运行在 goroutine 中</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基于已有的具名函数</span></span><br><span class="line"><span class="keyword">go</span> fmt.Println(<span class="string">&quot;I am a goroutine&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于匿名函数/闭包</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">  c &lt;- a + b</span><br><span class="line">&#125;(<span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>net/http/server.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基于已有的具名方法</span></span><br><span class="line">c := srv.newConn(rw)</span><br><span class="line"><span class="keyword">go</span> c.serve(connCtx)</span><br></pre></td></tr></table></figure>

<ol>
<li>一个应用内部启动的所有 goroutine <code>共享</code>进程空间的资源</li>
<li>如果多个 goroutine 访问<code>同一块</code>内存数据，将会存在<code>竞争</code>，此时需要进行 goroutine 之间的<code>同步</code></li>
</ol>
<blockquote>
<p>退出 goroutine</p>
</blockquote>
<ol>
<li>goroutine 的<code>使用代价很低</code>，goroutine 的<code>执行函数返回</code>，意味着 goroutine 退出</li>
<li>如果 <code>main goroutine</code> 退出，意味着<code>整个应用</code>退出</li>
</ol>
<blockquote>
<p>goroutine 执行的<code>函数</code>或者<code>方法</code>即便有<code>返回值</code>，Go 也会<code>忽略</code>这些返回值</p>
</blockquote>
<h2 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h2><h3 id="传统"><a href="#传统" class="headerlink" title="传统"></a>传统</h3><ol>
<li>传统的编程语言（C++、Java 等）并非<code>面向并发</code>而生，所以面向并发的逻辑多是基于<code>操作系统线程</code><ul>
<li>并发的<code>执行单元</code>（线程）之间的通信，利用的也是<code>操作系统</code>提供的<code>线程</code>或者<code>进程</code>间通信的<code>原语</code><ul>
<li>如：共享内存、信号、管道、消息队列、套接字等</li>
<li>使用最广泛的是结合了<code>线程同步原语</code>（<code>锁</code>以及更为低级的<code>原子</code>操作）的<code>共享内存</code>方式</li>
</ul>
</li>
</ul>
</li>
<li>传统编程语言的<code>并发模型</code>是基于<code>共享内存</code>的 - <code>难用</code> + <code>易错</code></li>
</ol>
<h3 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h3><blockquote>
<p>Communicating sequential processes，CSP 模型旨在<code>简化并发程序的编写</code></p>
</blockquote>
<ol>
<li>输入输出为基本的编程原语，数据处理逻辑（<code>P</code>）调用输入原语获取数据，顺序处理数据，并将结果输出到输出原语</li>
<li>一个符合 CSP 模型的并发程序应该是一组通过<code>输入输出</code>原语<code>连接</code>起来的 <code>P 集合</code><ul>
<li>CSP 的<code>组合</code>思想与 Go 的设计哲学不谋而合</li>
</ul>
</li>
</ol>
<blockquote>
<p><code>sequential processes</code><br>P 为一个抽象概念，代表任何<code>顺序处理逻辑</code>的封装，获得输入数据，并生产可以被其它 P 消费的输出数据</p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231125103915703.png" alt="image-20231125103915703"></p>
<ol>
<li>P 不一定就是操作系统的进程或者线程，在 Go 中，<code>P</code> 就是 <code>goroutine</code></li>
<li>为了实现 CSP 并发模型中的<code>输入输出原语</code>，Go 引入了 goroutine 之间的通信原语 <code>channel</code></li>
<li>通过 channel 将 goroutine <code>组合</code>连接在一起</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spawn</span><span class="params">(f <span class="keyword">func</span>()</span></span> <span class="type">error</span>) &lt;-<span class="keyword">chan</span> <span class="type">error</span> &#123;</span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">error</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        c &lt;- f()</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := spawn(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">        time.Sleep((<span class="number">1</span> &lt;&lt; <span class="number">1</span>) * time.Second)</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(&lt;-c) <span class="comment">// timeout</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>CSP</code> 为 Go 支持的<code>主流</code>并发模型 - <code>推荐</code></li>
<li>Go 也支持<code>基于共享内存</code>的并发模型<ul>
<li>提供基本的<code>低级别同步原语</code>，如 sync 包中<code>互斥锁</code>、<code>条件变量</code>、<code>读写锁</code>、<code>原子操作</code>等</li>
</ul>
</li>
</ol>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2023/01/15/go-foundation-csp/">https://blog.zhongmingmao.top/2023/01/15/go-foundation-csp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/go/">Go</a><a class="post-meta__tags" href="/tags/cloud/">Cloud</a><a class="post-meta__tags" href="/tags/native/">Native</a></div><div class="post-share"><div class="social-share" data-image="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-csp.webp" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/01/16/go-foundation-gpm/" title="Go - GPM"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-concurrency.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Go - GPM</div></div><div class="info-2"><div class="info-item-1">CPU 一个 Go 程序对于操作系统来说只是一个用户层程序，操作系统眼中只有线程 goroutine 的调度由 Go Runtime 来完成：『公平』竞争『CPU』 Go Runtime 如何将众多的 goroutine 按照一定的算法调度到『CPU』上运行   goroutine 要竞争的『CPU』是操作系统线程 将 goroutine 按照一定算法放到不同的操作系统线程上执行      演进 G-M -&gt; G-P-M 不支持抢占 -&gt; 支持协作式抢占 -&gt; 支持基于信号的异步抢占  G-M 2012.03.28 Go 1.0   抽象 每个 goroutine 对应于运行时的一个抽象结构 G 被视作『CPU』的操作系统线程，则对应另一个抽象结构 M（machine）   工作 将 G 调度到 M 上去运行   GOMAXPROCS 调度器可见的最大 M 数     缺陷：限制 Go 并发程序的伸缩性，尤其对于有高吞吐或并行计算的服务程序   由于单一全局互斥锁和集中状态存储的存在，导致所有 goroutine 相关操作，都需要上锁 M 之间经常传递可运行的 goroutine，导致...</div></div></div></a><a class="pagination-related" href="/2023/01/14/go-foundation-pattern/" title="Go - Pattern"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231119210747019.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Go - Pattern</div></div><div class="info-2"><div class="info-item-1">前置原则 在实际真正需要的时候才对程序进行抽象   不要为了抽象而抽象 不要为了使用接口而使用接口   解耦或者抽象是有成本的   造成运行效率的下降 影响代码的可读性    组合 如果 C++ 和 Java 是关于类型层次结构和类型分类的语言，那么 Go 是关于组合的语言 组合是 Go 的重要设计哲学之一，而正交性则为组合哲学的落地提供了方便的条件  正交 在计算机技术中，正交性用于表示某种不相依赖性或者解耦性 编程语言中的语法元素和语言特性也存在正交的情况，通过将这些正交的特性组合起来，可以实现更为高级的特性   Go 在语言设计层面提供的正交的语法元素     Key Value    类型定义是正交的 无类型体系，没有父子类的概念   方法和类型是正交的 方法的本质只是将 receiver 参数作为第一个参数的函数而已   接口与其它语言元素是正交的 接口与它的实现者之间没有显式关联   方式 垂直组合 用在将多个类型通过类型嵌入的方式实现新类型的定义   传统的 OOP 编程语言大多是通过继承的方式构建出类型体系 Go 没有类型体系的概念，Go 通过类型的组合而不是继承让单一类型承载更多的功能...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/01/26/go-foundation-pointer/" title="Go - Pointer"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-pointer.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-26</div><div class="info-item-2">Go - Pointer</div></div><div class="info-2"><div class="info-item-1">指针类型 指针类型是依托某一类型而存在的 对于某一类型 T，以 T 为基类型的指针类型为 *T unsafe.Pointer 不需要基类型，用于表示一个通用指针类型 任何指针类型和 unsafe.Pointer 可以相互显式转换    1234567type T struct&#123;&#125;func main() &#123;    var p *T    var p1 = unsafe.Pointer(p) // 任意指针类型 -&gt; unsafe.Pointer    p = (*T)(p1)               // unsafe.Pointer -&gt; 任意指针类型&#125;     如果指针类型变量没有被显式赋予初值，默认值为 nil  123456type T struct&#123;&#125;func main() &#123;    var p *T    println(p == nil) // true&#125;   给指针类型变量赋值  123var a int = 13var p *int = &amp;a               // &amp...</div></div></div></a><a class="pagination-related" href="/2023/01/25/go-foundation-type-constraint/" title="Go - Type Constraint"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-constraint.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-25</div><div class="info-item-2">Go - Type Constraint</div></div><div class="info-2"><div class="info-item-1">限制 对泛型函数的类型参数以及泛型函数中的实现代码设置限制 泛型函数的调用者只能传递满足限制条件的类型实参 泛型函数内部也只能以类型参数允许的方式使用这些类型实参值   在 Go 中，使用类型参数约束来表达这种限制条件 函数普通参数在函数实现中可以表现出来的性质与可以参与的运算由参数类型限制 泛型函数的类型参数由约束来限制       内置约束any 最宽松的约束   无论是泛型函数还是泛型类型，其所有的类型参数声明中都必须显式包含约束 可以使用空接口类型来表达所有类型  123func foo[T interface&#123;&#125;](sl []T) &#123;&#125;func bar[T1 interface&#123;&#125;, T2 interface&#123;&#125;](t1 T1, t2 T2) &#123;&#125;   空接口类型的不足：使得声明变得冗长、复杂、语义不清  builtin/builtin.go12// any is an alias for interface&#123;&#125; and is equivalent to interface&...</div></div></div></a><a class="pagination-related" href="/2023/01/24/go-foundation-type-parameter/" title="Go - Type Parameter"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-generics-01.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-24</div><div class="info-item-2">Go - Type Parameter</div></div><div class="info-2"><div class="info-item-1">不支持   Feature Desc    泛型特化 编写一个泛型函数针对某个具体类型的特殊版本   元编程 编写在编译时执行的代码来生成在运行时执行的代码   操作符方法 不能将操作符视为方法并自定义其实现   变长类型参数      容器重复代码123456789101112131415161718192021222324252627func maxInt(sl []int) int &#123;    if len(sl) == 0 &#123;        panic(&quot;empty slice&quot;)    &#125;    max := sl[0]    for _, v := range sl[1:] &#123;        if v &gt; max &#123;            max = v        &#125;    &#125;    return max&#125;func maxString(sl []string) string &#123;    if len(sl) == 0 &#123;        panic(&quot;empt...</div></div></div></a><a class="pagination-related" href="/2023/01/23/go-foundation-gc/" title="Go - GC"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-gc-1533114.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-23</div><div class="info-item-2">Go - GC</div></div><div class="info-2"><div class="info-item-1">逃逸分析 在传统的不带 GC 的编程语言中，需要关注对象的分配位置，是分配在堆上还是栈上 Go 集成了逃逸分析功能来自动判断对象是应该分配在堆上还是栈上 只有在代码优化时，才需要研究具体的逃逸分析规则    escape.go123456package mainfunc main() &#123;    var m = make([]int, 10240)    println(m[0])&#125;    1234$  go build -gcflags=&#x27;-m&#x27; escape.go# command-line-arguments./escape.go:3:6: can inline main./escape.go:4:14: make([]int, 10240) escapes to heap   较大的对象会被放在堆上 如果对象分配在栈上，其管理成本比较低，只需要挪动栈顶寄存器就可以实现对象的分配和释放 如果对象分配在堆上，需要经过层层的内存申请过程   逃逸分析和垃圾回收结合，可以极大地降低开发者的心智负担，无需再担心内存的分配和释放  抽象成本 Rust - 零成本抽象  ...</div></div></div></a><a class="pagination-related" href="/2023/01/22/go-foundation-module-maintainer/" title="Go - Module Maintainer"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-module-02.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-22</div><div class="info-item-2">Go - Module Maintainer</div></div><div class="info-2"><div class="info-item-1">仓库布局单模块 首选：一个 repo 管理一个 module，一般情况下，module path 与仓库地址保持一致  go.mod123module github.com/zhongmingmao/srsmgo 1.18     如果对 repo 打 tag，该 tag 会成为 module 的版本号，对 repo 的版本管理即对 module 的版本管理  12345678$ tree.├── LICENSE├── go.mod├── pkg1│   └── pkg1.go└── pkg2    └── pkg2.go   该 module 对应的包导入路径为 github.com/zhongmingmao/srsm/pkg1 和 github.com/zhongmingmao/srsm/pkg2   如果 module 演进到了 2.x 版本，则包导入路径变更为 github.com/zhongmingmao/srsm/v2/pkg1  多模块1234567891011$ tree.├── LICENSE├── module1│   ├── go.mod│   └── pkg1│       └─...</div></div></div></a><a class="pagination-related" href="/2023/01/21/go-foundation-generics/" title="Go - Generics"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-generics.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-21</div><div class="info-item-2">Go - Generics</div></div><div class="info-2"><div class="info-item-1">泛型概念 将算法与类型解耦，实现算法更广泛的复用  实现方向 拖慢程序员 不实现泛型，不会引入复杂性 但需要程序员花费精力重复实现同逻辑但不同类型的函数或者方法   拖慢编译器 – C++&#x2F;Go 类似 C++ 的泛型实现方案，通过增加编译器的负担为每个类型实例生成一份单独的泛型函数的实现 产生大量的代码，且大部分是多余的   拖慢执行性能 – Java 类似 Java 的泛型实现方案，即伪泛型，通过隐式的装箱和拆箱操作消除类型的差异 虽然节省了空间，但代码执行效率低      泛型设计类型系统 静态强类型：C++&#x2F;Java&#x2F;Go；动态强类型：Python；动态弱类型：JavaScript   Go 为强类型语言，而 JavaScript 为弱类型语言，Go 的类型强度高于 JavaScript Go 和 Python 都有较高的类型强度，但类型检查的时机不同 Go 是在编译期，而 Python 则在运行期 如果类型检查是发生在运行期，则为动态类型语言   动态类型不仅仅表现在变量的类型可以更改，在 OOP 的编程语言中，类的定义也可以动态修改 动态类型的优点 动态类型有更好...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91-vs-%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.</span> <span class="toc-text">并发 vs 并行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E6%A0%B8"><span class="toc-number">1.1.</span> <span class="toc-text">单核</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">单进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">多进程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%A0%B8"><span class="toc-number">1.2.</span> <span class="toc-text">多核</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">多线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.</span> <span class="toc-text">对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E7%BA%BF%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">原生线程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#goroutine"><span class="toc-number">3.</span> <span class="toc-text">goroutine</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">3.1.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1"><span class="toc-number">3.3.</span> <span class="toc-text">通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F"><span class="toc-number">3.3.1.</span> <span class="toc-text">传统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSP"><span class="toc-number">3.3.2.</span> <span class="toc-text">CSP</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>