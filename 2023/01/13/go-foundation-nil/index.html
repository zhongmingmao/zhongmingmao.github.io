<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Go - nil | ByteCoding</title><meta name="author" content="zhongmingmao"><meta name="copyright" content="zhongmingmao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="接口类型静态特性 接口类型变量具有静态类型   在编译阶段保证灵活性的安全  12345func main() &amp;#123;    var err error &#x3D; 1 &#x2F;&#x2F; err 的静态类型为 error    &#x2F;&#x2F;	cannot use 1 (type int) as type error in assignment:    &#x2F;&#x2F;		int does not implement error (">
<meta property="og:type" content="article">
<meta property="og:title" content="Go - nil">
<meta property="og:url" content="https://blog.zhongmingmao.top/2023/01/13/go-foundation-nil/index.html">
<meta property="og:site_name" content="ByteCoding">
<meta property="og:description" content="接口类型静态特性 接口类型变量具有静态类型   在编译阶段保证灵活性的安全  12345func main() &amp;#123;    var err error &#x3D; 1 &#x2F;&#x2F; err 的静态类型为 error    &#x2F;&#x2F;	cannot use 1 (type int) as type error in assignment:    &#x2F;&#x2F;		int does not implement error (">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-nil.png">
<meta property="article:published_time" content="2023-01-12T16:06:25.000Z">
<meta property="article:modified_time" content="2023-11-19T13:01:54.732Z">
<meta property="article:author" content="zhongmingmao">
<meta property="article:tag" content="Go">
<meta property="article:tag" content="Cloud">
<meta property="article:tag" content="Native">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-nil.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Go - nil",
  "url": "https://blog.zhongmingmao.top/2023/01/13/go-foundation-nil/",
  "image": "https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-nil.png",
  "datePublished": "2023-01-12T16:06:25.000Z",
  "dateModified": "2023-11-19T13:01:54.732Z",
  "author": [
    {
      "@type": "Person",
      "name": "zhongmingmao",
      "url": "https://blog.zhongmingmao.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png"><link rel="canonical" href="https://blog.zhongmingmao.top/2023/01/13/go-foundation-nil/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":32,"languages":{"author":"Author: zhongmingmao","link":"Link: ","source":"Source: ByteCoding","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go - nil',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ByteCoding" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/url(https:/cdn.pixabay.com/photo/2021/07/20/03/39/fisherman-6479663_1280.jpg));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-nil.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ByteCoding</span></a><a class="nav-page-title" href="/"><span class="site-name">Go - nil</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Go - nil</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-01-12T16:06:25.000Z" title="Created 2023-01-13 00:06:25">2023-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/go/">Go</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>11mins</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:512,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2023-11-19 21:01:54&quot;}" hidden></div><h1 id="接口类型"><a href="#接口类型" class="headerlink" title="接口类型"></a>接口类型</h1><h2 id="静态特性"><a href="#静态特性" class="headerlink" title="静态特性"></a>静态特性</h2><blockquote>
<p><code>接口类型变量</code>具有<code>静态类型</code></p>
</blockquote>
<blockquote>
<p>在<code>编译</code>阶段保证灵活性的<code>安全</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> err <span class="type">error</span> = <span class="number">1</span> <span class="comment">// err 的静态类型为 error</span></span><br><span class="line">    <span class="comment">//	cannot use 1 (type int) as type error in assignment:</span></span><br><span class="line">    <span class="comment">//		int does not implement error (missing Error method)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>编译器会在<code>编译阶段</code>对所有<code>接口类型变量</code>的<code>赋值操作</code>进行<code>类型检查</code></li>
<li>如果右值的类型没有实现接口<code>方法集合</code>中的<code>所有方法</code>，会<code>编译报错</code></li>
</ol>
<span id="more"></span>

<h2 id="动态特性"><a href="#动态特性" class="headerlink" title="动态特性"></a>动态特性</h2><blockquote>
<p><code>接口类型变量</code>在<code>运行时</code>存储了右值的<code>真实类型信息</code>（即接口类型变量的<code>动态类型</code>）</p>
</blockquote>
<blockquote>
<p>拥有与<code>动态语言</code>相近的<code>灵活性</code></p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">err = errors.New(<span class="string">&quot;this is an error&quot;</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, err) <span class="comment">// *errors.errorString</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>errors/errors.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(text <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;errorString&#123;text&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Duck-Typing"><a href="#Duck-Typing" class="headerlink" title="Duck Typing"></a>Duck Typing</h1><ol>
<li>接口类型变量在<code>运行时</code>可以被赋值为不同的<code>动态类型变量</code><ul>
<li>每次赋值后，接口类型变量中<code>存储</code>的<code>动态类型信息</code>都会发生变化</li>
</ul>
</li>
<li>Duck Typing<ul>
<li>某类型所表现出来的<code>特性</code>，并非由其<code>基因</code>决定的，而是由类型所表现出来的<code>行为</code>决定的</li>
</ul>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">interface</span> &#123;</span><br><span class="line">    Run()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Man <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m Man)</span></span> Run() &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;man run&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Woman <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w Woman)</span></span> Run() &#123;</span><br><span class="line">    <span class="built_in">println</span>(<span class="string">&quot;woman run&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HumanRun</span><span class="params">(h Human)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 接口类型变量 h 中会存储的动态类型信息</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%T\n&quot;</span>, h)</span><br><span class="line">    h.Run() <span class="comment">// 根据实际的动态类型，调用对应的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// Man 和 Woman 都是 Duck Type，本身没啥联系，只是都实现了 Run 方法，满足 Human 接口</span></span><br><span class="line">    animals := []Human&#123;<span class="built_in">new</span>(Man), <span class="built_in">new</span>(Woman)&#125;</span><br><span class="line">    <span class="keyword">for</span> _, human := <span class="keyword">range</span> animals &#123;</span><br><span class="line">        HumanRun(human)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Output:</span></span><br><span class="line">    <span class="comment">//	*main.Man</span></span><br><span class="line">    <span class="comment">//	man run</span></span><br><span class="line">    <span class="comment">//	*main.Woman</span></span><br><span class="line">    <span class="comment">//	woman run</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="nil-nil"><a href="#nil-nil" class="headerlink" title="nil !&#x3D; nil"></a>nil !&#x3D; nil</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyError <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="type">error</span> <span class="comment">// type embedding</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ErrBad = MyError&#123;</span><br><span class="line">    <span class="type">error</span>: errors.New(<span class="string">&quot;bad thing happened&quot;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bad</span><span class="params">()</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnsError</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p *MyError = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">if</span> bad() &#123;</span><br><span class="line">        p = &amp;ErrBad</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// === 等价</span></span><br><span class="line">    <span class="keyword">var</span> e <span class="type">error</span>         <span class="comment">// 非空接口类型</span></span><br><span class="line">    e = (*MyError)(<span class="literal">nil</span>) <span class="comment">// 已经有 MyError 类型，tab 不为空，data 为空</span></span><br><span class="line">    <span class="built_in">println</span>(e)          <span class="comment">// (0x1003ba488,0x0)</span></span><br><span class="line">    <span class="comment">// ===</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    err := returnsError()</span><br><span class="line">    <span class="built_in">println</span>(err) <span class="comment">// (0x1003ba488,0x0) != (0x0,0x0)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;error occur: %+v\n&quot;</span>, err) <span class="comment">// error occur: &lt;nil&gt;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;no error&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="内部表示"><a href="#内部表示" class="headerlink" title="内部表示"></a>内部表示</h1><blockquote>
<p>在<code>运行时</code>层面，接口类型变量有<code>两种</code>内部表示（用于不同的接口类型变量）</p>
</blockquote>
<figure class="highlight go"><figcaption><span>runtime/runtime2.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123;</span><br><span class="line">    _type *_type</span><br><span class="line">    data  unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123;</span><br><span class="line">    tab  *itab</span><br><span class="line">    data unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>data ：指向当前赋值给该接口类型变量的<code>动态类型变量的值</code></p>
</blockquote>
<table>
<thead>
<tr>
<th>Runtime</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td><code>eface</code> - empty interface</td>
<td>用于表示没有方法的<code>空接口类型</code>变量，即 <code>interface&#123;&#125;</code> 类型变量</td>
</tr>
<tr>
<td><code>iface</code></td>
<td>用于表示拥有方法的接口类型变量</td>
</tr>
</tbody></table>
<ol>
<li><p><code>tab</code> 和 <code>_type</code> 可以统一看作<code>动态类型的信息</code></p>
</li>
<li><p>Go 中<code>每种类型</code>都会有<code>唯一</code>的 <code>_type</code> 信息，无论是<code>内置原生类型</code>，还是<code>自定义类型</code></p>
<ul>
<li><p>Go <code>运行时</code>会为程序内的<code>全部类型</code>建立<code>只读的共享 _type 信息表</code></p>
</li>
<li><p>拥有<code>相同动态类型</code>的同类接口变量的 <code>_type/tab</code> 信息是相同的</p>
</li>
</ul>
</li>
<li><p><code>data</code> 指向一个<code>动态分配</code>的内存空间（存储赋值给接口类型变量的<code>动态类型变量的值</code>）</p>
</li>
<li><p><code>未显式初始化</code>的<code>接口类型变量</code>的值为 <code>nil</code>，即对应的 <code>_type/tab</code> 和 <code>data</code> 都为 <code>nil</code></p>
</li>
</ol>
<h2 id="eface"><a href="#eface" class="headerlink" title="eface"></a>eface</h2><blockquote>
<p><code>_type</code>：接口类型变量的<code>动态类型的信息</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>runtime/type.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> _type <span class="keyword">struct</span> &#123;</span><br><span class="line">    size       <span class="type">uintptr</span></span><br><span class="line">    ptrdata    <span class="type">uintptr</span> <span class="comment">// size of memory prefix holding all pointers</span></span><br><span class="line">    hash       <span class="type">uint32</span></span><br><span class="line">    tflag      tflag</span><br><span class="line">    align      <span class="type">uint8</span></span><br><span class="line">    fieldAlign <span class="type">uint8</span></span><br><span class="line">    kind       <span class="type">uint8</span></span><br><span class="line">    <span class="comment">// function for comparing objects of this type</span></span><br><span class="line">    <span class="comment">// (ptr to object A, ptr to object B) -&gt; ==?</span></span><br><span class="line">    equal <span class="function"><span class="keyword">func</span><span class="params">(unsafe.Pointer, unsafe.Pointer)</span></span> <span class="type">bool</span></span><br><span class="line">    <span class="comment">// gcdata stores the GC type data for the garbage collector.</span></span><br><span class="line">    <span class="comment">// If the KindGCProg bit is set in kind, gcdata is a GC program.</span></span><br><span class="line">    <span class="comment">// Otherwise it is a ptrmask bitmap. See mbitmap.go for details.</span></span><br><span class="line">    gcdata    *<span class="type">byte</span></span><br><span class="line">    str       nameOff</span><br><span class="line">    ptrToThis typeOff</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">    n <span class="type">int</span></span><br><span class="line">    s <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t = T&#123;</span><br><span class="line">        n: <span class="number">17</span>,</span><br><span class="line">        s: <span class="string">&quot;hello, interface&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ei <span class="keyword">interface</span>&#123;&#125; = t <span class="comment">// Go 运行时使用 eface 结构表示 ei</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>_type</code> 指向<code>动态类型</code> T 的<code>类型信息</code>，而 <code>data</code> 指向<code>动态类型</code> T 的<code>实例</code></p>
</blockquote>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231119175801429.png" alt="image-20231119175801429"></p>
<h2 id="iface"><a href="#iface" class="headerlink" title="iface"></a>iface</h2><blockquote>
<p>除了需要存储<code>动态类型信息</code>，还需要存储<code>接口本身的信息</code>，因此需要一个额外的结构体 <code>itab</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>runtime/runtime2.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123;</span><br><span class="line">    inter *interfacetype</span><br><span class="line">    _type *_type</span><br><span class="line">    hash  <span class="type">uint32</span> <span class="comment">// copy of _type.hash. Used for type switches.</span></span><br><span class="line">    _     [<span class="number">4</span>]<span class="type">byte</span></span><br><span class="line">    fun   [<span class="number">1</span>]<span class="type">uintptr</span> <span class="comment">// variable sized. fun[0]==0 means _type does not implement inter.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>inter</code>：存储<code>接口类型自身的信息</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>runtime/type.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> interfacetype <span class="keyword">struct</span> &#123;</span><br><span class="line">    typ     _type	<span class="comment">// 类型信息</span></span><br><span class="line">    pkgpath name	<span class="comment">// 包路径名</span></span><br><span class="line">    mhdr    []imethod	<span class="comment">// 由接口方法集合组成的切片</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>_type</code>：存储该接口类型变量的<code>动态类型的信息</code>，与 eface 的语义一致</p>
</blockquote>
<blockquote>
<p><code>fun</code>：动态类型<code>已实现</code>的接口方法的<code>调用地址</code>数组</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NonEmptyInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">    M1()</span><br><span class="line">    M2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">    n <span class="type">int</span></span><br><span class="line">    s <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span></span> M1() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span></span> M2() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t = T&#123;</span><br><span class="line">        n: <span class="number">18</span>,</span><br><span class="line">        s: <span class="string">&quot;hello, interface&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i NonEmptyInterface = t <span class="comment">// Go 运行时使用 iface 结构表示 i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231119180642209.png" alt="image-20231119180642209"></p>
<h1 id="等值比较"><a href="#等值比较" class="headerlink" title="等值比较"></a>等值比较</h1><blockquote>
<p>判断两个接口类型变量是否相同</p>
</blockquote>
<ol>
<li>只需要判断 <code>_type/tab</code>  是否相同，以及 <code>data</code> 指针指向的内存空间所存储的<code>数据值</code>是否相同</li>
<li>并非 data 指针的值相同，类似与 Java 的 <code>equals</code></li>
</ol>
<blockquote>
<p>在<code>编译</code>阶段，编译器会根据要输出的<code>参数的类型</code>将 <code>println</code> 替换为<code>特定函数</code></p>
</blockquote>
<figure class="highlight go"><figcaption><span>runtime/print.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printeface</span><span class="params">(e eface)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(&quot;</span>, e._type, <span class="string">&quot;,&quot;</span>, e.data, <span class="string">&quot;)&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printiface</span><span class="params">(i iface)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(&quot;</span>, i.tab, <span class="string">&quot;,&quot;</span>, i.data, <span class="string">&quot;)&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil 接口变量</span></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; <span class="comment">// 空接口类型，采用 eface 结构</span></span><br><span class="line"><span class="keyword">var</span> err <span class="type">error</span>     <span class="comment">// 非空接口类型，采用 iface 结构</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println</span>(i)   <span class="comment">// (0x0,0x0)</span></span><br><span class="line"><span class="built_in">println</span>(err) <span class="comment">// (0x0,0x0)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println</span>(i == <span class="literal">nil</span>)   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">println</span>(err == <span class="literal">nil</span>) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">println</span>(i == err)   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h2><blockquote>
<p>只有 <code>_type</code> 和 <code>data</code> 所指<code>数据内容</code>一致的情况下，才是<code>相等</code>的</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> eif1 <span class="keyword">interface</span>&#123;&#125; <span class="comment">// 空接口类型</span></span><br><span class="line"><span class="keyword">var</span> eif2 <span class="keyword">interface</span>&#123;&#125; <span class="comment">// 空接口类型</span></span><br><span class="line"><span class="keyword">var</span> n, m <span class="type">int</span> = <span class="number">17</span>, <span class="number">18</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, &amp;n) <span class="comment">// 0x140000a6000</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, &amp;m) <span class="comment">// 0x140000a6008</span></span><br><span class="line"></span><br><span class="line">eif1 = n</span><br><span class="line">eif2 = m</span><br><span class="line"></span><br><span class="line"><span class="comment">// _type 相同，但 data 指向的值不同</span></span><br><span class="line"><span class="built_in">println</span>(eif1)         <span class="comment">// (0x1023a68e0,0x1400011ff30)</span></span><br><span class="line"><span class="built_in">println</span>(eif2)         <span class="comment">// (0x1023a68e0,0x1400011ff28)</span></span><br><span class="line"><span class="built_in">println</span>(eif1 == eif2) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// _type 相同，并且 data 指向的值也相同，即便 data 指针的值不同</span></span><br><span class="line">eif2 = <span class="number">17</span>             <span class="comment">// 17 默认为 int</span></span><br><span class="line"><span class="built_in">println</span>(eif1)         <span class="comment">// (0x1023a68e0,0x1400011ff30)</span></span><br><span class="line"><span class="built_in">println</span>(eif2)         <span class="comment">// (0x1023a68e0,0x10239ab58)</span></span><br><span class="line"><span class="built_in">println</span>(eif1 == eif2) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// _type 不同，即便 data 指向的值相同</span></span><br><span class="line">eif2 = <span class="type">int64</span>(<span class="number">17</span>)</span><br><span class="line"><span class="built_in">println</span>(eif1)         <span class="comment">// (0x1023a68e0,0x1400011ff30)</span></span><br><span class="line"><span class="built_in">println</span>(eif2)         <span class="comment">// (0x1023a69a0,0x10239ab58)</span></span><br><span class="line"><span class="built_in">println</span>(eif1 == eif2) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Go 在创建 eface 时一般会为 data <code>重新分配</code>内存空间<br>将动态类型变量的值<code>复制</code>到这块内存空间，并将 data 指针<code>指向</code>这块内存空间</p>
</blockquote>
<h2 id="非空接口"><a href="#非空接口" class="headerlink" title="非空接口"></a>非空接口</h2><blockquote>
<p>只有 <code>tab</code> 和 <code>data</code> 所指<code>数据内容</code>一致的情况下，才是<code>相等</code>的</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;bad things happened&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> err1 <span class="type">error</span> <span class="comment">// 非空接口类型</span></span><br><span class="line">    <span class="keyword">var</span> err2 <span class="type">error</span> <span class="comment">// 非空接口类型</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// tab 不为空，data 为空，不能与 nil(0x0,0x0) 相等</span></span><br><span class="line">    err1 = (*T)(<span class="literal">nil</span>)</span><br><span class="line">    <span class="built_in">println</span>(err1)        <span class="comment">// (0x104462478,0x0)</span></span><br><span class="line">    <span class="built_in">println</span>(err1 == <span class="literal">nil</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    err1 = T(<span class="number">5</span>)</span><br><span class="line">    err2 = T(<span class="number">6</span>)</span><br><span class="line">    <span class="built_in">println</span>(err1)         <span class="comment">// (0x1044624b8,0x1044396f8)</span></span><br><span class="line">    <span class="built_in">println</span>(err2)         <span class="comment">// (0x1044624b8,0x104439700)</span></span><br><span class="line">    <span class="built_in">println</span>(err1 == err2) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">    err2 = fmt.Errorf(<span class="string">&quot;%d\n&quot;</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="built_in">println</span>(err1)         <span class="comment">// (0x1044624b8,0x1044396f8)</span></span><br><span class="line">    <span class="built_in">println</span>(err2)         <span class="comment">// (0x1044623f8,0x14000110220)</span></span><br><span class="line">    <span class="built_in">println</span>(err1 == err2) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="空接口-vs-非空接口"><a href="#空接口-vs-非空接口" class="headerlink" title="空接口 vs 非空接口"></a>空接口 vs 非空接口</h2><blockquote>
<p> <code>eface._type</code> 和 <code>iface.itab._type</code> 进行比较</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> T <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span></span> Error() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;bad things happened&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> eif <span class="keyword">interface</span>&#123;&#125; = T(<span class="number">5</span>) <span class="comment">// 空接口类型变量</span></span><br><span class="line">    <span class="keyword">var</span> err <span class="type">error</span> = T(<span class="number">5</span>)       <span class="comment">// 非空接口类型变量</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(eif)        <span class="comment">// (0x104308e60,0x1042fe070)</span></span><br><span class="line">    <span class="built_in">println</span>(err)        <span class="comment">// (0x104316b38,0x1042fe070)</span></span><br><span class="line">    <span class="built_in">println</span>(eif == err) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    err = T(<span class="number">6</span>)</span><br><span class="line">    <span class="built_in">println</span>(eif)        <span class="comment">// (0x104308e60,0x1042fe070)</span></span><br><span class="line">    <span class="built_in">println</span>(err)        <span class="comment">// (0x104316b38,0x1042fe078)</span></span><br><span class="line">    <span class="built_in">println</span>(eif == err) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="boxing"><a href="#boxing" class="headerlink" title="boxing"></a>boxing</h1><blockquote>
<p>装箱：将一个<code>值类型</code>转换成<code>引用类型</code></p>
</blockquote>
<blockquote>
<p>Go <code>接口类型</code>的装箱：创建 <code>eface</code> 或者 <code>iface</code> 的过程</p>
</blockquote>
<figure class="highlight go"><figcaption><span>main.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> NonEmptyInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">    M1()</span><br><span class="line">    M2()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> T <span class="keyword">struct</span> &#123;</span><br><span class="line">    n <span class="type">int</span></span><br><span class="line">    s <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(T)</span></span> M1() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(T)</span></span> M2() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t = T&#123;</span><br><span class="line">        n: <span class="number">17</span>,</span><br><span class="line">        s: <span class="string">&quot;hello, interface&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ei <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    ei = t <span class="comment">// boxing</span></span><br><span class="line">    fmt.Println(ei)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i NonEmptyInterface</span><br><span class="line">    i = t <span class="comment">// boxing</span></span><br><span class="line">    fmt.Println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出<code>汇编</code>代码</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go tool compile -S main.go &gt; main.s</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ei &#x3D; t - <code>runtime.convT2E</code><br>将<code>任意类型</code>转换为一个 <code>eface</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0x001c 00028 (main.go:25)    MOVD	$17, R0</span><br><span class="line">0x0020 00032 (main.go:25)    MOVD	R0, &quot;&quot;..autotmp_15-24(SP)</span><br><span class="line">0x0024 00036 (main.go:25)    MOVD	$go.string.&quot;hello, interface&quot;(SB), R1</span><br><span class="line">0x002c 00044 (main.go:25)    MOVD	R1, &quot;&quot;..autotmp_15-16(SP)</span><br><span class="line">0x0030 00048 (main.go:25)    MOVD	$16, R2</span><br><span class="line">0x0034 00052 (main.go:25)    MOVD	R2, &quot;&quot;..autotmp_15-8(SP)</span><br><span class="line">0x0038 00056 (main.go:25)    MOVD	$type.&quot;&quot;.T(SB), R3</span><br><span class="line">0x0040 00064 (main.go:25)    MOVD	R3, 8(RSP)</span><br><span class="line">0x0044 00068 (main.go:25)    MOVD	$&quot;&quot;..autotmp_15-24(SP), R3</span><br><span class="line">0x0048 00072 (main.go:25)    MOVD	R3, 16(RSP)</span><br><span class="line">0x004c 00076 (main.go:25)    PCDATA	$1, ZR</span><br><span class="line">0x004c 00076 (main.go:25)    CALL	runtime.convT2E(SB)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>runtime/iface.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convT2E</span><span class="params">(t *_type, elem unsafe.Pointer)</span></span> (e eface) &#123;</span><br><span class="line">    <span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">        raceReadObjectPC(t, elem, getcallerpc(), funcPC(convT2E))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> msanenabled &#123;</span><br><span class="line">        msanread(elem, t.size)</span><br><span class="line">    &#125;</span><br><span class="line">    x := mallocgc(t.size, t, <span class="literal">true</span>)</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> We allocate a zeroed object only to overwrite it with actual data.</span></span><br><span class="line">    <span class="comment">// Figure out how to avoid zeroing. Also below in convT2Eslice, convT2I, convT2Islice.</span></span><br><span class="line">    typedmemmove(t, x, elem)</span><br><span class="line">    e._type = t</span><br><span class="line">    e.data = x</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>i &#x3D; t - <code>runtime.convT2I</code><br>将任意类型转换为一个 <code>iface</code></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x0098 00152 (main.go:29)    MOVD	$17, R0</span><br><span class="line">0x009c 00156 (main.go:29)    MOVD	R0, &quot;&quot;..autotmp_15-24(SP)</span><br><span class="line">0x00a0 00160 (main.go:29)    MOVD	$go.string.&quot;hello, interface&quot;(SB), R0</span><br><span class="line">0x00a8 00168 (main.go:29)    MOVD	R0, &quot;&quot;..autotmp_15-16(SP)</span><br><span class="line">0x00ac 00172 (main.go:29)    MOVD	$16, R0</span><br><span class="line">0x00b0 00176 (main.go:29)    MOVD	R0, &quot;&quot;..autotmp_15-8(SP)</span><br><span class="line">0x00b4 00180 (main.go:29)    MOVD	$go.itab.&quot;&quot;.T,&quot;&quot;.NonEmptyInterface(SB), R0</span><br><span class="line">0x00bc 00188 (main.go:29)    MOVD	R0, 8(RSP)</span><br><span class="line">0x00c0 00192 (main.go:29)    MOVD	$&quot;&quot;..autotmp_15-24(SP), R0</span><br><span class="line">0x00c4 00196 (main.go:29)    MOVD	R0, 16(RSP)</span><br><span class="line">0x00c8 00200 (main.go:29)    CALL	runtime.convT2I(SB)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><figcaption><span>runtime/iface.go</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convT2I</span><span class="params">(tab *itab, elem unsafe.Pointer)</span></span> (i iface) &#123;</span><br><span class="line">    t := tab._type</span><br><span class="line">    <span class="keyword">if</span> raceenabled &#123;</span><br><span class="line">        raceReadObjectPC(t, elem, getcallerpc(), funcPC(convT2I))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> msanenabled &#123;</span><br><span class="line">        msanread(elem, t.size)</span><br><span class="line">    &#125;</span><br><span class="line">    x := mallocgc(t.size, t, <span class="literal">true</span>)</span><br><span class="line">    typedmemmove(t, x, elem)</span><br><span class="line">    i.tab = tab</span><br><span class="line">    i.data = x</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现逻辑</p>
</blockquote>
<ol>
<li>根据传入的类型信息（<code>convT2E</code> 的 <code>_type</code> 和 <code>convT2I</code> 的 <code>tab._type</code>）分配一块内存空间<ul>
<li>类型信息依赖于<code>编译器</code>的工作，因此 Go 是一门<code>运行时</code>和<code>编译器</code>紧密协作的一门语言</li>
</ul>
</li>
<li>并将 <code>elem</code> 指向的数据<code>拷贝</code>到新分配的内存空间</li>
<li>最后传入的类型信息作为返回值结构体中的类型信息，返回值结构体中的 data 指向新分配的内存空间</li>
</ol>
<blockquote>
<p>经过装箱后，存放在新分配的内存空间中的数据与原变量<code>没有关系</code>了</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="type">int</span> = <span class="number">61</span></span><br><span class="line"><span class="keyword">var</span> ei <span class="keyword">interface</span>&#123;&#125; = n</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;%p\n&quot;</span>, &amp;n) <span class="comment">// 0x14000130008</span></span><br><span class="line"><span class="built_in">println</span>(ei)            <span class="comment">// (0x1045c28e0,0x1400012bf48)</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">62</span></span><br><span class="line"><span class="keyword">if</span> i, ok := ei.(<span class="type">int</span>); ok &#123;</span><br><span class="line">  <span class="built_in">println</span>(i) <span class="comment">// 61</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>装箱是一个有<code>性能损耗</code>的操作，Go 也在不断地对装箱操作进行<code>性能优化</code></p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top">zhongmingmao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.zhongmingmao.top/2023/01/13/go-foundation-nil/">https://blog.zhongmingmao.top/2023/01/13/go-foundation-nil/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/go/">Go</a><a class="post-meta__tags" href="/tags/cloud/">Cloud</a><a class="post-meta__tags" href="/tags/native/">Native</a></div><div class="post-share"><div class="social-share" data-image="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-nil.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/01/14/go-foundation-pattern/" title="Go - Pattern"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/image-20231119210747019.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Go - Pattern</div></div><div class="info-2"><div class="info-item-1">前置原则 在实际真正需要的时候才对程序进行抽象   不要为了抽象而抽象 不要为了使用接口而使用接口   解耦或者抽象是有成本的   造成运行效率的下降 影响代码的可读性    组合 如果 C++ 和 Java 是关于类型层次结构和类型分类的语言，那么 Go 是关于组合的语言 组合是 Go 的重要设计哲学之一，而正交性则为组合哲学的落地提供了方便的条件  正交 在计算机技术中，正交性用于表示某种不相依赖性或者解耦性 编程语言中的语法元素和语言特性也存在正交的情况，通过将这些正交的特性组合起来，可以实现更为高级的特性   Go 在语言设计层面提供的正交的语法元素     Key Value    类型定义是正交的 无类型体系，没有父子类的概念   方法和类型是正交的 方法的本质只是将 receiver 参数作为第一个参数的函数而已   接口与其它语言元素是正交的 接口与它的实现者之间没有显式关联   方式 垂直组合 用在将多个类型通过类型嵌入的方式实现新类型的定义   传统的 OOP 编程语言大多是通过继承的方式构建出类型体系 Go 没有类型体系的概念，Go 通过类型的组合而不是继承让单一类型承载更多的功能...</div></div></div></a><a class="pagination-related" href="/2023/01/12/go-foundation-interface/" title="Go - interface"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-interface.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Go - interface</div></div><div class="info-2"><div class="info-item-1">概述 接口类型是由 type 和 interface 关键字定义的一组方法集合（唯一确定所代表的接口）称为方法，而非函数，更多是从这个接口的实现者的角度考虑的  1234type MyInterface interface &#123;    M1(int) error    M2(io.Writer, ...string)&#125;     方法的参数列表中的形参名和返回值列表中的具名返回值，都不作为区分两个方法的凭据  12345// 等价type MyInterface interface &#123;    M1(a int) error    M2(w io.Writer, args ...string)&#125;   在接口类型中声明的方法必须是具名的，且方法名在这个接口类型的方法集合中是唯一的   类型嵌入：在 Go 1.14 开始，接口类型允许嵌入不同接口类型的方法集合存在交集但需要方法名和函数签名也要保持一致，否则会编译报错  123456789101112131415type I1 interface &#123;    M1()&#125;type I2 interface &...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/01/26/go-foundation-pointer/" title="Go - Pointer"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-pointer.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-26</div><div class="info-item-2">Go - Pointer</div></div><div class="info-2"><div class="info-item-1">指针类型 指针类型是依托某一类型而存在的 对于某一类型 T，以 T 为基类型的指针类型为 *T unsafe.Pointer 不需要基类型，用于表示一个通用指针类型 任何指针类型和 unsafe.Pointer 可以相互显式转换    1234567type T struct&#123;&#125;func main() &#123;    var p *T    var p1 = unsafe.Pointer(p) // 任意指针类型 -&gt; unsafe.Pointer    p = (*T)(p1)               // unsafe.Pointer -&gt; 任意指针类型&#125;     如果指针类型变量没有被显式赋予初值，默认值为 nil  123456type T struct&#123;&#125;func main() &#123;    var p *T    println(p == nil) // true&#125;   给指针类型变量赋值  123var a int = 13var p *int = &amp;a               // &amp...</div></div></div></a><a class="pagination-related" href="/2023/01/25/go-foundation-type-constraint/" title="Go - Type Constraint"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-constraint.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-25</div><div class="info-item-2">Go - Type Constraint</div></div><div class="info-2"><div class="info-item-1">限制 对泛型函数的类型参数以及泛型函数中的实现代码设置限制 泛型函数的调用者只能传递满足限制条件的类型实参 泛型函数内部也只能以类型参数允许的方式使用这些类型实参值   在 Go 中，使用类型参数约束来表达这种限制条件 函数普通参数在函数实现中可以表现出来的性质与可以参与的运算由参数类型限制 泛型函数的类型参数由约束来限制       内置约束any 最宽松的约束   无论是泛型函数还是泛型类型，其所有的类型参数声明中都必须显式包含约束 可以使用空接口类型来表达所有类型  123func foo[T interface&#123;&#125;](sl []T) &#123;&#125;func bar[T1 interface&#123;&#125;, T2 interface&#123;&#125;](t1 T1, t2 T2) &#123;&#125;   空接口类型的不足：使得声明变得冗长、复杂、语义不清  builtin/builtin.go12// any is an alias for interface&#123;&#125; and is equivalent to interface&...</div></div></div></a><a class="pagination-related" href="/2023/01/24/go-foundation-type-parameter/" title="Go - Type Parameter"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-generics-01.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-24</div><div class="info-item-2">Go - Type Parameter</div></div><div class="info-2"><div class="info-item-1">不支持   Feature Desc    泛型特化 编写一个泛型函数针对某个具体类型的特殊版本   元编程 编写在编译时执行的代码来生成在运行时执行的代码   操作符方法 不能将操作符视为方法并自定义其实现   变长类型参数      容器重复代码123456789101112131415161718192021222324252627func maxInt(sl []int) int &#123;    if len(sl) == 0 &#123;        panic(&quot;empty slice&quot;)    &#125;    max := sl[0]    for _, v := range sl[1:] &#123;        if v &gt; max &#123;            max = v        &#125;    &#125;    return max&#125;func maxString(sl []string) string &#123;    if len(sl) == 0 &#123;        panic(&quot;empt...</div></div></div></a><a class="pagination-related" href="/2023/01/23/go-foundation-gc/" title="Go - GC"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-gc-1533114.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-23</div><div class="info-item-2">Go - GC</div></div><div class="info-2"><div class="info-item-1">逃逸分析 在传统的不带 GC 的编程语言中，需要关注对象的分配位置，是分配在堆上还是栈上 Go 集成了逃逸分析功能来自动判断对象是应该分配在堆上还是栈上 只有在代码优化时，才需要研究具体的逃逸分析规则    escape.go123456package mainfunc main() &#123;    var m = make([]int, 10240)    println(m[0])&#125;    1234$  go build -gcflags=&#x27;-m&#x27; escape.go# command-line-arguments./escape.go:3:6: can inline main./escape.go:4:14: make([]int, 10240) escapes to heap   较大的对象会被放在堆上 如果对象分配在栈上，其管理成本比较低，只需要挪动栈顶寄存器就可以实现对象的分配和释放 如果对象分配在堆上，需要经过层层的内存申请过程   逃逸分析和垃圾回收结合，可以极大地降低开发者的心智负担，无需再担心内存的分配和释放  抽象成本 Rust - 零成本抽象  ...</div></div></div></a><a class="pagination-related" href="/2023/01/22/go-foundation-module-maintainer/" title="Go - Module Maintainer"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-module-02.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-22</div><div class="info-item-2">Go - Module Maintainer</div></div><div class="info-2"><div class="info-item-1">仓库布局单模块 首选：一个 repo 管理一个 module，一般情况下，module path 与仓库地址保持一致  go.mod123module github.com/zhongmingmao/srsmgo 1.18     如果对 repo 打 tag，该 tag 会成为 module 的版本号，对 repo 的版本管理即对 module 的版本管理  12345678$ tree.├── LICENSE├── go.mod├── pkg1│   └── pkg1.go└── pkg2    └── pkg2.go   该 module 对应的包导入路径为 github.com/zhongmingmao/srsm/pkg1 和 github.com/zhongmingmao/srsm/pkg2   如果 module 演进到了 2.x 版本，则包导入路径变更为 github.com/zhongmingmao/srsm/v2/pkg1  多模块1234567891011$ tree.├── LICENSE├── module1│   ├── go.mod│   └── pkg1│       └─...</div></div></div></a><a class="pagination-related" href="/2023/01/21/go-foundation-generics/" title="Go - Generics"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://go-1253868755.cos.ap-guangzhou.myqcloud.com/foundation/go-generics.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-21</div><div class="info-item-2">Go - Generics</div></div><div class="info-2"><div class="info-item-1">泛型概念 将算法与类型解耦，实现算法更广泛的复用  实现方向 拖慢程序员 不实现泛型，不会引入复杂性 但需要程序员花费精力重复实现同逻辑但不同类型的函数或者方法   拖慢编译器 – C++&#x2F;Go 类似 C++ 的泛型实现方案，通过增加编译器的负担为每个类型实例生成一份单独的泛型函数的实现 产生大量的代码，且大部分是多余的   拖慢执行性能 – Java 类似 Java 的泛型实现方案，即伪泛型，通过隐式的装箱和拆箱操作消除类型的差异 虽然节省了空间，但代码执行效率低      泛型设计类型系统 静态强类型：C++&#x2F;Java&#x2F;Go；动态强类型：Python；动态弱类型：JavaScript   Go 为强类型语言，而 JavaScript 为弱类型语言，Go 的类型强度高于 JavaScript Go 和 Python 都有较高的类型强度，但类型检查的时机不同 Go 是在编译期，而 Python 则在运行期 如果类型检查是发生在运行期，则为动态类型语言   动态类型不仅仅表现在变量的类型可以更改，在 OOP 的编程语言中，类的定义也可以动态修改 动态类型的优点 动态类型有更好...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zhongmingmao-1253868755.cos.ap-guangzhou.myqcloud.com/z.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">zhongmingmao</div><div class="author-info-description">Focus on Infrastructure.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">640</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">191</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">83</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="mailto:zhongmingmao0625@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Things are always unexpected!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">接口类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">静态特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%89%B9%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">动态特性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Duck-Typing"><span class="toc-number">2.</span> <span class="toc-text">Duck Typing</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nil-nil"><span class="toc-number">3.</span> <span class="toc-text">nil !&#x3D; nil</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text">内部表示</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#eface"><span class="toc-number">4.1.</span> <span class="toc-text">eface</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iface"><span class="toc-number">4.2.</span> <span class="toc-text">iface</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%89%E5%80%BC%E6%AF%94%E8%BE%83"><span class="toc-number">5.</span> <span class="toc-text">等值比较</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nil"><span class="toc-number">5.1.</span> <span class="toc-text">nil</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.2.</span> <span class="toc-text">空接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.3.</span> <span class="toc-text">非空接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E6%8E%A5%E5%8F%A3-vs-%E9%9D%9E%E7%A9%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">5.4.</span> <span class="toc-text">空接口 vs 非空接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#boxing"><span class="toc-number">6.</span> <span class="toc-text">boxing</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/prometheus.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - Prometheus Introduction"/></a><div class="content"><a class="title" href="/2025/01/22/cloud-native-observability-prometheus-introduction/" title="Observability - Prometheus Introduction">Observability - Prometheus Introduction</a><time datetime="2025-01-21T16:06:25.000Z" title="Created 2025-01-22 00:06:25">2025-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java-agent.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java Zero Code"/></a><div class="content"><a class="title" href="/2025/01/21/cloud-native-observability-opentelemetry-java-zero-code/" title="Observability - OpenTelemetry Java Zero Code">Observability - OpenTelemetry Java Zero Code</a><time datetime="2025-01-20T16:06:25.000Z" title="Created 2025-01-21 00:06:25">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://observability-1253868755.cos.ap-guangzhou.myqcloud.com/otel-java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Observability - OpenTelemetry Java"/></a><div class="content"><a class="title" href="/2025/01/20/cloud-native-observability-opentelemetry-java/" title="Observability - OpenTelemetry Java">Observability - OpenTelemetry Java</a><time datetime="2025-01-19T16:06:25.000Z" title="Created 2025-01-20 00:06:25">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/mcp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - MCP Overview"/></a><div class="content"><a class="title" href="/2025/01/19/ai-agent-overview-mcp/" title="AI Agent - MCP Overview">AI Agent - MCP Overview</a><time datetime="2025-01-18T16:06:25.000Z" title="Created 2025-01-19 00:06:25">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ai-agent-1253868755.cos.ap-guangzhou.myqcloud.com/ai-agent.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI Agent - Overview"/></a><div class="content"><a class="title" href="/2025/01/18/ai-agent-overview/" title="AI Agent - Overview">AI Agent - Overview</a><time datetime="2025-01-17T16:06:25.000Z" title="Created 2025-01-18 00:06:25">2025-01-18</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2015 - 2025 By zhongmingmao</span></div><div class="footer_custom_text">Life is like a box of chocolates. You can't know what you'll eat until you open it.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script></div></body></html>